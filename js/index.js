const funnelJson = {"funnelData":{"referenceId":"f35c0990-acf4-41f6-a9ad-114f0d30243d","campaign":"13","salt":"6e8b6900-5e66-11ef-be85-c3fe19e1d3a3","headTrackingCode":null,"bodyTrackingCode":null,"title":"TACKLIFE","addOns":[{"keyName":"Purchase_Event_FB","keyValue":"1"},{"keyName":"FB_ADV_TRACKING","keyValue":"false"},{"keyName":"SYGNAL_ADV_TRACKING","keyValue":"false"},{"keyName":"LISTRAK_CART_UPDATE","keyValue":"false"},{"keyName":"EXTERNAL_TRACK_REQ","keyValue":"false"},{"keyName":"SEND_USER_DATA","keyValue":"false"},{"keyName":"TRIPLE_WHALE_REQ","keyValue":"false"},{"keyName":"AD_BEACON_REQ","keyValue":"false"},{"keyName":"SEND_UNIQUE_TRANS_ID","keyValue":"false"}],"providers":[],"pages":[{"referenceId":"2355988a-139f-454d-8a9e-57c44ad4fd48","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Shopify Cart","urlSlug":null,"externalURL":null,"pageView":[{"referenceId":"ddba4a74-8c2e-43ad-a610-33f00792a490","templateTypeId":26,"pageType":26}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[],"isPageTitle":false,"pageProperties":[]},{"referenceId":"7ae02a40-8ada-4bc1-8a48-f92ebe161c14","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Thank You Page","urlSlug":null,"externalURL":null,"pageView":[{"referenceId":"fd2dfcca-28d0-4a56-8ba8-b8474ed557cd","templateTypeId":5,"pageType":5}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[],"isPageTitle":false,"pageProperties":[]},{"referenceId":"343fa1f0-2a3d-46de-be61-f1704f466397","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Checkout Page","urlSlug":"checkout","externalURL":null,"pageView":[{"referenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","templateTypeId":4,"pageType":4}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[],"isPageTitle":true,"pageProperties":[]},{"referenceId":"a755dea6-27eb-483f-b8ab-6a450fcc195d","splitReferenceId":null,"splitEnabled":false,"isMembershipRequired":false,"title":"Thank You Page","urlSlug":"thank_you","externalURL":null,"pageView":[{"referenceId":"623849cf-a36e-4bb9-a9ab-04d5af01a3ba","templateTypeId":5,"pageType":5}],"pageProducts":[],"pagebillingCycles":[],"pageVariants":[],"isPageTitle":true,"pageProperties":[]}],"disableBadge":false,"name":"TACKLIFE","whitelabelId":10,"affiliateId":null,"isMenuEnabled":false},"elements":[{"elementId":"fkt-button-12c-495-bab","href":null,"status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]},{"elementId":"fkt-link-1b0-38f-838","href":"https://tack-life.com/pages/refund-policy","status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]},{"elementId":"fkt-link-724-390-b09","href":"https://tack-life.com/pages/terms-of-service","status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]},{"elementId":"fkt-link-9a2-5bd-b30","href":"https://tack-life.com/pages/terms-of-service","status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]},{"elementId":"fkt-link-ae5-bbe-9c0","href":"","status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]},{"elementId":"fkt-link-af3-e94-859","href":null,"status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[{"targetPageReferenceId":"a755dea6-27eb-483f-b8ab-6a450fcc195d","targetPageViewReferenceId":"623849cf-a36e-4bb9-a9ab-04d5af01a3ba","products":[],"urlSlug":"thank_you","billingCycleIds":[],"isAllProducts":false,"previouslyPurchasedProducts":false,"customerType":0,"pageVariants":null,"countryStates":null,"customLinkViewEntities":[{"LinkId":319193,"Name":"CustomProductTags","Value":""}]}],"products":[]},{"elementId":"fkt-link-f05-abd-b42","href":"https://tack-life.com/pages/privacy-policy","status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]},{"elementId":"fkt-link-f63-88c-92f","href":"https://tack-life.com/pages/privacy-policy","status":null,"pageViewReferenceId":"02d4a576-21b5-48b9-a902-757924b9ac7d","linkDetails":[],"products":[]}],"isFunnel":true,"faviconUrl":"","logoUrl":""};const campaignJson = {"selectedCampaign":{"campaignId":13,"dateCreated":"2024-10-23 17:30:04","campaignName":"TACKLIFE  Shopify Campaign","campaignType":"ECOMMERCE","currency":"USD","requireQA":0,"listSalesEntry":0,"captureOnShipment":0,"requireTOS":0,"eSignature":0,"campaignTOS":null,"preauthOnly":0,"enableFraudPlugin":0,"insureShipId":0,"insureShipBillerId":null,"insureShipLoadBalancerId":null,"defaultShipProfileId":null,"externalCampaignId":null,"qaPercent":0,"campaignCategoryId":1,"pinlessDebitRoute":0,"prPercent":0,"codOrders":0,"blockPrepaid":0,"blockDebit":0,"blockMastercard":0,"blockVisa":0,"disableExternalPayments":0,"disableRecycleBilling":0,"singleTransaction":0,"bundleFulfillment":0,"blockChargebackBlacklist":0,"couponMax":1,"visible":1,"isLocked":0,"taxServiceId":null,"autoTax":0,"upsellWindow":null,"maxBundleHours":96,"reOrderDays":7,"currencySymbol":"$","currencyNumber":"840","defaultCouponCode":null,"hasAutomaticCoupons":0,"singleTxnGateways":["AcquiredV2","Apcopay","Authorize.netV2","Braintree","cardinity","Cardstream","Celerispay","CheckoutV2","Corvia","Dummy Gateway","Easytransac","Fluid Pay","Gala Technology","Gate2Payments","maverick","MiCamp","NMI","NomuPay","Oonex","Open Payment Platform","PayCom","Payfirma","Paynetworx","Payon Gateway","PayPal Commerce","PaysafeDirect","Paystrax","Poynt","Revolv3","StripeV2","Swipen","VantivV2","Whitelabel Payments","WithReach","WorldlineV2","Worldpay Corporate"],"shopPayUrl":"https://7dfbhp-0c.myshopify.com","products":[{"campaignProductId":5070,"productName":"TACKLIFE Mini Refrigerator","productType":"OFFER","price":"49.99","shippingPrice":"0.00","compareAtPrice":"124.99","billerId":2,"billerName":"Authorize.net","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"49.99","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":3603,"clientProductId":null,"baseProductName":"TACKLIFE Mini Refrigerator","productSku":null,"productDescription":null,"productCost":null,"shippingCost":null,"weight":"0.000","msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"campaignProductQty":null,"productCategoryId":"16","productCategoryName":"7dfbhp-0c.myshopify.com","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8763221180630","imageUrl":"https://cdn.shopify.com/s/files/1/0725/7364/9110/files/1_fridge.png","stockQuantity":"0","allowStorePickup":0,"productTags":null,"variantDetailId":3043,"externalVariantDetailId":"46247457456342","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"fixedBillingDay":null,"persistentRebillDay":0,"isPricePercent":0,"hasVariants":false,"variants":[],"memberPricing":[],"combinations":[]},{"campaignProductId":5546,"productName":"Fully Automatic Espresso Machine","productType":"OFFER","price":"99.99","shippingPrice":"0.00","compareAtPrice":"499.99","billerId":4,"billerName":"Authorize.netV2","showToAffiliates":1,"useOfferMid":0,"loadBalancerId":null,"loadBalancerName":null,"billingCycleType":"ONE_TIME","finalBillingCycle":null,"staggerFulfillments":0,"staggerIntervalCycles":null,"cycle1_price":"99.99","cycle1_shipPrice":"0.00","cycle1_isShippable":1,"cycle1_billDelay":null,"cycle2_price":null,"cycle2_shipPrice":null,"cycle2_isShippable":0,"cycle2_billDelay":null,"cycle3_price":null,"cycle3_shipPrice":null,"cycle3_isShippable":0,"cycle3_billDelay":null,"trialEnabled":0,"trialType":null,"trialAuthType":null,"trialBillerId":null,"trialBillerName":null,"trialLoadBalancerId":null,"trialLoadBalancerName":null,"minOrderPrice":"0.00","maxOrderPrice":null,"maxOrderQty":null,"productId":4079,"clientProductId":null,"baseProductName":"Fully Automatic Espresso Machine","productSku":null,"productDescription":null,"productCost":null,"shippingCost":null,"weight":"0.000","msrp":null,"isVariantBundle":0,"bundleProductQty":null,"productQty":1,"campaignProductQty":null,"productCategoryId":"16","productCategoryName":"7dfbhp-0c.myshopify.com","isProductCombo":null,"fulfillmentCycleType":"RECURRING","fulfillmentHouseId":null,"fulfillmentDelayHours":0,"clubPluginId":null,"externalProductId":"8772636442838","imageUrl":"https://cdn.shopify.com/s/files/1/0725/7364/9110/files/1726116027-n1.webp","stockQuantity":"0","allowStorePickup":0,"productTags":null,"variantDetailId":5258,"externalVariantDetailId":"46281476669654","isEditable":0,"storefront":1,"taxServiceId":null,"descriptor":null,"fixedBillingDay":null,"persistentRebillDay":0,"isPricePercent":0,"hasVariants":false,"variants":[],"memberPricing":[],"combinations":[]}],"countries":[{"countryName":"United States","countryCode":"US","continent":"NA","currencyCode":"USD","numericCode":"840"}],"currencies":[{"currencyCode":"USD","symbolAlign":"LEFT","includeShipping":0,"isComma":0,"decimals":2,"rounding":null,"currencyFee":"0.00","sendToGateway":1,"currencySymbol":"$","currencyNumber":"840","currencyName":"US Dollar"}],"taxes":[],"coupons":[],"shipProfiles":[],"zones":[],"storePickup":[],"blacklist":null}};/**FUNNELDATA**/"use strict";function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},"catch":function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}var providerUrl="https://live-api.checkoutchamp.com/providersApi/V1";var rootUrl="https://live-api.checkoutchamp.com/api/V1";var assetsUrl="https://assets.checkoutchamp.com";var ccIdMeClientId=" ";var message={membershipNoProductError:"There are no products listed on the Page. Please contact customer service.",cardUpdateSuccessMessage:"Card Details have been updated successfully",provideDetailsForAllFields:"Please provide valid card number, month, and year",membershipBillingCycleError:"Please provide valid billing cycle number"};var membershipState={active:"ACTIVE",inActive:"INACTIVE"};var defaultImagePlaceHolder="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3R5bGU9ImZpbGw6IHJnYmEoMCwwLDAsMC4xNSk7IHRyYW5zZm9ybTogc2NhbGUoMC43NSkiPgogICAgICAgIDxwYXRoIGQ9Ik04LjUgMTMuNWwyLjUgMyAzLjUtNC41IDQuNSA2SDVtMTYgMVY1YTIgMiAwIDAgMC0yLTJINWMtMS4xIDAtMiAuOS0yIDJ2MTRjMCAxLjEuOSAyIDIgMmgxNGMxLjEgMCAyLS45IDItMnoiPjwvcGF0aD4KICAgICAgPC9zdmc+";var rightPanelStyles=".sidepanel { height: 100%; visibility: hidden; width: 300px; position: fixed; z-index: 1; top: 0; right: 0; background-color: white; overflow-x: hidden; padding-top: 10px; } .sidepanel a { padding: 8px 8px 8px 32px; text-decoration: none; font-size: 25px; color: #818181; display: block; } .sidepanel a:hover { color: #f1f1f1; } .sidepanel .closebtn { position: absolute; top: 0; right: 25px; font-size: 36px; margin-left: 50px; } .openbtn { font-size: 20px; cursor: pointer; background-color: #111; color: white; padding: 10px 15px; border: none; } .openbtn:hover { background-color: #444; } .image-quantity-container{ margin: 0 auto; width: 100px; height: auto; position: relative; } .image-cart-header { width: 300px; height: 56px; float:left; margin-left:10%; max-height:100px; } @media (max-width:480px) { .image-quantity-container { margin: 0 auto; width: 55px; position: relative; } .image-cart-header { margin-left: 5%; width: 150px; height: 28px; margin-top: 3%; } } .close-panel{float:right;margin-right:8%;cursor:pointer} .sidepanel .cc-panel-view-cart, .sidepanel .cc-panel-checkout{font-size:16px;padding:5px 0;margin: 0px auto;}";var overlayStyles="\n    <style>\n    #overlayEffectDiv {\n        position: fixed;\n        display: none;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: rgba(0,0,0,0.5);\n        z-index: 100;\n        cursor: pointer;\n    }\n    #overlayEffectDiv div{\n        position: absolute;\n        top: 35%;\n        left: 50%;\n        font-size: 50px;\n        color: white;\n        transform: translate(-50%,-50%);\n        -ms-transform: translate(-50%,-50%);\n    }\n    #overlayEffectDiv div div{\n        top: 50%;\n    }\n    #importURLModalContent {\n        color: #ffffff;\n    }\n    </style>\n";var reachBadgeStyles="\n<style>\n.reach--disclosure {\n    background-color: #ced4da;\n    font-family: \"Inter\", sans-serif;\n    font-size: 10px;\n    line-height: 14px;\n    border-color: #626264;\n    color: #626264;\n    letter-spacing: 0em;\n}\n.reach--payment--banner {\n    padding-left: 0.875rem;\n    padding-right: 0.875rem;\n    padding-top: 0.625rem;\n    padding-bottom: 0.625rem;\n    border-radius: 0.5rem;\n    display: flex;\n    margin-top: 0.75rem;\n}\n.reach--logo {\n    /* background-image: url(&quot;https://st.rch.how/logos/reach-verified-logo-grey.svg&quot;); */\n    background-position: center;\n    background-repeat: no-repeat;\n    background-size: cover;\n    width: 100px;\n    height: 50px;\n    border-color: #626264;\n    display: flex;\n    position: relative; /* Add position relative to the parent */\n    padding-right: 2rem;\n}\n.reach--logo::after {\n    content: \"\";\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #626264; /* Adjust the color of the vertical bar */\n    border-right: 2px solid #626264; /* Border color and width */\n    margin-right: 0.875rem; /* Margin for spacing */\n}\n.reach--payment--banner-light {\n    color: #626264; \n    background-color: #ffffff;\n}\n.reach--inline-link {\n    text-decoration: underline;\n}\n</style>";var overlayHTML="<div id='overlayEffectDiv'>\n        <div>\n            Please wait.  Do not refresh your browser.\n            <br/><br/><br/>\n            <div class=\"fa fa-spinner fa-pulse fa-lg m-r-xs\" style=\"display: block; text-align: center;\"></div>\n        </div>\n    </div>\n";var productCardLoaderStyles="\n    <style>\n    .fk-product-loader-wrapper {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        margin: 10px 0;\n    }\n    .fk-product-loader {\n        border-radius: 50%;\n        height: 30px;\n        width: 30px;\n        border: 3px solid #8080802e;\n        border-top-color: #0f0f0f;\n        animation: fkRotateProductLoader 1s infinite linear;\n    }\n    @keyframes fkRotateProductLoader {\n        from {\n            transform: rotate3d(0, 0, 1, 0deg);\n        }\n        to {\n            transform: rotate3d(0, 0, 1, 360deg);\n        }\n    }\n    </style>\n";var productCardLoaderHTML="<div id=\"infiniteCardLoader\" class=\"fk-product-loader-wrapper\">\n            <div class=\"fk-product-loader\"></div>\n        </div>\n";var fflHTML="\n<div id=\"fflWrapper\" class=\"ffl-modal-overlay\">\n    <div class=\"ffl-modal-wrapper\">\n        <div class=\"ffl-modal-container\">\n            <div class=\"ffl-modal-header ffl-fields-spacing\">Products on this order must ship to a licensed firearm dealer</div>\n            <div class=\"ffl-fields-spacing\">\n                <div class=\"ffl-modal-field-label\">Search By</div>\n                <div>\n                    <select class=\"form-control\" id=\"fflOptions\" name=\"fflFieldOptions\" onchange=\"handleFFLSearchTypeChange()\">\n                        <option value=\"fflZipCode\">Zip Code</option>\n                        <option value=\"fflNumber\">FFL Number</option>\n                        <option value=\"fflName\">FFL Name</option>\n                    <select>\n                </div>\n            </div>\n            <div class=\"ffl-fields-spacing\" id=\"fflSearchFieldBlock\">\n                <div class=\"ffl-fields-spacing\" style=\"display: flex;\">\n                    <div class=\"ffl-input-field-side-spacing\">\n                        <div class=\"ffl-modal-field-label\">Zip Code</div>\n                        <div><input type=\"text\" class=\"form-control\" name=\"fflZipCode\"/></div>\n                    </div>\n                    <div class=\"ffl-input-field-side-spacing\">\n                        <div class=\"ffl-modal-field-label\">Radius (Miles) <span style=\"font-size:12px;\">Optional</span></div>\n                        <div><input type=\"text\" class=\"form-control\" oninput=\"fflRadiusChange()\" name=\"fflRadius\"/></div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"ffl-fields-spacing ffl-margin-botton-30\" style=\"position: relative;\">\n                <button id=\"ffl-search-btn\" class=\"form-control ffl-btn-styles\" onclick=\"searchFFL()\">SEARCH</button>\n                <div class=\"ffl-icon-container\" id=\"fflSelectLoader\">\n                    <i class=\"loader\"></i>\n                </div>\n            </div>\n            <div class=\"ffl-container\" id=\"fflContainer\">\n                <div class=\"ffl-fields-spacing\">\n                    <div class=\"ffl-modal-field-label\">Select a licensed firearm dealer</div>\n                    <div>\n                        <select class=\"form-control\" id=\"fflOptions\" name=\"fflOptions\" required>\n                            <option value=\"\">Select FFL</option>\n                        <select>\n                    </div>\n                </div>\n                <div class=\"ffl-fields-spacing\">\n                    <button class=\"form-control ffl-btn-styles\" onclick=\"addFFL()\">Done</button>\n                </div>\n            </div>\n        </div>\n        <div class=\"ffl-btn-styles ffl-modal-close\" onclick=\"hideFFLPopUp()\">\n            <i class=\"fa fa-times\"></i>\n        </div>\n    </div>\n</div>\n";var comboStyles="\n<style>\n.combo {\n    padding: 5px 15px;\n    background-color: rgb(244 245 249);\n    border-radius: 5px;\n    text-wrap: wrap;\n    text-align:left;\n}\n.combo-caret {\n    cursor: pointer;\n}\n.rotateComboCaret {\n    rotate: 90deg;\n}\n.combo hr{\n    margin: 0;\n}\n</style>";var accordionStyles="\n<style>\ntable.fold-table > tbody > tr.fk-custom-cart-view td, table.fold-table > tbody > tr.fk-custom-cart-view th {\n    cursor: pointer;\n}\ntable.fold-table > tbody > tr.fk-custom-cart-view.fk-custom-open td:nth-child(2) > i.fa.fa-caret-right.fk-caret-rotate {\n    color: #333;\n  }\ntable.fold-table > tbody > tr.fk-custom-cart-view.fk-custom-open td:nth-child(2) > i.fa.fa-caret-right {\n    -webkit-transform: rotate(90deg);\n    -ms-transform: rotate(90deg);\n    transform: rotate(90deg);\n    color: #333;\n}\ntable.fold-table > tbody > tr.fk-custom-cart-fold {\n  display: none;\n}\ntable.fold-table > tbody > tr.fk-custom-cart-fold.fk-custom-open {\n  display: table-row;\n}\n.fold-content > p {\n    margin: 6px;\n    color: #212529;\n}\n.fold-content > p > hr {\n    margin: 12px 0;\n    border-top: 1px solid #2125;\n}\n.fold-content {\n  padding: 0.5em;\n}\n.fk-custom-cart-fold > td {\n    background: #eee;\n}\n</style>";var fflStyles="\n<style>\n.ffl-btn-styles {\n    background-color: #0d6efd;\n    color: white;\n    margin: 15px 0;\n}\n.ffl-btn-styles:focus {\n    background-color: #0d6efd;\n    color: white;\n}\n.ffl-modal-overlay {\n    position: fixed;\n    background-color: #afacaca6;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 10001;\n    display: none;\n}\n.ffl-modal-wrapper {\n    width: 400px;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    -webkit-transform: translate(-50%, -50%);\n    -ms-transform: translate(-50%, -50%);\n    transform: translate(-50%, -50%);\n    z-index: 10002;\n}\n.ffl-modal-container {\n    height: auto;\n    background-color: white;\n    border-radius: 10px;\n    padding: 20px;\n    -webkit-box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;\n    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;\n}\n.ffl-modal-header {\n    font-size: 20px;\n    text-align: center;\n    line-height: 1.2;\n}\n.ffl-modal-field-label {\n    font-size: 16px;\n    margin: 5px 0;\n}\n.ffl-fields-spacing {\n    margin: 15px 0;\n}\n.ffl-modal-close {\n    position: absolute;\n    top: -10px;\n    right: -10px;\n    padding: 8px 10px;\n    cursor: pointer;\n    background-color: #0d6efd;\n    color: white;\n    border-radius: 50%;\n    margin: 0;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n}\n.ffl-margin-botton-30 {\n    margin-bottom: 30px;\n}\n.ffl-input-field-side-spacing {\n    margin-left: 5px;\n    margin-right: 5px;\n}\n.ffl-input-field-side-spacing:first-child {\n    margin-left: 0;\n}\n.ffl-input-field-side-spacing:last-child {\n    margin-right: 0;\n}\n.ffl-icon-container {\n    position: absolute;\n    right: 50%;\n    top: calc(50% - 10px);\n    display: none;\n    -webkit-transform: translateX(+50%);\n    -ms-transform: translateX(+50%);\n    transform: translateX(+50%);\n}\n.ffl-container {\n    display: none;\n}\n.loader {\n    position: relative;\n    height: 20px;\n    width: 20px;\n    display: inline-block;\n    -webkit-animation: around 5.4s infinite;\n    animation: around 5.4s infinite;\n}\n@-webkit-keyframes around {\n    0% {\n        -webkit-transform: rotate(0deg);\n        -ms-transform: rotate(0deg);\n        transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n        -ms-transform: rotate(360deg);\n        transform: rotate(360deg);\n    }\n}\n@keyframes around {\n    0% {\n        -webkit-transform: rotate(0deg);\n        -ms-transform: rotate(0deg);\n        transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n        -ms-transform: rotate(360deg);\n        transform: rotate(360deg);\n    }\n}\n.loader::after, .loader::before {\n    content: \"\";\n    background: transparent;\n    position: absolute;\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    border-width: 2px;\n    border-color: #333 #333 transparent transparent;\n    border-style: solid;\n    border-radius: 20px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    top: 0;\n    left: 0;\n    -webkit-animation: around 0.7s ease-in-out infinite;\n    animation: around 0.7s ease-in-out infinite;\n}\n.loader::after {\n    webkit-animation: around 0.7s ease-in-out 0.1s infinite;\n    animation: around 0.7s ease-in-out 0.1s infinite;\n    background: transparent;\n}\n@media screen and (max-width: 500px) {\n    .ffl-modal-wrapper {\n        width: 90%;\n    }\n}\n</style>\n";/*eslint-disable*/var stripeConstants={publishableKey:{name:"googlePayStripePublishableKey",paramName:"stripe:publishableKey",label:"Publishable Key",addOnName:"STRIPE_KEY",action:"STRIPE_KEY_UPDATE",tooltip:"Publishable Key received from Stripe"}};var gPayGatewayWithOtherFields=["stripe"];var gPayGatewayFieldsForOthers={stripe:[{// componentType: component[1],
args:{paramName:stripeConstants.publishableKey.paramName,addOnName:stripeConstants.publishableKey.addOnName}}]};var response=null;var membershipNoProductError=message.membershipNoProductError,cardUpdateSuccessMessage=message.cardUpdateSuccessMessage,provideDetailsForAllFields=message.provideDetailsForAllFields,membershipBillingCycleError=message.membershipBillingCycleError;var active=membershipState.active,inActive=membershipState.inActive;var cardRegex=/\d{12,16}/;var integerRegex=/\D/g;var alphabetsRegex=/[A-Z]/i;var cardDateRegex="(1[0-2]|0[1-9])";var cardNumberRegex="\\d{4}?[\\s.-]?\\d{4}?[\\s.-]?\\d{4}?[\\s.-]?\\d{4}";var dinerFormatRegex="\\d{4}?[\\s.-]?\\d{6}?[\\s.-]?\\d{4}";var amexFormatRegex="\\d{4}?[\\s.-]?\\d{6}?[\\s.-]?\\d{5}";var phoneNumberRegex="^(\\+\\d{1,2}\\s?)?1?\\-?\\.?\\s?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$";var commonPhoneNumberRegex=/[^0-9+-/()]/g;var breakTagRegex="/(<br/>|<br>|</br>)/g";var amexRegex=/^3[47]\d{0,13}$/;var dinersClubRegex=/^3(?:0[0-5]|[68]\d)\d{0,11}$/gm;var regularCCard=/^\d{0,16}$/;// Constants
//------------------------------------------
var ccProductSectionsOnPage=$(".fk-product-section").length;ccProductSectionsOnPage&&disableInteractions(null,true,true);var percentage="%";var zeroPercentage="0%";var allowedCardNetworks=["AMEX","DISCOVER","INTERAC","JCB","MASTERCARD","VISA"];var prepaidGateways=["SKRILL","CENTROBILL","QUICKPAY","CCBILL","WITHREACH_PAYPAL"];var pagBrasilGateways=["BOLETO","PIX"];var stripeAlternateGateways=["BANCONTACT","IDEAL","BLIK","SEPA_DEBIT","SOFORT","P24"];var multiPayRebillGateways=["AFTERPAY","SEZZLE","KLARNA","AFFIRM"];var allowedFraudPixelPages=[1,2,3,4,5,17,18,21,33,34];// const gPayGatewayFieldsForOthers = JSON.stringify(gPayGatewayFieldsForOthers);
// const gPayGatewayWithOtherFields = JSON.stringify(gPayGatewayWithOtherFields);
var todayDate=new Date;var todayDateLong=todayDate.getTime()+todayDate.getMilliseconds();var userRef=Math.floor(Math.random()*Math.random()*todayDateLong);var tokenType="MembershipBearer";var cookieData={};var scrollCardsSlotSize=30;var fkCheckboxAndRadioProductIdHashMap={};var checkoutChampWhiteLabelId="10";var ccUpsellPageFFLProducts={};var excludeInputs={"product":true,"shipProfileId":true,"fk-payment-option-toggler":true,"payment_method":true};var excludeClassName={"variant-radio":true};var commonErrorClass="ccError";/*
Fields supported to authenticate a card transaction.
PAN_ONLY: This authentication method is associated with payment cards stored on file with the user's Google Account. Returned payment data includes personal account number (PAN) with the expiration month and the expiration year.
CRYPTOGRAM_3DS: This authentication method is associated with cards stored as Android device tokens. Returned payment data includes a 3-D Secure (3DS) cryptogram generated on the device.
*/var allowedCardAuthMethods=["PAN_ONLY","CRYPTOGRAM_3DS"];var baseCardPaymentMethod={type:"CARD",/*Other options - 'PAYPAL - https://developer.paypal.com/docs/archive/checkout/how-to/googlepay-integration/ */parameters:{allowedAuthMethods:allowedCardAuthMethods,allowedCardNetworks:allowedCardNetworks,assuranceDetailsRequired:false}};var baseRequest={apiVersion:2,apiVersionMinor:0};var browserData={acceptHeader:"application/json",userAgent:navigator.userAgent,language:navigator.language,timezone:new Date().getTimezoneOffset().toString(),colorDepth:screen.colorDepth,screen:{height:screen.height.toString(),width:screen.width.toString()},javaScriptEnabled:true,javaEnabled:navigator.javaEnabled()};window.ccHandleIdmeRedirect&&ccHandleIdmeRedirect(pageData);var ccUrlParams=new URLSearchParams(getCurrentWindowLocation().search);var ship=["shipFirstName","shipLastName","shipAddress1","shipAddress2","shipCity","shipCountry","shipState","shipPostalCode","shipFullName"];var ccBillingFields=["firstName","lastName","address1","address2","city","country","state","postalCode","fullName"];var memberFields=["emailAddress","phoneNumber","address1","address2","city","state","country","postalCode"];var ccDynamicProductSection=document.querySelector(".cc-dynamic-product-section");var subscribeAndSave=document.getElementById("Subscribe");var dynamicOrderBump=document.getElementsByClassName("cc-dynamic-order-bump")[0];var spEnable=getAddOnKeyValue(findAddOn("SP_ENABLE"))==="true";var captchaTrigger=getAddOnKeyValue(findAddOn("RECAPT_TRIGGER"));var captchaSiteKey=getAddOnKeyValue(findAddOn("RECAPT_SITE_KEY"));var captchaAssessmentKey=getAddOnKeyValue(findAddOn("RECAPT_ASSESS_KEY"));var captchaProjectId=getAddOnKeyValue(findAddOn("RECAPT_PROJ_ID"));var captchaThresholdScore=getAddOnKeyValue(findAddOn("RECAPT_THRESHOLD"));var captchaType=getAddOnKeyValue(findAddOn("RECAPT_TYPE"));var captchaFailRedirect=getAddOnKeyValue(findAddOn("RECAPT_FAIL_URL"));var reachMerchantId=getAddOnKeyValue(findAddOn("REACH_MERCH_ID"));var reachLocale=getAddOnKeyValue(findAddOn("REACH_LOCALE"));var reachTheme=getAddOnKeyValue(findAddOn("REACH_THEME_VALUE"));var orderPurchaseEvent=getAddOnKeyValue(findAddOn("Purchase_Event_FB"))==="3";var sendUniqueId=getAddOnKeyValue(findAddOn("SEND_UNIQUE_TRANS_ID"));var btnClasses=["btnPayPal","btnPayPal2","klarnaButton","affirmButton","sezzleButton","afterpayButton","bancontactButton","idealButton","blikButton","sofortButton","p24Button","boletoButton","pixButton","sepaButton","shopPayButton","bitPayButton","btnGoogle1","btnGoogle2","gpay-button","btnAmazonLight","btnAmazonDark","btnAmazonGold","cod-button","btnApplePay","splitItButton","radomButton","trustlyButton","twintButton"];var removeBundleFromCart=[],ccMinPaginationSize=1;var ccPopupConfigData={ccdesktoppopupheight:0.75,ccdesktoppopupwidth:0.75,ccmobilepopupheight:0.75,ccmobilepopupwidth:0.75};var ccPaginationElementExists=$(".cc-pagination-bar").find(".cc-pagination-tab-container").find(".cc-pagination-tab").length;var ccStampedPluginId=getAddOnKeyValue(findAddOn("STAMPED_PLUGIN_ID")),ccSygnalPixelId=(getAddOnKeyValue(findAddOn("SYGNAL_PIXEL_ID"))||"").trim(),ccSygnalTrackingGateway=(getAddOnKeyValue(findAddOn("SYGNAL_GATEWAY"))||"").trim(),ccTrackSygnalEvents=ccSygnalPixelId&&ccSygnalTrackingGateway;var ccOpenPathId=getAddOnKeyValue(findAddOn("OPEN_PATH_ID")),ccOpenPathUser=getAddOnKeyValue(findAddOn("OPEN_PATH_USER"));var ccLoadingButtonsMap={};// CODE
// -------------------------------------------------
var cellFormat=[];var ccProductId;var variantSelectFlag=0;var checkedElement;setShoppingCartSpinner();var isVisited=true;var isVisitedOnScroll=true;var isVisitedOnLoad=true;var isStickyBar=true;var isVisitedStickyOnLoad=true;var captureLeadInterval;var ccIsVisitedOnScrollUp=true;var ccScrollOffset=0;var products=[];var fkCart={};var rebillCart={};var customCart={};var altValues=[];var orderId;var result=true;var surveySectionCount=1;var progressBar=[];var decrementSectionCount=0;var parentSection="";var cartProduct=[];var defaultCountryCode="US";var appliedCouponCode=[];var address1FieldAutComplete;var shipAddress1FieldAutComplete;var maskShellCssAdded=false;var lisTrakCapturedEmail="";var lisTrakCartUpdated=false;/*Google Pay fields starts*/var googlePaymentsClient=null;var googlePaymentDataRequest;var shippingCostIncluded=false;var shippingCostApplePayIncluded=false;var campaignBaseCurrencySymbol;var staticCurrencyValues=[];var fkMenuList=[];var fkConfiguredProductCol=null;var fkCollectionData=[];var fkProductCollection=[];var scrolledCardsCount=30;var fkCollectionSize=0;var fkCollectionLoader=false;var vatTaxRate=1;var globalOrderData;var isVatOnOrder;var isSubscribeOn=sessionStorage.getItem("isSubscribeOn")!==null?JSON.parse(sessionStorage.getItem("isSubscribeOn")):null;var ccSkipStaticCurrencyConversion=false,ccStopSPPopups=false;var ccCardBin=null,ccCardMonth=null,ccCardYear=null,ccCardCvv=null;var globalStoreDetails=[];var ccSavings=0,ccCompareAtTotal=0;var handleBundleEle=true;var phInputCode;var recommendationFlag;var ccMaxCollectionProducts=100,ccMaxCollectionProductsOnPage=100,ccMaxPaginationSize=1,ccCurrentPagePosition=1,ccCurrentPaginationArray=[],ccCurrentCollectonId;var ccCampaignProductsData;var prevOrderItems,glOrderItems,glDetailedOrderItems;var ccCheckExpressBtnsLoadStateVar,ccCheckExpressBtnsLoadStatePromise;if($(".cc-express-checkout").length){ccCheckExpressBtnsLoadStatePromise=new Promise(function(resolve){ccCheckExpressBtnsLoadStateVar=setInterval(function(){if(!document.body.classList.contains("dom-pending")){clearInterval(ccCheckExpressBtnsLoadStateVar);resolve();ccDisplayExpressCheckoutButtons()}},200)});setTimeout(function(){$(".cc-express-checkout").removeClass("cc-express-checkout")},5000)}$(".cc-show-av-popup").hide();if(document.cookie){var cookies=document.cookie.split(";");cookies.forEach(function(d){var cookieName=d.split("=")[0].trim();var cookieVal=d.split("=")[1].trim();if(cookieVal){cookieData[cookieName]=cookieVal}})}function ccSetDefaultExpressButtonsStatus(){var excludeBtns={"btnAmazonLight":true,"btnAmazonDark":true,"btnAmazonGold":true};if(!window.configureGooglePay){excludeBtns["btnGoogle1"]=true;excludeBtns["btnGoogle2"]=true}var btnArr=btnClasses&&btnClasses.length&&btnClasses.filter(function(item){return!excludeBtns[item]}).join(",.")||"";if(btnArr&&btnArr.length){var btns=$(".cc-express-checkout").find("."+btnArr);if(btns.length){btns.each(function(){var dataId=$(this).attr("data-id");if(dataId){ccLoadingButtonsMap[dataId]=false}})}else{ccCheckButtonsLoadingStatus()}}}function ccSetSpecificButtonLoadStatus(classIdentifier){if(classIdentifier&&ccCheckExpressBtnsLoadStatePromise){ccCheckExpressBtnsLoadStatePromise.then(function(){$(".cc-express-checkout").find(classIdentifier).each(function(){var dataId=$(this).attr("data-id"),src=ccGetButtonBackgroundUrl(dataId);dataId&&src&&ccSetButtonLoadStatus(src,dataId)})})}}function ccCheckButtonsLoadingStatus(){if(ccLoadingButtonsMap&&Object.keys(ccLoadingButtonsMap).length){for(var _i in ccLoadingButtonsMap){if(!ccLoadingButtonsMap[_i]){return}}}$(".cc-express-checkout").removeClass("cc-express-checkout")}function ccSetButtonLoadStatus(src,id,eventBased){function setLoadStatus(btnId){ccLoadingButtonsMap[btnId]=true;ccCheckButtonsLoadingStatus()}if(eventBased){setLoadStatus(id)}else{var image=new Image;image.addEventListener("load",function(){setLoadStatus(id)});image.addEventListener("error",function(){setLoadStatus(id)});image.src=src}}function ccGetButtonBackgroundUrl(dataId){if(dataId){var element=$("[data-id='"+dataId+"']").first();if(element.length){var src=element.css("background-image");if(src){src=src.split("(")[1];src=src&&src.split(")")[0];src=src&&src.trim();return src||""}}}return""}function ccDisplayExpressCheckoutButtons(){var excludeBtns={"btnAmazonLight":true,"btnAmazonDark":true,"btnAmazonGold":true,"btnPayPal":true,"btnPayPal2":true,"btnGoogle1":true,"btnGoogle2":true};var expressBtns=$(".cc-express-checkout");if(expressBtns.length){var btnArr=btnClasses&&btnClasses.length&&btnClasses.filter(function(item){return!excludeBtns[item]}).join(",.");if(btnArr&&btnArr.length){expressBtns.find("."+btnArr).each(function(){var dataId=$(this).attr("data-id");var src=ccGetButtonBackgroundUrl(dataId);if(src){ccSetButtonLoadStatus(src,dataId)}})}}}ccSetDefaultExpressButtonsStatus();var displayPricesApplyClosure=function displayPricesApplyClosure(){var timer;return function(){clearTimeout(timer);timer=setTimeout(function(){displayPricesApplyMethod()},100)}};var displayPricesApply=displayPricesApplyClosure();function ccLoadPaginationTabs(){try{var container=$(".cc-pagination-bar").find(".cc-pagination-tab-container"),containerLength=container.length;if(containerLength){ccMaxPaginationSize=Math.ceil(ccMaxCollectionProducts/ccMaxCollectionProductsOnPage);var paginationArray=[];if(ccMaxPaginationSize<=6){for(var _i2=1;_i2<=ccMaxPaginationSize;_i2++){paginationArray.push(_i2)}}else{if(ccCurrentPagePosition<=ccMaxPaginationSize/2){if(ccCurrentPagePosition===ccMinPaginationSize){paginationArray=[1,2,3,4,"...",ccMaxPaginationSize]}else{paginationArray=[ccCurrentPagePosition-1,ccCurrentPagePosition,ccCurrentPagePosition+1,ccCurrentPagePosition+2,"...",ccMaxPaginationSize];if(ccCurrentPaginationArray[2]===ccCurrentPagePosition&&ccCurrentPaginationArray[1]!=="..."){paginationArray=ccCurrentPaginationArray}}}else{if(ccCurrentPagePosition==ccMaxPaginationSize){paginationArray=[ccMinPaginationSize,"...",ccCurrentPagePosition-3,ccCurrentPagePosition-2,ccCurrentPagePosition-1,ccCurrentPagePosition]}else if(ccCurrentPaginationArray[4]===ccCurrentPagePosition){paginationArray=ccCurrentPaginationArray}else if(ccCurrentPagePosition==ccMaxPaginationSize-1){paginationArray=[ccMinPaginationSize,"...",ccCurrentPagePosition-2,ccCurrentPagePosition-1,ccCurrentPagePosition,ccMaxPaginationSize]}else{paginationArray=[ccMinPaginationSize,"...",ccCurrentPagePosition-1,ccCurrentPagePosition,ccCurrentPagePosition+1,ccCurrentPagePosition+2]}}}paginationArray=paginationArray||[1];ccCurrentPaginationArray=paginationArray;var _loop=function _loop(_i3){var tab=container[_i3]&&$(container[_i3]).find(".cc-pagination-tab").first();if(tab&&tab.length){$(container[_i3]).empty();$(".cc-pagination-tab-prev, .cc-pagination-tab-next").removeClass("cc-disabled-pagination-tab");paginationArray&&paginationArray.forEach(function(item){var page=item&&Number(item);var clonedTab=tab.clone(true);if(isNaN(page)){clonedTab.find(".cc-pagination-tab-number").html("...");clonedTab.addClass("cc-disabled-pagination-tab")}else if(ccCurrentPagePosition===ccMinPaginationSize&&page===ccMinPaginationSize){clonedTab.find(".cc-pagination-tab-number").html(ccMinPaginationSize);clonedTab.attr("onclick","ccPageTabClick("+ccMinPaginationSize+")");$(".cc-pagination-tab-prev").addClass("cc-disabled-pagination-tab");if(ccCurrentPagePosition===ccMaxPaginationSize)$(".cc-pagination-tab-next").addClass("cc-disabled-pagination-tab")}else if(ccCurrentPagePosition===ccMaxPaginationSize&&page===ccMaxPaginationSize){clonedTab.find(".cc-pagination-tab-number").html(ccMaxPaginationSize);clonedTab.attr("onclick","ccPageTabClick("+ccMaxPaginationSize+")");$(".cc-pagination-tab-next").addClass("cc-disabled-pagination-tab")}else{clonedTab.find(".cc-pagination-tab-number").html(page);clonedTab.attr("onclick","ccPageTabClick("+page+")")}if(ccCurrentPagePosition===page){clonedTab.addClass("cc-active-pagination-tab")}else{clonedTab.removeClass("cc-active-pagination-tab")}$(container[_i3]).append(clonedTab)});tab.remove()}};for(var _i3=0;_i3<containerLength;_i3++){_loop(_i3)}}}catch(err){console.log(err)}}function ccPageTabClick(pageNumber){try{ccCurrentPagePosition=Number(pageNumber)||1;invokeCollectionApi(ccCurrentCollectonId,true,false,ccMaxCollectionProductsOnPage,ccCurrentPagePosition)}catch(err){console.log(err)}}function ccPageNext(){try{ccCurrentPagePosition=ccCurrentPagePosition%ccMaxPaginationSize+1;invokeCollectionApi(ccCurrentCollectonId,true,false,ccMaxCollectionProductsOnPage,ccCurrentPagePosition)}catch(err){console.log(err)}}function ccPagePrev(){try{ccCurrentPagePosition=(ccCurrentPagePosition-1)%ccMaxPaginationSize;ccCurrentPagePosition=ccCurrentPagePosition===0?1:ccCurrentPagePosition;invokeCollectionApi(ccCurrentCollectonId,true,false,ccMaxCollectionProductsOnPage,ccCurrentPagePosition)}catch(err){console.log(err)}}function ccGetBuilderScreenSizeStats(){var width=window.innerWidth;if(width<=480){return{device:"mobilesize",defaultMaxProducts:30}}else if(width<=600){return{device:"largemobilesize",defaultMaxProducts:40}}else if(width<=768){return{device:"tabletsize",defaultMaxProducts:60}}else if(width<=992){return{device:"largetabletsize",defaultMaxProducts:80}}return{device:"desktopsize",defaultMaxProducts:100}}function ccGenerateRandomUUID(){var timestamp=new Date().getTime(),timestampHex=timestamp.toString(16);var randomHex=Array.from({length:32-timestampHex.length},function(){return Math.floor(Math.random()*16).toString(16)}).join("");return(timestampHex+randomHex).substring(0,32)}var ccVideoLogs=$("[data-video-logs]");var ccVSLKeyMap={86:false,83:false,76:false};if(ccVideoLogs.length){$(window).on("keydown",function(event){if(ccVSLKeyMap[event.keyCode]!==undefined){ccVSLKeyMap[event.keyCode]=true}if(event.shiftKey&&ccVSLKeyMap[86]&&ccVSLKeyMap[83]&&ccVSLKeyMap[76]){ccVSLKeyMap={86:false,83:false,76:false};ccVideoLogs.each(function(){try{var attrValue=$(this).attr("data-video-logs");attrValue&&attrValue.replace(/\s+/g,"").split(";").forEach(function(log){var id=log.split(":")[1];id&&$("#"+id).removeClass("fk-display-none-on-load")})}catch(err){console.log(err)}})}})}window.ccAdjustCarouselArrowDimensions&&window.ccAdjustCarouselArrowDimensions();$(".cc-cart-toggle").each(function(){try{var toggleElement=$(this);var hideOnLoad=toggleElement.attr("hideonload");var toggleTarget=toggleElement.closest(".cc-cart-wrapper").find(".cc-cart-toggle-target");if(hideOnLoad==="true"){toggleTarget.hide();toggleElement.find(".cc-cart-hidden-text").hide();toggleElement.find(".cc-cart-open-text").show()}else{toggleTarget.show();toggleElement.find(".cc-cart-hidden-text").show();toggleElement.find(".cc-cart-open-text").hide()}}catch(err){console.log(err)}});$(".cc-cart-toggle").on("click",function(event){try{var toggleElement=$(this);var toggleTarget=toggleElement.closest(".cc-cart-wrapper").find(".cc-cart-toggle-target");if(toggleTarget&&toggleTarget.length){if(toggleTarget.is(":hidden")){toggleTarget.show();toggleElement.find(".cc-cart-hidden-text").show();toggleElement.find(".cc-cart-open-text").hide()}else{toggleTarget.hide();toggleElement.find(".cc-cart-hidden-text").hide();toggleElement.find(".cc-cart-open-text").show()}}}catch(err){console.log(err)}});function ccRemoveEmptyKeysForPayload(obj){for(var key in obj){var val=obj[key];if(val===""||val===null||val===undefined){delete obj[key]}}return obj}function ccInitializeStamped(){if(![3,5,7].includes(pageData.pageTypeId)&&ccStampedPluginId){var ccStampedLoadScriptCallback=function ccStampedLoadScriptCallback(){if(window.StampedFn){StampedFn.init({apiKey:stampedPublicKey,storeUrl:stampedStoreHash});if(cookieData["access_token"]){StampedFn.initRewards({customerId:cookieData["stampedCustomerId"],customerEmail:cookieData["stampedCustomerEmail"],customerFirstName:cookieData["stampedCustomerFirstName"],customerLastName:cookieData["stampedCustomerLastName"],customerTags:cookieData["stampedCustomerTags"],totalOrders:Number(cookieData["stampedCustomerOrders"])||0,totalSpent:Number(cookieData["stampedCustomerSpent"])||0,isAcceptMarketing:cookieData["stampedCustomerAcceptMarketing"]==="true",authToken:cookieData["stampedCustomerToken"]})}else{StampedFn.initRewards({})}}};var ccStampedLoadScriptFail=function ccStampedLoadScriptFail(){console.log("Stamped script load failed")};var stampedPublicKey=getAddOnKeyValue(findAddOn("STAMPED_PUBLIC_KEY"));var stampedStoreHash=getAddOnKeyValue(findAddOn("STAMPED_STORE_HASH"));$("#stamped-rewards-init").remove();$("body").append("<div id='stamped-rewards-init' data-widget-type='full-page'></div>");loadScript("https://cdn1.stamped.io/files/widget.min.js",ccStampedLoadScriptCallback,null,"ccStampedScript",null,[{key:"async",value:true}],null,ccStampedLoadScriptFail)}}function ccGetTimeDifference(current,past){try{var utcx=Date.UTC(past.getFullYear(),past.getMonth(),past.getDate(),past.getHours(),past.getMinutes(),past.getSeconds());var utcy=Date.UTC(current.getFullYear(),current.getMonth(),current.getDate(),current.getHours(),current.getMinutes(),current.getSeconds());var yearSecs=1000*60*60*24*30*12,timeDiff=utcy-utcx,ago=" ago";var diff=0;if(diff=Math.floor(timeDiff/yearSecs)){return diff+" year"+(diff>1?"s":"")+ago}else if(diff=Math.floor(timeDiff/(yearSecs/12))){return diff+" month"+(diff>1?"s":"")+ago}else if(diff=Math.floor(timeDiff/(yearSecs/(12*30)))){return diff+" day"+(diff>1?"s":"")+ago}else if(diff=Math.floor(timeDiff/(yearSecs/(12*30*24)))){return diff+" hour"+(diff>1?"s":"")+ago}else if(diff=Math.floor(timeDiff/(yearSecs/(12*30*24*60)))){return diff+" min"+(diff>1?"s":"")+ago}}catch(err){err}return"Just Now"}function ccHideSocialProofPopup(){$(".cc-social-proof-container").hide()}function ccResetAddToCartButtonStyles(item){try{if(!item)return;var initBtnValue=item.getAttribute("data-text-value")||"Select";var btnSelectedText=item.getAttribute("selectedText")||"Selected";var btnSelectedTextColor=item.getAttribute("selectedTextColor")||"Selected";var initTextColor=$(item).attr("initTextColor"),initBgColor=$(item).attr("initBgColor");if(!initBgColor){var currentBgColor=$(item).css("background-color");$(item).attr("initBgColor",currentBgColor);initBgColor=currentBgColor}if(!initTextColor){var currentTextColor=$(item).css("color");$(item).attr("initTextColor",currentTextColor);initTextColor=currentTextColor}if(item.innerHTML===btnSelectedText){item.innerHTML=initBtnValue;initBgColor?item.style.setProperty("background-color",initBgColor,"important"):item.className="btn btn-primary";btnSelectedTextColor&&initTextColor?item.style.setProperty("color",initTextColor,"important"):null}}catch(err){err}}function ccHandleButtonStylesForRemovedProducts(productId){try{if(!productId)return;var _productData=productId.toString().split("."),campaignId=Number(_productData[0]),variantId=Number(_productData[1]);var query=campaignId&&"[offer='"+campaignId+"']";if(query){query+=variantId?"[variantvalue='"+variantId+"']":"[variantvalue='']";var buttons=$(":not(.fk-product-section)[action='addToCart']"+query+", :not(.fk-product-section)[action='addAndOpenCart']"+query);buttons.each(function(index,btn){ccResetAddToCartButtonStyles(btn)});var buttonSections=$("[action='addToCart'], [action='addAndOpenCart']").closest(".fk-product-section[value='"+campaignId+"']");buttonSections.each(function(index,item){var variantSectionOptions=$(item).find("select[name='variant1'], select[name='variant2'], select[name='variant3'], select[name='productVariant'], .variant-label1, .variant-label2, .variant-label3").length;var variantSelectionSection=variantId?variantSectionOptions:!variantSectionOptions;variantSelectionSection&&$(item).find("[action='addToCart'], [action='addAndOpenCart']").each(function(index,btn){ccResetAddToCartButtonStyles(btn)})})}}catch(err){err}}function ccTriggerSocialProofDebounce(){var funcTimeout=null,funcCountry=null,skipInitialDelay=false,orderDetails=[],maxOrdersLength=0,clearTimeoutInitial=null,clearTimeoutDisplay=null,clearTimeoutDelay=null;return function(country){clearTimeout(funcTimeout);funcTimeout=setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var spContainer,spContainerTitle,spContainerSubtitle,spDisplay,spDelay,spDelayAtStart,spName,spAddress,pastDate,params,_data,capitalize,ccHandleSPTitle,ccShowSocialProofPopup,index,currentIndex,title;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;spContainer=$(".cc-social-proof-container");if(!(spEnable&&spContainer.length)){_context.next=29;break}if(!(funcCountry===country)){_context.next=5;break}return _context.abrupt("return");case 5:clearTimeout(clearTimeoutInitial);clearTimeout(clearTimeoutDisplay);clearTimeout(clearTimeoutDelay);spContainerTitle=spContainer.find(".cc-social-proof-title");spContainerSubtitle=spContainer.find(".cc-social-proof-subtitle");funcCountry=country;ccStopSPPopups=true;spDisplay=getAddOnKeyValue(findAddOn("SP_DISPLAY"));spDisplay=(spDisplay?Number(spDisplay):3)*1000;spDelay=getAddOnKeyValue(findAddOn("SP_DELAY"));spDelay=(spDelay?Number(spDelay):3)*1000;spDelayAtStart=getAddOnKeyValue(findAddOn("SP_DELAY_ST"));spDelayAtStart=(spDelayAtStart?Number(spDelayAtStart):3)*1000;spName=getAddOnKeyValue(findAddOn("SP_NAME"));spAddress=getAddOnKeyValue(findAddOn("SP_ADD"));pastDate=new Date;pastDate.setHours(-168);params={campaignId:pageData.selectedCampaign.campaignId,orderStatus:"COMPLETE",limit:50,startDate:setDateFormat(pastDate,"MM/dd/yyyy"),endDate:setDateFormat(new Date,"MM/dd/yyyy"),isSocialProof:1,country:country};_context.next=25;return httpMethod("".concat(providerUrl,"/ClubMembership/OrderQueryByOrderId"),JSON.stringify(params));case 25:_data=_context.sent;orderDetails=_data&&_data.result==="SUCCESS"&&_data.message||[];maxOrdersLength=orderDetails.length;if(maxOrdersLength){capitalize=function capitalize(s){return s&&s[0].toUpperCase()+s.slice(1)||""};ccHandleSPTitle=function ccHandleSPTitle(index){var order=orderDetails[index],firstName=capitalize(order.firstName&&order.firstName.trim()),lastName=capitalize(order.lastName&&order.lastName.trim()),cityInfo=capitalize(order.city&&order.city.trim());var name="Someone",address="";switch(spName){case"1":name=firstName?firstName+(lastName?" "+lastName:""):lastName?lastName:"Someone";break;case"2":name=firstName||name;break;case"3":name=firstName?firstName[0]+"."+(lastName?" "+(lastName[0]+"."):""):lastName?lastName[0]+".":"Someone";break}var defAdd=capitalize(order.stateName&&order.stateName.trim())||address;switch(spAddress){case"1":address=cityInfo?cityInfo+(defAdd.length?", "+defAdd:""):defAdd;break;case"2":address=defAdd;break;case"3":address=cityInfo||address;break}return name+(address.length?" from "+address:"")+" recently purchased"};ccShowSocialProofPopup=function ccShowSocialProofPopup(index){spContainer.removeClass("animated fadeIn slow");spContainer.fadeOut(800,"linear",function(){$(this).hide()});if(!ccStopSPPopups){clearTimeoutDelay=setTimeout(function(){var currentIndex=index%maxOrdersLength,orderDate=new Date;try{var orderDateMinutes=orderDetails[currentIndex]&&orderDetails[currentIndex].createdTime;var _title=ccHandleSPTitle(currentIndex);spContainerTitle.html(_title);orderDate.setMinutes(orderDate.getMinutes()-(orderDateMinutes||1));spContainerSubtitle.html(ccGetTimeDifference(new Date,orderDate));spContainer.addClass("animated fadeIn slow");spContainer.show()}catch(err){err}clearTimeoutDisplay=setTimeout(function(){ccShowSocialProofPopup(currentIndex+1)},spDisplay)},spDelay)}};index=0;currentIndex=index%maxOrdersLength;title=ccHandleSPTitle(currentIndex);clearTimeoutInitial=setTimeout(function(){ccStopSPPopups=false;skipInitialDelay=true;ccShowSocialProofPopup(currentIndex)},skipInitialDelay?0:spDelayAtStart)}else{spContainer.removeClass("animated fadeIn slow");spContainer.fadeOut(800,"linear",function(){$(this).hide()})}case 29:_context.next=34;break;case 31:_context.prev=31;_context.t0=_context["catch"](0);_context.t0;case 34:case"end":return _context.stop()}},_callee,null,[[0,31]])})),500)}}var ccTriggerSocialProof=ccTriggerSocialProofDebounce();function ccInitializeSocialProof(){try{if(spEnable){var spOffsetX=getAddOnKeyValue(findAddOn("SP_OFFX"));var spOffsetY=getAddOnKeyValue(findAddOn("SP_OFFY"));var spWidth=getAddOnKeyValue(findAddOn("SP_WIDTH"));var spTitleFontFamily=getAddOnKeyValue(findAddOn("SP_TITLE_FF"));var spSubTitleFontFamily=getAddOnKeyValue(findAddOn("SP_STITLE_FF"));var desktopPlacement;switch(getAddOnKeyValue(findAddOn("SP_DESK_PLA"))){case"1":desktopPlacement="bottom:"+spOffsetY+"px;left:"+spOffsetX+"px;";break;case"2":desktopPlacement="bottom:"+spOffsetY+"px;right:"+spOffsetX+"px;";break;case"3":desktopPlacement="top:"+spOffsetX+"px;left:"+spOffsetY+"px;";break;default:desktopPlacement="top:"+spOffsetX+"px;right:"+spOffsetY+"px;"}var titleStyle=".cc-social-proof-title{color:"+getAddOnKeyValue(findAddOn("SP_TITLE_CO"))+";font-size:"+getAddOnKeyValue(findAddOn("SP_TITLE_FS"))+"px;font-weight:"+getAddOnKeyValue(findAddOn("SP_TITLE_FW"))+";font-family:"+(spTitleFontFamily.length?spTitleFontFamily:"inherit")+";}";var subTitleStyle=".cc-social-proof-subtitle{color:"+getAddOnKeyValue(findAddOn("SP_STITLE_CO"))+";font-size:"+getAddOnKeyValue(findAddOn("SP_STITLE_FS"))+"px;font-weight:"+getAddOnKeyValue(findAddOn("SP_STITLE_FW"))+";font-family:"+(spSubTitleFontFamily.length?spSubTitleFontFamily:"inherit")+";}";var mobilePlacement=getAddOnKeyValue(findAddOn("SP_MOB_PLA"))==="1"?"bottom:10px;top:unset;":"top:10px;";var contentAlignment="text-align:"+getAddOnKeyValue(findAddOn("SP_CON_ALIGN"))+";";var structure="<div class='cc-social-proof-container animated fadeIn slow'><div class='cc-social-proof-flex'><div><div class='cc-social-proof-title'></div><div class='cc-social-proof-subtitle'></div></div><div><div class='cc-social-proof-close' onclick='ccHideSocialProofPopup();ccStopSPPopups=true;'>&times;</div></div></div>";var structureCss="<style type='text/css'>.cc-social-proof-flex{display:flex;justify-content:space-between;}.cc-social-proof-container{display:none;box-shadow:0 0 20px #00000026;-webkit-box-shadow:0 0 20px 0 rgba(0,0,0,.15);-moz-box-shadow:0 0 20px 0 rgba(0,0,0,.15);position:fixed;z-index:100;padding:10px 10px 10px 10px;"+desktopPlacement+contentAlignment+"background-color:"+getAddOnKeyValue(findAddOn("SP_BG_CO"))+";border-radius:"+getAddOnKeyValue(findAddOn("SP_BR"))+"px;width:"+(spWidth==="0"?"auto":spWidth+"px")+";"+"}@media screen and (max-width: 600px){.cc-social-proof-container{right:unset;left:unset;margin:10px;width:-webkit-fill-available;width:-moz-available;width:fill-available;height:fit-content;"+mobilePlacement+"}}.cc-social-proof-close{font-size:22px;cursor:pointer;position:relative;top:0;color:#858585;right:0;line-height:1.5rem;font-family:none;font-weight:bold;padding:0 0 0 5px;}.cc-social-proof-title,.cc-social-proof-subtitle{margin:5px;line-height:1.5rem;}"+titleStyle+subTitleStyle+"</style>";$("body").append(structureCss);$("body").append(structure)}}catch(err){err}}function ccGetTrackingDetails(){var orderData=sessionStorage.getItem("orderData");var params={};var inputs=[].concat(ship,ccBillingFields,["emailAddress","phoneNumber","gender","dob"]);orderData=orderData?JSON.parse(orderData):{};if([3,5].includes(pageData&&pageData.pageTypeId)||["COMPLETE","PENDING","COD_PENDING"].includes(orderData.orderStatus)){inputs.forEach(function(name){params[name]=orderData[name]});params["couponCode"]=orderData["couponCode"];params["currencyCode"]=orderData["currencyCode"]}else{var ccGetTrackingInputValue=function ccGetTrackingInputValue(name,urlParamsObj,orderData){return $("[name='"+name+"']").first().val()||urlParamsObj&&urlParamsObj.get(name)||orderData&&orderData[name]};var ccUpdateNameParams=function ccUpdateNameParams(name,firstNameType,lastNameType,obj){var fullName=name.trim(),pos=fullName.indexOf(" ");obj[firstNameType]=pos>-1?fullName.substring(0,pos):fullName;obj[lastNameType]=pos>-1?fullName.substring(pos+1):null};params["couponCode"]=appliedCouponCode&&appliedCouponCode.length>0?appliedCouponCode.toString():null;params["currencyCode"]=returnCurrencyCode()||pageData.selectedCampaign.currency;inputs.forEach(function(name){params[name]=ccGetTrackingInputValue(name,ccUrlParams,orderData)});params.country=params.country||defaultCountryCode;params.shipCountry=params.shipCountry||defaultCountryCode;params.fullName&&!params.firstName&&ccUpdateNameParams(params.fullName,"firstName","lastName",params);params.shipFullName&&!params.shipFirstName&&ccUpdateNameParams(params.shipFullName,"shipFirstName","shipLastName",params)}delete params["fullName"];delete params["shipFullName"];return params}function ccTrackAddToCartEvent(productDetails){try{var campaignProductId=productDetails&&productDetails.campaignProductId;if(campaignProductId){var params=ccGetTrackingDetails();params["eventType"]="eventAddToCart";params["product1_id"]=campaignProductId;params["product1_qty"]=productDetails.quantity;var variantId=productDetails.variantDetailId;if(variantId)params["variant1_id"]=productDetails.variantDetailId;httpMethod("".concat(providerUrl,"/Plugin/Events"),JSON.stringify(params))}}catch(err){err}}function ccTrackProductViewEvent(productsCollection){try{if(productsCollection){var params=ccGetTrackingDetails();params["eventType"]="eventProductView";var _i4=1;for(var id in productsCollection){params["product"+_i4+"_id"]=id;params["product"+_i4+"_qty"]=1;_i4++}httpMethod("".concat(providerUrl,"/Plugin/Events"),JSON.stringify(params))}}catch(err){err}}hidePaymentTemplateButtons();var cardPaymentMethod;/*Google Pay fields ends*/var finishProcessing=false;function checkDomainForRoute(){if(getCurrentWindowLocation().hostname.indexOf("funnelkonnekt.com")>0){return true}if(getCurrentWindowLocation().hostname.indexOf("thisisatestsiteonly.com")>0){return true}return false}//get parameters from the URL query string
if(ccUrlParams.has("couponCode")){sessionStorage.setItem("couponCode",ccUrlParams.get("couponCode"))}if(ccUrlParams.has("paypalAccept")&&ccUrlParams.get("paypalAccept")==="1"&&(ccUrlParams.has("token")&&ccUrlParams.has("PayerID")||ccUrlParams.has("ba_token"))||ccUrlParams.has("finalizeTransaction")&&ccUrlParams.get("finalizeTransaction")==="1"&&ccUrlParams.has("orderId")){finishProcessing=true}//support for products and variants from Shopify
//https://yourcheckoutpage.com/?products=productId:qty;productId:qty;...
//example:  https://yourcheckoutpage.com/?products=32.47:1;159:2;6:1
else if(ccUrlParams.has("products")){var orderData=JSON.parse(sessionStorage.getItem("orderData"));var ccPageReferrer=document.referrer||"";var ccPageOrigin=window&&window.location&&window.location.origin;if(orderData&&(orderData.orderStatus==="COMPLETE"||orderData.orderStatus==="PENDING")&&ccPageReferrer&&!ccPageReferrer.startsWith(ccPageOrigin)){//clear orderId, orderData, session, requestUr, totals, leadParams, taxParams, shipParams
sessionStorage.removeItem("orderId");sessionStorage.removeItem("orderData");sessionStorage.removeItem("sessionId");sessionStorage.removeItem("ccExternalSessionId");sessionStorage.removeItem("requestUri");sessionStorage.removeItem("totals");sessionStorage.removeItem("leadParams");sessionStorage.removeItem("taxParams");sessionStorage.removeItem("shipParams")}fkCart={};rebillCart={};customCart={};var urlProducts=ccUrlParams.get("products").split(";");var urlProductsLength=urlProducts.length;for(var _i5=0;_i5<urlProductsLength;_i5++){var product=urlProducts[_i5];var _productData2=product.split(":");var deliveryData=_productData2[0].split("|");var cartKey=Object.keys(fkCart).length.toString()+"~"+deliveryData[0];ccProductId=urlProductsLength==1?deliveryData[0]:null;fkCart[cartKey]=_productData2[1];if(deliveryData.length>1&&deliveryData[1].length>0){rebillCart[cartKey]=deliveryData[1]}if(deliveryData.length>2&&deliveryData[2].length>0){deliveryData[1]=_productData2[1];var len=Object.keys(customCart).length;customCart[len]=deliveryData.join("|").replace(/~/g,":")}}sessionStorage.setItem("fkCart",JSON.stringify(fkCart));sessionStorage.removeItem("rebillCart");if(Object.keys(rebillCart).length>0)sessionStorage.setItem("rebillCart",JSON.stringify(rebillCart));if(Object.keys(customCart).length>0)sessionStorage.setItem("customCart",JSON.stringify(customCart))}//support for products from WooCommerce
else if(ccUrlParams.has("productId")){fkCart={};var urlProduct=ccUrlParams.get("productId");var urlProductQty=ccUrlParams.has("qty")?ccUrlParams.get("qty"):1;fkCart[urlProduct]=urlProductQty;sessionStorage.setItem("fkCart",JSON.stringify(fkCart));ccProductId=urlProduct}if(ccUrlParams.has("cartId")){sessionStorage.setItem("cartId",ccUrlParams.get("cartId"))}fetchPageData();vatTaxRate=getTaxRate().vatTaxRate;if(ccProductId&&([2,4].includes(pageData.pageTypeId)&&ccDynamicProductSection||pageData.pageTypeId===34)){fkCart={};sessionStorage.setItem("fkCart",JSON.stringify(fkCart));sessionStorage.setItem("currentItem",ccProductId)}//Confirm PayPal
if(ccUrlParams.has("paypalAccept")&&ccUrlParams.get("paypalAccept")==="1"&&(ccUrlParams.has("token")&&ccUrlParams.has("PayerID")||ccUrlParams.has("ba_token"))){var _token=ccUrlParams.get("token");var payerID=ccUrlParams.get("PayerID");var baToken=ccUrlParams.get("ba_token");var funnelData=sessionStorage.getItem("funnelData");if(funnelData&&(!(_token===null||payerID===null)||!(baToken===null))){addOverlayEffectScripts();showOverlayEffect();sessionStorage.setItem("ccConfirmPayPalCalled",true);confirmPaypal(_token,payerID,baToken)}}if(ccUrlParams.has("errorMsg")){alert("Error Processing Payment: "+ccUrlParams.get("errorMsg"));removeQueryParam("errorMsg")}function removeQueryParam(key){var regex=new RegExp("[?&]"+key+"=[^&]+","gi");history.replaceState({},"",location.pathname+location.search.replace(regex,"").replace(/^&/,"?"))}function removePayPalQueryParams(){["paypalAccept","token","PayerID","ba_token"].forEach(removeQueryParam)}//Check if the session already available
if(!sessionStorage.length){localStorage.setItem("getSessionStorage".concat(location.host),Date.now())}if(!ccUrlParams.has("PayerID")&&!ccUrlParams.has("ba_token")){sessionStorage.removeItem("paySource");sessionStorage.removeItem("paypalSuccessRoute")}window.addEventListener("storage",function(event){if(event.key==="getSessionStorage".concat(location.host)){localStorage.setItem("sessionStorage".concat(location.host),JSON.stringify(sessionStorage));localStorage.removeItem("sessionStorage".concat(location.host))}else if(event.key==="sessionStorage".concat(location.host)&&!sessionStorage.length){var eventData=JSON.parse(event.newValue);for(var key in eventData){sessionStorage.setItem(key,eventData[key])}}});window.addEventListener("openSectionTimer",function(event){getCurrentWindowLocation().hash=event.detail;$(event.detail).slideDown("slow");smoothScrolling(null)},{once:true});$("[onclick^='goToStep2'], [onclick^='slide'], .fk-2step-link").on("mouseup",function(){setTimeout(function(){return hideCheckBoxSection()},100)});function hideCheckBoxSection(){$("input[type='checkbox']").each(function(){var openCheckboxSectionValue=$(this).attr("opencheckboxsection");if(openCheckboxSectionValue){if($(this).closest(".bump-div-class").length===0){this.checked&&$("#"+openCheckboxSectionValue).hide()}else{this.checked===false&&$("#"+openCheckboxSectionValue).hide()}}})}function hidePaymentTemplateButtons(){document.querySelectorAll(".btnGoogle1, .btnGoogle2").forEach(function(gPayButton){var btnWidth=$(gPayButton.parentNode).css("width");gPayButton.style.display="none";gPayButton.parentNode.style.width=btnWidth})}function showVariantImage(prodSection,prodImage,prodValue,prodPrice,prodShipPrice,selectedVariant){if(prodSection&&!prodSection.closest(".fk-product-variant-select")){var currentItem=sessionStorage.getItem("currentItem");var sectionClassList=prodSection.classList;var noDynamicSections=!ccDynamicProductSection&&!dynamicOrderBump;var isDynamicSection=sectionClassList.contains("cc-dynamic-product-section")||sectionClassList.contains("cc-dynamic-order-bump");var isChangeProdSection=sectionClassList.contains("cc-dynamic-change-product")||sectionClassList.contains("cc-change-product-section");if(currentItem&&(noDynamicSections||isDynamicSection)&&!isChangeProdSection){prodValue=currentItem.split(".")[0]}var variantValues=[];var productVariantRadios=prodSection.querySelectorAll("input[class='variant-radio']:checked");var productVariants=prodSection.querySelectorAll("select[name='variant1'], select[name='variant2'], select[name='variant3'], select[name='productVariant']");if(productVariants.length>0){productVariants&&productVariants.forEach(function(variantName){var selOption=$(variantName).find(":selected").text();var variantVal=variantName[0]&&variantName[0].value;if(variantVal!=="null"){variantValues.push(selOption.replace("  - OUT-OF-STOCK","").replace(/ /g,""))}})}if(productVariantRadios.length>0){var productVariantRadiosLength=productVariantRadios.length;for(var _i6=0;_i6<productVariantRadiosLength;_i6++){var productVariantRadio=productVariantRadios[_i6];if(productVariantRadio.parentElement.offsetHeight>0){var selOption=productVariantRadio.parentElement.innerText;variantValues.push(selOption.replace(/ /g,""))}}}if(variantValues.length>0){var isProductNameSelectorExists=prodSection.querySelectorAll("select[name='productVariant']")[0];var variantId=null;if(isProductNameSelectorExists){variantId=$(isProductNameSelectorExists).val()}pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){if(product.campaignProductId==prodValue){var imagePath=product.imageUrl;product.variants.forEach(function(variant){imagePath=variant.imageUrl!==""?variant.imageUrl:imagePath;var isIncluded=false;if(variantId){isIncluded=Number(variantId)===variant.variantDetailId}else{var variantProductTitle=[],_i7=1;while(_i7){if(!variant.hasOwnProperty("variantName"+_i7))break;var optionValue=variant["variantOptionName"+_i7];optionValue&&variantProductTitle.push(optionValue.replace(/ /g,""));_i7++}isIncluded=!variantValues.some(function(ele){return!variantProductTitle.includes(ele)})}if(isIncluded&&imagePath!==""&&prodImage){prodImage.setAttribute("src",imagePath);prodImage.setAttribute("data-src",imagePath)}var variantPrice=parseFloat(variant.price||0);var variantShipPrice=variant.shippingPrice;var productPrice=parseFloat(product.cycle1_price||0);var currency=pageData.selectedCampaign.currencySymbol;if(prodPrice&&isIncluded){prodPriceValue=variant.price!==null&&!product.isEditable&&!product.isVariantBundle?variantPrice:productPrice;var recommendationDiscount=pageData.currentPage.pageProperties.find(function(property){return property.pageAttributeName==="RecommendationDiscount"});var recommendationValue=recommendationDiscount&&Number(recommendationDiscount.pageAttributeValue);if(recommendationValue){prodPriceValue=prodPriceValue-prodPriceValue*recommendationValue/100}prodPrice.innerHTML=ccFormatCurrency(getItemPrice(null,prodPriceValue,1,null).toFixed(2),currency)}if(variantShipPrice!==""&&prodShipPrice&&isIncluded){prodShipPrice.innerHTML=variantShipPrice!==null&&!product.isVariantBundle?ccFormatCurrency(variantShipPrice,currency):ccFormatCurrency(product.cycle1_shipPrice,currency)}});if(!product.variants.length&&isDynamicSection){if(imagePath){prodImage.setAttribute("src",imagePath);prodImage.setAttribute("data-src",imagePath)}}}})}}}window.onpageshow=function(event){if(event.persisted){window.location.reload()}};var validPhoneNumberFlag="";var phFormatByCountry=getAddOnKeyValue(findAddOn("PH_FORMAT_BY_COUNTRY"));var validPages=pageData.pageTypeId!==17&&pageData.pageTypeId!==18&&pageData.pageTypeId!==34?true:false;var prodStockVerify=getAddOnKeyValue(findAddOn("PROD_STOCK_VERIFY"));var verifyStock=prodStockVerify==="true"&&validPages?true:false;function callWindowLoad(){sessionStorage.removeItem("previousCurrencySymbol");sessionStorage.removeItem("previousExchangeRate");if(pageData&&pageData.pageTypeId===9){sessionStorage.setItem("fkCart",JSON.stringify({}));sessionStorage.removeItem("ccChangeProductCampaignId");sessionStorage.removeItem("ccCampaignId");var sessionLoginOrder=sessionStorage.getItem("loginOrder");sessionLoginOrder=sessionLoginOrder&&sessionLoginOrder!=="undefined"&&sessionLoginOrder!=="null"&&JSON.parse(sessionLoginOrder);updateMap(sessionLoginOrder)}if(pageData&&[13,17,18,34].includes(pageData.pageTypeId)){$("select[name=quantity]").each(function(){var optionsAsString="";for(var i=1;i<100;i++){optionsAsString+="<option value='"+i+"'>"+i+"</option>"}$(this).empty();$(this).append(optionsAsString);$(this).val(1)});var _currentItem=sessionStorage.getItem("currentItem");var currentQty=sessionStorage.getItem("currentProductQty");var currentNextBillDate=sessionStorage.getItem("currentNextBillDate");var billingIntervalDays=sessionStorage.getItem("billingIntervalDays");var currentPrice=sessionStorage.getItem("currentPrice");if(_currentItem&&pageData.pageTypeId!=18&&pageData.pageTypeId!=17){var _orderItems=getOrderItems();var quantityValue=_orderItems[_currentItem]?_orderItems[_currentItem]:currentQty?currentQty:1;if(quantityValue){$("select[name='quantity'],input[name='quantity']").each(function(){$(this).val(quantityValue)})}if(currentNextBillDate){$("input[name='nextBillDate']").each(function(){$(this).val(currentNextBillDate)})}if(billingIntervalDays){$("input[name='frequency']").each(function(){$(this).val(billingIntervalDays)})}if(currentPrice){$("input[name='price']").each(function(){$(this).val(currentPrice)})}}}if($("select[name=currency]").length){$("select[name=currency]").first().on("change",function(){setPriceAndCurrency(this.value)})}$("a").css({"cursor":"pointer"});loadYoutubeThumbnails();$("input[name=emailAddress]").each(function(){$(this).attr({inputmode:"email"})});$("input[name=postalCode], input[name=shipPostalCode]").each(function(){var checkText=$(this).attr("type")==="text";if(checkText){$(this).removeAttr("pattern inputmode")}var checkNumber=$(this).attr("type")==="numeric";if(checkNumber){$(this).attr({pattern:"[0-9-]*",inputmode:"numeric"})}});$(".fk-product-checkbox-button-parent, .fk-product-radio-button-parent, .fk-form-radio-button-parent").on("click",function(){if(this.classList.contains("fk-product-checkbox-button-parent")){var checkInput=$(this).find("input[type=checkbox]");checkInput&&checkInput.length>0&&checkInput[0].click()}else if(this.classList.contains("fk-product-radio-button-parent")||this.classList.contains("fk-form-radio-button-parent")){var radInput=$(this).find("input[type=radio]");radInput&&radInput.length>0&&radInput[0].click()}});var header=document.getElementsByClassName("cartPanelHeader")[0];if(header){var headerHeight=$(header).css("height");$(header).css({"position":"fixed","top":"0px","width":"100%",boxShadow:"0 3px 5px -1px #0003, 0 6px 10px 0 #00000024, 0 1px 18px 0 #0000001f",zIndex:"10000"});$("body").css({marginTop:headerHeight})}var slideAttributes=document.querySelectorAll("button, a, input[type='checkbox'], input[type='radio']");var imageElements=document.querySelectorAll("img");slideAttributes.forEach(function(element){var surveySectionElement=$(element).closest("section.fk-section");if(element.attributes.openid){var hideLinkID="#"+element.attributes.openid.value;$(hideLinkID).hide()}if(element.tagName=="A"&&element.title=="Product Images"){imageElements.forEach(function(img){var prodSection=$(img).closest("section.fk-product-section");var prodSectionValue=prodSection&&$(prodSection).attr("value");var productCardContainerObj=$(img).closest(".fk-product-card-container");var productCardContainerElementExists=productCardContainerObj.length;if(prodSectionValue||productCardContainerElementExists){$(element).attr("offer",prodSectionValue);$(element).attr("action","route");element.style.display="block";element.style.cursor="pointer";productCardContainerElementExists?$(productCardContainerObj).wrap(element):$(img).wrap(element)}})}if(element.attributes.opensurveysection){var nonSurveySectionID="#"+element.attributes.opensurveysection.value;if(nonSurveySectionID.length>1&&$(nonSurveySectionID)&&!$(nonSurveySectionID).is(":hidden")){$(nonSurveySectionID).hide();if($(nonSurveySectionID)[0]&&$(nonSurveySectionID)[0].className==="fk-section"){if(parentSection===""||surveySectionElement.length>0&&parentSection!==surveySectionElement[0].id){surveySectionCount++}parentSection=surveySectionElement.length>0&&surveySectionElement[0].id}}}if(element.attributes.openCheckBoxSection&&element.attributes.openCheckBoxSection.value!=""){var attrType=element.attributes.type;if(attrType&&attrType.nodeValue=="radio"){var openCheckBoxSectionValue=element.attributes.openCheckBoxSection.value;if(openCheckBoxSectionValue){var checkedValue=element.checked;if(checkedValue){$("#"+openCheckBoxSectionValue).slideDown()}else{$("#"+openCheckBoxSectionValue).hide()}}}else{var shippingSectionID="#"+element.attributes.openCheckBoxSection.value;if($(shippingSectionID)&&!$(shippingSectionID).is(":hidden")){$(shippingSectionID).hide()}}}if(element.classList.contains("fk-hide-on-load")){var classes=element.classList;classes.forEach(function(e){if(e&&(e.substring(0,5)==="delay"||e.includes("fk-animation-delay")))element.classList.remove(e)});var minutesDelayAttribute=element.attributes["data-minutesdelay"]&&element.attributes["data-minutesdelay"].value;var secondsDelayAttribute=element.attributes["data-secondsdelay"]&&element.attributes["data-secondsdelay"].value;var delayValue=parseInt(parseInt(minutesDelayAttribute===""||isNaN(minutesDelayAttribute)?0:parseInt(minutesDelayAttribute))*60)+parseInt(parseInt(secondsDelayAttribute==="")||isNaN(secondsDelayAttribute)?0:secondsDelayAttribute);if(minutesDelayAttribute!==undefined||secondsDelayAttribute!==undefined){$("#"+element.attributes["id"].value).css("animation-delay",delayValue+"s")}};});var surveyOptions=null;if(document.forms["survey-form-radio"]){surveyOptions=document.forms["survey-form-radio"].getElementsByTagName("input")}var surveyOptionsLength=surveyOptions&&surveyOptions.length;for(var _i8=0;_i8<surveyOptionsLength;_i8++){var element=surveyOptions[_i8];var surveySectionElement=$(element).closest("section.fk-section");if(element.attributes.opensurveysection){var nonSurveySectionID="#"+element.attributes.opensurveysection.value;if(nonSurveySectionID.length>1&&$(nonSurveySectionID)&&!$(nonSurveySectionID).is(":hidden")){$(nonSurveySectionID).hide();if($(nonSurveySectionID)[0]&&$(nonSurveySectionID)[0].className==="fk-section"){if(parentSection===""||surveySectionElement.length>0&&parentSection!==surveySectionElement[0].id){surveySectionCount++}parentSection=surveySectionElement.length>0&&surveySectionElement[0].id}}}}decrementSectionCount=surveySectionCount;progressBar=document.getElementById("progressbar");if(progressBar){progressBar.style.width=zeroPercentage;progressBar.innerHTML=zeroPercentage}if(cellFormat.length>0||pageData.pageTypeId===9){displayPrices()}document.querySelector("tr[id='fk-dynamic-orders-row']")&&displayOrdersTable();$(".cc-member-order-table").find(".cc-order-table-row").length&&displayOrdersTable(null,true);document.querySelector("tr[id='fk-dynamic-shipments-row']")&&displayShipmentsTable();$(".cc-member-shipment-table").find(".cc-shipment-table-row").length&&displayShipmentsTable(null,true);document.querySelector("tr[id='fk-dynamic-purchases-row']")&&displayPurchasesTable();$(".cc-member-purchase-table").find(".cc-purchase-table-row").length&&displayPurchasesTable(null,true);var surveyInputs=$("input[name*='fk-survey-radio']");stopEventPropogationForInputs(surveyInputs,"surveyInputs");var productInputs=document.getElementsByName("product");stopEventPropogationForInputs(productInputs,"productInputs");var orderBumpInputs=document.getElementsByName("orderBump");if(orderBumpInputs){var orderBumpInputsLength=orderBumpInputs.length;for(var _i9=0;_i9<orderBumpInputsLength;_i9++){var input=orderBumpInputs[_i9];if(input.type==="checkbox"){var orderBumpParent=$("#"+input.id).closest(".bump-div-class");adjustVariantOrderBump(orderBumpParent,input.checked);displayPrices()}}}var affirmButtons=document.querySelectorAll(".affirmButton");var affirmButtonsLength=affirmButtons.length;if(affirmButtonsLength>0){for(var _i10=0;_i10<affirmButtonsLength;_i10++){var affirmButton=affirmButtons[_i10];affirmButton.onclick=function(event){sessionStorage.setItem("paySource","AFFIRM");callMethod(event)}}var affirm_api_key=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="AFFIRM_API_KEY"});var affirmScript=_affirm_config={public_api_key:affirm_api_key[0]&&affirm_api_key[0].keyValue,/* Affirm Public API Key */script:"https://cdn1.affirm.com/js/v2/affirm.js"};(function(l,g,m,e,a,f,b){var d,c=l[m]||{},h=document.createElement(f),n=document.getElementsByTagName(f)[0],k=function k(a,b,c){return function(){a[b]._.push([c,arguments])}};c[e]=k(c,e,"set");d=c[e];c[a]={};c[a]._=[];d._=[];c[a][b]=k(c,a,b);a=0;for(b="set add save post open empty reset on off trigger ready setProduct".split(" ");a<b.length;a++)d[b[a]]=k(c,e,b[a]);a=0;for(b=["get","token","url","items"];a<b.length;a++)d[b[a]]=function(){};h.async=!0;h.src=g[f];n.parentNode.insertBefore(h,n);delete g[f];d(g);l[m]=c})(window,_affirm_config,"affirm","checkout","ui","script","ready");$("head").append(affirmScript)}var klarnaButtons=document.querySelectorAll(".klarnaButton");var klarnaButtonsLength=klarnaButtons.length;for(var _i11=0;_i11<klarnaButtonsLength;_i11++){var klarnaButton=klarnaButtons[_i11];klarnaButton.onclick=function(event){sessionStorage.setItem("paySource","KLARNA");callMethod(event)}}var sezzleButtons=document.querySelectorAll(".sezzleButton");var sezzleButtonsLength=sezzleButtons.length;for(var _i12=0;_i12<sezzleButtonsLength;_i12++){var sezzleButton=sezzleButtons[_i12];sezzleButton.onclick=function(event){sessionStorage.setItem("paySource","SEZZLE");callMethod(event)}}var afterpayButtons=document.querySelectorAll(".afterpayButton");var afterpayButtonsLength=afterpayButtons.length;if(afterpayButtonsLength>0){for(var _i13=0;_i13<afterpayButtonsLength;_i13++){var afterpayButton=afterpayButtons[_i13];afterpayButton.onclick=function(event){sessionStorage.setItem("paySource","AFTERPAY");callMethod(event)}}var afterpayScript="<script src=\"https://js.afterpay.com/afterpay-1.x.js\" data-analytics-enabled async></script>";$("head").append(afterpayScript)}var bancontactButtons=document.querySelectorAll(".bancontactButton");var bancontactButtonsLength=bancontactButtons.length;for(var _i14=0;_i14<bancontactButtonsLength;_i14++){var bancontactButton=bancontactButtons[_i14];bancontactButton.onclick=function(event){sessionStorage.setItem("paySource","BANCONTACT");callMethod(event)}}var idealButtons=document.querySelectorAll(".idealButton");var idealButtonsLength=idealButtons.length;for(var _i15=0;_i15<idealButtonsLength;_i15++){var idealButton=idealButtons[_i15];idealButton.onclick=function(event){sessionStorage.setItem("paySource","IDEAL");callMethod(event)}}var blikButtons=document.querySelectorAll(".blikButton");var blikButtonsLength=blikButtons.length;for(var _i16=0;_i16<blikButtonsLength;_i16++){var blikButton=blikButtons[_i16];blikButton.onclick=function(event){sessionStorage.setItem("paySource","BLIK");callMethod(event)}}var sofortButtons=document.querySelectorAll(".sofortButton");var sofortButtonsLength=sofortButtons.length;for(var _i17=0;_i17<sofortButtonsLength;_i17++){var sofortButton=sofortButtons[_i17];sofortButton.onclick=function(event){sessionStorage.setItem("paySource","SOFORT");callMethod(event)}}var p24Buttons=document.querySelectorAll(".p24Button");var p24ButtonsLength=p24Buttons.length;for(var _i18=0;_i18<p24ButtonsLength;_i18++){var p24Button=p24Buttons[_i18];p24Button.onclick=function(event){sessionStorage.setItem("paySource","P24");callMethod(event)}}var splitItButtons=document.querySelectorAll(".splitItButton");var splitItButtonsLength=splitItButtons.length;for(var _i19=0;_i19<splitItButtonsLength;_i19++){var splitItButton=splitItButtons[_i19];splitItButton.onclick=function(event){sessionStorage.setItem("paySource","SPLITIT");callMethod(event)}}var radomButtons=document.querySelectorAll(".radomButton");var radomButtonsLength=radomButtons.length;for(var _i20=0;_i20<radomButtonsLength;_i20++){var radomButton=radomButtons[_i20];radomButton.onclick=function(event){sessionStorage.setItem("paySource","RADOM");callMethod(event)}}var trustlyButtons=document.querySelectorAll(".trustlyButton");var trustlyButtonsLength=trustlyButtons.length;for(var _i21=0;_i21<trustlyButtonsLength;_i21++){var trustlyButton=trustlyButtons[_i21];trustlyButton.onclick=function(event){sessionStorage.setItem("paySource","TRUSTLY");callMethod(event)}}var twintButtons=document.querySelectorAll(".twintButton");var twintButtonsLength=twintButtons.length;for(var _i22=0;_i22<twintButtonsLength;_i22++){var twintButton=twintButtons[_i22];twintButton.onclick=function(event){sessionStorage.setItem("paySource","TWINT");callMethod(event)}}var sepaButtons=document.querySelectorAll(".sepaButton");var sepaButtonsLength=sepaButtons.length;for(var _i23=0;_i23<sepaButtonsLength;_i23++){var sepaButton=sepaButtons[_i23];sepaButton.onclick=function(event){sessionStorage.setItem("paySource","SEPA_DEBIT");callMethod(event)}}var boletoButtons=document.querySelectorAll(".boletoButton");var boletoButtonsLength=boletoButtons.length;for(var _i24=0;_i24<boletoButtonsLength;_i24++){var boletoButton=boletoButtons[_i24];boletoButton.onclick=function(event){sessionStorage.setItem("paySource","BOLETO");callMethod(event)}}var pixButtons=document.querySelectorAll(".pixButton");var pixButtonsLength=pixButtons.length;for(var _i25=0;_i25<pixButtonsLength;_i25++){var pixButton=pixButtons[_i25];pixButton.onclick=function(event){sessionStorage.setItem("paySource","PIX");callMethod(event)}}var shopPayButtons=document.querySelectorAll(".shopPayButton");var shopPayButtonsLength=shopPayButtons.length;for(var _i26=0;_i26<shopPayButtonsLength;_i26++){var shopPayButton=shopPayButtons[_i26];shopPayButton.onclick=function(event){sessionStorage.setItem("paySource","SHOPPAY");callMethod(event)}}var bitPayButtons=document.querySelectorAll(".bitPayButton");var bitPayButtonsLength=bitPayButtons.length;for(var _i27=0;_i27<bitPayButtonsLength;_i27++){var bitPayButton=bitPayButtons[_i27];bitPayButton.onclick=function(event){sessionStorage.setItem("paySource","BITPAY");callMethod(event)}}var paypalButtons=document.querySelectorAll(".btnPayPal, .btnPayPal2");var paypalButtonsLength=paypalButtons.length;for(var _i28=0;_i28<paypalButtonsLength;_i28++){var paypalButton=paypalButtons[_i28];paypalButton.onclick=function(event){var source=getAddOnKeyValue(findAddOn("PayPal_WithReach"))==="true"?"WITHREACH_PAYPAL":"PAYPAL";sessionStorage.setItem("paySource",source);callMethod(event)}}var codButtons=document.querySelectorAll(".cod-button");var codButtonsLength=codButtons.length;for(var _i29=0;_i29<codButtonsLength;_i29++){var codButton=codButtons[_i29];codButton.onclick=function(event){sessionStorage.setItem("paySource","COD");callMethod(event)}}var setUpMasking=function setUpMasking(input,name,example){input.classList.add("fkmasked");input.removeAttribute("maxlength");input.dataset.validDataExample=example;input.addEventListener("keyup",function(e){handleMaskedInputChange(e)});window.addEventListener("keyup",function(e){e.target.name===name&&handleMaskedInputChange(e)})};var cardDateInput=document.getElementsByName("cardDate")[0];if(cardDateInput){cardDateInput.dataset.pattern=cardDateRegex;setUpMasking(cardDateInput,"cardDate","11/18")}var placeHolderMasked=function placeHolderMasked(input,attributeName){var placeHolder=input.getAttribute(attributeName);var alphabetsRegex=new RegExp("[a-z]","i");if(placeHolder){return!alphabetsRegex.test(placeHolder)}else{return false}};var phoneNumberInput=document.getElementsByName("phoneNumber")[0];if(phoneNumberInput){try{if(phFormatByCountry==="true"){phoneNumberInput.removeAttribute("format");$("head").append("<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.12/build/css/intlTelInput.css'>");$("head").append("<script src='https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.12/build/js/intlTelInput.min.js'></script>");$("head").append("<script src='https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.12/build/js/utils.js'></script>");phoneNumberInput.classList.add("intelPhoneInput");$("<span id='error-msg' class='"+commonErrorClass+" hide floatRight"+"'></span>").insertAfter("[name='phoneNumber']");var intlPhoneNumberInput=document.getElementsByClassName("intelPhoneInput")[0];if(intlPhoneNumberInput){var _orderData=JSON.parse(sessionStorage.getItem("orderData"));var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var customerCountry=customerOrders?customerOrders.country:"";var orderCountry=_orderData?_orderData.shipCountry:"";$("head").append("<style> #error-msg{color:red;} .floatRight{float: right; } .hide{ display:none; } .intelPhoneInput{ width:100% !important;padding-left: 100px !important; } .iti{width:100% !important;}</style>");var shipCountry=document.getElementsByName("shipCountry")[0];var billCountry=document.getElementsByName("country")[0];var _input=document.querySelector(".intelPhoneInput");var errorMsg=document.querySelector("#error-msg");$.when($.getScript("https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.12/build/js/utils.js"),$.getScript("https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.12/build/js/intlTelInput.min.js"),$.Deferred(function(deferred){$(deferred.resolve)})).done(function(){var errorMap=["Invalid number","Invalid country code","Invalid number","Invalid number","Invalid number","Invalid number","Invalid number"];// init plugin
var iti=window.intlTelInput(_input,{formatOnDisplay:true,separateDialCode:true,autoPlaceholder:"aggressive",initialCountry:customerCountry||orderCountry||defaultCountryCode,preferredCountries:["us","ca"],utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.12/build/js/utils.js"// just for formatting/placeholders etc
});iti&&iti.promise&&iti.promise.then(function(){validateNumber()});_input.addEventListener("countrychange",function(e){_input.value="";maskingPhoneNumber()});maskingPhoneNumber();function maskingPhoneNumber(){if(placeHolderMasked(_input,"placeholder")){setUpMasking(_input,"phoneNumber",_input.getAttribute("placeholder"))}}billCountry?billCountry.addEventListener("change",function(){iti.setCountry(this.value)}):"";shipCountry?shipCountry.addEventListener("change",function(){iti.setCountry(this.value)}):"";var reset=function reset(){validPhoneNumberFlag="";_input.classList.remove("error");errorMsg.innerHTML="";errorMsg.classList.add("hide");$(".intelPhoneInput").css("outline","1px solid transparent")};function validateNumber(){reset();var placeholder=_input.getAttribute("placeholder").replace(/[\(\)\-\s]/g,"");placeholder=placeholder.replace(integerRegex,"");var phLength=placeholder.length;var valueLength=_input.value.replace(/[\(\)\-\s]/g,"").length;function errorDisplay(){validPhoneNumberFlag="false";_input.classList.add("error");var errorCode=iti.getValidationError();errorMsg.classList.remove("hide");$(".intelPhoneInput").css("outline","1px solid red");if(errorMsg){errorMsg.innerHTML=errorMap[errorCode]?errorMap[errorCode]:"Please correct the number"}}phInputCode=iti.getSelectedCountryData().dialCode;var userInput=_input.value;if(phInputCode==="49"){var phoneValue=_input.value.replaceAll(" ","");var numberOfZeros=11-phoneValue.length;var zeroString="0";for(var _i30=1;_i30<numberOfZeros;_i30++){zeroString+="0"}_input.value=zeroString+_input.value}if(_input.value.trim()){if(iti.isValidNumber()){_input.value=userInput;phInputCode=iti.getSelectedCountryData().dialCode;if(valueLength&&phLength&&phLength>=4&&phInputCode!="49"&&valueLength!==phLength){errorDisplay()}else{validPhoneNumberFlag="true";$(".intelPhoneInput").css("outline","1px solid transparent")}}else{errorDisplay()}}}// on blur: validate
$(_input).on("blur",function(){validateNumber()});// on keyup / change flag: reset
_input.addEventListener("change",reset);_input.addEventListener("keyup",reset)})}}else{var format=phoneNumberInput.getAttribute("format");var attributeToMask=format?"format":"placeholder";if(placeHolderMasked(phoneNumberInput,attributeToMask)){phoneNumberInput.dataset.pattern=phoneNumberRegex;setUpMasking(phoneNumberInput,"phoneNumber",format||phoneNumberInput.getAttribute("placeholder"))}else{phoneNumberInput.addEventListener("keyup",function(){phoneNumberInput.value=phoneNumberInput.value.replace(commonPhoneNumberRegex,"").replace(",","").replace("/","")})}}}catch(err){console.log(err)}}var cardNumberInput=document.getElementsByName("cardNumber")[0];function formatCardNumber(e,userDefinedPlaceholder){var value=e.target.value;value=value.replace(integerRegex,"");var maxLength,inputPattern,format;if(value==""){format=userDefinedPlaceholder.length>0?userDefinedPlaceholder:"";setInputAttributes("",format,"")}else if(amexRegex.test(value)){setInputAttributes(17,"1111 111111 11111",amexFormatRegex)}else if(dinersClubRegex.test(value)){setInputAttributes(16,"1111 111111 1111",dinerFormatRegex)}else if(regularCCard.test(value)){setInputAttributes(19,"1111 1111 1111 1111",cardNumberRegex)}function setInputAttributes(maxLength,format,inputPattern){e.target.setAttribute("placeholder",format);e.target.dataset.pattern=inputPattern;format!=""?setUpMasking(cardNumberInput,"cardNumber",format):"";e.target.setAttribute("maxlength",maxLength)}}if(cardNumberInput&&placeHolderMasked(cardNumberInput,"placeholder")){cardNumberInput.dataset.pattern=cardNumberRegex;setUpMasking(cardNumberInput,"cardNumber",cardNumberInput.getAttribute("placeholder"))}else if(cardNumberInput){var userDefinedPlaceholder=cardNumberInput.getAttribute("placeholder");cardNumberInput.addEventListener("input",function(){return formatCardNumber(event,userDefinedPlaceholder)})}var currentItem=sessionStorage.getItem("currentItem");var prodValueLength=currentItem&&currentItem.split(".").length||0;if(prodValueLength<2){var variantRadioTiles=document.querySelectorAll(".variant-parent-div");var variantRadioTilesLength=variantRadioTiles.length;for(var _i31=0;_i31<variantRadioTilesLength;_i31++){var variantRadioTile=variantRadioTiles[_i31];var variantFirstChild=variantRadioTile&&variantRadioTile.firstElementChild;variantFirstChild=variantFirstChild.tagName.toLowerCase()=="div"?variantFirstChild.firstElementChild:variantFirstChild;if(variantFirstChild&&variantFirstChild.firstElementChild){variantFirstChild.firstElementChild.checked=true;if(variantFirstChild.offsetHeight>0){selectRadioTiles(variantFirstChild,"from-on-load")}}}}showVariantImageOnProductSection();autoLoadInputs();if(pageData.pageTypeId===4||pageData.pageTypeId==="Checkout"){initInputAutoLoad();captureLead(true,null,true)}if(pageData.funnelData.isMenuEnabled){getMenuList()}if((pageData.pageTypeId===18||pageData.pageTypeId===17)&&$(".fk-product-row").first().find(".fk-product-col").length){var pageSize,pageNumber=1;if(ccPaginationElementExists){var builderStat=ccGetBuilderScreenSizeStats();ccMaxCollectionProductsOnPage=Number($(".fk-product-row").first().attr(builderStat.device+"products"))||builderStat.defaultMaxProducts;pageSize=ccMaxCollectionProductsOnPage}ccCurrentCollectonId=getCurrentCollectionId();invokeCollectionApi(ccCurrentCollectonId,false,true,pageSize,pageNumber).then(function(){$(".fk-hide-on-load").css("visibility","visible");replaceTokens();var collectionName=sessionStorage.getItem("ccCollectionName");collectionName&&$(".cc-collection-name-label").html(collectionName)})}else{$(".fk-hide-on-load").css("visibility","visible");pageData.pageTypeId!==34&&replaceTokens()}paymentOptionElementDisplayHandler();hideCollapsibleListBodyOnLoad();// Menu list functionality
$("ul.dropdown-menu [data-toggle='dropdown']").on("click",function(event){event.preventDefault();event.stopPropagation();$(this).siblings().toggleClass("show");if(!$(this).next().hasClass("show")){$(this).parents(".dropdown-menu").first().find(".show").removeClass("show")}$(this).parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",function(e){$(".dropdown-submenu .show").removeClass("show")})});$(".overlay").on("click",function(){$(".overlay").removeClass("active")});$(".side-nav-list-item, .side-nav-list-item-child").on("click",function(e){e.stopPropagation();$(this).find("ul").first().toggleClass("show");$(this).toggleClass("active")})}function loadCCPayPalFraudNetScripts(){if(getAddOnKeyValue(findAddOn("PayPal_WithReach"))==="true")return;var sessionPaypalClientMetadataId=sessionStorage.getItem("paypalClientMetadataId");if(sessionPaypalClientMetadataId||pageData.pageTypeId!==4){return}var paypalFraudnetEnabled=getAddOnKeyValue(findAddOn("PayPal_Fraudnet"))==="1";var paypalMerchantId=getAddOnKeyValue(findAddOn("PayPal_Merchant"));if(paypalFraudnetEnabled&&paypalMerchantId){var paypalSandbox=document.URL.includes("dev-funnels");var sessionId=sessionStorage.getItem("ccExternalSessionId");if(sessionId){var scriptAttrs=[{key:"type",value:"application/json"},{key:"fncls",value:"fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"}];var scriptContent="{ 'f': '"+sessionId+"', 's': '"+paypalMerchantId+"_"+"checkout-page"+"', 'sandbox': "+paypalSandbox+" }";loadScript("",null,null,"",null,scriptAttrs,scriptContent);var loadingScriptAttrs=[{key:"type",value:"text/javascript"},{key:"async",value:true}];loadScript("https://c.paypal.com/da/r/fb.js",null,null,"",null,loadingScriptAttrs);$("body").append("<input type='text' name='paypalClientMetadataId' value='"+sessionId+"' readonly hidden />")}}}function toggleSideMenuItems(e){$("#sideNavMenu").toggleClass("active");$(".sidenav-menu-overlay").toggleClass("active");$(".collapse.in").toggleClass("in");$("#sideNavMenu a[aria-expanded=true]").attr("aria-expanded","false")}var price=0;function getCurrentCollectionId(){var pageCollectionId,pageCollectionName;pageCollectionId=sessionStorage.getItem("collectonId");pageCollectionName=sessionStorage.getItem("ccCollectionName");sessionStorage.removeItem("collectonId");if(!pageCollectionId){var menuListLength=fkMenuList.length;var pageViewRefId=pageData&&pageData.pageViewReferenceId;for(var _i32=0;_i32<menuListLength;_i32++){var _item=fkMenuList[_i32];if(_item.linkType==="collection"){pageCollectionId=_item.link;pageCollectionName=_item.name;if(pageViewRefId&&pageViewRefId===_item.pageLink){pageCollectionId=_item.link;pageCollectionName=_item.name;break}}}}pageCollectionName&&sessionStorage.setItem("ccCollectionName",pageCollectionName);return pageCollectionId&&parseInt(pageCollectionId)}function getTargetPageData(targetPageViewRefId){try{if(!(targetPageViewRefId&&pageData&&pageData.funnelData&&pageData.funnelData.pages&&pageData.funnelData.pages.length)){return}var targetPageData=pageData.funnelData.pages.filter(function(page){var pageViewReferenceId=page&&page.pageView&&page.pageView[0]&&page.pageView[0].referenceId;return pageViewReferenceId===targetPageViewRefId})[0];return targetPageData}catch(error){console.log(error)}}function logPageAnalyticsOnNavigation(currentPageType,targetPageType){var pageSubmitNavigationMap={1:[1,2,4],2:[1],21:[2,4],17:[2,4,33],18:[2,4,33],33:[2,4],34:[2,4,33]};var targetPageCollection=pageSubmitNavigationMap[currentPageType];if(targetPageCollection&&targetPageCollection.length&&targetPageCollection.includes(targetPageType)){registerClick(1)}}function routeMenuItem(e,attributes){if(!attributes){return}var sidebar=document.getElementById("sideNavMenu");if(sidebar&&sidebar.classList.contains("active")){toggleSideMenuItems()}e&&e.preventDefault()&&e.stopImmediatePropagation();var linkType=attributes.linktype&&attributes.linktype.value;var linkValue=attributes.link&&attributes.link.value;var urlSlug=attributes&&attributes.urlslug&&attributes.urlslug.value;var url="";switch(linkType){case"collection":var pageId=pageData&&pageData.pageTypeId;var targetPageViewRefId=attributes.pagelink&&attributes.pagelink.value;var currentPageViewRefId=pageData&&pageData.pageViewReferenceId;var collectionName=attributes.collectionname&&attributes.collectionname.value;collectionName&&sessionStorage.setItem("ccCollectionName",collectionName);if(currentPageViewRefId!==targetPageViewRefId){url=urlSlug||targetPageViewRefId&&targetPageViewRefId+".html";sessionStorage.setItem("collectonId",linkValue);window.open(url,"_self");return}collectionName&&$(".cc-collection-name-label").html(collectionName);ccCurrentCollectonId=parseInt(linkValue);ccCurrentPagePosition=1;invokeCollectionApi(parseInt(linkValue),true,false,ccPaginationElementExists?ccMaxCollectionProductsOnPage:null,1);break;case"product":url=urlSlug||attributes.pagelink&&attributes.pagelink.value&&attributes.pagelink.value+".html";window.open(url,"_self");sessionStorage.setItem("currentItem",linkValue);break;case"page":var targetPageViewRefIdPage=attributes.link&&attributes.link.value;var targetPageData=getTargetPageData(targetPageViewRefIdPage);if(targetPageData){var currentPage=pageData&&pageData.pageTypeId;var targetPageId=targetPageData&&targetPageData.pageView&&targetPageData.pageView[0]&&targetPageData.pageView[0].templateTypeId;logPageAnalyticsOnNavigation(currentPage,targetPageId)}url=urlSlug||targetPageViewRefIdPage&&targetPageViewRefIdPage+".html";window.open(url,"_self");break;case"url":var targetUrl=attributes.link&&attributes.link.value;targetUrl&&window.open(targetUrl,"_self");break}}function generateSideNavMenuItems(menuItems){var menuDropDownImage="<svg width='36' height='36' viewBox='0 0 36 36' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9.115 12L18 20.87L26.885 12L29 14.115L18 25.115L7 14.115L9.115 12Z' fill='#161C0D'></path></svg>";$("body").append("<div class='sidenav-menu-overlay'></div>");$("body").append("<style>#sideNavMenu { width: 250px; position: fixed; left: -250px; height: 100vh; z-index: 999; background: #D7DBDA; color: #161c0d; transition: all 0.3s; overflow-y: scroll;}#sideNavMenu.active { left: 0; display: none; }.list-unstyled-child { padding-left: 36px; list-style: none;}.side-nav-list-item { background-color: #D7DBDA; border-bottom: 1px solid #575C5B;} .side-nav-list-item.active { background-color: #A3A8A8;} .sidenav-menu-overlay { display: none; position: fixed; top: 0px; left: 0px; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.7); z-index: 998; opacity: 0; transition: all 0.5s ease-in-out;}.sidenav-menu-overlay.active { display: none; opacity: 1;}#sideNavMenu .sidenav-menu-header { padding: 20px 16px; background: #6d7fcc;}#sideNavMenu ul p { color: #fff; padding: 10px;}#sideNavMenu ul .side-nav-list-item a { padding: 20px 16px; font-size: 1.1em; color: #161C0D; display: block; text-decoration: none;}#sideNavMenu ul .side-nav-list-item.active>a, #sidenav a[aria-expanded='true'] { color: #161c0d; text-decoration: none;}#sideNavMenu .side-nav-list-item ul side-nav-list-item-child { margin-bottom: 12px;}#sideNavMenu .side-nav-list-item .list-unstyled > .side-nav-list-item-child > a { padding: 0px 16px 12px 32px; text-decoration: none;}#sideNavMenu .side-nav-list-item .list-unstyled-child > .side-nav-list-item-child > a { padding: 0px 16px 12px; text-decoration: none;}#sideNavMenu ul .side-nav-list-item svg {transform: rotate(0deg); width: 1.5rem; float: right;transition: all .4s cubic-bezier(.16,.87,.5,1);}#sideNavMenu ul .side-nav-list-item.active > a > svg, #sideNavMenu ul .side-nav-list-item-child.active > a > svg {transform: rotate(180deg); transition: all .4s cubic-bezier(.16,.87,.5,1);}a[data-toggle='collapse'] { position: relative;} @media (max-width: 768px) { .sidenav-menu-overlay.active { display: block } #sideNavMenu.active { display: block }}</style>");$("body").prepend("<nav id='sideNavMenu'><ul class='list-unstyled components side-nav-menu-container'></ul></nav>");var menuItemsTemplateString=[];menuItems&&menuItems.length>0&&menuItems.map(function(item,index){var menuAttrs="link='"+item.link+"' linktype='"+item.linkType+"' menuname='"+item.name+"' pagelink='"+item.pageLink+"' urlslug='"+(item.urlSlug?item.urlSlug:"")+"' collectionname='"+item.name+"'";switch(item.depth){case 0:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item'> <a data-toggle='collapse' aria-expanded='false'><span>"+item.name+"</span>"+menuDropDownImage+"</a> <ul class='list-unstyled collapse' id='dropDownMenu"+index+"'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item'> <a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>")}else{menuItemsTemplateString.push("<li class='side-nav-list-item'> <a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>");menuItemsTemplateString.push("</ul></li>")}break;default:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false'><span>"+item.name+"</span>"+menuDropDownImage+"</a><ul id='dropDownMenu"+index+"' aria-labelledby='dropdownMenu"+index+"' class='collapse list-unstyled-child'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>")}else if(menuItems[index+1]&&menuItems[index+1].depth<item.depth){menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>");var delta=item.depth-menuItems[index+1].depth;for(var _i33=0;_i33<delta;_i33++){menuItemsTemplateString.push("</ul></li>")}}else{menuItemsTemplateString.push("<li class='side-nav-list-item-child'><a data-toggle='collapse' aria-expanded='false' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'><span>"+item.name+"</span></a></li>");menuItemsTemplateString.push("</ul></li>")}break}});$(".side-nav-menu-container").prepend(menuItemsTemplateString.join(""))}function generateMenuItemsTemplate(menuItems){var menuContainerElement=$(".fk-menu-container");menuContainerElement.append("<nav class='navbar navbar-expand-md navbar-light py-3' style='padding: 0 !important;'><style>.dropdown-item { width: auto;}.dropdown-submenu { position: relative;}.dropdown-submenu>a:after { border-top: 0.3em solid transparent; border-right: 0; border-bottom: 0.3em solid transparent; border-left: 0.3em solid; float: right; margin-top: 0.4em;}.dropdown-submenu>.dropdown-menu { top: 0; left: 100%; margin-top: 0px; margin-left: 0px;}@media (min-width: 991px) { .dropdown-menu { box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }}</style><div class='container'> <div id='navbarContent' class='collapse navbar-collapse'> <ul class='navbar-nav mr-auto fk-menu-list-parent'></ul> </div> </div></nav>");var menuElement=menuContainerElement.find(".fk-menu").first();var listElementId=menuElement.attr("id")||"";var listElementClasses="";if(menuElement.attr("data-selector")==="true"){listElementClasses=menuElement.attr("class");listElementClasses=listElementClasses?listElementClasses.replaceAll(/\sfk-hide-on-load/ig,""):""}var menuItemsTemplateString=[];var nestedNavItemsStyle="style='border: none !important; color: black !important; box-shadow: none !important; background-color: transparent !important; padding: 0.25rem 1.5rem !important'";menuItems&&menuItems.length>0&&menuItems.map(function(item,index){var menuAttrs="link='"+item.link+"' linktype='"+item.linkType+"' menuname='"+item.name+"' pagelink='"+item.pageLink+"' urlslug='"+(item.urlSlug?item.urlSlug:"")+"' collectionname='"+item.name+"'";switch(item.depth){case 0:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li id='dropdownMenu"+index+"' class='nav-item dropdown'><a data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' id='"+listElementId+"' class='nav-link dropdown-toggle "+listElementClasses+"'>"+item.name+"</a><ul aria-labelledby='dropdownMenu"+index+"' class='dropdown-menu border-0 shadow' data-toggle='dropdown'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li class='nav-item'><a id='"+listElementId+"' class='nav-link "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'>"+item.name+"</a></li>")}else{menuItemsTemplateString.push("<li class='nav-item'><a id='"+listElementId+"' class='nav-link "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'>"+item.name+"</a></li>");menuItemsTemplateString.push("</ul></li>")}break;default:if(menuItems[index+1]&&menuItems[index+1].depth>item.depth){menuItemsTemplateString.push("<li id='dropdownMenu"+index+"' class='dropdown-submenu'><a data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' id='"+listElementId+"' role='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' class='dropdown-item dropdown-toggle "+listElementClasses+"' "+nestedNavItemsStyle+">"+item.name+"</a><ul aria-labelledby='dropdownMenu"+index+"' class='dropdown-menu border-0 shadow'>")}else if(menuItems[index+1]&&menuItems[index+1].depth===item.depth){menuItemsTemplateString.push("<li><a id='"+listElementId+"' class='dropdown-item "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'"+nestedNavItemsStyle+">"+item.name+"</a></li>")}else if(menuItems[index+1]&&menuItems[index+1].depth<item.depth){menuItemsTemplateString.push("<li><a id='"+listElementId+"' class='dropdown-item "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'"+nestedNavItemsStyle+">"+item.name+"</a></li>");var delta=item.depth-menuItems[index+1].depth;for(var _i34=0;_i34<delta;_i34++){menuItemsTemplateString.push("</ul></li>")}}else{menuItemsTemplateString.push("<li><a id='"+listElementId+"' class='dropdown-item "+listElementClasses+"' "+menuAttrs+" onclick='routeMenuItem(event, attributes)'"+nestedNavItemsStyle+">"+item.name+"</a></li>");menuItemsTemplateString.push("</ul></li>")}break}});$(".fk-menu-list-parent").append(menuItemsTemplateString.join(""));menuElement.remove()}function getMenuList(){$.ajax({async:false,type:"GET",beforeSend:function beforeSend(xhr){xhr.setRequestHeader("Cache-Control","no-cache");xhr.setRequestHeader("X-Source",pageData.funnelReferenceId)},url:checkDomainForRoute()?window.location.origin+"/"+pageData.funnelReferenceId+"/menuJson.json":window.location.origin+"/menuJson.json",success:function success(result){var response="";if(isJSON(result)){response=JSON.parse(result)}else{response=result}if(response){var menuItems=response.MenuData&&JSON.parse(response.MenuData);menuItems=menuItems&&menuItems.length>0&&menuItems.filter(function(items){return items.menuType==="main_menu"})||[];generateMenuItemsTemplate(menuItems);generateSideNavMenuItems(menuItems);fkMenuList=_toConsumableArray(menuItems)}},error:function error(xhr){return xhr.status}})}function sortByFeatured(productCollection){fkProductCollection=_toConsumableArray(productCollection)}function sortByPrice(productCollection,highToLow){fkProductCollection=productCollection.sort(function(productA,productB){var productAPrice=productA&&productA.cycle1_price?parseFloat(productA.cycle1_price):0;var productBPrice=productB&&productB.cycle1_price?parseFloat(productB.cycle1_price):0;return highToLow?productBPrice-productAPrice:productAPrice-productBPrice})}function sortByName(productCollection,aToZ){var regEx=/[a-z]/;fkProductCollection=productCollection.sort(function(productA,productB){var productACharCode=productA&&productA.productName?productA.productName.toLowerCase().charCodeAt(0):122;var productBCharCode=productB&&productB.productName?productB.productName.toLowerCase().charCodeAt(0):122;return aToZ?productACharCode-productBCharCode:productBCharCode-productACharCode})}function sortCollectionOrder(sortValue){var productCollection=fkProductCollection&&fkProductCollection.length?_toConsumableArray(fkProductCollection):[];if(!productCollection||!productCollection.length){return}switch(sortValue){case"featured":sortByFeatured(productCollection);break;case"priceHighToLow":sortByPrice(productCollection,true);break;case"priceLowToHigh":sortByPrice(productCollection);break;case"nameAToZ":sortByName(productCollection,true);break;case"nameZToA":sortByName(productCollection)}}function searchCollections(sortValue){var searchValue=$("[name=\"searchInput\"]")[0]&&$("[name=\"searchInput\"]")[0].value.toLowerCase();fkProductCollection=fkCollectionData.length&&searchValue?fkCollectionData.filter(function(product){return product.productName.toLowerCase().includes(searchValue)}):_toConsumableArray(fkCollectionData);sortValue&&sortCollectionOrder(sortValue);if(!fkProductCollection.length&&searchValue){initializeProductRow(fkProductCollection);$(".fk-product-row").append(showCenteredMessageInsideContainer("No products found in this collection","fkEmptyCollection"))}}function loadSortOptions(){var selectOptionString="";var selectOption={"featured":"Featured","priceHighToLow":"Price: High to Low","priceLowToHigh":"Price: Low to High","nameAToZ":"Name: A to Z","nameZToA":"Name: Z to A"};for(var key in selectOption){selectOptionString+="<option value='"+key+"'>"+selectOption[key]+"</option>"}$("select[name=\"sortOrder\"]").each(function(){$(this).empty();$(this).append(selectOptionString);$(this).val("featured");$(this).change(function(){var selectedValue=$(this).val();sessionStorage.setItem("productSortOrder",selectedValue);if(ccPaginationElementExists){invokeCollectionApi(ccCurrentCollectonId,true,false,ccMaxCollectionProductsOnPage,ccCurrentPagePosition)}else{selectedValue&&searchCollections(selectedValue);fkProductCollection.length&&initializeProductRow(fkProductCollection)}})});$("[name=\"searchInput\"]")[0]&&$("[name=\"searchInput\"]")[0].addEventListener("input",function(){searchCollections(sessionStorage.getItem("productSortOrder"));fkProductCollection.length&&initializeProductRow(fkProductCollection)})}function showCenteredMessageInsideContainer(message,id){$("#fkEmptyCollection").remove();return"<div id='"+id+"' style='position: absolute;top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 18px; font-weight: 500;'>"+message+"</div>"}function invokeCollectionApi(_x,_x2,_x3,_x4,_x5){return _invokeCollectionApi.apply(this,arguments)}function _invokeCollectionApi(){_invokeCollectionApi=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(id,menuClicked,onPageLoad,pageSize,pageNumber){var productColNode,campaignId,sortOrderQuery,sortOrderValue,_response4,productListWithStoreFront,productList,productOrder,productsLength,_loop37,product,_i144,sortOrder;return _regeneratorRuntime().wrap(function _callee8$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:_context9.prev=0;if(id){_context9.next=4;break}console.error("Invalid collection id");return _context9.abrupt("return");case 4:$(".cc-pagination-bar-loader").show();$(".cc-pagination-bar").css({"pointer-events":"none"});if(onPageLoad&&!fkConfiguredProductCol){productColNode=$(".fk-product-col").first();fkConfiguredProductCol=productColNode.length?productColNode.clone(true):fkConfiguredProductCol}campaignId=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.campaignId;sortOrderQuery="";if(!ccPaginationElementExists){_context9.next=22;break}sortOrderValue=$("select[name=\"sortOrder\"]").val()||sessionStorage.getItem("productSortOrder");_context9.t0=sortOrderValue;_context9.next=_context9.t0==="priceHighToLow"?14:_context9.t0==="priceLowToHigh"?16:_context9.t0==="nameAToZ"?18:_context9.t0==="nameZToA"?20:22;break;case 14:sortOrderQuery="&sortBy=price&sortDir=1";return _context9.abrupt("break",22);case 16:sortOrderQuery="&sortBy=price&sortDir=0";return _context9.abrupt("break",22);case 18:sortOrderQuery="&sortBy=productName&sortDir=0";return _context9.abrupt("break",22);case 20:sortOrderQuery="&sortBy=productName&sortDir=1";return _context9.abrupt("break",22);case 22:_context9.next=24;return httpMethod("".concat(providerUrl,"/Collection/live/")+id+(pageSize&&pageNumber?"?resultsPerPage="+pageSize+"&page="+pageNumber+"&collections=1"+sortOrderQuery:""),JSON.stringify({skipRecommendations:1}));case 24:_response4=_context9.sent;if(!(_response4&&_response4.result==="SUCCESS")){_context9.next=48;break}productListWithStoreFront=_response4.message&&_response4.message.data&&_response4.message.data[campaignId]&&_response4.message.data[campaignId].products&&_response4.message.data[campaignId].products.filter(function(product){return product.storefront===1});ccMaxCollectionProducts=Number(_response4.message&&_response4.message.queryArgs.totalProducts)||1;ccPaginationElementExists&&ccLoadPaginationTabs();productList=[];if(!(_response4.message.queryArgs&&_response4.message.queryArgs.campaignProductId&&productListWithStoreFront&&productListWithStoreFront.length)){_context9.next=42;break}productOrder=_response4.message.queryArgs.campaignProductId.split(",").map(function(x){return parseInt(x)});productsLength=productOrder.length;_loop37=/*#__PURE__*/_regeneratorRuntime().mark(function _loop37(_i144){return _regeneratorRuntime().wrap(function _loop37$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:product=productListWithStoreFront.find(function(x){return x.campaignProductId===productOrder[_i144]});if(product){productList.push(product)}case 2:case"end":return _context8.stop()}},_loop37)});_i144=0;case 35:if(!(_i144<productsLength)){_context9.next=40;break}return _context9.delegateYield(_loop37(_i144),"t1",37);case 37:_i144++;_context9.next=35;break;case 40:_context9.next=43;break;case 42:productList=productListWithStoreFront;case 43:if(productList&&productList.length){fkCollectionData=_toConsumableArray(productList);fkProductCollection=_toConsumableArray(productList);sortOrder=sessionStorage.getItem("productSortOrder");if(sortOrder&&sortOrder!=="featured"){!ccPaginationElementExists&&sortCollectionOrder(sortOrder);$("select[name=\"sortOrder\"]").val(sortOrder)}if($("[name=\"searchInput\"]")[0])$("[name=\"searchInput\"]")[0].value="";initializeProductRow(fkProductCollection,menuClicked,onPageLoad)}else{fkCollectionData=_toConsumableArray(productList);fkProductCollection=_toConsumableArray(productList);initializeProductRow(fkProductCollection);$(".fk-product-row").append(showCenteredMessageInsideContainer("No products on this page","fkEmptyCollection"))}$(".cc-pagination-bar").css({"pointer-events":"auto"});!onPageLoad&&ccPaginationElementExists&&$("html, body").animate({scrollTop:0},1000);$(".cc-pagination-bar-loader").hide();return _context9.abrupt("return");case 48:fkCollectionData=[];fkProductCollection=[];initializeProductRow([{}],menuClicked,onPageLoad);$(".fk-product-row").append(showCenteredMessageInsideContainer("No products on this page","fkEmptyCollection"));$(".cc-pagination-bar").css({"pointer-events":"auto"});!onPageLoad&&ccPaginationElementExists&&$("html, body").animate({scrollTop:0},1000);$(".cc-pagination-bar-loader").hide();console.error(_response4.message);_context9.next=64;break;case 58:_context9.prev=58;_context9.t2=_context9["catch"](0);$(".cc-pagination-bar-loader").hide();$(".cc-pagination-bar").css({"pointer-events":"auto"});$(".fk-hide-on-load").css("visibility","visible");console.log(_context9.t2);case 64:case"end":return _context9.stop()}},_callee8,null,[[0,58]])}));return _invokeCollectionApi.apply(this,arguments)}function getTextNodes(element){var n,a=[],walk=document.createTreeWalker(element[0],NodeFilter.SHOW_TEXT,null,false);while(n=walk.nextNode())a.push(n);return a}function updateProductTileToken(tokenItem,productCol){var textNodeCollection=getTextNodes(productCol);textNodeCollection.forEach(function(textNode){var content=textNode.textContent;var remSubstring=content&&content.match(/{{(.*?)}}/g);if(remSubstring&&remSubstring.length>0){var _loop2=function _loop2(){var trimmedString=remSubstring[_i35].trim().replace(/(?:^(?:&nbsp;)+)|(?:(?:&nbsp;)+$)/g,"");token=trimmedString;trimmedString=trimmedString.split("{{")[1].split("}}")[0];var formattedValue="";if(tokenItem&&(tokenItem[trimmedString]||trimmedString==="stockQuantity")){formattedValue=tokenItem[trimmedString];if(trimmedString==="stockQuantity"&&!formattedValue){formattedValue="0"}if(formattedValue){if(trimmedString==="cycle1_price"){if(parseFloat(formattedValue).toFixed(2)==="0.00"){var variants=tokenItem.variants;if(variants&&variants.length>0&&!tokenItem.isVariantBundle&&!tokenItem.isEditable){var lowVarPrice=parseFloat(variants[0].price);var mulVariantPrices=false;variants.forEach(function(variant){var variantMemberPrice=getMemberPrice(variant).price;var currentVarPrice=variantMemberPrice?parseFloat(variantMemberPrice):parseFloat(variant.price);if(lowVarPrice&&lowVarPrice!==currentVarPrice){mulVariantPrices=true;lowVarPrice=lowVarPrice>currentVarPrice?currentVarPrice:lowVarPrice}});formattedValue=mulVariantPrices===true?lowVarPrice.toFixed(2)+"+":lowVarPrice.toFixed(2)}}else{tokenItem=getMemberPrice(tokenItem)?getMemberPrice(tokenItem):tokenItem;formattedValue=tokenItem[trimmedString];formattedValue=typeof formattedValue==="number"?formattedValue.toFixed(2):formattedValue}formattedValue=(parseFloat(formattedValue)*vatTaxRate).toFixed(2)}formattedValue=typeof formattedValue==="string"?formattedValue.replaceAll("\n","<br>"):formattedValue;if(trimmedString.match(/price/gi)){if(Number(formattedValue)===0&&trimmedString==="compareAtPrice"){formattedValue=""}else{formattedValue=pageData.selectedCampaign.currencySymbol+formattedValue}}textNode.textContent=content.replace(token,formattedValue);content=textNode.textContent}}else{textNode.textContent=content.replace(token,"");content=textNode.textContent}};for(var _i35=0;_i35<remSubstring.length;_i35++){_loop2()}}})}function initializeProductRow(collection,newMenuClicked,onPageLoad){fkCollectionSize=collection.length;var productRowCardsCount=sessionStorage.getItem("productRowCardsCount");if(productRowCardsCount&&productRowCardsCount!=="0"){scrolledCardsCount=parseInt(productRowCardsCount)}if(newMenuClicked){scrolledCardsCount=scrollCardsSlotSize;sessionStorage.setItem("productRowCardsCount",scrollCardsSlotSize)}var productRowNode=$(".fk-product-row").first();if(fkCollectionSize&&productRowNode.find(".fk-product-col").length){productRowNode.empty();if($(".fk-product-row").first().attr("lazyload")==="1"){populateProductRow(collection.slice(0,scrolledCardsCount),fkConfiguredProductCol)}else{populateProductRow(collection,fkConfiguredProductCol)}$(".fk-product-col").css("visibility","visible")}else if(productRowNode.find(".fk-product-col").length){$(".fk-product-col").css("visibility","hidden")}}function populateProductRow(collection,productTile){var productRow=$(".fk-product-row");var tile=productTile||$(".fk-product-col").first();tile.find("button").attr("disabled",false);tile.find("a").css("pointer-events","auto");if(productRow.length){collection.forEach(function(itemColl,index){var _pageData$selectedCam;var item=(_pageData$selectedCam=pageData.selectedCampaign.products.find(function(data){return data.campaignProductId===parseInt(itemColl.campaignProductId)}))!==null&&_pageData$selectedCam!==void 0?_pageData$selectedCam:itemColl;var productCol=tile.clone(true);var addToCartBtn=productCol.find("[action=addToCart],[action=addAndOpenCart]")[0];if(addToCartBtn){addToCartBtn.dataset.id=addToCartBtn.dataset.id+"_prodCol"+index}var routeActionBtn=productCol.find("[action=route][onclick='route(event)']")[0];if(routeActionBtn){routeActionBtn.dataset.id=routeActionBtn.dataset.id+"_prodCol"+index;routeActionBtn.setAttribute("offer",item.campaignProductId)}productCol.find(".fk-product-section").attr("value",item.campaignProductId);var productColImg=productCol.find(".fk-product-card-image-container").find("img");productColImg.length?productColImg.attr("src",item.imageUrl):productCol.find("img").attr("src",item.imageUrl);productCol.find("a").attr("offer",item.campaignProductId);updateProductTileToken(item,productCol);productRow.append(productCol)})}}function initInputAutoLoad(){var is_customer_known=cookieData["access_token"];var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));if(customerOrders){autoLoadInputs(customerOrders[0])}else if(is_customer_known){autoLoadInputFromCustomerOrder()}}function stopEventPropogationForInputs(inputsList,inputType){if(inputsList){var inputsListLength=inputsList.length;for(var _i36=0;_i36<inputsListLength;_i36++){var input=inputsList[_i36];if(input.type==="checkbox"||input.type==="radio")if(inputType==="surveyInputs")input.addEventListener("click",function(e){e.stopPropagation()});else{input.addEventListener("click",function(e){e.stopPropagation();var coupon=e.currentTarget.getAttribute("coupon");coupon=coupon&&coupon.trim().toUpperCase();if(coupon){if(e.currentTarget.checked){!appliedCouponCode.includes(coupon)&&appliedCouponCode.splice(0,0,coupon)}else{var index=appliedCouponCode.findIndex(function(item){return item===coupon});index!==-1&&appliedCouponCode.splice(index,1)}}displayPrices()})}}}}function ccRoundingPrice(value){if(![2,3,4,5].includes(pageData.pageTypeId)){return value}var itemTotalPrice=value;var currencyFee=Number(pageData.selectedCampaign.ccCurrencyFee);if(currencyFee){itemTotalPrice=itemTotalPrice*(1+currencyFee/100)}var ccCurrencyDecimals=pageData.selectedCampaign.ccCurrencyDecimals;var currencyRounding=pageData.selectedCampaign.ccCurrencyRounding||null;if((ccCurrencyDecimals===0||ccCurrencyDecimals)&&currencyRounding&&itemTotalPrice){var _price=itemTotalPrice.toString().split(".");if(currencyRounding===1){itemTotalPrice=_price[1]&&Number(_price[1])?(Number(_price[0])+1).toString():itemTotalPrice}else if(_price[1]&&Number(_price[1])>Number(currencyRounding)){itemTotalPrice=(Number(_price[0])+1).toString()+"."+currencyRounding}else{itemTotalPrice=_price[0]+"."+currencyRounding}}return parseFloat(itemTotalPrice)}function ccFormatCurrency(value,symbol,useValueDecimalCount){if(![2,3,4,5].includes(pageData.pageTypeId)){return(symbol||pageData.selectedCampaign.currencySymbol||"$")+value}var rValue=value&&value.toString()||"0";if(rValue){var splitValues=rValue.split(".");var ccCurrencyDecimals=pageData.selectedCampaign.ccCurrencyDecimals;var decimals=useValueDecimalCount?splitValues[1]?splitValues[1].length:0:ccCurrencyDecimals===0||ccCurrencyDecimals?ccCurrencyDecimals:2;if(decimals==0||decimals){rValue=decimals===0?splitValues[0]:splitValues[0]+"."+((splitValues[1]||"00")+"0000000000").substring(0,decimals)}if(pageData.selectedCampaign.ccCurrencyComma){rValue=rValue.replace(".",",")}var symbolAlign=pageData.selectedCampaign.ccCurrencySymbolAlign||"";var currencySymbol=pageData.selectedCampaign.currencySymbol||"$";switch(symbolAlign.toUpperCase()){case"RIGHT":rValue=rValue+currencySymbol;break;case"RIGHT_SPACE":rValue=rValue+"&nbsp;"+currencySymbol;break;case"LEFT_SPACE":rValue=currencySymbol+"&nbsp;"+rValue;break;default:rValue=currencySymbol+rValue}}return rValue}function ccSetCurrencyRules(currency){var currencyObj=fetchCurrentCurrencyObj(currency)||{};pageData.selectedCampaign.ccCurrencyDecimals=currencyObj.decimals;pageData.selectedCampaign.ccCurrencyFee=currencyObj.currencyFee;pageData.selectedCampaign.ccCurrencyComma=currencyObj.isComma;pageData.selectedCampaign.ccCurrencyRounding=currencyObj.rounding;pageData.selectedCampaign.ccCurrencySymbolAlign=currencyObj.symbolAlign;pageData.selectedCampaign.ccCurrencySendToGateway=currencyObj.sendToGateway;var currentCurrencySymbol=currency===pageData.selectedCampaign.currency?campaignBaseCurrencySymbol||"$":currencyObj["currencySymbol"];pageData.selectedCampaign.currencySymbol=currentCurrencySymbol;showVariantImageOnProductSection()}function ccUpdateTokenSpanValues(){var additionalSelector=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||1;var currencyCode=returnCurrencyCode(),pageTypeId=pageData.pageTypeId;var baseCurrency=!currencyCode||currencyCode===pageData.selectedCampaign.currency;var percProductTotal=Number(sessionStorage.getItem("ccCartProductsPercentageTotal"))||0;$("[data-cc-price]"+additionalSelector).each(function(){var ccPrice=$(this).attr("data-cc-price");var price=ccPrice&&parseFloat(ccPrice.includes(",")?ccPrice.replaceAll(",",""):ccPrice);if($(this).children().length===0&&(price||price==0)){var priceType=$(this).attr("data-cc-price-type")||"";var _productId=pageData.cartData&&$(this).attr("data-cc-prod-id");var useTax=[2,3,4].includes(pageTypeId);var cycle1PriceType=priceType.includes("cycle1_price");if(cycle1PriceType||priceType.includes("compareAtPrice")||priceType==="true"){if(cycle1PriceType&&$(this).attr("data-cc-perc-prod")==="true"){$(this).html(ccFormatCurrency((percProductTotal*Number(price)*0.01).toFixed(2)))}else{$(this).html(ccFormatCurrency(getItemPrice(_productId,price,1,!useTax).toFixed(2)))}}else{if(baseCurrency&&$(this).attr("data-cc-check-decimal")==="true"){$(this).html(ccFormatCurrency(ccPrice,null,true))}else{$(this).html(ccFormatCurrency((exchangeRate*price).toFixed(2)))}}}})}//set the prices and symbols as per the updated currency
function setPriceAndCurrency(selectedCurrencyCode){var campaignCurrencyCode=pageData.selectedCampaign.currency,campaignCurrencySelected=selectedCurrencyCode===campaignCurrencyCode;var newSymbol=campaignCurrencySelected?campaignBaseCurrencySymbol:sessionStorage.getItem("currencyCodeSymbol");var currencyCodeValue=returnCurrencyCode(),selectedCurrencyIsSessionCurrency=currencyCodeValue===selectedCurrencyCode;var ccExchangeRateList=JSON.parse(sessionStorage.getItem("ccExchangeRateList"))||{};sessionStorage.setItem("currencyCode",selectedCurrencyCode);var paypalSrc=pageData.pageTypeId===4&&$("[data-partner-attribution-id=CheckoutChampLLC_PPFM_PPCP]").attr("src");if(paypalSrc){$(".btnPayPal, .btnPayPal2").css("pointer-events","auto");$(".paypalSdkLoadFailureError, #paypal-notify").remove();!paypalSrc.includes(selectedCurrencyCode)&&configurePayPalSmartButtons()}function ccUpdateCurrencyValues(currencyChanged,exchangeRateValue,currencySymbol){currencyChanged&&sessionStorage.setItem("exchangeRate",exchangeRateValue);ccSetCurrencyRules(selectedCurrencyCode);sessionStorage.setItem("currencyCodeSymbol",currencySymbol);if(currencyChanged&&!appliedCouponCode.length){var discountsObj=sessionStorage.getItem("discountsObj");discountsObj?appliedCouponCode=JSON.parse(discountsObj)["coupons"]:null}displayPrices()}if(newSymbol&&(selectedCurrencyIsSessionCurrency||campaignCurrencySelected)){ccUpdateCurrencyValues(campaignCurrencySelected,1,newSymbol)}else{var currencyObj=fetchCurrentCurrencyObj(selectedCurrencyCode)||{};var currentCurrencySymbol=currencyObj["currencySymbol"]||selectedCurrencyCode;var checkoutAndCampaignCurrency=campaignCurrencyCode+"|"+selectedCurrencyCode;if(!ccExchangeRateList[checkoutAndCampaignCurrency]){httpMethod("".concat(providerUrl,"/Currency/exchangerate"),JSON.stringify({"currencyCode":selectedCurrencyCode,"baseCurrencyCode":campaignCurrencyCode})).then(function(data){if(data.result==="SUCCESS"){ccUpdateCurrencyValues(true,data.message,currentCurrencySymbol);ccExchangeRateList[checkoutAndCampaignCurrency]=data.message;sessionStorage.setItem("ccExchangeRateList",JSON.stringify(ccExchangeRateList))}})}else{ccUpdateCurrencyValues(true,ccExchangeRateList[checkoutAndCampaignCurrency],currentCurrencySymbol)}}}function paymentOptionElementDisplayHandler(){var fkPaymentOptionTogglerField=document.querySelectorAll(".fk-payment-option-toggler-field");if(fkPaymentOptionTogglerField&&fkPaymentOptionTogglerField.length>0){fkPaymentOptionTogglerField.forEach(function(element){var openId=element.getAttribute("opencheckboxsection");if(openId){var obj=document.getElementById(openId);if(!obj)return;if(element.checked){obj.style.display="flex";return}obj.style.display="none"}})}}function hideCollapsibleListBodyOnLoad(){try{var collapsibleList=document.querySelectorAll(".fk-collapsible-list-wrapper");collapsibleList.forEach(function(list){var item=list.querySelectorAll(".fk-collapsible-list-details");if(item.length){var collapsibleDetailElement=item[0];var openIcon=$(collapsibleDetailElement).find(".open-icon");var closeIcon=$(collapsibleDetailElement).find(".close-icon");if(list.dataset.open==="true"){collapsibleDetailElement.open=true;openIcon.hide()}else{collapsibleDetailElement.open=false;closeIcon.hide()}var iconContainer=collapsibleDetailElement.querySelectorAll(".fk-collapsible-list-icon-rotate");iconContainer.length===1?iconContainer[0].classList.add("fk-icon-rotate"):null;collapsibleDetailElement.onclick=function(e){if(!$(e.target).closest("summary").length)return;var scrollInView=$(e.currentTarget).closest("[data-scroll-in-view=true]");var container=$(e.currentTarget).closest("[data-toggle-collapsible=true]");var openValue=e.currentTarget.open;if(container.length){var details=container.find("details");details.attr("open",false);details.find(".open-icon").show();details.find(".close-icon").hide();$(e.currentTarget).attr("open",openValue)}if(!openValue){openIcon.hide();closeIcon.show()}else{openIcon.show();closeIcon.hide()}if(scrollInView.length&&!openValue){var summaryElement=$(e.currentTarget).find("summary").first();summaryElement.length&&summaryElement[0].scrollIntoView({behavior:"smooth",block:"center"})}return true}}})}catch(error){console.log(error)}}//fetch the current currency symbol
function fetchCurrentCurrencyObj(currencyCode){return pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencies&&pageData.selectedCampaign.currencies.find(function(obj){return obj.currencyCode===currencyCode})}function changeFaviconLink(url){if(url&&url.length>0){var link=$("head link[rel=\"shortcut icon\"]")||$("head link[rel=\"icon\"]");if(link&&link.length>0){$(link).attr("href",url)}else{var newLink=$("<link>");newLink.attr("href",url);newLink.attr("rel","shortcut icon");$("head").append(newLink)}}}function ccSetAttributesForYTAPI(targetElement,id,logs,type){try{if(YT&&YT.Player){$(targetElement).attr("id",id);$(targetElement).attr("data-video-logs",logs);$(targetElement).attr("data-video-type",type);ccYTAPIObjs[id]=new YT.Player(id,{events:{"onReady":ccOnYTPlayerReady,"onStateChange":ccOnYTPlayerStateChange}})}}catch(error){}}function loadYoutubeThumbnails(){var element=document.querySelectorAll(".fk-youtube");var _loop3=function _loop3(){var isEmbedClassExists=element[i].classList.value.match(/embed-responsive\S{0,}/g);source="https://img.youtube.com/vi/"+element[i].getAttribute("fk-video-id")+"/sddefault.jpg";div=document.createElement("DIV");div.style.backgroundImage="url('"+source+"')";if(isEmbedClassExists){div.style.top="0"}div.className="fk-rm image";div.addEventListener("load",function(){element[i].appendChild(div)}(i));var ytSrcIframe=$(element[i]).find("iframe");var iframeVideoType=ytSrcIframe.attr("data-video-type");var iframeVideoLogs=ytSrcIframe.attr("data-video-logs");var supportVSL=["yt","ytnc"].includes(iframeVideoType)&&iframeVideoLogs;var fkVideoSrc=element[i].getAttribute("fk-video-src");if(fkVideoSrc.includes("autoplay=1")||element[i].classList.contains("fk-disable-lazy")){iframe=getYoutubeIframe();isEmbedClassExists&&iframe.classList.add("embed-responsive-item");if(fkVideoSrc.includes("autoplay=1")){iframe.setAttribute("src",fkVideoSrc+"&mute=1")}else{iframe.setAttribute("src",fkVideoSrc)}element[i].innerHTML="";element[i].appendChild(iframe);supportVSL&&ccSetAttributesForYTAPI(iframe,"ccytvsl"+getUniqueId(),iframeVideoLogs,iframeVideoType)}else{element[i].addEventListener("click",function(){var iframe=getYoutubeIframe();isEmbedClassExists&&iframe.classList.add("embed-responsive-item");iframe.setAttribute("src","https://www.youtube.com/embed/"+this.getAttribute("fk-video-id")+"?rel=0&showinfo=0&autoplay=1"+(supportVSL?"&enablejsapi=1":""));this.innerHTML="";this.appendChild(iframe);supportVSL&&ccSetAttributesForYTAPI(iframe,"ccytvsl"+getUniqueId(),iframeVideoLogs,iframeVideoType)})}},source,div,iframe;for(var i=0;i<element.length;i++){_loop3()};}function getYoutubeIframe(){var iframe=document.createElement("iframe");iframe.setAttribute("frameborder","0");iframe.setAttribute("allowfullscreen","");iframe.setAttribute("allow","autoplay");return iframe}function updateReplacementProducts(orderItems){// Converting Nodelists to normal arrays to avoid forEach errors in Microsoft Edge - FUN2-1637
var productInputs=_toConsumableArray(document.getElementsByName("product"));if(productInputs){productInputs.forEach(function(product){var replacementProductValue=product.getAttribute("replaceproductid");if(replacementProductValue&&replacementProductValue.toLowerCase()!=="none"&&product.tagName.toLowerCase()==="input"){if(product.checked){if(orderItems[replacementProductValue]){delete orderItems[replacementProductValue]}}else{if(!orderItems[replacementProductValue]){orderItems[replacementProductValue]=1}}}})}return orderItems}function updateCheckboxAndRadioProductIdHashMap(){var shoppingCart=document.querySelectorAll(".fk-shopping-cart");if(shoppingCart&&shoppingCart.length||$(".cc-cart-container").length){var productInputs=document.querySelectorAll(".fk-product-checkbox, .fk-product-radio");var productInputsCount=productInputs.length;for(var _i37=0;_i37<productInputsCount;_i37++){var _item2=productInputs[_i37];var type=_item2.getAttribute("type");var value=_item2.getAttribute("value");if((type==="checkbox"||type==="radio")&&value){fkCheckboxAndRadioProductIdHashMap[value]=true}}}}function ccCaptchaAssessmentCallback(_x6,_x7,_x8,_x9,_x10){return _ccCaptchaAssessmentCallback.apply(this,arguments)}function _ccCaptchaAssessmentCallback(){_ccCaptchaAssessmentCallback=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(token,uniqueId,action,successCallbackFn,failureCallbackFn){var params,options,res,resJson;return _regeneratorRuntime().wrap(function _callee9$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:_context10.prev=0;if(token){_context10.next=3;break}return _context10.abrupt("return");case 3:params={"event":{"token":token,"expectedAction":action,"siteKey":captchaSiteKey}};options={"method":"POST","headers":{"Content-Type":"application/json"},"body":JSON.stringify(params)};_context10.next=7;return fetch("https://recaptchaenterprise.googleapis.com/v1/projects/"+captchaProjectId+"/assessments?key="+captchaAssessmentKey,options);case 7:res=_context10.sent;_context10.next=10;return res.json();case 10:resJson=_context10.sent;if(!(resJson&&resJson.tokenProperties.valid&&resJson.riskAnalysis.score>=Number(captchaThresholdScore)&&resJson.tokenProperties.action===resJson.event.expectedAction)){_context10.next=18;break}uniqueId&&$("#"+uniqueId).hide();if(!successCallbackFn){_context10.next=16;break}_context10.next=16;return successCallbackFn();case 16:_context10.next=22;break;case 18:if(!failureCallbackFn){_context10.next=21;break}_context10.next=21;return failureCallbackFn();case 21:if(captchaFailRedirect)window.location.href=captchaFailRedirect;case 22:_context10.next=31;break;case 24:_context10.prev=24;_context10.t0=_context10["catch"](0);uniqueId&&$("#"+uniqueId).hide();if(!failureCallbackFn){_context10.next=30;break}_context10.next=30;return failureCallbackFn();case 30:console.log(_context10.t0);case 31:case"end":return _context10.stop()}},_callee9,null,[[0,24]])}));return _ccCaptchaAssessmentCallback.apply(this,arguments)}function ccGenerateCaptchaToken(uniqueId,skipUniqueIdPassing,successCallback,failCallback){if(window.grecaptcha&&window.grecaptcha.enterprise){var action="VERIFY",sectionId=skipUniqueIdPassing?null:uniqueId;if(captchaType==="2"){grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.render(uniqueId,{"sitekey":captchaSiteKey,"action":action,"callback":function callback(token){ccCaptchaAssessmentCallback(token,sectionId,action,successCallback,failCallback)}})})}else{grecaptcha.enterprise.ready(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return grecaptcha.enterprise.execute(captchaSiteKey,{action:action});case 2:token=_context2.sent;ccCaptchaAssessmentCallback(token,sectionId,action,successCallback,failCallback);case 4:case"end":return _context2.stop()}},_callee2)})))}}}function ccAddReCaptchaScripts(){try{var pageId=pageData&&pageData.pageTypeId,checkoutPage=pageId===4,loginPage=pageId===7;if((loginPage||checkoutPage&&$("[name='cardNumber']").length)&&captchaSiteKey&&captchaAssessmentKey&&captchaProjectId){var ccSetPageLoadCookies=function ccSetPageLoadCookies(){var cookie=pageData&&pageData.pageTypeId===4?"ccCheckoutPageLoad":"ccLoginPageLoad";ccSetCookie(cookie,"true",false,5*60*1000)};var alphabets="abcdefghijklmnopqrstuvwxyz";var randomLetter=alphabets[Math.floor(Math.random()*alphabets.length)];var uniqueId=randomLetter+Math.random().toString(36).substring(7);var captchaLoadCookiesExists=checkoutPage&&!ccGetCookie("ccCheckoutPageLoad")||loginPage&&!ccGetCookie("ccLoginPageLoad");if(captchaType==="2"){$.getScript("https://www.google.com/recaptcha/enterprise.js?render=explicit",function(){if(captchaLoadCookiesExists&&captchaTrigger==="1"){$("head").append("<style>#"+uniqueId+"{position: fixed;top: 0;left: 0;height: 100vh;width: 100vw;background-color: white;display: flex;z-index:2000000000;} #"+uniqueId+" div{margin: 10px auto;}</style>");$("body").append("<div id=\""+uniqueId+"\"></div>");ccGenerateCaptchaToken(uniqueId,false,ccSetPageLoadCookies)}})}else{$.getScript("https://www.google.com/recaptcha/enterprise.js?render="+captchaSiteKey,function(){if(captchaLoadCookiesExists&&captchaTrigger==="1"){ccGenerateCaptchaToken(uniqueId,true,ccSetPageLoadCookies)}})}}}catch(err){console.log(err)}}function ccUpdateCampaignId(){var pageTypeId=pageData&&pageData.pageTypeId;if(pageTypeId===7)return;var campaignId=pageTypeId===13?Number(sessionStorage.getItem("ccChangeProductCampaignId")):Number(sessionStorage.getItem("ccCampaignId"));if(campaignId){pageData.selectedCampaign.campaignId=campaignId;pageData.funnelData.campaign=campaignId}}function fetchPageData(){var isBuildOrTemplate=checkBuildOrTemplate();var funnelJsonResult=funnelJson;var campaignJsonResult=campaignJson;var funnelData=funnelJsonResult&&!funnelJsonResult.isFunnel?funnelJsonResult.funnelTemplateData:funnelJsonResult.funnelData;var faviconUrl=funnelJsonResult&&funnelJsonResult.faviconUrl;changeFaviconLink(faviconUrl);pageData.funnelData=funnelData;window.ccFacebookPixelID=getProvidersData(2);var currentFunnelData=sessionStorage.getItem("funnelData")!="undefined"?JSON.parse(sessionStorage.getItem("funnelData")):null;if(document.getElementById("fk-dynamic-orders-table")){sessionStorage.removeItem("orderStatusInfo")}if(currentFunnelData&&currentFunnelData.referenceId!=funnelData.referenceId){sessionStorage.removeItem("sessionId");sessionStorage.removeItem("ccExternalSessionId");sessionStorage.removeItem("requestUri");sessionStorage.removeItem("orderId");sessionStorage.removeItem("orderData");sessionStorage.removeItem("userDetails");sessionStorage.removeItem("products");sessionStorage.removeItem("bundleItems");sessionStorage.removeItem("bundleStringArray");sessionStorage.removeItem("bundleProductsPageRef");sessionStorage.removeItem("dynamicUpsellsByPageRef");sessionStorage.removeItem("importOrderSuccess");sessionStorage.removeItem("importOrderSuccessGA");sessionStorage.removeItem("importOrderSuccessSC");sessionStorage.removeItem("importUpsellSuccessSC");sessionStorage.removeItem("importUpsellSuccess");sessionStorage.removeItem("importUpsellSuccessGA");sessionStorage.removeItem("importOrderSuccessSygnal");sessionStorage.removeItem("importUpsellSuccessSygnal")}if(!sessionStorage.getItem("requestUri")){sessionStorage.setItem("requestUri",getCurrentWindowLocation().href);sessionStorage.setItem("httpReferer",document.referrer)}sessionStorage.setItem("funnelData",JSON.stringify(funnelData));pageData.currentPage=getCurrentPage(funnelData);setSplitSelected(pageData.currentPage);var currentSlug=window.location.pathname.substring(1).split(".")[0];try{if(currentSlug!==""&&currentSlug!==pageData.pageViewReferenceId&&currentSlug!==pageData.currentPage.urlSlug&&checkDomainForRoute()===false){window.history.replaceState({},"","/"+(pageData.currentPage.urlSlug||pageData.pageViewReferenceId+".html")+window.location.search)}}catch(ex){console.log(ex)}var funnelTitle=pageData.currentPage.isPageTitle?pageData.currentPage.title:funnelData.title;funnelTitle?$("title").text(funnelTitle):$("title").text("Checkout Champ");pageData.pageTypeId=pageData.currentPage&&pageData.currentPage.pageView[0].pageType;![13,18,34].includes(pageData.pageTypeId)&&(ccDynamicProductSection||dynamicOrderBump)&&sessionStorage.removeItem("currentItem");if(pageData.pageTypeId===5){sessionStorage.removeItem("currentItem");sessionStorage.removeItem("isSubscribeOn")}pageData.pageTypeId===4&&ccLoadOpenPathScript();ccInitializeStamped();globalOrderData=pageData.pageTypeId===9?JSON.parse(sessionStorage.getItem("orderStatusInfo")):JSON.parse(sessionStorage.getItem("orderData"));isVatOnOrder=globalOrderData&&globalOrderData.items&&Object.values(globalOrderData.items)[0].vatPrice;pageData.salt=funnelData.salt;sessionStorage.setItem("fk_salt",pageData.salt);pageData.navigationItems=funnelJsonResult.elements.filter(function(element){return element.pageViewReferenceId===pageData.currentPage.pageView[0].referenceId});pageData.selectedCampaign=campaignJsonResult.selectedCampaign;ccUpdateCampaignId();(pageData.pageTypeId===4||pageData.pageTypeId===9)&&checkForMembershipLogin();!isBuildOrTemplate&&pageData.pageTypeId===3&&updatePaymentButtons(globalOrderData);updateCheckboxAndRadioProductIdHashMap();campaignBaseCurrencySymbol=pageData.selectedCampaign.currencySymbol;ccAddReCaptchaScripts();swapCartProducts().then(function(){var variationIds=setOrderItemDetails();if(variationIds.length>0){populateVariantAsync(variationIds.join(",")).then(function(data){if(data.result==="SUCCESS"){populateProductVariants(data.message)}HeadAndInitializePage()})}else{HeadAndInitializePage()}})}function HeadAndInitializePage(){return _HeadAndInitializePage.apply(this,arguments)}function _HeadAndInitializePage(){_HeadAndInitializePage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){var currencyCode,captureLeadArray,rightPanelEnabledPages,purchaseActionPageTypes;return _regeneratorRuntime().wrap(function _callee10$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:if(!document.URL.includes("funnels-build"))getHeadCode();campaignBaseCurrencySymbol=pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol;currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;ccSetCurrencyRules(currencyCode);initializePage();captureLeadArray=[2,4,15];rightPanelEnabledPages=[2,17,18,34];if(captureLeadArray.includes(pageData.pageTypeId)&&!finishProcessing){captureLeadInterval=window.setInterval(function(){captureLead()},10000)}if(rightPanelEnabledPages.includes(pageData.pageTypeId)){showRightPanel()}$("img").each(function(){var hrefAttr=$(this).attr("href");if(hrefAttr!==""&&hrefAttr!==undefined&&hrefAttr!==false&&hrefAttr!==null){$(this).css("cursor","pointer");$(this).hover(function(){$(this).css("opacity","0.5")},function(){$(this).css("opacity","1")})}});if(pageData.pageTypeId!==13)sessionStorage.removeItem("ccActionPurchaseItem");if(!isMembershipPage(pageData.pageTypeId)){_context11.next=16;break}purchaseActionPageTypes=[10,11,13,31];if(!purchaseActionPageTypes.includes(pageData.pageTypeId)){sessionStorage.removeItem("actionPurchaseId");sessionStorage.removeItem("actionProductId");sessionStorage.removeItem("actionCurrentItem");sessionStorage.removeItem("actionNextBillDate");sessionStorage.removeItem("actionCurrentProductQty")}_context11.next=16;return validateToken();case 16:callWindowLoad();fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):{};case 18:case"end":return _context11.stop()}},_callee10)}));return _HeadAndInitializePage.apply(this,arguments)}function ccShowBSAlert(content,alertClass,removeAlert){var alertColorClass=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"alert-danger";var boldText=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"Alert :";try{removeAlert&&alertClass&&$("."+alertClass).remove();$("body").append("<div style='padding-top: 15px; padding-bottom: 15px; position: fixed; top: 0; width: 100%; z-index: 99999999;' class='alert "+alertClass+" "+alertColorClass+" alert-dismissible fade show' role='alert'><strong>"+boldText+"</strong> "+content+"<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>")}catch(err){}}function ccConfigureAndInitializeAgeVerificationScript(){try{var showAVStatus=function showAVStatus(status){switch(status||sessionStorage.getItem("ccAgeVerificationStatus")){case"SUCCESS":ccShowBSAlert("Age verification succeeded"+messageWithId+".","cc-av-popup-alert",true,"alert-success");break;case"FAIL":ccShowBSAlert("Age verification failed"+messageWithId+". Please contact customer support for inquiries related to order status.","cc-av-popup-alert",true);break;case"CLOSED":ccShowBSAlert("Age verification is required"+messageWithId+". Please reload the page and complete age verification to prevent order cancellation.","cc-av-popup-alert",true)}};var avPluginId=getAddOnKeyValue(findAddOn("AV_PLUGIN_ID"));if(!avPluginId)return;$(".cc-av-popup-alert").remove();var avSection=$(".cc-show-av-popup"),avSectionBtn=avSection.find("button");var _orderData2=pageData&&pageData.pageTypeId===5&&sessionStorage.getItem("orderData");_orderData2=_orderData2?JSON.parse(_orderData2):null;var _orderId=_orderData2&&_orderData2.orderId,messageWithId=_orderId?" for order with ID "+_orderId:"";var avStatus=sessionStorage.getItem("ccAgeVerificationStatus");if(_orderData2&&_orderData2.reviewStatus==="AGE"&&(!avStatus||avStatus==="CLOSED")){sessionStorage.removeItem("ccAgeVerificationStatus");var avClientId=getAddOnKeyValue(findAddOn("AV_ClientId")),avLevel=getAddOnKeyValue(findAddOn("AV_Level"));if(avClientId&&avLevel){var oneAccountLoadSuccessCallback=function oneAccountLoadSuccessCallback(){try{ccShowBSAlert("Please wait. Validating order details for age verification.","cc-av-popup-alert",true);avSection.find("button").attr("disabled",true);if(window.PUSH_API){PUSH_API.init({authCode:_orderData2.orderId,avLevel:avLevel,clientId:avClientId,onClose:function onClose(){$(".cc-show-av-popup").find("button").attr("disabled",false);sessionStorage.setItem("ccAgeVerificationStatus","CLOSED");showAVStatus("CLOSED")},onComplete:function onComplete(response){$(".cc-show-av-popup").find("button").attr("disabled",false);if(response.status==="AV_SUCCESS"){sessionStorage.setItem("ccAgeVerificationStatus","SUCCESS")}else if(response.status==="AV_FAIL"){sessionStorage.setItem("ccAgeVerificationStatus","FAIL");showAVStatus("FAIL")}}});var iframe=document.querySelector("iframe#one-account-push-api");iframe&&iframe.addEventListener("load",function(){$(".cc-av-popup-alert").remove();avSection.length&&avSection.show();if(avSectionBtn.length){avSectionBtn.attr({"disabled":false,"onclick":""});avSectionBtn.on("click",function(event){event.preventDefault();var avPopupBtn=$(".cc-show-av-popup").find("button");avPopupBtn.attr("disabled",true);$(".cc-av-popup-alert").remove();var avSessionStatus=sessionStorage.getItem("ccAgeVerificationStatus");if(!avSessionStatus){PUSH_API.validate(userData)}else{showAVStatus(avSessionStatus);avPopupBtn.attr("disabled",false)}})}else{PUSH_API.validate(userData)}})}}catch(err){console.log(err)}};var oneAccountLoadFailureCallback=function oneAccountLoadFailureCallback(){ccShowBSAlert("Age verification script load failed. Please reload the page and complete verification or contact support.","cc-av-popup-alert",true)};var userData={"msisdn":_orderData2.phoneNumber||"","email":_orderData2.emailAddress||"","forename":_orderData2.firstName||"","surname":_orderData2.lastName||"","city":_orderData2.city||"","street":_orderData2.address1||"","building":_orderData2.address2||"","postCode":_orderData2.postalCode||"","country":_orderData2.country||""};if(Number(avLevel)>2)userData["dobDay"]="";loadScript("https://www.1account.net/pushApi/index.js",oneAccountLoadSuccessCallback,null,"one-account-push-api",null,null,null,oneAccountLoadFailureCallback)}}else{showAVStatus(avStatus)}}catch(err){console.log(err)}}function showRightPanel(){// To load the required styles and html content for right panel
if($("body").find(".rightPanelHTML").length!==0){$("head").append("<style>".concat(rightPanelStyles,"</style>"));$(".rightPanelHTML").css("display","block")}}function removeCartIcon(){// To remove the cart icon and quantity circle for Upsell and Thank you pages
$(".fk-parent-cart-element, .rightPanelHTML").remove()}function removeMenuElement(){// To remove menu elements and hamburger icon from upsell and thank you pages
$(".fk-menu-btn-container, .fk-menu-container").remove()}function getCurrentPage(funnelData){var funnelPages=funnelData.pages;if(funnelPages&&funnelPages.length){var matchedPage=$.grep(funnelPages,function(page){var currentPageView=page&&page.pageView&&page.pageView[0];if(currentPageView){return currentPageView.referenceId===pageData.pageViewReferenceId}});return matchedPage&&matchedPage[0]}return null}function autoLoadInputFromCustomerOrder(){orderQuery().then(function(){var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));autoLoadInputs(customerOrders[0])})["catch"](function(error){consumerLogout(false)})}function autoLoginCookie(){var productData=getNavigationItemFromPageData(cookieData["buttonId"]);var loginUrl=getCurrentWindowLocation().protocol+"//"+getCurrentWindowLocation().host+getCurrentWindowLocation().pathname;localStorage.setItem("loginUrl",loginUrl);if(localStorage.getItem("isMembershipLogin")==="true"){if(cookieData["status"]===active){clubQuery(cookieData["clubId"],cookieData["memberId"],productData)}else{var _route="";var inActiveNavItem=pageData.navigationItems.find(function(element){return element.status&&element.status.toUpperCase()===inActive});var linkWithNoProduct=inActiveNavItem&&inActiveNavItem.linkDetails.find(function(linkDetail){return linkDetail.products.length===0});if(linkWithNoProduct){_route=redirectPath(linkWithNoProduct,true)}else{var savedButtonLink=pageData.navigationItems.find(function(element){return element.elementId===cookieData["buttonId"]});savedButtonLink?_route=redirectPath(savedButtonLink.linkDetails[0],true):null}if(!_route){clubLogout(true);return}clubQuery(cookieData["clubId"],cookieData["memberId"],productData,_route)}}else{Promise.all([customerQuery(),orderQuery()]).then(function(){var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var orderInfo=customerOrders.find(function(_ref3){var orderId=_ref3.orderId;return orderId===cookieData["orderId"]})||customerOrders[customerOrders.length-1];sessionStorage.setItem("loginOrder",JSON.stringify(orderInfo));if(orderInfo&&orderInfo.items){var clubMembershipProducts=Object.entries(orderInfo.items).map(function(item){return parseInt(item[1].productId)});sessionStorage.setItem("orderLoginProducts",JSON.stringify(clubMembershipProducts));memberProductRoute(clubMembershipProducts,productData)}})["catch"](function(error){consumerLogout(false)})}}var importClickcounter=0;function triggerImportClick(pageType,firstTimeLoad,externalSessionId){if(sessionStorage.getItem("sessionId")){return}importClick(pageType,externalSessionId).then(function(data){if(sessionStorage.getItem("sessionId")){return}if(data.result==="SUCCESS"){window.ccInitializeIdMe&&ccInitializeIdMe(providerUrl,externalSessionId,pageData);var jsonStr=JSON.stringify(data);sessionStorage.setItem("sessionId",jsonStr);if(data.message){if(data.message.pixel)firePixel(data.message.pixel);if(data.message.siftBeaconKey)fireSiftPixel(data.message.siftBeaconKey)}firstTimeLoad&&registerClick(0);loadCCPayPalFraudNetScripts()}else if(data.message==="duplicate"){window.ccInitializeIdMe&&ccInitializeIdMe(providerUrl,externalSessionId,pageData);var sessionValue={"result":"SUCCESS","message":{"sessionId":externalSessionId}};sessionStorage.setItem("sessionId",JSON.stringify(sessionValue));firstTimeLoad&&registerClick(0);loadCCPayPalFraudNetScripts()}else if(data.message==="session failed"){if(pageType!==3&&pageType!==5){if(importClickcounter<4){setTimeout(function(){triggerImportClick(pageType,firstTimeLoad,externalSessionId)},3000)}importClickcounter++}else{$("body").append(data.message)}}else{$("body").append(data.message)}response=data})}function checkForMembershipLogin(){if(pageData&&pageData.currentPage&&pageData.currentPage.isMembershipRequired&&!(cookieData["access_token"]&&cookieData["memberId"]&&cookieData["status"]===active)){redirectToLoginPage()}}function updatePaymentButtons(orderData){var pageNavigationItems=pageData&&pageData.navigationItems;var isGooglePayCheckout=orderData&&orderData.prepaidType==="GOOGLEPAY";var isApplePayCheckout=orderData&&orderData.prepaidType==="APPLEPAY";var isGooglePay=isGooglePayCheckout&&($(".btnGoogle1").length||$(".btnGoogle2").length);var isApplePay=isApplePayCheckout&&$(".btnApplePay").length;for(var _i38=0;_i38<pageNavigationItems.length;_i38++){var btnLinkEle=$("[data-id="+pageNavigationItems[_i38].elementId+"]")[0];var btnLinkAction=btnLinkEle&&btnLinkEle.getAttribute("action");var btnLinkClassList=btnLinkEle&&btnLinkEle.classList;if(btnLinkAction==="submit"){if(isGooglePay){if(!(btnLinkClassList.contains("btnGoogle1")||btnLinkClassList.contains("btnGoogle2")))btnLinkEle.remove()}else if(isGooglePayCheckout&&!btnLinkClassList.contains("cc-one-click-btn")){btnLinkClassList.add("cc-global-payment-btn");btnLinkClassList.contains("btnApplePay")&&btnLinkEle.remove()}else if(isApplePay){if(!btnLinkClassList.contains("btnApplePay"))btnLinkEle.remove()}else if(isApplePayCheckout&&!btnLinkClassList.contains("cc-one-click-btn")){btnLinkClassList.add("cc-global-payment-btn");(btnLinkClassList.contains("btnGoogle1")||btnLinkClassList.contains("btnGoogle2"))&&btnLinkEle.remove()}else if(btnLinkClassList.contains("btnGoogle1")||btnLinkClassList.contains("btnGoogle2")||btnLinkClassList.contains("btnApplePay")){btnLinkEle.remove()}}}}function addTripleWhaleDefaultScript(shopPayUrl){try{$("head").append("<link rel='preconnect dns-prefetch' href='https://api.config-security.com/' crossorigin /><link rel='preconnect dns-prefetch' href='https://conf.config-security.com/' crossorigin /><link rel='preconnect dns-prefetch' href='https://whale.camera/' crossorigin />");var tripleWhaleGlobalScript=document.createElement("script");var url=shopPayUrl&&shopPayUrl.replace("https://","");tripleWhaleGlobalScript.innerHTML="window.TriplePixelData={TripleName:'"+url+"',ver:'2.11',plat:'SHOPIFY',isHeadless:true},function(W,H,A,L,E,_,B,N){function O(U,T,P,H,R){void 0===R&&(R=!1),H=new XMLHttpRequest,P?(H.open('POST',U,!0),H.setRequestHeader('Content-Type','application/json')):H.open('GET',U,!0),H.send(JSON.stringify(P||{})),H.onreadystatechange=function(){4===H.readyState&&200===H.status?(R=H.responseText,U.includes('.txt')?eval(R):P||(N[B]=R)):(299<H.status||H.status<200)&&T&&!R&&(R=!0,O(U,T-1,P))}}if(N=window,!N[H+'sn']){N[H+'sn']=1,L=function(){return Date.now().toString(36)+'_'+Math.random().toString(36)};try{A.setItem(H,1+(0|A.getItem(H)||0)),(E=JSON.parse(A.getItem(H+'U')||'[]')).push({u:location.href,r:document.referrer,t:Date.now(),id:L()}),A.setItem(H+'U',JSON.stringify(E))}catch(e){}var i,m,p;A.getItem('\"!nC`')||(_=A,A=N,A[H]||(E=A[H]=function(t,e,a){return void 0===a&&(a=[]),'State'==t?E.s:(W=L(),(E._q=E._q||[]).push([W,t,e].concat(a)),W)},E.s='Installed',E._q=[],E.ch=W,B='configSecurityConfModel',N[B]=1,O('https://conf.config-security.com/model',5),i=L(),m=A[atob('c2NyZWVu')],_.setItem('di_pmt_wt',i),p={id:i,action:'profile',avatar:_.getItem('auth-security_rand_salt_'),time:m[atob('d2lkdGg=')]+':'+m[atob('aGVpZ2h0')],host:A.TriplePixelData.TripleName,plat:A.TriplePixelData.plat,url:window.location.href,ref:document.referrer,ver:A.TriplePixelData.ver},O('https://api.config-security.com/event',5,p),O('https://whale.camera/live/dot.txt',5)))}}('','TriplePixel',localStorage);";$("head").append(tripleWhaleGlobalScript)}catch(err){err}}function addTripleWhaleFollowUpScript(buyerEmail){try{if(buyerEmail){var tripleWhaleFollowUpScript=document.createElement("script");var tripleWhaleFollowUpScriptText="~function TP(){const email = '"+buyerEmail+"';if(!email||!window.TriplePixel){setTimeout(TP, 400); return;}TriplePixel('Contact', {email:email})}();";tripleWhaleFollowUpScript.append(tripleWhaleFollowUpScriptText);$("head").append(tripleWhaleFollowUpScript);sessionStorage.setItem("tripleWhaleFollowUpScriptAdded",true)}}catch(err){err}}function ccCreateSession(pageType,firstTimeLoad){try{if(!sessionStorage.getItem("requestUri")){sessionStorage.setItem("requestUri",getCurrentWindowLocation().href);sessionStorage.setItem("httpReferer",document.referrer)}var ccExternalSessionId=sessionStorage.getItem("ccExternalSessionId")||ccGenerateRandomUUID();var headCode=document.head.innerHTML;var _ccUrlParams=new URLSearchParams(getCurrentWindowLocation().search);if(headCode&&headCode.includes("EF.urlParameter('_ef_transaction_id')")&&_ccUrlParams.has("oid")&&!checkBuildOrTemplate()){var clickEventCalled=true;var cValueRegEx=/\s*updateURLParameter+\s*[(]+\s*window.location.href+\s*,+\s*"+(c+[1-3])+"\s*,+\s*\S+[)]+\s*/;var cValue=headCode.match(cValueRegEx);cValue=cValue&&cValue[1]||"c1";var EFInterval=setInterval(function(){_ccUrlParams=new URLSearchParams(getCurrentWindowLocation().search);var cValueCheck=_ccUrlParams.has(cValue)&&_ccUrlParams.get(cValue);if(cValueCheck&&cValueCheck.length===32){clearInterval(EFInterval);sessionStorage.setItem("requestUri",getCurrentWindowLocation().href);clickEventCalled&&triggerImportClick(pageType,firstTimeLoad,ccExternalSessionId);clickEventCalled=false}},300);setTimeout(function(){if(clickEventCalled){clearInterval(EFInterval);sessionStorage.setItem("requestUri",getCurrentWindowLocation().href);triggerImportClick(pageType,firstTimeLoad,ccExternalSessionId);clickEventCalled=false}},5000)}else{triggerImportClick(pageType,firstTimeLoad,ccExternalSessionId)}}catch(err){err}}function initializePage(){var queryString=getCurrentWindowLocation().search;var ccUrlParams=new URLSearchParams(queryString);var firstTimeLoad=isFirstTime();var isBuildOrTemplate=checkBuildOrTemplate();var externalSessionId=sessionStorage.getItem("ccExternalSessionId");if(pageData){var triggerUseSession=function triggerUseSession(sessionId,ccSessionCreated){useSession(sessionId,pageType,pageData.currentPage.referenceId).then(function(data){if(data.message==="session failed"){if(pageType!=="upsellPage"&&pageType!=="thankyouPage"){if(useSessionCounter<10){setTimeout(function(){ccSessionCreated&&triggerUseSession(sessionId,ccSessionCreated)},3000)}useSessionCounter++}else{$("body").append(data.message)}}if(data.result==="ERROR"){$("body").append(data.message)}if(data.message){if(data.message.pixel)firePixel(data.message.pixel);if(data.message.siftBeaconKey)fireSiftPixel(data.message.siftBeaconKey)}})};//import click need to be called on the load of every page, so I added this function to the template
var pageType=pageData.pageTypeId;var pageTypeId=pageType;var shopPayUrl=pageData.selectedCampaign&&pageData.selectedCampaign.shopPayUrl,orderEmail=globalOrderData&&globalOrderData.emailAddress;var tripleWhaleTracking=shopPayUrl&&getAddOnKeyValue(findAddOn("TRIPLE_WHALE_REQ"))==="true";tripleWhaleTracking&&addTripleWhaleDefaultScript(shopPayUrl);var fflApplied=pageTypeId===3&&globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber;if(!fflApplied&&[3,4].includes(pageTypeId)){pageData.selectedCampaign&&pageData.selectedCampaign.ffl&&pageData.selectedCampaign.ffl.length?addFFLPopUp():null;addFFLInfoOnPage()}switch(pageType){// Lead page
case 2:case"Lead":case 15:case"Opt-in":pageType="leadPage";initAddressFields();removeNavigationOffersFromCart();break;// Checkout Page
case 4:case"Checkout":pageType="checkoutPage";window.ccInitializeIdMe&&window.ccInitializeIdMe(providerUrl,null,pageData);initSocialProof();initAddressFields();ccInitializeSocialProof();assignProdQtyEventListeners();assignCardDetailsEventListeners();removeNavigationOffersFromCart();sessionStorage.removeItem("upsalefkCart");configurePayPalSmartButtons();window.configureGooglePay&&configureGooglePay();configureAmazonPay();configureSquare();configureRoutePlugin();configureApplePay();facebookCustomerChat();configureFBMessengerCheckboxPlugin();configureLoyaltyLion();configureReachBadge();break;// Upsell Page
case 3:case"Upsell":pageType="upsellPage";assignProdQtyEventListeners();configureAmazonPay();isBuildOrTemplate&&window.configureGooglePay&&configureGooglePay();globalOrderData&&globalOrderData.prepaidType==="GOOGLEPAY"&&window.configureGooglePay&&configureGooglePay();globalOrderData&&globalOrderData.prepaidType==="APPLEPAY"&&configureApplePay();configurePayPalSmartButtons();confirmation();removeCartIcon();removeMenuElement();updateMap();break;// Thank You Page
case 5:case"Thank You":pageType="thankyouPage";updateMap();removeCartIcon();removeMenuElement();break;case 8:case"Profile":initAddressFields();break;case 17:case 18:loadSortOptions();case 34:initSocialProof();displayPrices();break;case 1:case 21:// Clear shopping cart while loading Presell Page
sessionStorage.removeItem("fkCart");sessionStorage.removeItem("fkCartSent");initAddressFields();break;case 31:document.getElementsByName("custom_restartDate")[0]&&affixImports("js","https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js");break;case 7:case"login":if(ccUrlParams.get("emailAddress")&&ccUrlParams.get("orderId")){autoLogin(ccUrlParams.get("emailAddress"),ccUrlParams.get("orderId"));return}if(ccUrlParams.has("userName")&&ccUrlParams.has("password")){autoLoginClub(ccUrlParams.get("userName"),ccUrlParams.get("password"));return}if(cookieData["access_token"]){autoLoginCookie()}break;case 13:sessionStorage.removeItem("newProductItem");sessionStorage.removeItem("currentItem");sessionStorage.removeItem("newProductQty");sessionStorage.removeItem("currentProductQty");sessionStorage.removeItem("currentNextBillDate");sessionStorage.removeItem("billingIntervalDays");sessionStorage.removeItem("currentPrice");var membership=getMembershipDetails();var currentProductItem=sessionStorage.getItem("actionCurrentItem");var currentProductQty=sessionStorage.getItem("actionCurrentProductQty");var currentNextBillDate=sessionStorage.getItem("actionNextBillDate");var currentBillingIntervalDays=sessionStorage.getItem("actionBillingIntervalDays");var currentPrice=sessionStorage.getItem("actionPrice");if(currentProductItem){sessionStorage.setItem("currentItem",currentProductItem);sessionStorage.setItem("currentProductQty",currentProductQty);sessionStorage.setItem("currentNextBillDate",currentNextBillDate);sessionStorage.setItem("billingIntervalDays",currentBillingIntervalDays);sessionStorage.setItem("currentPrice",currentPrice)}else if(membership){sessionStorage.setItem("currentItem",membership.productId);sessionStorage.setItem("currentProductQty",1);sessionStorage.setItem("currentNextBillDate",membership.nextBillDate);sessionStorage.setItem("billingIntervalDays",membership.frequency);sessionStorage.setItem("currentPrice",membership.price)}break;case 9:configureLoyaltyLion();break;default:pageType="presellPage"}pageTypeId!==2&&sessionStorage.removeItem("ccCartItem");var upsellOrThankyouPage=[3,5].includes(pageTypeId);!upsellOrThankyouPage&&ccLoadDataDojoScript();if(pageTypeId===2){var cartPanelButtons=$("#mySidepanel").find("button[onclick='callMethod(event)']");var cartPanelButtonsLength=cartPanelButtons.length;if(cartPanelButtonsLength){for(var _i39=0;_i39<cartPanelButtonsLength;_i39++){var btn=cartPanelButtons[_i39];if(btn.innerText==="VIEW CART"){btn.setAttribute("onclick","route(event)");btn.setAttribute("action","route");break}}}}var fflNumberSection=$(".ffl-number");if(!fflApplied&&fflNumberSection&&fflNumberSection.length){var fflNumberSectionBtns=fflNumberSection.find("button, a");fflNumberSectionBtns&&fflNumberSectionBtns.length&&fflNumberSectionBtns.attr("onclick","callFFLPopUp(event)");[4,3].includes(pageTypeId)&&checkFFLProductsInCart(pageTypeId===3?ccUpsellPageFFLProducts:null)?$(".ffl-number").show():$(".ffl-number").hide()}else fflNumberSection.hide();updateLoginLinks();var useSessionCounter=0;var ccSessionCreated=sessionStorage.getItem("sessionId");var ccCallUseSession=upsellOrThankyouPage?true:ccSessionCreated;if(externalSessionId&&ccCallUseSession){triggerUseSession(externalSessionId,ccSessionCreated);window.ccInitializeIdMe&&ccInitializeIdMe(providerUrl,externalSessionId,pageData);loadCCPayPalFraudNetScripts()}else{!upsellOrThankyouPage&&ccCreateSession(pageTypeId,firstTimeLoad)}tripleWhaleTracking&&sessionStorage.getItem("tripleWhaleFollowUpScriptAdded")!=="true"&&upsellOrThankyouPage&&orderEmail&&addTripleWhaleFollowUpScript(orderEmail)}if(ccUrlParams.has("alertMessage")){var _message=ccUrlParams.get("alertMessage");var decodedMessage=decodeURI(_message);$("body").append("<div class='alert alert-danger alert-dismissible fade show' role='alert' ><strong>"+decodedMessage+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div>")}externalSessionId&&firstTimeLoad&&registerClick(0);initializeCountryStates(pageData.pageTypeId===8||pageData.pageTypeId==="Profile"?loadProfilePage:pageType==="checkoutPage"?displayPrices:undefined);loadMonth();loadYear();if(pageType===4||pageType==="checkoutPage"){cookieData["access_token"]&&addAcctOnFile()}loadShipProfiles();if(pageData.funnelData&&pageData.funnelData.addOns&&(pageData.pageTypeId===4||pageData.pageTypeId===3)){var paayKey=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="PAAY_API_key"});if(paayKey.length!==0&&paayKey[0].keyValue){sessionStorage.setItem("paayEnabled",true);sessionStorage.removeItem("paayCompleted");sessionStorage.removeItem("paayInitialAsRebill");sessionStorage.removeItem("paayInitialData");sessionStorage.removeItem("paayRebillData");var paayPageOption=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="PAAY_page_option"});if(paayPageOption&&paayPageOption[0]){sessionStorage.setItem("paay_page_option",paayPageOption[0].keyValue)}if(paayPageOption.length===0||paayPageOption[0].keyValue==="2"||pageData.pageTypeId===4&&paayPageOption[0].keyValue==="0"||pageData.pageTypeId===3&&paayPageOption[0].keyValue==="1")initializePAAY(paayKey[0].keyValue)}}if(window.location===window.parent.location){affixImports("css","https://code.jquery.com/ui/1.12.0-rc.2/themes/smoothness/jquery-ui.css");affixImports("js","https://code.jquery.com/ui/1.12.0-rc.2/jquery-ui.min.js",configurePopup)}loadVariants();loadAltValues();if(pageData.pageTypeId===4){if(sessionStorage.getItem("couponCode")!==null)appliedCouponCode=handleCouponSplit(sessionStorage.getItem("couponCode"));else{var defaultCoupon=pageData.selectedCampaign.defaultCouponCode;appliedCouponCode=defaultCoupon?handleCouponSplit(defaultCoupon):[]}window.ccPushIdMeCouponToAppliedCoupons&&ccPushIdMeCouponToAppliedCoupons(appliedCouponCode);if(document.getElementsByName("cardNumber").length){getVariants()}displayPrices()}if(pageData.pageTypeId===3){displayPrices()}if($(".fk-product-row").first().attr("lazyload")==="1"){$("head").append("`"+productCardLoaderStyles+"`")}if($(".fk-shopping-cart").length){$("head").append("`"+accordionStyles+"`")}}$(document).on("change","select[name='variant1'], select[name='variant2'], select[name='variant3'], select[name='productVariant'],input[type='radio'][class='variant-radio']",function(){if(window.ccFacebookPixelID){window.triggerfacebookpixelEvent&&triggerfacebookpixelEvent("CustomizeProduct")}ccTrackSygnalEvents&&window.rrq&&window.rrq("track","CustomizeProduct",{});this.getAttribute("type")==="radio"&&this.classList.contains("variant-radio")&&productVariantTileClick(this);var element=$(this);var prodSection=element.closest("section.fk-product-section");var prodValue=prodSection&&prodSection[0]&&prodSection[0].getAttribute("value");prodValue=isSubscribeOn?swapSubscriptions("","",prodValue).sectionValue:prodValue;if(prodSection&&prodSection[0]){var prodImg=$(prodSection).find("img");var prodPrice=$(prodSection).find(".fk-price");var prodShipPrice=$(prodSection).find(".fk-ship-price");var variantValue=$(this).attr("data-value");showVariantImage(prodSection[0],prodImg&&prodImg[0],prodValue,prodPrice&&prodPrice[0],prodShipPrice&&prodShipPrice[0],variantValue);if(pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length){//remove existing variant from cart
var _orderItems2=getOrderItems();for(var sessionItemCpId in _orderItems2){if(sessionItemCpId.indexOf(".")>0){var _productData3=sessionItemCpId.split(".");if(_productData3[0]==prodValue){delete _orderItems2[sessionItemCpId];sessionStorage.setItem("fkCart",JSON.stringify(_orderItems2))}}}getVariants(prodSection[0].id);displayPrices()}var productVariantElement=this.closest(".fk-product-variant-select");if(productVariantElement&&this.classList.contains("variant-radio")){var _product=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==prodValue});filterTiles(productVariantElement,_product)}}});$(document).on("change","select[name='state'], select[name='shipState']",function(){var shipStateChange=false;if(this.getAttribute("name")==="shipState"){evaluateFFLSectionDisplay();shipStateChange=true}pageData.pageTypeId==4&&displayPrices(shipStateChange)});isSubscribeOn=isSubscribeOn&&!subscribeAndSave?false:isSubscribeOn;if(subscribeAndSave){subscribeAndSave.checked=!isSubscribeOn||isSubscribeOn===false?false:true;subscribeAndSave.onclick=function(e){e.stopPropagation();isSubscribeOn=e.target.checked;sessionStorage.setItem("isSubscribeOn",isSubscribeOn);displayPrices()}}function ccLoadDataDojoScript(){var dataDojoPixelId=getAddOnKeyValue(findAddOn("DATA_DOJO_PIXEL_ID"));if(dataDojoPixelId){(function(p,i,x,e,l){if((typeof window==="undefined"?"undefined":_typeof(window))!==undefined){window._dojoPixel={};window._dojoPixel.events_queue=window._dojoPixel.events_queue||[];window._ddq=function(){window._dojoPixel.events_queue.push(arguments)};var f=p.getElementsByTagName(i)[0],k=p.createElement(i);k.async=1;k.src="https://pixel.clickslogistics.com/load.js?id="+dataDojoPixelId;f.parentNode.insertBefore(k,f)}})(document,"script");_ddq("PIXEL_INIT",{});_ddq("PAGE_VIEW")}}function swapSubscriptions(orderItems,removeProductId,sectionValue,getOneTime){orderItems=orderItems?orderItems:getOrderItems();var orderItemDetails={};var offers=[],recurringProducts=[],oneTimeProducts=[],recurringProductIds=[],oneTimeProductIds=[];var products=pageData.selectedCampaign.products;products.forEach(function(prod,index){prod.productType==="OFFER"&&offers.push(prod);if(prod.billingCycleType==="RECURRING"){recurringProducts.push(prod);recurringProductIds.push(prod.productId)}else if(prod.billingCycleType==="ONE_TIME"){oneTimeProducts.push(prod);oneTimeProductIds.push(prod.productId)}});for(var _i40 in orderItems){for(var index in products){var prodId=_i40.split(".")[0];if(products[index].campaignProductId==prodId){orderItemDetails[_i40]=products[index];break}}}if(sectionValue){sectionValue=sectionValue.toString();var _prodId=sectionValue.split(".")[0];var variantId=sectionValue.split(".")[1];var _product2=_prodId&&products.length&&products.find(function(prod){return prod.campaignProductId==_prodId});var reccurringId,oneTimeId;if(_product2&&_product2.billingCycleType==="ONE_TIME"){var recurringProduct=recurringProducts.length&&recurringProducts.find(function(prod){return prod.productId==_product2.productId});if(recurringProduct){reccurringId=variantId?recurringProduct.campaignProductId+"."+variantId:recurringProduct.campaignProductId}}if(getOneTime&&_product2&&_product2.billingCycleType==="RECURRING"){var oneTimeProduct=oneTimeProducts.length&&oneTimeProducts.find(function(prod){return prod.productId==_product2.productId});if(oneTimeProduct){oneTimeId=variantId?oneTimeProduct.campaignProductId+"."+variantId:oneTimeProduct.campaignProductId}}sectionValue=reccurringId?reccurringId:sectionValue;return{sectionValue:sectionValue,oneTimeId:oneTimeId}}else if(removeProductId&&recurringProductIds.length&&oneTimeProductIds.length){removeProductId=removeProductId.toString();var _prodId2=removeProductId.split(".")[0];var _variantId=removeProductId.split(".")[1];var _product3=_prodId2&&oneTimeProducts.find(function(prod){return prod.campaignProductId==_prodId2});var _recurringProduct=_product3&&recurringProducts.find(function(prod){return prod.productId==_product3.productId});_prodId2=_recurringProduct&&_recurringProduct.campaignProductId;_prodId2=_variantId?_prodId2+"."+_variantId:_prodId2;delete orderItems[_prodId2]}else if(recurringProductIds.length&&oneTimeProductIds.length){if(isSubscribeOn){orderItemDetails&&manipulateRecurring(orderItemDetails,recurringProductIds,"RECURRING",recurringProducts)}else if(isSubscribeOn===false){orderItemDetails&&manipulateRecurring(orderItemDetails,oneTimeProductIds,"ONE_TIME",oneTimeProducts)}}function manipulateRecurring(orderItemDetails,productIds,billingCycleType,filteredProducts){var _loop4=function _loop4(){if(productIds.includes(orderItemDetails[_i41].productId)){var _productId2=orderItemDetails[_i41].billingCycleType!==billingCycleType&&orderItemDetails[_i41].productId;var _product4=_productId2&&filteredProducts.find(function(prod){return prod.productId==_productId2});if(_product4){var _variantId2=_i41.split(".")[1];var recurringProdVariant=_variantId2?_product4.campaignProductId+"."+_variantId2:_product4.campaignProductId;orderItems[recurringProdVariant]=orderItems[_i41];delete orderItems[_i41]}}};for(var _i41 in orderItemDetails){_loop4()}}return orderItems}function ccProdSelectSectionLoad(productSection,targetValue,newProductItem,skipRecall){var previousValue=$(productSection).attr("value");$(productSection).attr("value",targetValue);if(newProductItem&&pageData.pageTypeId===13)sessionStorage.setItem("newProductItem",targetValue);loadVariants(true,previousValue,skipRecall);var prodImg=$(productSection).find("img");showVariantImage(productSection,prodImg&&prodImg[0],targetValue)}function ccDeleteBundleFromCart(){var orderItems=getOrderItems();var bundleProductsPageRef=sessionStorage.getItem("bundleProductsPageRef")!==null?JSON.parse(sessionStorage.getItem("bundleProductsPageRef")):{};for(var prodId in removeBundleFromCart){var id=prodId.split("|")[1];delete orderItems[id];delete bundleProductsPageRef[prodId]}sessionStorage.setItem("fkCart",JSON.stringify(orderItems));sessionStorage.setItem("bundleProductsPageRef",JSON.stringify(bundleProductsPageRef))}$(document).on("change","select[name='productSelect']",function(e){var productSection=e.target.closest(".fk-product-section");handleBundleEle=false;if(productSection){var isBundle=productSection.classList.contains("fk-variant-bundle1")||productSection.classList.contains("fk-variant-bundle2");isBundle&&ccDeleteBundleFromCart();ccProdSelectSectionLoad(productSection,e.target.value,true);pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length?getBundleVariants({},0):null}displayPrices()});$(document).on("change","input[name='quantity'], select[name='quantity']",function(e){var bundleOnCheckout=pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length&&$(e.currentTarget).closest(".fk-variant-bundle1")[0];if(bundleOnCheckout){getBundleVariants({},0);displayPrices()}pageData.pageTypeId==3&&displayPrices()});function removeAcctOnFile(){try{var _acctOnFileContainer=document.getElementById("acctOnFileContainer");if(_acctOnFileContainer){var isChecked=document.getElementById("acctOnFile");isChecked.checked=false;sessionStorage.removeItem("paySource");$("[name=cardSecurityCode], [name=cardDate], [name=cardNumber]").val("").prop("disabled",false);$("[name=cardMonth]").val("0").prop("disabled",false);$("[name=cardYear]").val("").prop("disabled",false);$("#cardLockIcon").css("top","40%");_acctOnFileContainer.remove()}}catch(error){console.log(error)}}function populateAcctOnFile(){try{var cardExpiry=sessionStorage.getItem("customerCardExpiry");var cardNumber=sessionStorage.getItem("customerCardLastDigits");var cardExpiryDateArray=cardExpiry&&cardExpiry.split(" ")[0].split("-");cardExpiry=cardExpiryDateArray&&cardExpiryDateArray.length===3&&cardExpiryDateArray[1]+cardExpiryDateArray[0].substr(2);var isChecked=document.getElementById("acctOnFile");var cvvElement=$("[name=cardSecurityCode]");var cardDateElement=$("[name=cardDate]");var cardNumberElement=$("[name=cardNumber]");var cardMonth=$("[name=cardMonth]");var cardYear=$("[name=cardYear]");if(isChecked.checked===true){cardNumberElement.val(cardNumber?"XXXXXXXXXXXX"+cardNumber:"").prop("disabled",true);cardDateElement.val(cardExpiry?cardExpiry:"").prop("disabled",true);cardMonth.val(cardExpiryDateArray[1]).prop("disabled",true);cardYear.val(cardExpiryDateArray[0]).prop("disabled",true);cvvElement.val("***").prop("disabled",true);sessionStorage.setItem("paySource","ACCTONFILE")}else{cardNumberElement.val("").prop("disabled",false);cardDateElement.val("").prop("disabled",false);cardMonth.val("0").prop("disabled",false);cardYear.val("").prop("disabled",false);cvvElement.val("").prop("disabled",false);sessionStorage.removeItem("paySource")}}catch(error){console.log(error)}}function addAcctOnFile(){return _addAcctOnFile.apply(this,arguments)}function _addAcctOnFile(){_addAcctOnFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(){var customerOrderData,inputFieldObj,accOnFileTemplateStrContainer,inputFieldContainer,inputFieldParentContainer,lockIcon;return _regeneratorRuntime().wrap(function _callee11$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:_context12.prev=0;_context12.next=3;return orderQuery();case 3:customerOrderData=sessionStorage.getItem("customerOrders");customerOrderData=customerOrderData?JSON.parse(customerOrderData):null;customerOrderData=customerOrderData&&customerOrderData[customerOrderData.length-1];if(customerOrderData&&customerOrderData.cardLast4){_context12.next=8;break}return _context12.abrupt("return");case 8:sessionStorage.setItem("customerCardLastDigits",customerOrderData.cardLast4);sessionStorage.setItem("customerCardExpiry",customerOrderData.cardExpiryDate);inputFieldObj=document.getElementsByName("cardNumber")[0];if(inputFieldObj){accOnFileTemplateStrContainer=document.createElement("div");accOnFileTemplateStrContainer.id="acctOnFileContainer";accOnFileTemplateStrContainer.style.cssText="display:flex;flex-direction: row;";accOnFileTemplateStrContainer.innerHTML="<div id='' class=''><input id='acctOnFile' class='' type='checkbox' name='acctOnFile' checked='true' onclick='populateAcctOnFile()' style='cursor: pointer; height: auto; width: auto;'></div><div id='' class=''><label id='' class='' style='text-align: left; padding-left: 5px;'>Use card ending in "+customerOrderData.cardLast4+"</label></div>";inputFieldContainer=inputFieldObj.parentNode;inputFieldContainer.append(accOnFileTemplateStrContainer);inputFieldContainer.style.position="relative";inputFieldParentContainer=inputFieldContainer.parentNode;lockIcon=inputFieldParentContainer.getElementsByClassName("fa-lock")[0];if(lockIcon){lockIcon.remove();lockIcon=null}lockIcon=document.createElement("i");lockIcon.style.cssText="position: absolute; right: 3%; top: 60%;";lockIcon.id="cardLockIcon";lockIcon.classList="fa fa-lock";inputFieldContainer.append(lockIcon);inputFieldContainer.insertBefore(acctOnFileContainer,inputFieldObj);populateAcctOnFile()}_context12.next=17;break;case 14:_context12.prev=14;_context12.t0=_context12["catch"](0);consumerLogout(false);case 17:case"end":return _context12.stop()}},_callee11,null,[[0,14]])}));return _addAcctOnFile.apply(this,arguments)}function removeNavigationOffersFromCart(){var fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;var offerItems=[];if(fkCart&&Object.keys(fkCart).length>0){for(var offer in fkCart){offerItems.push(String(offer))}}var buttonAndLinkItems=$("button, a");$(buttonAndLinkItems).each(function(){var offer=$(this).attr("offer");offer=isSubscribeOn?swapSubscriptions(fkCart,"",offer).sectionValue:offer;if(offerItems.includes(offer)){delete fkCart[offer]}});sessionStorage.setItem("fkCart",JSON.stringify(fkCart))}function updateMap(mapData){var orderData=mapData?mapData:JSON.parse(sessionStorage.getItem("orderData"));var requiredFields=["shipAddress1","shipAddress2","shipCity","shipState","shipPostalCode","shipCountry"];var addressDetails="";if(orderData){requiredFields.forEach(function(field,index){if(orderData[field]){addressDetails+=index===requiredFields.length-1?orderData[field]:orderData[field]+", "}});var mapElement=document.getElementsByName("map");if(mapElement&&mapElement.length>0){mapElement.forEach(function(elem){var src=$(elem).attr("src")!==""?$(elem).attr("src"):$(elem).attr("data-src");var pattern=/&q=.*?&/g;var testValue=pattern.test(src);var parseSrc=testValue?src.replace(/&q=.*?&/g,"&q="+addressDetails+"&"):src.replace(/maps\?/g,"maps?&q="+addressDetails);$(elem).attr("src","");$(elem).attr("src",parseSrc);$(elem).attr("data-src",parseSrc)})}}}function getProvidersData(id){if(id&&pageData&&pageData.funnelData&&pageData.funnelData.providers&&pageData.funnelData.providers.length){var providers=pageData.funnelData.providers;var providerObj=providers.filter(function(provider){return provider.id===id});if(providerObj&&providerObj.length){return providerObj[0].keyValue}}return null}function getHeadCode(){var funnelData=pageData.funnelData;if(funnelData.providers&&funnelData.providers.length>0){pageData.funnelData.GA_MEASUREMENT_ID=getProvidersData(1);pageData.funnelData.facebookPixelID=getProvidersData(2);pageData.funnelData.snapchatPixelID=getProvidersData(3);pageData.funnelData.tiktokPixelID=getProvidersData(4);pageData.funnelData.lisTrakMerchantID=getProvidersData(5);pageData.funnelData.lisTrakRedirectUrl=getProvidersData(6);pageData.funnelData.lisTrakMeta1=getProvidersData(7);if(pageData.funnelData.GA_MEASUREMENT_ID!==null)window.getGoogleAnalyticsCode&&getGoogleAnalyticsCode();if(pageData.funnelData.facebookPixelID!==null)window.getFacebookPixelCode&&getFacebookPixelCode();if(pageData.funnelData.snapchatPixelID!==null)window.getSnapchatPixelCode&&getSnapchatPixelCode();if(pageData.funnelData.tiktokPixelID!==null)window.getTikTokPixelCode&&getTikTokPixelCode();if(pageData.funnelData.lisTrakMerchantID!==null)getLisTrakCode()}ccTrackSygnalEvents&&ccGetSygnalPixelCode(ccSygnalPixelId,ccSygnalTrackingGateway);sessionStorage.removeItem("merchantRedirectUpsalefkCart");sessionStorage.removeItem("preUpsalefkCart");sessionStorage.removeItem("importUpsellSuccess");sessionStorage.removeItem("importUpsellSuccessSC");sessionStorage.removeItem("importUpsellSuccessGA");sessionStorage.removeItem("importUpsellSuccessSygnal");var scriptSplitter=function scriptSplitter(trackingCode){return trackingCode.split("<script").filter(function(script){return script!==""}).map(function(script){return"<script "+script.trim()})};var appendScript=function appendScript(appendTo,scriptArray,count){var headElement=document.createElement("head");// dummy element just to read src. wont be injected into dom.
headElement.innerHTML=scriptArray[count];if(headElement.firstChild.src!==""){loadScript(headElement.firstChild.src,function(){count++;count<scriptArray.length&&appendScript(appendTo,scriptArray,count)},appendTo,headElement.firstChild.id)}else{$(appendTo).append(scriptArray[count]).ready(function(){count++;count<scriptArray.length&&appendScript(appendTo,scriptArray,count)})}};if(funnelData.headTrackingCode){try{if(funnelData.headTrackingCode.includes("<script")){appendScript("head",scriptSplitter(funnelData.headTrackingCode),0)}else{var headTrackingScript=document.createElement("script");headTrackingScript.innerHTML=funnelData.headTrackingCode;document.head.append(headTrackingScript)}}catch(err){console.log(err)}}if(funnelData.bodyTrackingCode){try{if(funnelData.bodyTrackingCode.includes("<script")){appendScript("body",scriptSplitter(funnelData.bodyTrackingCode),0)}else{var bodyTrackingScript=document.createElement("script");bodyTrackingScript.innerHTML=funnelData.bodyTrackingCode;document.body.append(bodyTrackingScript)}}catch(err){console.log(err)}}}function getOrderDataObj(analyticsTool){var isSendExternalProductId=getAddOnKeyValue(findAddOn("EXTERNAL_TRACK_REQ"));var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(!(orderData&&orderData.hasOwnProperty("items"))){return}var orderItems;var upsellOrderDataItems;var requiredProducts=[];var contentsAllProducts=[];var contentsAllUpsellProducts=[];var contentsUpsellProducts=[];if(orderPurchaseEvent){upsellOrderDataItems=sessionStorage.getItem("preUpsellOrderDataItems");upsellOrderDataItems=upsellOrderDataItems?JSON.parse(upsellOrderDataItems):null;var upsalefkCart=sessionStorage.getItem("merchantRedirectUpsalefkCart")||sessionStorage.getItem("preUpsalefkCart");orderItems=upsalefkCart?JSON.parse(upsalefkCart):null;var orderItemsKeys=orderItems&&Object.keys(orderItems);if(orderItemsKeys&&orderItemsKeys.length){orderItemsKeys.forEach(function(productId){var id=productId&&productId.split(".")[0];id&&requiredProducts.push(id)})}}var requiredProductsLength=requiredProducts.length;var checkoutOrderData=JSON.parse(sessionStorage.getItem("checkoutOrderData"));orderData.items.forEach(function(item,index){var doNotAddIntoUpsellProducts=requiredProductsLength&&!requiredProducts.includes(item.productId);var isUpsellProduct=false;if(checkoutOrderData){isUpsellProduct=!checkoutOrderData.items.find(function(checkoutProd){return checkoutProd.productId==item.productId})}var details={id:item.externalProductId&&isSendExternalProductId==="true"?item.externalProductId:item.productId.toString(),quantity:parseInt(item.qty)};if(["FB","GA","GTM","SYGNAL"].includes(analyticsTool)){details["name"]=item.name;details["variant"]=item.title;details["price"]=parseFloat(item.price);details["shipping"]=parseFloat(item.shipping);details["tax"]=parseFloat(item.initialSalesTax);details["item_id"]=details["id"];details["item_name"]=item.name;details["item_variant"]=item.title;details["index"]=index;contentsAllProducts.push(details);isUpsellProduct&&contentsAllUpsellProducts.push(details);!doNotAddIntoUpsellProducts&&contentsUpsellProducts.push(details)}});if(orderPurchaseEvent&&upsellOrderDataItems&&["FB","GTM","SYGNAL"].includes(analyticsTool)){var upsell={};var _checkoutOrderData=JSON.parse(sessionStorage.getItem("checkoutOrderData"));upsell.upsellTotalAmount=parseFloat((orderData.totalAmount-(_checkoutOrderData?_checkoutOrderData.totalAmount:0)).toFixed(2));upsell.upsellTaxTotal=parseFloat((orderData.taxTotal-(_checkoutOrderData?_checkoutOrderData.taxTotal:0)).toFixed(2));upsell.upsellShipTotal=parseFloat((orderData.shipTotal-(_checkoutOrderData?_checkoutOrderData.shipTotal:0)).toFixed(2));upsell.upsellItems=contentsAllUpsellProducts;orderData.upsell=upsell}if(orderPurchaseEvent&&["FB","GA","SYGNAL"].includes(analyticsTool)){var lastPurchasedUpsellItem=orderData.items[orderData.items.length-1];orderData.orderId=lastPurchasedUpsellItem.merchantTxnId||lastPurchasedUpsellItem.transactionItemId;contentsAllProducts=contentsUpsellProducts}return{orderData:orderData,contents:contentsAllProducts,pageProducts:sessionStorage.getItem("importOrderSuccessGA")==="true"?contentsAllProducts:sessionStorage.getItem("importUpsellSuccessGA")==="true"?contentsUpsellProducts:null}}function generateSHA256Hash(_x11){return _generateSHA256Hash.apply(this,arguments)}function _generateSHA256Hash(){_generateSHA256Hash=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(message){var encoder,data,hash,hashArray,hashHex;return _regeneratorRuntime().wrap(function _callee12$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:encoder=new TextEncoder;data=encoder.encode(message);_context13.next=4;return crypto.subtle.digest("SHA-256",data);case 4:hash=_context13.sent;hashArray=Array.from(new Uint8Array(hash));hashHex=hashArray.map(function(_byte){return _byte.toString(16).padStart(2,"0")}).join("");return _context13.abrupt("return",hashHex);case 8:case"end":return _context13.stop()}},_callee12)}));return _generateSHA256Hash.apply(this,arguments)}function callPurchaseEventForSygnal(rrq){if(!rrq)return;var orderInfo=getOrderDataObj("SYGNAL");if(orderInfo&&(sessionStorage.getItem("importOrderSuccessSygnal")==="true"||sessionStorage.getItem("importUpsellSuccessSygnal")==="true")){sessionStorage.removeItem("importOrderSuccessSygnal");rrq("track","Purchase",{value:orderInfo.orderData.totalAmount,currency:orderInfo.orderData.currencyCode,num_items:orderInfo.orderData.items.length,contents:orderInfo.contents,order_id:orderInfo.orderData.orderId,upsell:orderInfo.orderData.upsell})}}function ccGetSygnalPixelCode(pixelId,trackingGateway){try{if(!(pixelId&&trackingGateway))return;!function(){"use strict";!function(n,t){var r=[];n.rrq=n.rrq||function(){function n(){r.push(arguments)}return n.q=r,n}();var c=t.createElement("script");c.async=!0,c.src="https://".concat(trackingGateway,"/s/events.js"),c.id="rrq",t.head.appendChild(c)}(window,document)}();if(window.rrq){if(getAddOnKeyValue(findAddOn("SYGNAL_ADV_TRACKING"))==="true"){var advanceTrackingDetails=ccGetAdvanceTrackingDetails();advanceTrackingDetails?window.rrq("init",pixelId,advanceTrackingDetails):window.rrq("init",pixelId)}else{window.rrq("init",pixelId)}window.rrq("track","PageView");var purchaseEventType=getAddOnKeyValue(findAddOn("Purchase_Event_FB"));switch(pageData.pageTypeId){// Presell and VSL page
case 1:case 21:window.rrq("track","ViewContent",{});break;// Checkout Page
case 4:document.getElementsByName("cardNumber").length&&window.rrq("track","InitiateCheckout",{});break;// Upsell Page
case 3:["2","3"].includes(purchaseEventType)&&callPurchaseEventForSygnal(window.rrq);break;// Thank You Page
case 5:purchaseEventType&&callPurchaseEventForSygnal(window.rrq);break;default:break}}}catch(err){console.log(err)}}function callAddToCartEvent(product){var obj=getProductDetails(product);window.TriplePixel&&window.TriplePixel("AddToCart",{item:Number(obj.externalProductId||obj.campaignProductId),q:Number(obj.quantity)});if(window.ccFacebookPixelID){window.callAddToCartFBEvent&&callAddToCartFBEvent(obj)}ccTrackSygnalEvents&&window.rrq&&window.rrq("track","AddToCart",{content_name:obj.productName,content_ids:[obj.externalProductId||obj.campaignProductId],content_type:"product",value:obj.productValue,currency:returnCurrencyCode()||pageData.selectedCampaign.currency});// ccTrackAddToCartEvent(obj);
}function ccGetAdvanceTrackingDetails(){var email,fName,lName,phone,city,state,zipCode,country,orderData=sessionStorage.getItem("orderData");orderData=orderData?JSON.parse(orderData):{};if([3,5].includes(pageData&&pageData.pageTypeId)||["COMPLETE","PENDING","COD_PENDING"].includes(orderData.orderStatus)){email=orderData.emailAddress||"";fName=orderData.firstName||orderData.shipFirstName||"";lName=orderData.lastName||orderData.shipLastName||"";phone=orderData.phoneNumber||"";city=orderData.city||orderData.shipCity||"";state=orderData.state||orderData.shipState||"";zipCode=orderData.postalCode||orderData.shipPostalCode||"";country=orderData.country||orderData.shipCountry||""}else{email=orderData.emailAddress||ccUrlParams.get("emailAddress")||"";fName=orderData.firstName||ccUrlParams.get("firstName")||orderData.shipFirstName||ccUrlParams.get("shipFirstName")||"";lName=orderData.lastName||ccUrlParams.get("lastName")||orderData.shipLastName||ccUrlParams.get("shipLastName")||"";phone=orderData.phoneNumber||ccUrlParams.get("phoneNumber")||"";city=orderData.city||ccUrlParams.get("city")||orderData.shipCity||ccUrlParams.get("shipCity")||"";state=orderData.state||ccUrlParams.get("state")||orderData.shipState||ccUrlParams.get("shipState")||"";zipCode=orderData.postalCode||ccUrlParams.get("postalCode")||orderData.shipPostalCode||ccUrlParams.get("shipPostalCode")||"";country=orderData.country||ccUrlParams.get("country")||orderData.shipCountry||ccUrlParams.get("shipCountry")||""}email=email.toLowerCase().replace(/\s/g,"");fName=fName.toLowerCase().replace(/\s/g,"");if(!(email&&fName))return null;return{"em":email,"fn":fName,"ln":lName.toLowerCase().replace(/\s/g,""),"ph":phone.replace(/\D/g,""),"external_id":email,"ct":city.toLowerCase().replace(/\s/g,""),"zp":zipCode.trim(),"st":state.toLowerCase().replace(/\s/g,"").slice(0,2),"country":country.toLowerCase().replace(/\s/g,"").slice(0,2)}}function getUniqueId(){return Math.random().toString(36).substring(7)}function ccGetCookie(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(";");for(var _i42=0;_i42<ca.length;_i42++){var c=ca[_i42];while(c.charAt(0)==" "){c=c.substring(1)}if(c.indexOf(name)==0){return c.substring(name.length,c.length)}}return""}function sendListrakCartValue(){var updateCartValue=getAddOnKeyValue(findAddOn("LISTRAK_CART_UPDATE"));if(updateCartValue==="true"){return true}return false}function callLisTrakConversion(listr,eventname){if(eventname=="CaptureEmail"){if(document.getElementsByName("emailAddress")[0]){var emailAddress=document.getElementsByName("emailAddress")[0].value;if(emailAddress!=""&&lisTrakCapturedEmail!=emailAddress){lisTrakCapturedEmail=emailAddress;listr.SCA.Update("email",emailAddress)}}}else if(eventname=="UpdateCart"&&!sendListrakCartValue()){var lisTrakItems=sessionStorage.getItem("fkCart");var existingLisTrakItems=sessionStorage.getItem("lisTrakItems");if(lisTrakItems!==existingLisTrakItems){var cartProducts=getOrderItemDetails();var lisTrakRedirectUrl=pageData&&pageData.funnelData&&pageData.funnelData.lisTrakRedirectUrl;var cartPathname=lisTrakRedirectUrl||getCurrentWindowLocation().protocol+"//"+getCurrentWindowLocation().host+getCurrentWindowLocation().pathname;var meta1=pageData&&pageData.funnelData&&pageData.funnelData.lisTrakMeta1;var cartProductsCount=cartProducts?Object.keys(cartProducts).length:0;if(!lisTrakCartUpdated&&cartProductsCount>0){lisTrakCartUpdated=true;var oneTimeItemsCount=recurringItemsCount=0;var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i43=0;_i43<cartProductsEntriesLength;_i43++){if(cartProductsEntries[_i43][1].billingCycleType==="ONE_TIME"||cartProductsEntries[_i43][1].finalBillingCycle==2)oneTimeItemsCount++;else recurringItemsCount++}var sendAllItems=oneTimeItemsCount==cartProductsCount||recurringItemsCount==cartProductsCount;// FUN2-3578
for(var _i44=0;_i44<cartProductsEntriesLength;_i44++){var _product5=cartProductsEntries[_i44][1];if(_product5.hasVariants&&!_product5.variant){lisTrakCartUpdated=false;listr.SCA.ClearCart();return}var sku=_product5.variant&&_product5.variant.productSku!==""?_product5.variant.productSku:_product5.productSku;if(sku.trim()=="")continue;if(!sendAllItems&&_product5.billingCycleType!=="ONE_TIME"&&_product5.finalBillingCycle!=2)continue;var variantName=_product5.variant?" "+_product5.variant.title:"";var title=_product5.productName+variantName;var imageURL=_product5.variant&&_product5.variant.imageUrl!==""?_product5.variant.imageUrl:_product5.imageUrl;var unitPrice=_product5.variant&&parseFloat(_product5.variant.price)>0&&!_product5.isVariantBundle&&!_product5.isEditable?_product5.variant.price:_product5.cycle1_price;var _price2=getItemPrice(cartProductsEntries[_i44][0],unitPrice,_product5.currentOrderQuantity).toFixed(2);var quantity=_product5.currentOrderQuantity;listr.SCA.AddItemWithLinks(sku,quantity,_price2,title,imageURL,cartPathname)}if(meta1){listr.SCA.Meta1=meta1}listr.SCA.Submit()}else if(lisTrakCartUpdated&&sessionStorage.getItem("lisTrakItems")&&cartProductsCount==0){lisTrakCartUpdated=false;listr.SCA.ClearCart();listr.SCA.Submit()}sessionStorage.setItem("lisTrakItems",lisTrakItems)}}}function callPurchaseEventForLisTrak(listr){var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(orderData&&orderData.emailAddress){listr.Order.SetCustomer(orderData.emailAddress,orderData.firstName,orderData.lastName);listr.Order.OrderNumber=orderData.orderId;listr.Order.customernumber=orderData.customerId;listr.Order.ShippingTotal=orderData.shipTotal;listr.Order.TaxTotal=orderData.taxTotal;listr.Order.OrderTotal=orderData.totalAmount;if(orderData.items&&orderData.items.length>0){var items=orderData.items;for(var index in items){if(!items[index].productSku&&!items[index].variantSku)continue;var sku=items[index].variantSku?items[index].variantSku:items[index].productSku;listr.Order.AddItem(sku,items[index].qty,items[index].price)}}listr.Order.Submit()}}function getLisTrakCode(){(function(d,tid,vid){if(typeof _ltk!="undefined")return;var js=d.createElement("script");js.id="ltkSDK";js.src="https://cdn.listrakbi.com/scripts/script.js?m="+tid+"&v="+vid;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(js,s)})(document,pageData.funnelData.lisTrakMerchantID,"1");(function(d){if(typeof _ltk=="undefined"){if(document.addEventListener)document.addEventListener("ltkAsyncListener",function(){_ltk_util.ready(d)});else{e=document.documentElement;e.ltkAsyncProperty=0;e.attachEvent("onpropertychange",function(e){if(e.propertyName=="ltkAsyncProperty"){_ltk_util.ready(d)}})}}else{_ltk_util.ready(d)}})(function(){window.ltk=_ltk;callLisTrakConversion(window.ltk,"UpdateCart");var purchaseEventType=pageData.funnelData.addOns.find(function(_ref4){var keyName=_ref4.keyName;return keyName==="Purchase_Event_FB"}).keyValue;switch(pageData.pageTypeId){// Upsell Page
case 3:purchaseEventType==2&&callPurchaseEventForLisTrak(_ltk);break;// Thank You Page
case 5:callPurchaseEventForLisTrak(_ltk);break;default:break}})}function httpMethod(url,data,headerParams){var loading=document.getElementById("loading");loading?loading.style.display="block !important":null;return fetch(url,{method:"POST",mode:"cors",headers:headerParams?headerParams:getDefaultHeaders(),body:data}).then(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(response){var _data2;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(!(response.url.includes("ImportClick")&&!response.ok)){_context3.next=8;break}if(!response.url.includes("CreateSession")){_context3.next=7;break}_context3.next=4;return response.json();case 4:_data2=_context3.sent;if(!(_data2&&_data2.message&&_data2.message.includes&&_data2.message.includes("Duplicate"))){_context3.next=7;break}throw new Error("duplicate");case 7:throw new Error("session failed");case 8:return _context3.abrupt("return",response.json());case 9:case"end":return _context3.stop()}},_callee3)}));return function(_x12){return _ref5.apply(this,arguments)}}())["catch"](function(error){return error})}function getDefaultHeaders(){var includeKeepAlive=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var headers={"Content-Type":"application/json; charset=utf-8","Cache-Control":"no-cache","Access-Control-Allow-Origin":"*",companyToken:sessionStorage.getItem("fk_salt")!==null?sessionStorage.getItem("fk_salt"):pageData.salt,funnelReferenceId:pageData.funnelReferenceId};if(includeKeepAlive){headers["keepalive"]="true"}return headers}//TODO write test data function
function getIpAddress(){var response;$.ajax({async:false,type:"GET",// cors: true,
// headers: {
//     "Cache-Control": "no-cache",
//     "Access-Control-Allow-Origin": "*"
// },
url:"https://api.ipify.org",success:function success(result){response=result},error:function error(xhr){return xhr.status}});return response}function getIpPhysicalAddress(){return _getIpPhysicalAddress.apply(this,arguments)}function _getIpPhysicalAddress(){_getIpPhysicalAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(){var geoLocationDisabled,geoLocationInfo,url,apiResponse,_data5,regionCode,formattedData;return _regeneratorRuntime().wrap(function _callee13$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:_context14.prev=0;geoLocationDisabled=getAddOnKeyValue(findAddOn("GEOLOCATION_ADDRESS"));if(!(geoLocationDisabled==="true"||pageData.pageTypeId==8)){_context14.next=4;break}return _context14.abrupt("return",null);case 4:geoLocationInfo=sessionStorage.getItem("ccGeoLocationInfo");geoLocationInfo=geoLocationInfo?JSON.parse(geoLocationInfo):null;if(!geoLocationInfo){_context14.next=8;break}return _context14.abrupt("return",geoLocationInfo);case 8:url="https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=&longitude=&localityLanguage=en";_context14.next=11;return fetch(url);case 11:apiResponse=_context14.sent;_context14.next=14;return apiResponse.json();case 14:_data5=_context14.sent;regionCode=_data5.principalSubdivisionCode&&_data5.principalSubdivisionCode.split("-");regionCode=regionCode&&regionCode[1];formattedData={city:_data5.city,region_code:regionCode||"",country_code:_data5.countryCode,zip_code:_data5.postcode};sessionStorage.setItem("ccGeoLocationInfo",JSON.stringify(formattedData));return _context14.abrupt("return",formattedData);case 22:_context14.prev=22;_context14.t0=_context14["catch"](0);return _context14.abrupt("return",null);case 25:case"end":return _context14.stop()}},_callee13,null,[[0,22]])}));return _getIpPhysicalAddress.apply(this,arguments)}function getPageType(pageTypeId){var pageType="";switch(pageTypeId){// Lead page
case 2:case 15:pageType="leadPage";break;// Checkout Page
case 4:pageType="checkoutPage";break;// Upsell Page
case 3:pageType="upsellPage1";break;// Thank You Page
case 5:pageType="thankyouPage";break;default:pageType="presellPage"}return pageType}function addFunnelPageRefId(obj){var isBuildOrTemplate=checkBuildOrTemplate();if(!isBuildOrTemplate){obj.funnelReferenceId=pageData.funnelReferenceId;obj.pageReferenceId=pageData.currentPage.referenceId;obj.funnelName=pageData.funnelData.name;obj.pageName=pageData.currentPage.title}}function importClick(pageType,externalSessionId){var obj={};obj.pageType=typeof pageType!=="string"?getPageType(pageType):pageType;if(obj.pageType==="upsellPage")obj.pageType="upsellPage1";//obj.ipAddress = getIpAddress();
obj.userAgent=navigator.userAgent;obj.campaignId=parseInt(pageData.funnelData.campaign);obj.requestUri=sessionStorage.getItem("requestUri");obj.httpReferer=sessionStorage.getItem("httpReferer");var pageTypeId=pageData&&pageData.pageTypeId,createSession=![3,5].includes(pageTypeId);createSession?obj.externalSessionId=externalSessionId:null;if(allowedFraudPixelPages.includes(pageTypeId))obj.fraudPixel=1;if(obj.pageType==="checkoutPage")obj.orderItems=sessionStorage.getItem("fkCart");addFunnelPageRefId(obj);var data=JSON.stringify(obj);if(createSession){sessionStorage.setItem("sessionStartDateTime",new Date().toJSON());sessionStorage.setItem("ccExternalSessionId",externalSessionId)}var response=httpMethod("".concat(providerUrl,"/ImportClick/CreateSession"),data);if(obj.pageType===5||obj.pageType==="thankyouPage"){if(isFirstTime()){registerClick(1,function(regClickData){confirmation()})}else{confirmation()}}return response}function useSession(session,pageType,refId){var obj={};obj.pageType=typeof pageType!=="string"?getPageType(pageType):pageType;if(obj.pageType==="upsellPage"){var visitedUpsellPages=sessionStorage.getItem("visitedUpsellPages")?JSON.parse(sessionStorage.getItem("visitedUpsellPages")):{};if(visitedUpsellPages[refId]){upsellCount=visitedUpsellPages[refId]}else{var pageCount=Object.keys(visitedUpsellPages).length;if(pageCount<4){visitedUpsellPages[refId]=pageCount+1}else{visitedUpsellPages[refId]=4}upsellCount=visitedUpsellPages[refId]}obj.pageType="upsellPage"+upsellCount;sessionStorage.setItem("visitedUpsellPages",JSON.stringify(visitedUpsellPages))}obj.sessionId=session;obj.userAgent=navigator.userAgent;if(pageData&&pageData.pageTypeId&&allowedFraudPixelPages.includes(pageData.pageTypeId))obj.fraudPixel=1;if(obj.pageType==="checkoutPage")obj.orderItems=sessionStorage.getItem("fkCart");addFunnelPageRefId(obj);var data=JSON.stringify(obj);var response=httpMethod("".concat(providerUrl,"/ImportClick/UseSession"),data);if(obj.pageType===5||obj.pageType==="thankyouPage"){if(isFirstTime()){registerClick(0);registerClick(1,function(regClickData){confirmation()})}else{confirmation()}}return response}function memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle,noProducts,noBilling){//Check arrow product and page product
var selectedArrowPages=pageData.funnelData.pages.filter(function(page){return arrowWithMappedProducts.some(function(linkProduct){return linkProduct.targetPageReferenceId===page.referenceId})});var mappedPageProduct=selectedArrowPages.find(function(page){return page.pageProducts.some(function(productId){return arrowWithMappedProducts.some(function(linkProduct){return linkProduct.products.includes(productId)})})});//Check arrow Billing and page Billing
var selectedArrowPagesBilling=pageData.funnelData.pages.filter(function(page){return arrowWithBillingCycle.some(function(linkBilling){return linkBilling.targetPageReferenceId===page.referenceId})});var sortedArrowPagesBilling=selectedArrowPagesBilling.toSorted(function(a,b){return b.pagebillingCycles[0]-a.pagebillingCycles[0]});var sortedArrowWithBillingCycle=arrowWithBillingCycle.toSorted(function(a,b){return b.billingCycleIds[0]-a.billingCycleIds[0]});var mappedPageBilling=sortedArrowPagesBilling.find(function(page){return sortedArrowWithBillingCycle.some(function(linkBilling){return linkBilling.billingCycleIds[0]>=page.pagebillingCycles[0]})});var pageWithoutBilling=selectedArrowPagesBilling.find(function(page){return page.pagebillingCycles.length===0});var pageWithNoProducts=selectedArrowPages.find(function(page){return page.pageProducts.length===0});if(!mappedPageProduct&&!pageWithNoProducts&&!noProducts){enableInteractions();$("body").append("<div class='alert alert-danger alert-dismissible fade show' role='alert' ><strong>"+"Access Denied"+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div>");console.log(membershipNoProductError)}else if(!mappedPageBilling&&!pageWithoutBilling&&!noBilling){enableInteractions();$("body").append("<div class='alert alert-danger alert-dismissible fade show' role='alert' ><strong>"+"Access Denied"+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div>");console.log(membershipBillingCycleError)}else if(mappedPageProduct||mappedPageBilling){setCurrentWindowLocation(redirectPath(mappedPageProduct||mappedPageBilling,true))}else{setCurrentWindowLocation(redirectPath(pageWithoutBilling||pageWithNoProducts,true))}}function memberProductRoute(clubMembershipProducts,buttonProductData){var clubBillingCycleNumber=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;//Check the Arrow/Link with product
var arrowWithMappedProducts=buttonProductData&&buttonProductData.linkDetails.filter(function(linkDetail){return clubMembershipProducts.some(function(productId){return linkDetail.products.includes(productId)})});//Check the Arrow/Link with billingCycleNumber
var arrowWithBillingCycle=buttonProductData.linkDetails.filter(function(linkDetail){return clubBillingCycleNumber>=linkDetail.billingCycleIds[0]});if(arrowWithMappedProducts.length!==0&&arrowWithBillingCycle.length!==0){memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle)}if(arrowWithMappedProducts.length===0||arrowWithBillingCycle.length===0){//Get the Arrow with no product and redirect to that page
var arrowWithNoProducts=buttonProductData&&buttonProductData.linkDetails.filter(function(linkDetail){return linkDetail.products.length===0});var pageMappedWithArrow=pageData.funnelData.pages.filter(function(page){return arrowWithNoProducts.some(function(linkProduct){return linkProduct.targetPageReferenceId===page.referenceId})});var pageMappedWithClubProducts=pageMappedWithArrow.find(function(page){return page.pageProducts.some(function(pageProductId){return clubMembershipProducts.includes(pageProductId)})});var pageWithNoProducts=pageMappedWithArrow.find(function(page){return page.pageProducts.length===0});//Get the Arrow with no billing and redirect to that page
var arrowWithNoBilling=buttonProductData.linkDetails.filter(function(linkDetail){return linkDetail.billingCycleIds.length===0});var pageMappedWithArrowBilling=pageData.funnelData.pages.filter(function(page){return arrowWithNoBilling.some(function(linkBilling){return linkBilling.targetPageReferenceId===page.referenceId})});var pageMappedWithClubBilling=pageMappedWithArrowBilling.find(function(page){return page.pagebillingCycles.some(function(pageBillingId){return clubBillingCycleNumber>=pageBillingId})});var pageWithNoBilling=pageMappedWithArrowBilling.find(function(page){return page.pagebillingCycles.length===0});var pageWithMatchingProduct=pageMappedWithArrow.find(function(page){return page.pageProducts.some(function(pageProduct){return clubMembershipProducts.includes(pageProduct)})});if(pageWithNoProducts){if(pageWithNoBilling){setCurrentWindowLocation(redirectPath(pageWithNoProducts||pageWithNoBilling,true))}else if(pageMappedWithClubBilling){setCurrentWindowLocation(redirectPath(pageMappedWithClubBilling,true))}else{memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle,pageWithNoProducts,pageWithNoBilling)}}else if(pageWithMatchingProduct){setCurrentWindowLocation(redirectPath(pageWithMatchingProduct,true))}else{memberPageRoute(arrowWithMappedProducts,arrowWithBillingCycle,pageWithNoProducts,pageWithNoBilling)}}}function isMembershipPage(pageType){var membershipPageTypes=[7,8,9,10,11,12,13,31];return membershipPageTypes.includes(pageType)}function memberRoute(buttonProductData){var memberships=JSON.parse(sessionStorage.getItem("clubMemberships"));var clubMembershipProducts=memberships?memberships.map(function(product){return product.productId}):sessionStorage.getItem("actionProductId")?JSON.parse(sessionStorage.getItem("actionProductId")):sessionStorage.getItem("orderLoginProducts")?JSON.parse(sessionStorage.getItem("orderLoginProducts")):[];var clubMembershipBillingCycle=memberships&&memberships[0]&&memberships[0].billingCycleNumber;memberProductRoute(clubMembershipProducts,buttonProductData,clubMembershipBillingCycle)}//memberships
function clubQuery(clubId,memberId,productData,route){var obj={};// obj.clubId = clubId
obj.memberId=memberId;var data=JSON.stringify(obj);var headers=getMembershipHeaders();httpMethod("".concat(providerUrl,"/ClubMembership/Query"),data,headers).then(function(data){if(data.result==="SUCCESS"){sessionStorage.setItem("clubMemberships",JSON.stringify(data.message.data));ccSetCookie("customerBoughtProducts",data.message.data.map(function(product){return product.productId}).join(","),false);setMembershipExternalProduct(data.message.data,clubId,false);sessionStorage.setItem("membership",JSON.stringify(data.message.data[0]));ccSetCookie("customerId",data.message.data[0].customerId,true);if(ccUrlParams.get("redirectToMe")){setCurrentWindowLocation(ccUrlParams.get("redirectToMe"));return}var _result=data.message;if(_result&&_result.data[0].status===active){var clubMembershipProducts=_result.data.map(function(product){return product.productId});var clubBillingCycleNumber=_result.data[0].billingCycleNumber;memberProductRoute(clubMembershipProducts,productData,clubBillingCycleNumber)}else{setCurrentWindowLocation(route)}}else{setCurrentWindowLocation(route)}})}function customerQuery(){var obj={};var data=JSON.stringify(obj);var headers=getMembershipHeaders();return httpMethod("".concat(providerUrl,"/ClubMembership/CustomerQuery"),data,headers).then(function(data){if(data.result==="SUCCESS"){sessionStorage.setItem("loginCustomer",JSON.stringify(data.message.data[0]));ccSetCookie("customerId",data.message.data[0].customerId,true)}})}function orderQueryWithOrderId(){var obj={orderId:ccUrlParams.get("orderId")};var data=JSON.stringify(obj);httpMethod("".concat(providerUrl,"/ClubMembership/OrderQueryByOrderId"),data).then(function(data){var orderData=data&&data.message&&data.message.data&&data.message.data[0];orderData&&autoLoadInputs(orderData)})["catch"](function(err){})}function orderQuery(){var obj={};obj.funnelsOrderHistory=true;var loyaltyLionPluginId=getAddOnKeyValue(findAddOn("loyaltyLionPluginId"));var loyaltyLionToken=getAddOnKeyValue(findAddOn("loyaltyLionToken"));if(loyaltyLionPluginId&&loyaltyLionToken)obj.loyaltyLionPluginId=loyaltyLionPluginId;var data=JSON.stringify(obj);var headers=getMembershipHeaders();return httpMethod("".concat(providerUrl,"/ClubMembership/OrderQuery"),data,headers).then(function(data){if(data.result==="SUCCESS"){var orders=data.message.data;sessionStorage.setItem("customerOrders",JSON.stringify(orders));if(!sessionStorage.getItem("customerPurchases"))purchaseQuery();if(data.message.loyaltyLionAuthToken)sessionStorage.setItem("loyaltyLionAuthToken",data.message.loyaltyLionAuthToken)}})}function purchaseQuery(){var obj={};var data=JSON.stringify(obj);var headers=getMembershipHeaders();return httpMethod("".concat(providerUrl,"/ClubMembership/PurchaseQuery"),data,headers).then(function(data){if(data.result==="SUCCESS"){var customerPurchases=data.message.data;var purchases={};var purchaseEntries=[].concat(Object.entries(customerPurchases));var purchaseEntriesLength=purchaseEntries.length-1;for(var _i45=purchaseEntriesLength;_i45>=0;_i45--){var _item3=purchaseEntries[_i45][1];if(_item3&&_item3.status){purchases[_item3.purchaseId]={"purchaseId":_item3.purchaseId,"orderId":_item3.orderId,"productId":_item3.productId,"product":_item3.displayName,"pauseSchedule":_item3.pauseScheduled,"cancellationSchedule":_item3.cancellationScheduled,"clubPluginId":_item3.clubPluginId,"actualProductId":_item3.actualProductId,"status":_item3.status,"nextBillDate":_item3.nextBillDate,"frequency":_item3.billingIntervalDays,"billingCycleNumber":_item3.billingCycleNumber,"customization":_item3.customization,"cancelAfterDate":_item3.cancelAfterDate,"price":_item3.price,"currentQty":_item3.productQty,"currencySymbol":_item3.currencySymbol,"currentItem":_item3.variantDetailId?_item3.productId+"."+_item3.variantDetailId:_item3.productId,"campaignId":_item3.campaignId}}}sessionStorage.setItem("customerPurchases",JSON.stringify(purchases))}})["catch"](function(err){})}function getMembershipHeaders(){var accessToken=cookieData["access_token"];var headers={"Content-Type":"application/json; charset=utf-8","Cache-Control":"no-cache","Access-Control-Allow-Origin":"*","CompanyToken":pageData.salt,"Authorization":tokenType+" "+accessToken};return headers}function routingNotFound(){enableInteractions();alert("No page routing found. \nPlease verify this button or link is set properly on an arrow.");sessionStorage.removeItem("upsalefkCart")}function redirectPath(navigationItem){var shouldAppendDate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(navigationItem.externalURL){var _orderId2=sessionStorage.getItem("orderId");return addOrderIdInExternalURL(addValuesInExternalURL(navigationItem.externalURL),_orderId2)}var appendHtml=shouldAppendDate?".html?"+Date.now():".html";var targetPageViewReferenceId;var targetPageUrlSlug=navigationItem.urlSlug;try{if(pageData.pageTypeId!==3){targetPageViewReferenceId=navigationItem.targetPageViewReferenceId?navigationItem.targetPageViewReferenceId:navigationItem.pageView[0].referenceId}else{targetPageViewReferenceId=Object.keys(navigationItem).length&&(navigationItem.targetPageViewReferenceId?navigationItem.targetPageViewReferenceId:navigationItem.pageView[0].referenceId);if(!targetPageViewReferenceId){targetPageUrlSlug=pageData.currentPage.urlSlug;targetPageViewReferenceId=pageData.pageViewReferenceId}}}catch(err){routingNotFound();throw err}return targetPageUrlSlug?targetPageUrlSlug:targetPageViewReferenceId+appendHtml}function checkBuildOrTemplate(){var buildOrTemplateUrls=["funnels-build","funneltemplates"];return buildOrTemplateUrls.some(function(url){return getCurrentWindowLocation().href.includes(url)})}function getEnvironment(){if(checkBuildOrTemplate()){return"Build"}return"Public"}function validateSession(){return _validateSession.apply(this,arguments)}function _validateSession(){_validateSession=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(){var currentUrl,clubId,isLoginpage,isBuildOrTemplate,clubMembershipProducts,isCurrentPageProductMatched,checkBillingAccess,_checkBillingAccess,orderData;return _regeneratorRuntime().wrap(function _callee15$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:_checkBillingAccess=function _checkBillingAccess3(){_checkBillingAccess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(){var membershipBilling,customerPurchases,loginOrder,customerBilling,purchases,purchaseInfo,isCurrentPageBillingCycleMatched;return _regeneratorRuntime().wrap(function _callee14$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:membershipBilling=JSON.parse(sessionStorage.getItem("clubMemberships"));if(sessionStorage.getItem("customerPurchases")){_context15.next=4;break}_context15.next=4;return purchaseQuery();case 4:customerPurchases=JSON.parse(sessionStorage.getItem("customerPurchases"));loginOrder=JSON.parse(sessionStorage.getItem("loginOrder"));customerBilling=membershipBilling?membershipBilling[0].billingCycleNumber:0;if(!membershipBilling&&customerPurchases){purchases=Object.entries(customerPurchases);purchaseInfo=purchases.find(function(item){return item[1].orderId===loginOrder.orderId})||(purchases.length>0?purchases[purchases.length-1]:null);customerBilling=purchaseInfo?purchaseInfo[1].billingCycleNumber:0}isCurrentPageBillingCycleMatched=pageData.currentPage.pagebillingCycles[0]?Number(customerBilling)>=pageData.currentPage.pagebillingCycles[0]:true;if(!isCurrentPageBillingCycleMatched){_context15.next=11;break}return _context15.abrupt("return",true);case 11:return _context15.abrupt("return",false);case 12:case"end":return _context15.stop()}},_callee14)}));return _checkBillingAccess.apply(this,arguments)};checkBillingAccess=function _checkBillingAccess2(){return _checkBillingAccess.apply(this,arguments)};currentUrl=getCurrentWindowLocation().href;clubId=cookieData["clubId"];clubId=parseInt(clubId);//7 = Membership Login Page
isLoginpage=pageData.currentPage.pageView[0].pageType===7;isBuildOrTemplate=checkBuildOrTemplate();//Check the Current Page has access to the product
clubMembershipProducts=sessionStorage.getItem("actionProductId")?JSON.parse(sessionStorage.getItem("actionProductId")):sessionStorage.getItem("orderLoginProducts")?JSON.parse(sessionStorage.getItem("orderLoginProducts")):getClubMembershipProducts();if((!clubMembershipProducts||!clubMembershipProducts.length)&&cookieData["customerBoughtProducts"]){clubMembershipProducts=cookieData["customerBoughtProducts"].split(",")}isCurrentPageProductMatched=clubMembershipProducts.some(function(productId){return pageData.currentPage.pageProducts.includes(parseInt(productId))||pageData.currentPage.pageProducts.length===0});// Check the Current Page has access to the billingCycle
orderData=sessionStorage.getItem("orderData");_context16.t1=!isBuildOrTemplate&&!isLoginpage;if(!_context16.t1){_context16.next=19;break}_context16.t2=!isCurrentPageProductMatched;if(_context16.t2){_context16.next=18;break}_context16.next=17;return checkBillingAccess();case 17:_context16.t2=!_context16.sent;case 18:_context16.t1=_context16.t2;case 19:_context16.t0=_context16.t1;if(!_context16.t0){_context16.next=22;break}_context16.t0=!(orderData&&orderData.orderId);case 22:if(!_context16.t0){_context16.next=24;break}redirectToLoginPage();case 24:case"end":return _context16.stop()}},_callee15)}));return _validateSession.apply(this,arguments)}function reInitializeAndValidateSession(){return _reInitializeAndValidateSession.apply(this,arguments)}function _reInitializeAndValidateSession(){_reInitializeAndValidateSession=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(){var _data6,customerOrders,orderInfo,clubMembershipProducts,obj,reqData,headers,_data7;return _regeneratorRuntime().wrap(function _callee16$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:if(!(localStorage.getItem("isMembershipLogin")==="false")){_context17.next=12;break}_context17.next=3;return Promise.all([customerQuery(),orderQuery()]);case 3:_data6=_context17.sent;customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));setMembershipExternalProduct(customerOrders,cookieData["clubId"],true);orderInfo=customerOrders.find(function(_ref12){var orderId=_ref12.orderId;return orderId===cookieData["orderId"]})||customerOrders[customerOrders.length-1];sessionStorage.setItem("loginOrder",JSON.stringify(orderInfo));if(orderInfo&&orderInfo.items){clubMembershipProducts=Object.entries(orderInfo.items).map(function(item){return parseInt(item[1].productId)});sessionStorage.setItem("orderLoginProducts",JSON.stringify(clubMembershipProducts))}validateSession();_context17.next=21;break;case 12:if(!(localStorage.getItem("isMembershipLogin")==="true"&&cookieData["memberId"])){_context17.next=21;break}obj={};obj.memberId=cookieData["memberId"];reqData=JSON.stringify(obj);headers=getMembershipHeaders();_context17.next=19;return httpMethod("".concat(providerUrl,"/ClubMembership/Query"),reqData,headers);case 19:_data7=_context17.sent;if(_data7.result==="SUCCESS"){sessionStorage.setItem("clubMemberships",JSON.stringify(_data7.message.data));ccSetCookie("customerBoughtProducts",_data7.message.data.map(function(product){return product.productId}).join(","),false);setMembershipExternalProduct(_data7.message.data,cookieData["clubId"],false);sessionStorage.setItem("membership",JSON.stringify(_data7.message.data[0]));validateSession()}case 21:case"end":return _context17.stop()}},_callee16)}));return _reInitializeAndValidateSession.apply(this,arguments)}function validateToken(){return _validateToken.apply(this,arguments)}function _validateToken(){_validateToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(){var reqData,headers,isLoginpage,isBuildOrTemplate,_data8,_orderData10;return _regeneratorRuntime().wrap(function _callee17$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:reqData=JSON.stringify({});headers=getMembershipHeaders();isLoginpage=pageData.currentPage.pageView[0].pageType===7;isBuildOrTemplate=checkBuildOrTemplate();if(!(cookieData["access_token"]&&!isLoginpage)){_context18.next=31;break}_context18.prev=5;_context18.next=8;return httpMethod("".concat(providerUrl,"/ClubMembership/OrderQuery"),reqData,headers);case 8:_data8=_context18.sent;if(!(_data8.result==="SUCCESS")){_context18.next=23;break}if(!(localStorage.getItem("isMembershipLogin")==="false"&&(!sessionStorage.getItem("customerPurchases")||!sessionStorage.getItem("loginOrder")||!sessionStorage.getItem("orderLoginProducts")||!sessionStorage.getItem("customerOrders")||!sessionStorage.getItem("loginCustomer")))){_context18.next=15;break}_context18.next=13;return reInitializeAndValidateSession();case 13:_context18.next=21;break;case 15:if(!(localStorage.getItem("isMembershipLogin")==="true"&&(!sessionStorage.getItem("clubMemberships")||!sessionStorage.getItem("membership")))){_context18.next=20;break}_context18.next=18;return reInitializeAndValidateSession();case 18:_context18.next=21;break;case 20:validateSession();case 21:_context18.next=24;break;case 23:redirectToLoginPage();case 24:_context18.next=29;break;case 26:_context18.prev=26;_context18.t0=_context18["catch"](5);redirectToLoginPage();case 29:_context18.next=32;break;case 31:if(!isBuildOrTemplate&&!isLoginpage){_orderData10=JSON.parse(sessionStorage.getItem("orderData"));if(_orderData10&&_orderData10.orderId){clubLogin("","","",_orderData10)}else{redirectToLoginPage()}}case 32:case"end":return _context18.stop()}},_callee17,null,[[5,26]])}));return _validateToken.apply(this,arguments)}function redirectToLoginPage(){clearCookies();var loginPageDetail=pageData.funnelData.pages.find(function(page){return page.pageView[0].pageType===7});var redirectUrl=redirectPath(loginPageDetail)+"?alertMessage=Access Denied";var encodedUrl=encodeURI(redirectUrl);setCurrentWindowLocation(encodedUrl)}function clearCookies(){var cookies=document.cookie.split("; ");cookies.forEach(function(cookie){var name=cookie.split("=")[0];if(name&&name!=="X-Source"){ccSetCookie(name,"",false)}});document.cookie=""}function clearBrowserStorageData(storageType,keyList){var storage=storageType==="sessionStorage"?window.sessionStorage:window.localStorage;keyList.forEach(function(keyName){storage.removeItem(keyName)})}function clearConsumerLoginData(){/* NOTE:: IF THERE ANY CHANGES DONE IN THIS METHOD, IT NEEDS TO BE DONE IN /iframe.html ALSO WHICH IS DIRECTLY AVIALABLE FOR ALL MEMBERSHIP FUNNEL  */var sessionStorageData=["clubMemberships","membership","requestUri","count","customerOrders","customerCardExpiry","customerCardLastDigits","loginOrder","orderLoginProducts","customerPurchases","loginCustomer"];var localStorageData=["access_token","expireIn","loginUrl"];clearBrowserStorageData("sessionStorage",sessionStorageData);clearBrowserStorageData("localStorage",localStorageData);clearCookies();localStorage.setItem("logOut".concat(location.host),Date.now())}function clubLogout(isConsumerLogout){var loginUrl=localStorage.getItem("loginUrl");clearConsumerLoginData();if(!isConsumerLogout){loginUrl&&setCurrentWindowLocation(loginUrl)}}function ccSetCookie(name,value,allowCrossOrigin,cookieSpan){var sameSite=allowCrossOrigin?"; SameSite=None; Secure":";";var date=new Date;var cookieLife=getAddOnKeyValue(findAddOn("Cookie_Life"));var loginRememberMe=$("[name=rememberMe]").prop("checked");if(cookieLife){if(loginRememberMe===undefined||loginRememberMe===false){var cookieLifeVal=parseInt(cookieLife);if(cookieLifeVal>0){var dateVal=cookieLifeVal*60*60*1000;date.setTime(date.getTime()+dateVal)}else{date.setTime(date.getTime()+1*24*60*60*1000)}}else{var _dateVal=365*24*60*60*1000;date.setTime(date.getTime()+_dateVal)}}else{date.setTime(date.getTime()+1*24*60*60*1000)}if(cookieSpan&&Number(cookieSpan)){date=new Date;date.setTime(date.getTime()+cookieSpan)}var expires="; expires="+date.toGMTString();document.cookie=name+"="+value+expires+"; domain="+document.domain.split(".").reverse().splice(0,2).reverse().join(".")+sameSite+"; path=/";cookieData[name]=value}function consumerLogout(e){e&&e.preventDefault();clubLogout(true);removeAcctOnFile();updateLoginLinks(true)}function isCustomerOrderDataExists(){var serializedOrderData=sessionStorage.getItem("orderData");serializedOrderData=serializedOrderData?JSON.parse(serializedOrderData):null;return serializedOrderData&&serializedOrderData.customerId}function updateLoginLinks(isLogoutAction){var linkCollection=$("a[action=login], a[action=consumerLogout]");var serializedTemplateLinkData=localStorage.getItem("templateLinkData");var isCustomerKnown=isCustomerOrderDataExists();var templateLinkData=serializedTemplateLinkData?JSON.parse(serializedTemplateLinkData):{};linkCollection.each(function(){var linkElement=this;var action=linkElement.getAttribute("action");var linkId=linkElement.getAttribute("id");var linkDataId=linkElement.dataset.id;var linkLabel=linkElement.innerHTML;var templateLinkHashMapId=linkId+linkDataId;var href=linkElement.getAttribute("href");if(!templateLinkData[templateLinkHashMapId]||action==="login"&&templateLinkData[templateLinkHashMapId]&&(templateLinkData[templateLinkHashMapId].label!==linkLabel||templateLinkData[templateLinkHashMapId].href!==href)){templateLinkData[templateLinkHashMapId]={action:action,href:href,label:linkLabel}}if(cookieData&&cookieData["access_token"]){linkElement.innerHTML="Logout";linkElement.setAttribute("action","consumerLogout");linkElement.setAttribute("onclick","consumerLogout(event)");linkElement.setAttribute("href","")}else{linkElement.innerHTML=templateLinkData[templateLinkHashMapId].label;linkElement.setAttribute("action","login");linkElement.setAttribute("onclick","linkMethod(event, false, true);");linkElement.setAttribute("href",templateLinkData[templateLinkHashMapId].href)}});localStorage.setItem("templateLinkData",JSON.stringify(templateLinkData))}function setMembershipExternalProduct(queryData,clubId,nonMembershipLogin){if(!(clubId&&queryData&&queryData.length)){return}var productExtId="";if(nonMembershipLogin){var ordersIterator=queryData.length-1;for(var _i46=ordersIterator;_i46>=0;_i46--){var order=queryData[_i46];var items=order&&order.items||{};var collection=Object.values(items);var collectionLength=collection.length;for(var j=0;j<collectionLength;j++){var _product6=collection[j];if(_product6&&_product6.externalProductId&&["ACTIVE","TRIAL"].includes(_product6.purchaseStatus)&&_product6.clubPluginId===clubId+""){ccSetCookie("membershipExternalProduct",_product6.externalProductId,true);return}}}return}var queryDataLength=queryData.length;for(var _i47=0;_i47<queryDataLength;_i47++){var _productData4=queryData[_i47];if(["ACTIVE","TRIAL"].includes(_productData4["status"])&&_productData4["clubId"]===clubId){productExtId=_productData4["productId"];break}}var campaignProduct=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.products.find(function(product){return product["externalProductId"]&&product["campaignProductId"]===productExtId});if(campaignProduct){ccSetCookie("membershipExternalProduct",campaignProduct.externalProductId,true)}}function clubLogin(buttonId,clubId,productData,orderData){var obj={};var isMembershipLogin=true;var clubIds;if(orderData){obj.emailAddress=orderData.emailAddress;obj.orderId=orderData.orderId;isMembershipLogin=false}else if(document.getElementsByName("emailAddress")[0]){isMembershipLogin=false;obj.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;obj.orderId=document.getElementsByName("orderId")[0]?document.getElementsByName("orderId")[0].value:null}else if(document.getElementsByName("userName")[0]){obj.clubUsername=document.getElementsByName("userName")[0].value;obj.clubPassword=document.getElementsByName("password")[0]?document.getElementsByName("password")[0].value:null;clubIds=_typeof(clubId)=="object"?clubId:null;obj.clubId=clubIds?parseInt(clubId[0]):clubId}else{return}if(ccStampedPluginId){obj.campaignId=pageData.selectedCampaign.campaignId}var data=JSON.stringify(obj);httpMethod("".concat(providerUrl,"/ClubMembership/Login/"),data).then(function(data){var count=sessionStorage.getItem("count");if(count===null||count===undefined){count=0;sessionStorage.setItem("count",count)}else if(performance.navigation.type==1){count=sessionStorage.getItem("count")}if(data.result==="SUCCESS"){var _route2=null;if(clubIds)clubId=parseInt(clubId[0]);count=0;sessionStorage.setItem("count",count);var results="";if(isJSON(data.message)){results=JSON.parse(data.message)}else{results=data.message}sessionStorage.setItem("count",count);ccSetCookie("expireIn",results.expires_in,true);ccSetCookie("access_token",results.access_token,true);ccSetCookie("firstName",results.firstName,true);ccSetCookie("lastName",results.lastName,true);ccSetCookie("memberId",results.memberId,false);ccSetCookie("username",obj.clubUsername,false);ccSetCookie("status",results.status,false);ccSetCookie("buttonId",buttonId,false);ccSetCookie("clubId",clubId,false);var stamped=results.stampedCustomer||{};ccSetCookie("stampedCustomerId",stamped.customerId,false);ccSetCookie("stampedCustomerEmail",stamped.customerEmail,false);ccSetCookie("stampedCustomerFirstName",stamped.customerFirstName,false);ccSetCookie("stampedCustomerLastName",stamped.customerLastName,false);ccSetCookie("stampedCustomerTags",stamped.customerTags,false);ccSetCookie("stampedCustomerOrders",stamped.totalOrders,false);ccSetCookie("stampedCustomerSpent",stamped.totalSpent,false);ccSetCookie("stampedCustomerAcceptMarketing",stamped.isAcceptMarketing,false);ccSetCookie("stampedCustomerToken",stamped.authToken,false);var loginUrl=getCurrentWindowLocation().protocol+"//"+getCurrentWindowLocation().host+getCurrentWindowLocation().pathname;localStorage.setItem("loginUrl",loginUrl);if(isMembershipLogin&&results.memberId){localStorage.setItem("isMembershipLogin",true);if(results.status===active){clubQuery(obj.clubId,results.memberId,productData)}else{var inActiveNavItem=pageData.navigationItems.find(function(element){return element.status&&element.status.toUpperCase()===inActive});var linkWithNoProduct=inActiveNavItem&&inActiveNavItem.linkDetails.find(function(linkDetail){return linkDetail.products.length===0});if(linkWithNoProduct){_route2=redirectPath(linkWithNoProduct,true)}else{var targetButtonLink=pageData.navigationItems.find(function(element){return element.elementId===buttonId});targetButtonLink?_route2=redirectPath(targetButtonLink.linkDetails[0],true):null}clubQuery(obj.clubId,results.memberId,productData,_route2)}}else{localStorage.setItem("isMembershipLogin",false);var _orderId3=results.orderId?results.orderId:obj.orderId;ccSetCookie("orderId",_orderId3,false);Promise.all([customerQuery(),orderQuery(),purchaseQuery()]).then(function(data){var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var orderInfo=customerOrders.find(function(item){return item.orderId===_orderId3})||customerOrders[customerOrders.length-1];var customerPurchases=JSON.parse(sessionStorage.getItem("customerPurchases"));var purchases=customerPurchases?Object.entries(customerPurchases):[];var purchaseInfo=purchases.find(function(item){return item[1].orderId===_orderId3})||(purchases.length>0?purchases[purchases.length-1]:null);sessionStorage.setItem("loginOrder",JSON.stringify(orderInfo));if(orderInfo&&orderInfo.items){var clubMembershipProducts=Object.entries(orderInfo.items).map(function(item){return parseInt(item[1].productId)});ccSetCookie("customerBoughtProducts",clubMembershipProducts.join(","),false);setMembershipExternalProduct(customerOrders,clubId,true);if(ccUrlParams.get("redirectToMe")){setCurrentWindowLocation(ccUrlParams.get("redirectToMe"));return}sessionStorage.setItem("orderLoginProducts",JSON.stringify(clubMembershipProducts));if(purchaseInfo)productData&&memberProductRoute(clubMembershipProducts,productData,purchaseInfo[1].billingCycleNumber);else productData&&memberProductRoute(clubMembershipProducts,productData)}})}}else if(_typeof(clubId)=="object"&&clubId.length>1&&isMembershipLogin===true){clubId.splice(0,1);clubLogin(buttonId,clubId,productData,orderData)}else{/* Enabling the button again as we have disabled it onclick of the button (as part of restricting the double/triple click of the button)
            * so that the user can try re-submitting
            */enableInteractions();turnOffSpinner();if(isMembershipLogin)alert("Username or Password is invalid");else alert("Invalid email or Order ID");count++;sessionStorage.setItem("count",count);if(count>=3){$("[name=userName], [name=password], [name=orderId], [name=emailAddress]").prop("disabled",true);$("[data-id="+buttonId+"]").prop("disabled",true);alert("Too many failed attempts, Account will be disabled for 3 minutes");setTimeout(function(){$("[name=userName], [name=password], [name=orderId], [name=emailAddress]").prop("disabled",false);$("[data-id="+buttonId+"]").prop("disabled",false);count=0;sessionStorage.setItem("count",count)},180000)}}})}function isJSON(text){if(typeof text!=="string"){return false}try{var json=JSON.parse(text);return _typeof(json)==="object"}catch(error){return false}}function autoLogin(email,orderId){if(!email||!orderId)return;var buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status&&navItem.status.toLowerCase()==="automatic"});if(!buttonItem||buttonItem&&buttonItem.linkDetails.length===0)buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status==="Active"});if(!buttonItem)return;var buttonId=buttonItem.elementId;disableInteractions(buttonId,true,false);if(document.getElementsByName("emailAddress")[0])document.getElementsByName("emailAddress")[0].value=email;if(document.getElementsByName("orderId")[0])document.getElementsByName("orderId")[0].value=orderId;clubLogin(buttonId,null,buttonItem)}function autoLoginClub(userName,password){if(!userName||!password)return;var clubId=getClubId();var buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status&&navItem.status.toLowerCase()==="automatic"});if(!buttonItem||buttonItem&&buttonItem.linkDetails.length===0)buttonItem=pageData.navigationItems.find(function(navItem){return navItem.status==="Active"});if(!buttonItem)return;var buttonId=buttonItem.elementId;disableInteractions(buttonId,true,false);fillInInputIfExists("userName",userName);fillInInputIfExists("password",password);clubLogin(buttonId,clubId,buttonItem)}function restartMembership(route){var membership=JSON.parse(sessionStorage.getItem("membership"));var obj={};obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;obj.reactivate=true;var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("".concat(providerUrl,"/Purchases/Update"),data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.status=active;sessionStorage.setItem("membership",JSON.stringify(membership));alert("Membership has been restarted")}else{orderQuery();alert("Subscription has been restarted")}sessionStorage.removeItem("customerPurchases");setCurrentWindowLocation(route)})}else{enableInteractions();alert("There was an error restarting your membership, please contact customer service.")}})}function getClubId(){var clubId=[];var BreakException={};try{pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){if(product.clubPluginId&&!clubId.includes(product.clubPluginId)){clubId.push(product.clubPluginId)}})}catch(e){if(e!==BreakException)throw e}return clubId}function resetMemberPassword(){var obj={};function displayErrorMessage(message){if(!message){return}var errorPlacementElement=$(".fk-add-password-reset-error");var errorElement="<div style='color:red;width:100%;' class='fk-username-reset-error'>"+message+"</div>";errorPlacementElement.length?$(errorElement).insertAfter(errorPlacementElement.first()):$(errorElement).insertAfter($("[name=userName]"))}var userNameElement=document.getElementsByName("userName")[0];obj.clubId=getClubId();obj.clubId=_typeof(obj.clubId)=="object"?null:obj.clubId;obj.clubUsername=userNameElement?userNameElement.value:null;$(".fk-username-reset-error").remove();$("[name=userName]").removeClass("border-danger");if(!obj.clubUsername){$("[name=userName]").addClass("border-danger");displayErrorMessage("This is a required entry to reset password");return}var data=JSON.stringify(obj);var response=httpMethod("".concat(providerUrl,"/ClubMembership/Reset"),data).then(function(data){if(data.result==="SUCCESS"){alert(data.message)}else{$("[name=userName]").addClass("border-danger");displayErrorMessage(data.result)}})}function resetPW(route,clubId,memberId){var obj={};obj.clubId=clubId;obj.clubUsername=document.getElementsByName("userName")[0]?document.getElementsByName("userName")[0].value:null;obj.clubPassword=document.getElementsByName("password")[0]?document.getElementsByName("password")[0].value:null;if(obj.clubPassword!==document.getElementsByName("confirmPassword")[0]){alert("Passwords do not match")}var data=JSON.stringify(obj);var response=httpMethod("".concat(providerUrl,"/ClubMembership/Reset"),data).then(function(data){if(data.result==="SUCCESS"){alert("Password has been updated")}})}function cancelMembership(route){var obj={};obj.cancelReason=document.getElementsByName("cancelReason")[0]?document.getElementsByName("cancelReason")[0].value:null;var membership=JSON.parse(sessionStorage.getItem("membership"));obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("".concat(providerUrl,"/Purchases/Cancel"),data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.status="CANCELLED";sessionStorage.setItem("membership",JSON.stringify(membership));alert("Membership has been cancelled")}else{orderQuery();alert("Subscription has been cancelled")}sessionStorage.removeItem("customerPurchases");setCurrentWindowLocation(route)})}else{enableInteractions();if(membership)alert("There was an error cancelling your membership, please contact customer service.");else alert("There was an error cancelling your subscription, please contact customer service.")}})}function changeProduct(route){var obj={};var product_value,customFields;var isBillNow=$("[action=submit]")[0].attributes.billnow.value;var membership=getMembershipDetails();var customerPurchases=JSON.parse(sessionStorage.getItem("customPurchases"));var actionPurchaseId=sessionStorage.getItem("actionPurchaseId");var nextBillDateInput=document.getElementsByName("nextBillDate")[0];var billingIntervalDays=document.getElementsByName("frequency")[0];var currentPrice=document.getElementsByName("price")[0];var priceElement=$("input[name='price']");obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;var originalQuantity=sessionStorage.getItem("currentProductQty");obj.productQty=originalQuantity;var originalNextBillDate=sessionStorage.getItem("currentNextBillDate");var originalBillingIntervaldays=sessionStorage.getItem("billingIntervalDays");var originalCurrentPrice=sessionStorage.getItem("currentPrice");var nextBillDateValue,billingIntervalValue,selectedPrice;getVariants();for(var key in customerPurchases){if(key==actionPurchaseId){customFields=customerPurchases[key].customization}}if(customFields&&sessionStorage.getItem("selectedCombo"))obj.product_custom=sessionStorage.getItem("selectedCombo");var newProductItem=sessionStorage.getItem("newProductItem")?sessionStorage.getItem("newProductItem"):null;if(!newProductItem){var newProduct=document.getElementsByName("product");newProduct.forEach(function(product){if(product.checked){newProduct=product;newProductItem=newProduct.value;product.getAttribute("variantValue")?newProductItem+="."+newProduct.getAttribute("variantValue"):null}})}if(newProductItem){if(newProductItem.indexOf(".")>0){productData=newProductItem.split(".");obj.productId=productData[0];if(!obj.product_custom)obj.variantDetailId=productData[1]}else{obj.productId=newProductItem}}var newProductQty=sessionStorage.getItem("newProductQty")?sessionStorage.getItem("newProductQty"):null;if(newProductQty){obj.productQty=parseFloat(Math.floor(newProductQty))}else{obj.productQty=originalQuantity;var productInputs=$("input[name='product']");var prodInputLength=productInputs.length;if(prodInputLength){for(var _i48=0;_i48<prodInputLength;_i48++){var input=productInputs[_i48];if(input.checked){var prodSection=$(input).closest("section.fk-product-section");var quantityInputNode=prodSection.find("input[name='quantity'],select[name='quantity']")[0];obj.productQty=quantityInputNode?quantityInputNode.value:obj.productQty}}}else{var _prodSection=$(".fk-product-section");var _quantityInputNode=_prodSection.find("input[name='quantity'], select[name='quantity']")[0];obj.productQty=_quantityInputNode?_quantityInputNode.value:obj.productQty}}if(nextBillDateInput){nextBillDateValue=nextBillDateInput.value;obj.priorToNextBill=1;obj.nextBillDate=nextBillDateValue?nextBillDateValue:originalNextBillDate;if(nextBillDateValue==null){enableInteractions();alert("Please enter a valid Next Bill Date");return}}if(billingIntervalDays){billingIntervalValue=billingIntervalDays.value;obj.billingIntervalDays=billingIntervalValue?billingIntervalValue:originalBillingIntervaldays;if(!billingIntervalValue){enableInteractions();alert("Please enter a valid billing frequency");return}}if(priceElement.length){var _productInputs=$("input[name='product']");var _prodInputLength=_productInputs.length;for(var _i49=0;_i49<_prodInputLength;_i49++){var _input2=_productInputs[_i49];if(_input2.checked){var _prodSection2=$(_input2).closest("section.fk-product-section");var priceInputNode=_prodSection2.find("input[name='price']")[0];selectedPrice=priceInputNode&&priceInputNode.value;obj.price=priceInputNode&&priceInputNode.value?priceInputNode.value:originalCurrentPrice;if(!selectedPrice){enableInteractions();alert("Please enter a valid price amount");return}}}}var currentItem=sessionStorage.getItem("actionCurrentItem")?sessionStorage.getItem("actionCurrentItem"):membership?membership.productId.toString():null;if(currentItem&&!(obj.productQty&&obj.productQty!=originalQuantity)){var currentProductId=currentItem;var currentVariantDetailId=null;if(currentItem.indexOf(".")>0){var currentItemData=currentItem.split(".");currentProductId=currentItemData[0];currentVariantDetailId=currentItemData[1]}}if(isBillNow==="true"){obj.billNow=true}var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("".concat(providerUrl,"/Purchases/Update"),data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.productId=membership.productId?newProductItem:product_value;sessionStorage.setItem("membership",JSON.stringify(membership))}else{sessionStorage.removeItem("actionCurrentItem");orderQuery()}sessionStorage.removeItem("customerPurchases");alert("Your product has been updated");setCurrentWindowLocation(route)})}else{enableInteractions();alert("There was an error processing your request, if problems persist please contact customer service")}})}function pauseMembership(route){var obj={};var customrestartDate=document.getElementsByName("custom_restartDate")[0];var date=customrestartDate?customrestartDate.value:null;var membership=sessionStorage.getItem("membership")?JSON.parse(sessionStorage.getItem("membership")):null;obj.purchaseId=sessionStorage.getItem("actionPurchaseId")?sessionStorage.getItem("actionPurchaseId"):membership?membership.purchaseId:null;if(!obj.purchaseId)return;obj.priorToNextBill=1;var momentDate=moment(date);if(date==null||!momentDate.isValid()){enableInteractions();alert("Please enter a valid Restart Date");return}obj.restartDate=momentDate.format("YYYY-MM-DD");var data=JSON.stringify(obj);var headers=getMembershipHeaders();var response=httpMethod("".concat(providerUrl,"/Purchases/Pause"),data,headers).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){if(membership){membership.status="PAUSED";sessionStorage.setItem("membership",JSON.stringify(membership))}orderQuery();alert(data.message);setCurrentWindowLocation(route)})}else{enableInteractions();alert(data.message)}})}function updateCard(productData,profileObj,profileCustomer,profileRoute,profileCallback){var membership=getMembershipDetails();var customer=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):null;var paySourceId=membership?membership.paySourceId:customer?customer.paySourceId:null;if(!paySourceId)return;var cardNumber=$("input[name=\"cardNumber\"]").val().replace(integerRegex,"");var cardMonth=$("select[name=\"cardMonth\"]").val();var cardYear=$("select[name=\"cardYear\"]").val();var cardSecurityCode=$("input[name=\"cardSecurityCode\"]").val();if(cardRegex.test(cardNumber)&&cardMonth&&cardYear){var obj={cardNumber:cardNumber,cardMonth:cardMonth,cardYear:cardYear,cardSecurityCode:cardSecurityCode,validateCard:1};var _data3=JSON.stringify(obj);var headers=getMembershipHeaders();httpMethod("".concat(providerUrl,"/ClubMembership/UpdateCard"),_data3,headers).then(function(data){if(data.result==="SUCCESS"){if(!profileObj){if(customer)customerQuery();alert(cardUpdateSuccessMessage);memberRoute(productData)}else{updateProfilePage(profileObj,profileCustomer,profileRoute,profileCallback)}}else{enableInteractions();alert("error "+data.message)}})}else{enableInteractions();alert(provideDetailsForAllFields)}}function updateProfilePage(obj,customer,route,callback){updateMembershipDetails(obj);registerClick(1,function(regClickData){if(customer)customerQuery();alert("Your profile has been updated");if(route!==null)setCurrentWindowLocation(route);if(typeof callback==="function")callback()})}function updateMembershipDetails(updatedMembershipData){var existingMembershipData=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):getMembershipDetails();var membershipDetails=_objectSpread(_objectSpread({},existingMembershipData),updatedMembershipData);sessionStorage.getItem("loginCustomer")?sessionStorage.setItem("loginCustomer",JSON.stringify(membershipDetails)):sessionStorage.setItem("membership",JSON.stringify(membershipDetails))}function updateMember(route,clubId,callback){var obj={};var url="";var customer=null;var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(cookieData["memberId"]){obj.clubId=clubId;obj.memberId=cookieData["memberId"];if(document.getElementsByName("newPassword")[0].value!==document.getElementsByName("confirmPassword")[0].value){enableInteractions();$("#validationMessage").length?$("#validationMessage").show():alert("Passwords do not match");return}$("#validationMessage").hide();obj.clubPassword=document.getElementsByName("newPassword")[0]?document.getElementsByName("newPassword")[0].value:null;url="".concat(providerUrl,"/ClubMembership/Update")}else{if(document.getElementsByName("newPassword")[0]){if(document.getElementsByName("newPassword")[0].value!==document.getElementsByName("confirmPassword")[0].value){enableInteractions();$("#validationMessage").length?$("#validationMessage").show():alert("Passwords do not match");return}$("#validationMessage").hide();obj.eCommercePassword=document.getElementsByName("newPassword")[0].value}if(!orderData){customer=JSON.parse(sessionStorage.getItem("loginCustomer"))}url="".concat(providerUrl,"/ClubMembership/CustomerUpdate")}memberFields.forEach(function(field){if(field==="phoneNumber"&&phFormatByCountry==="true"){obj[field]=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:null;obj[field]=obj[field]?obj[field].replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):null}else{obj[field]=document.getElementsByName(field)[0]?document.getElementsByName(field)[0].value:null}});ship.forEach(function(field){obj[field]=document.getElementsByName(field)[0]?document.getElementsByName(field)[0].value:null});var inputs=$("input, select");inputs.each(function(index,input){if(input.name.indexOf("custom_")>=0){if(input.type==="checkbox")obj[input.name]=input.checked?1:0;else if(input.type==="radio"){if(input.checked)obj[input.name]=input.value}else obj[input.name]=input.value}else if(input.type==="checkbox"&&input.name!=="product"){if(input.name==="doNotSellName"){obj[input.name]=input.checked?0:1}else{obj[input.name]=input.checked?1:0}}});var data=JSON.stringify(obj);var headers=getMembershipHeaders();httpMethod(url,data,headers).then(function(data){if(data.result==="SUCCESS"){if($("input[name=\"cardNumber\"]").val()){updateCard("",obj,customer,route,callback)}else{updateProfilePage(obj,customer,route,callback)}}else{enableInteractions();alert("error "+data.message)}})}function generateComboDropDown(newDynamicCell,itemId,item,isPurchaseTable){var comboResult=comboDisplay("","","","","",itemId,"","","",item,isPurchaseTable);var container=document.createElement("span");container.innerHTML=comboResult.listOfItem;newDynamicCell.append(container)}function displayOrdersTable(retryCount,memberTable){var setBuyAgainRoute,buyAgainNodeName;var buyAgain=document.getElementById("buyAgainButton");var orderStatus=document.getElementById("orderStatusButton");var ordersTable=document.getElementById("fk-dynamic-orders-table");var dynamicOrdersBody=document.querySelector("tbody[id='fk-dynamic-orders-body']");var headerRow=document.querySelector("thead[id='fk-dynamic-orders-head'] > tr");if(buyAgain||orderStatus){var headerCell;if(!memberTable)headerCell=document.createElement("TH");if(buyAgain){!memberTable&&headerRow.appendChild(headerCell);buyAgain.setAttribute("action","route");buyAgainNodeName=buyAgain.nodeName;var buttonDataId=buyAgain.getAttribute("data-id");var buttonData=pageData.navigationItems&&pageData.navigationItems.find(function(item){return item.elementId===buttonDataId});setBuyAgainRoute=buttonData&&buttonData.linkDetails&&buttonData.linkDetails.length}!memberTable&&orderStatus&&headerRow.appendChild(headerCell)}var memberOrderRow=memberTable&&$(".cc-member-order-table").find(".cc-order-table-row");var memberOrderRowExists=memberOrderRow&&memberOrderRow.length;if(!memberTable&&!ordersTable||!memberOrderRowExists&&memberTable){return}if(memberOrderRowExists){memberOrderRow.slice(1).remove();memberOrderRow=memberOrderRow.first()}var orders=sessionStorage.getItem("customerOrders")?JSON.parse(sessionStorage.getItem("customerOrders")):null;if(!orders){var member=getMembershipDetails();var loginCustomer=sessionStorage.getItem("loginCustomer");if(member||loginCustomer){if(retryCount>3)return;orderQuery().then(function(data){displayOrdersTable((retryCount||1)+1,memberTable)})}return}var orderCellFormat=[];var currentOrderRow=document.querySelector("tr[id='fk-dynamic-orders-row']");if(currentOrderRow||memberTable){orderCellFormat=Array.prototype.slice.call(memberTable?memberOrderRow.children():currentOrderRow.cells)}if(dynamicOrdersBody&&!memberTable){dynamicOrdersBody.innerHTML=""}var newButton=function newButton(actionType,index){var actionBtn=document.createElement(actionType.nodeName);actionBtn.className=actionType.className;var buttonId=actionType.getAttribute("data-id");actionBtn.setAttribute("data-id",buttonId);var uniqueBtnId=buttonId+"-cc"+index;actionBtn.setAttribute("uniqueBtnId",uniqueBtnId);var id=actionType.getAttribute("id");actionBtn.title=actionType.title;actionBtn.innerHTML=actionType.innerHTML;actionBtn.style.cursor="pointer";return{actionBtn:actionBtn,uniqueBtnId:uniqueBtnId}};if(orders&&Object.keys(orders).length>0){var orderEntries=[].concat(Object.entries(orders).reverse());var orderEntriesLength=orderEntries.length;var _loop5=function _loop5(){var order=orderEntries[_i50][1];var newDynamicOrderRow=memberTable?memberOrderRow.clone(true):document.createElement("TR");var orderCellFormatLength=orderCellFormat.length;var _loop6=function _loop6(){var cell=orderCellFormat[j];var newDynamicCell=memberTable?cell.title&&newDynamicOrderRow.find("[title='"+cell.title+"']").find(".cc-order-table-cell-value")[0]:document.createElement("TD");if(!newDynamicCell&&memberTable){return 1;// continue
}cell.id!==""&&newDynamicCell.setAttribute("id",cell.id);if(!memberTable){newDynamicCell.className="table-cell"}newDynamicCell.textContent="";switch(cell.title){case"Order":newDynamicCell.textContent=order.orderId;break;case"Date":newDynamicCell.textContent=setDateFormat(new Date(order.dateCreated),"MM/dd/yy");break;case"Items":if(order.items&&Object.keys(order.items).length>0){var orderItemEntries=Object.entries(order.items);var orderItemsLength=orderItemEntries.length;for(var k=0;k<orderItemsLength;k++){var _item4=orderItemEntries[k][1];var productName="("+_item4.qty+") ";productName+=_item4.variantName?_item4.name+" "+_item4.variantName:_item4.name;if(_item4.customization&&_item4.customization.length){var orderItemId=_item4.orderItemId;generateComboDropDown(newDynamicCell,orderItemId,_item4,false)}else{newDynamicCell.append(productName+" ")}var lineBreak=document.createElement("BR");newDynamicCell.append(lineBreak)}}break;case"Amount":newDynamicCell.append(order.totalAmount?order.currencySymbol+order.totalAmount:"Pending");var amountRefunded=parseFloat(order.totalAmount||0)-parseFloat(order.refundRemaining||0);if(amountRefunded>0){var _lineBreak=document.createElement("BR");newDynamicCell.append(_lineBreak);var refundDiv=document.createElement("DIV");refundDiv.style.color="red";refundDiv.append("-"+order.currencySymbol+amountRefunded.toFixed(2)+" Refunded");newDynamicCell.append(refundDiv)}break;case"Tracking":newDynamicCell.textContent="";if(order.fulfillments&&Object.keys(order.fulfillments).length>0){var orderFulfillmentEntries=Object.entries(order.fulfillments);var orderFulfillmentEntriesLength=orderFulfillmentEntries.length;for(var _k=0;_k<orderFulfillmentEntriesLength;_k++){var fulfillment=orderFulfillmentEntries[_k][1];if(fulfillment.trackingNumber){newDynamicCell.append(addTrackingNumberLink(fulfillment.trackingNumber,true));var _lineBreak2=document.createElement("BR");newDynamicCell.append(_lineBreak2)}}}break;case"Date Shipped":newDynamicCell.textContent="";if(order.fulfillments&&Object.keys(order.fulfillments).length>0){var shippedFulfillmentEntries=Object.entries(order.fulfillments);var shippedFulfillmentEntriesLength=shippedFulfillmentEntries.length;for(var _k2=0;_k2<shippedFulfillmentEntriesLength;_k2++){newDynamicCell.textContent=setDateFormat(new Date(shippedFulfillmentEntries[_k2][1].dateShipped),"MM/dd/yy")}}break;case"Date Delivered":newDynamicCell.textContent="";if(order.fulfillments&&Object.keys(order.fulfillments).length>0){var deliveredFulfillmentsEntries=Object.entries(order.fulfillments);var deliveredFulfillmentsEntriesLength=deliveredFulfillmentsEntries.length;for(var _k3=0;_k3<deliveredFulfillmentsEntriesLength;_k3++){newDynamicCell.textContent=setDateFormat(new Date(deliveredFulfillmentsEntries[_k3][1].dateDelivered),"MM/dd/yy")}}break;case"Shipping Address":newDynamicCell.textContent="";if(order&&Object.keys(order.address1).length>0){var orderAddressEntries=Object.entries(order.address1);var orderAddressEntriesLength=orderAddressEntries.length;for(var _k4=0;_k4<orderAddressEntriesLength;_k4++){var address1=orderAddressEntries[_k4][1];if(address1){newDynamicCell.append(address1)}}}break;case"Order Actions":if(buyAgain&&order.orderType&&order.orderType==="NEW_SALE"){var bodyCell=document.createElement("SPAN");var buttonParams=newButton(buyAgain,_i50);bodyCell.innerHTML=buttonParams.actionBtn.outerHTML;bodyCell.childNodes[0].onclick=function(event){sessionStorage.setItem("ccCampaignId",order.campaignId);sessionStorage.setItem("fkCart",JSON.stringify({}));if(order.items&&Object.keys(order.items).length>0){var orderActionsEntries=Object.entries(order.items);var orderActionsEntriesLength=orderActionsEntries.length;for(var _k5=0;_k5<orderActionsEntriesLength;_k5++){var _item5=orderActionsEntries[_k5][1];var _productId3=_item5.variantDetailId?_item5.productId+"."+_item5.variantDetailId:_item5.productId;var ordersObject=JSON.parse(sessionStorage.getItem("fkCart"));ordersObject[_productId3]=_item5.qty;sessionStorage.setItem("fkCart",JSON.stringify(ordersObject))}}setBuyAgainRoute&&(buyAgainNodeName==="A"?linkMethod(event,"","",buttonParams.uniqueBtnId):buyAgainNodeName==="BUTTON"?route(event):null)};newDynamicCell.append(bodyCell)}if(orderStatus){var _bodyCell=document.createElement("SPAN");var _buttonParams=newButton(orderStatus,_i50);_bodyCell.innerHTML=_buttonParams.actionBtn.outerHTML;var buttonId=orderStatus.getAttribute("data-id");_bodyCell.onclick=function(e){sessionStorage.setItem("orderStatusInfo",JSON.stringify(order));callMethodApply(buttonId,"","",_buttonParams.uniqueBtnId)};newDynamicCell.append(_bodyCell)}break}!memberTable&&newDynamicOrderRow.appendChild(newDynamicCell)};for(var j=0;j<orderCellFormatLength;j++){if(_loop6())continue}if(!memberTable){newDynamicOrderRow.id="fk-dynamic-orders-row";dynamicOrdersBody.appendChild(newDynamicOrderRow)}else{newDynamicOrderRow.insertBefore(memberOrderRow)}};for(var _i50=0;_i50<orderEntriesLength;_i50++){_loop5()}memberTable&&memberOrderRow.remove()}}function displayShipmentsTable(retryCount,memberTable){var ordersTable=document.getElementById("fk-dynamic-shipments-table");var dynamicOrdersBody=document.querySelector("tbody[id='fk-dynamic-shipments-body']");var memberOrderRow=memberTable&&$(".cc-member-shipment-table").find(".cc-shipment-table-row");var memberOrderRowExists=memberOrderRow&&memberOrderRow.length;if(!ordersTable&&!memberTable||memberTable&&!memberOrderRowExists){return}if(memberOrderRowExists){memberOrderRow.slice(1).remove();memberOrderRow=memberOrderRow.first()}var orders=sessionStorage.getItem("customerOrders")?JSON.parse(sessionStorage.getItem("customerOrders")):null;if(!orders){var member=getMembershipDetails();var loginCustomer=sessionStorage.getItem("loginCustomer");if(member||loginCustomer){if(retryCount>3)return;orderQuery().then(function(data){displayShipmentsTable((retryCount||1)+1,memberTable)})}return}var orderCellFormat=[];var currentOrderRow=document.querySelector("tr[id='fk-dynamic-shipments-row']");if(currentOrderRow||memberTable){orderCellFormat=Array.prototype.slice.call(memberTable?memberOrderRow.children():currentOrderRow.cells)}if(dynamicOrdersBody&&!memberTable){dynamicOrdersBody.innerHTML=""}if(orders&&Object.keys(orders).length>0){var orderEntries=[].concat(Object.entries(orders).reverse());var orderEntriesLength=orderEntries.length;for(var _i51=0;_i51<orderEntriesLength;_i51++){var order=orderEntries[_i51][1];if(order&&order.fulfillments){var fulfillmentsEntries=Object.entries(order.fulfillments);var fulfillmentsEntriesLength=fulfillmentsEntries.length;for(var j=0;j<fulfillmentsEntriesLength;j++){var fulfillment=fulfillmentsEntries[j][1];var newDynamicOrderRow=memberTable?memberOrderRow.clone(true):document.createElement("TR");var orderCellFormatLength=orderCellFormat.length;for(var k=0;k<orderCellFormatLength;k++){var cell=orderCellFormat[k];var newDynamicCell=memberTable?cell.title&&newDynamicOrderRow.find("[title='"+cell.title+"']").find(".cc-shipment-table-cell-value")[0]:document.createElement("TD");cell.id!==""&&newDynamicCell.setAttribute("id",cell.id);if(!newDynamicCell&&memberTable){continue}if(!memberTable){newDynamicCell.className="table-cell"}newDynamicCell.textContent="";switch(cell.title){case"Order":newDynamicCell.textContent=order.orderId;break;case"Tracking":newDynamicCell.textContent="";if(order.fulfillments&&Object.keys(order.fulfillments).length>0){if(fulfillment.trackingNumber){newDynamicCell.append(addTrackingNumberLink(fulfillment.trackingNumber,true));var lineBreak=document.createElement("BR");newDynamicCell.append(lineBreak)}}break;case"Shipped":if(order.fulfillments&&Object.keys(order.fulfillments).length>0){newDynamicCell.textContent=fulfillment.dateShipped?setDateFormat(new Date(fulfillment.dateShipped),"MM/dd/yy"):""}break;case"Delivered":if(order.fulfillments&&Object.keys(order.fulfillments).length>0){newDynamicCell.textContent=fulfillment.dateDelivered?setDateFormat(new Date(fulfillment.dateDelivered),"MM/dd/yy"):""}break;case"Address":newDynamicCell.textContent="";if(order&&order.address1&&Object.keys(order.address1).length>0){var orderAddress1Entries=Object.entries(order.address1);var orderAddress1EntriesLength=orderAddress1Entries.length;for(var l=0;l<orderAddress1EntriesLength;l++){var address1=orderAddress1Entries[l][1];if(address1){newDynamicCell.append(address1)}}order.address2?newDynamicCell.append(", "):newDynamicCell.append(document.createElement("BR"))}if(order&&order.address2&&Object.keys(order.address2).length>0){var orderAddress2Entries=Object.entries(order.address2);var orderAddress2EntriesLength=orderAddress2Entries.length;for(var _l=0;_l<orderAddress2EntriesLength;_l++){var address2=orderAddress2Entries[_l][1];if(address2){newDynamicCell.append(address2)}}newDynamicCell.append(document.createElement("BR"))}if(order&&order.city&&Object.keys(order.city).length>0){var orderCityEntries=Object.entries(order.city);var orderCityEntriesLength=orderCityEntries.length;for(var _l2=0;_l2<orderCityEntriesLength;_l2++){var city=orderCityEntries[_l2][1];if(city){newDynamicCell.append(city)}}if(order.state){newDynamicCell.append(", ")}}if(order&&order.state&&Object.keys(order.state).length>0){var orderStateEntries=Object.entries(order.state);var orderStateEntriesLength=orderStateEntries.length;for(var _l3=0;_l3<orderStateEntriesLength;_l3++){var state=orderStateEntries[_l3][1];if(state){newDynamicCell.append(state)}}if(order.postalCode){newDynamicCell.append(" ")}}if(order&&order.postalCode&&Object.keys(order.postalCode).length>0){var postalCodeEntries=Object.keys(order.postalCode);var postalCodeEntriesLength=postalCodeEntries.length;for(var _l4=0;_l4<postalCodeEntriesLength;_l4++){var postalCode=postalCodeEntries[_l4][1];if(postalCode){newDynamicCell.append(postalCode)}}}break}!memberTable&&newDynamicOrderRow.appendChild(newDynamicCell)}if(!memberTable){newDynamicOrderRow.id="fk-dynamic-shipments-row";dynamicOrdersBody.appendChild(newDynamicOrderRow)}else{$(newDynamicOrderRow).insertBefore(memberOrderRow)}}}}memberTable&&memberOrderRow.remove()}}function displayPurchasesTable(retryCount,memberTable){var purchasesTable=document.getElementById("fk-dynamic-purchases-table");var dynamicPurchasesBody=document.querySelector("tbody[id='fk-dynamic-purchases-body']");var memberOrderRow=memberTable&&$(".cc-member-purchase-table").find(".cc-purchase-table-row");var memberOrderRowExists=memberOrderRow&&memberOrderRow.length;if(!purchasesTable&&!memberTable||memberTable&&!memberOrderRowExists){return}memberTable&&$("#ccNoSubscriptions").hide();if(memberOrderRowExists){memberOrderRow.slice(1).remove();memberOrderRow=memberOrderRow.first()}var purchases=JSON.parse(sessionStorage.getItem("customerPurchases"));if(!purchases){if(retryCount>3)return;purchaseQuery().then(function(data){displayPurchasesTable((retryCount||1)+1,memberTable)});return}var purchaseCellFormat=[];var currentPurchaseRow=document.querySelector("tr[id='fk-dynamic-purchases-row']");if(currentPurchaseRow||memberTable){purchaseCellFormat=Array.prototype.slice.call(memberTable?memberOrderRow.children():currentPurchaseRow.cells)}var pauseBtn=document.getElementById("purchasePauseBtn");var cancelBtn=document.getElementById("purchaseCancelBtn");var reactivateBtn=document.getElementById("purchaseReactivateBtn");var editBtn=document.getElementById("purchaseEditBtn");if(dynamicPurchasesBody){dynamicPurchasesBody.innerHTML=""}if(purchases&&Object.keys(purchases).length>0){var createActionBtn=function createActionBtn(purchase,sampleBtn,index){var actionBtn=document.createElement(sampleBtn.nodeName);actionBtn.className=sampleBtn.className;var buttonId=sampleBtn.getAttribute("data-id");var uniqueBtnId=buttonId+"-cc"+index;actionBtn.setAttribute("uniqueBtnId",uniqueBtnId);actionBtn.setAttribute("data-id",buttonId);var id=sampleBtn.getAttribute("id");actionBtn.setAttribute("id",id);actionBtn.innerHTML=sampleBtn.innerHTML;actionBtn.title=sampleBtn.title;actionBtn.style.cursor="pointer";actionBtn.onclick=function(e){e.preventDefault();e.target.id==="purchaseEditBtn"&&sessionStorage.setItem("ccChangeProductCampaignId",purchase.campaignId);sessionStorage.setItem("actionPurchaseId",purchase.purchaseId);sessionStorage.setItem("actionProductId",JSON.stringify([parseInt(purchase.productId)]));sessionStorage.setItem("actionCurrentItem",purchase.currentItem);sessionStorage.setItem("actionCurrentProductQty",parseFloat(purchase.currentQty));sessionStorage.setItem("actionNextBillDate",purchase.nextBillDate);sessionStorage.setItem("actionBillingIntervalDays",purchase.frequency);sessionStorage.setItem("actionPrice",purchase.price);sessionStorage.setItem("ccActionPurchaseItem",JSON.stringify(purchase));callMethodApply(buttonId,"","",uniqueBtnId)};return actionBtn};var purchaseEntries=Object.entries(purchases);var sortedStatuses={"ACTIVE":0,"TRIAL":0,"INACTIVE":1,"PENDING":2,"RECYCLE_BILLING":3,"RECYCLE_FAILED":3,"CANCELLED":4,"COMPLETE":5};purchaseEntries.sort(function(a,b){return sortedStatuses[a[1].status]<sortedStatuses[b[1].status]?-1:sortedStatuses[a[1].status]>sortedStatuses[b[1].status]?1:0});var purchaseEntriesLength=purchaseEntries.length;for(var _i52=0;_i52<purchaseEntriesLength;_i52++){var purchase=purchaseEntries[_i52][1];var newDynamicPurchaseRow=memberTable?memberOrderRow.clone(true):document.createElement("TR");var purchaseCellFormatLength=purchaseCellFormat.length;for(var j=0;j<purchaseCellFormatLength;j++){var cell=purchaseCellFormat[j];var newDynamicCell=memberTable?cell.title&&newDynamicPurchaseRow.find("[title='"+cell.title+"']").find(".cc-purchase-table-cell-value")[0]:document.createElement("TD");if(!newDynamicCell&&memberTable){continue}cell.id!==""&&newDynamicCell.setAttribute("id",cell.id);if(!memberTable){newDynamicCell.className="table-cell"}newDynamicCell.textContent="";switch(cell.title){case"Order":newDynamicCell.textContent=purchase.orderId;break;case"Purchase":newDynamicCell.textContent=purchase.purchaseId;break;case"Product":if(purchase.customization&&purchase.customization.length){var purchaseId=purchase.purchaseId;generateComboDropDown(newDynamicCell,purchaseId,purchases[purchaseId],true)}else{newDynamicCell.textContent=purchase.product+" "}break;case"Quantity":newDynamicCell.textContent=purchase.currentQty;break;case"Status":var displayStatus=purchase.status;var displayText=displayStatus.charAt(0)+displayStatus.slice(1).toLowerCase();var displaySubscriptionStatus=void 0;var subscriptionStatus=false;if(+purchase.pauseSchedule){subscriptionStatus=true;displaySubscriptionStatus="pause scheduled for "+purchase.nextBillDate}else if(+purchase.cancellationSchedule){subscriptionStatus=true;displaySubscriptionStatus="cancellation scheduled for "+(purchase.nextBillDate?purchase.nextBillDate:purchase.cancelAfterDate)}switch(displayStatus){case"INACTIVE":displayStatus="Paused";break;case"RECYCLE_BILLING":case"RECYCLE_FAILED":displayStatus="Declined";break;default:displayStatus=displayStatus&&subscriptionStatus?displayText+" ("+displaySubscriptionStatus+")":displayText;break}newDynamicCell.textContent=displayStatus;break;case"NextBill":newDynamicCell.textContent=+purchase.pauseSchedule||+purchase.cancellationSchedule?"--":purchase.nextBillDate;break;case"Actions":switch(purchase.status){case"CANCELLED":case"INACTIVE":if(reactivateBtn){newDynamicCell.append(createActionBtn(purchase,reactivateBtn,_i52))}break;case"ACTIVE":case"TRIAL":if(+purchase.pauseSchedule||+purchase.cancellationSchedule){newDynamicCell.append(createActionBtn(purchase,reactivateBtn,_i52))}else{if(editBtn&&purchase.status==="ACTIVE"){newDynamicCell.append(createActionBtn(purchase,editBtn,_i52))}if(pauseBtn){newDynamicCell.append(createActionBtn(purchase,pauseBtn,_i52))}if(cancelBtn){newDynamicCell.append(createActionBtn(purchase,cancelBtn,_i52))}}break;default:if(pauseBtn){newDynamicCell.append(createActionBtn(purchase,pauseBtn,_i52))}if(cancelBtn){newDynamicCell.append(createActionBtn(purchase,cancelBtn,_i52))}break}break;case"Price":newDynamicCell.textContent=purchase.price?purchase.currencySymbol+parseFloat(purchase.price).toFixed(2):"N/A";break}!memberTable&&newDynamicPurchaseRow.appendChild(newDynamicCell)}if(!memberTable){newDynamicPurchaseRow.id="fk-dynamic-purchases-row";dynamicPurchasesBody.appendChild(newDynamicPurchaseRow)}else{$(newDynamicPurchaseRow).insertBefore(memberOrderRow)}}}else if(memberOrderRow){$("#ccNoSubscriptions").length?$("#ccNoSubscriptions").show():$("<div class='p-2 text-center'>No subscriptions</div>").insertAfter(memberOrderRow)}memberOrderRow&&memberOrderRow.remove()}function setLeadCountryAndStateInputs(orderData,params){var majorAddressInputs=["state","country","shipState","shipCountry"];majorAddressInputs.forEach(function(inputName){var input=$("[name='"+inputName+"']");if(input.length&&!params[inputName]){params[inputName]=input.val()||orderData[inputName]}})}function captureLead(_x13,_x14,_x15){return _captureLead.apply(this,arguments)}function _captureLead(){_captureLead=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(callSync,containerId,skipCreateSession){var params,orderData,setLeadParams,pageTypeId,currentOrderItems,billShipSameElement,shippingProfileId,shipData,_orderItems27,index,sessionItemCpId,_productData18,emailRegex,session,leadParams,existingParams,setOrderDetails,_response5;return _regeneratorRuntime().wrap(function _callee18$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:setLeadParams=function _setLeadParams(inputs){var inputsLength=inputs.length;for(var _i145=0;_i145<inputsLength;_i145++){var input=inputs[_i145];if(input.name==="fullName"){var fullName=input.value.trim();var pos=fullName.indexOf(" ");params.firstName=pos>-1?fullName.substring(0,pos):fullName;params.lastName=pos>-1?fullName.substring(pos+1):null}else if(input.name==="shipFullName"){var _fullName2=input.value.trim();var _pos2=_fullName2.indexOf(" ");params.shipFirstName=_pos2>-1?_fullName2.substring(0,_pos2):_fullName2;params.shipLastName=_pos2>-1?_fullName2.substring(_pos2+1):null}else if(input.type==="checkbox"){if(input.name!=="product"){if(input.name==="doNotSellName"){params[input.name]=input.checked?0:1}else{params[input.name]=input.checked?1:0}}}else if(input.type==="radio"){if(input.checked&&input.name!=="product"){params[input.name]=input.value}}else if(input.name==="phoneNumber"&&phFormatByCountry==="true"){params.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";params.phoneNumber=params.phoneNumber?params.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else if(!input.name.startsWith("custom_item_")){params[input.name]=input.value}}};ccSetPhoneDialCode();params={};orderData=sessionStorage.getItem("orderData");orderData=orderData?JSON.parse(orderData):{};pageTypeId=pageData&&pageData.pageTypeId;if(containerId){window.clearInterval(captureLeadInterval);setLeadParams($("#"+containerId).find("input, select"));setLeadCountryAndStateInputs(orderData,params)}else{getExternalShipping();loadShipProfiles();if(pageData.selectedCampaign&&pageData.selectedCampaign.taxServiceId&&pageData.selectedCampaign.autoTax){currentOrderItems=getOrderItemDetails();calculateTax(currentOrderItems)}if(pageTypeId===4&&$("[name=cardNumber]").length){billShipSameElement=document.getElementsByName("billShipSame")[0];params.billShipSame=billShipSameElement?billShipSameElement.checked?1:0:document.getElementsByName("address1")[0]&&!document.getElementsByName("shipAddress1")[0]?1:0}setLeadParams($("input, select"));fetchLeadDetails(params);setLeadCountryAndStateInputs(orderData,params);if(params.billShipSame===1&&!params.address1){params.country=null}if(params.billShipSame===1&&!params.shipAddress1){params.shipCountry=null}shippingProfileId=getCurrentShipProfile();params.shipProfileId=shippingProfileId&&shippingProfileId.includes("pickup-")?null:shippingProfileId;if(params.shipProfileId&&params.shipProfileId.indexOf(":")>0){shipData=params.shipProfileId.split(":");params.shipProfileId=null;params.shipCarrier=shipData[3]=="OpenBorder"?"ob:"+shipData[0]:shipData[1];params.shipMethod=shipData[3]=="OpenBorder"?shipData[1]:shipData[3]}_orderItems27=getOrderItems();index=0;for(sessionItemCpId in _orderItems27){index++;if(sessionItemCpId.indexOf(".")>0){_productData18=sessionItemCpId.split(".");params["product"+index+"_id"]=_productData18[0];params["variant"+index+"_id"]=_productData18[1]}else{params["product"+index+"_id"]=sessionItemCpId}params["product"+index+"_qty"]=_orderItems27[sessionItemCpId]}if(orderData&&orderData.orderId)params.orderId=orderData.orderId}if(!skipCreateSession&&![3,5].includes(pageTypeId)&&!(sessionStorage.getItem("sessionId")&&sessionStorage.getItem("ccExternalSessionId"))){ccCreateSession(pageTypeId,isFirstTime())}delete params.cardNumber;delete params.cardSecurityCode;delete params.password;if(params.emailAddress){emailRegex=/^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$/i;if(!emailRegex.test(params.emailAddress))params.emailAddress=null}if(params.phoneNumber){params.phoneNumber=phFormatByCountry==="true"?params.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):params.phoneNumber.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}if(!(!params.emailAddress&&!containerId)){_context19.next=18;break}if(!((!params.firstName||!params.lastName)&&(!params.shipFirstName||!params.shipLastName))){_context19.next=16;break}return _context19.abrupt("return");case 16:if(!(!params.phoneNumber||params.phoneNumber.length<10)){_context19.next=18;break}return _context19.abrupt("return");case 18:params.salesUrl=getCurrentWindowLocation().href;params.campaignId=parseInt(pageData.funnelData.campaign);if(!params.custom1)params.custom1=pageData.funnelData.name;if(!params.custom2)params.custom2=pageData.currentPage.title;session=sessionStorage.getItem("ccExternalSessionId");session?params.sessionId=session:null;leadParams=JSON.stringify(params);existingParams=sessionStorage.getItem("leadParams");if(!(leadParams!==existingParams)){_context19.next=39;break}setOrderDetails=function setOrderDetails(data){if(data&&data.result==="SUCCESS"){sessionStorage.setItem("orderData",JSON.stringify(data.message));var _orderId7=data.message.orderId;sessionStorage.setItem("orderId",JSON.stringify(_orderId7))}};sessionStorage.setItem("leadParams",leadParams);if(!callSync){_context19.next=37;break}_context19.next=32;return httpMethod("".concat(providerUrl,"/Import/Lead"),leadParams);case 32:_response5=_context19.sent;setOrderDetails(_response5);if(_response5.result==="SUCCESS"){if(_response5.message.activeMembership){displayPrices()}}_context19.next=38;break;case 37:httpMethod("".concat(providerUrl,"/Import/Lead"),leadParams).then(function(data){setOrderDetails(data);if(data.result==="SUCCESS"){if(data.message.activeMembership){displayPrices()}}});case 38:if(window.ltk&&params.emailAddress){callLisTrakConversion(window.ltk,"CaptureEmail");callLisTrakConversion(window.ltk,"UpdateCart")}case 39:case"end":return _context19.stop()}},_callee18)}));return _captureLead.apply(this,arguments)}function showExceptionInPopupValue(){return getAddOnKeyValue(findAddOn("ENABLE_POPUP"))==="true"?true:false}function importLead(buttonId,route){ccSetPhoneDialCode();var obj={};if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");obj.firstName=pos>-1?fullName.substring(0,pos):fullName;obj.lastName=pos>-1?fullName.substring(pos+1):null}else{obj.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;obj.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}obj.companyName=document.getElementsByName("companyName")[0]?document.getElementsByName("companyName")[0].value:null;obj.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;obj.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;obj.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;obj.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;obj.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;obj.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;obj.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){obj.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";obj.phoneNumber=obj.phoneNumber?obj.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{obj.phoneNumber=document.getElementsByName("phoneNumber")[0].value.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}}obj.gender=document.getElementsByName("gender")[0]?document.getElementsByName("gender")[0].value:null;obj.dob=document.getElementsByName("dob")[0]?document.getElementsByName("dob")[0].value:null;var shippingProfileId=getCurrentShipProfile();obj.shipProfileId=shippingProfileId&&shippingProfileId.includes("pickup-")?null:shippingProfileId;if(obj.shipProfileId&&obj.shipProfileId.indexOf(":")>0){var shipData=obj.shipProfileId.split(":");obj.shipProfileId=null;obj.shipCarrier=shipData[1];obj.shipMethod=shipData[3]}obj.custom1=document.getElementsByName("custom1")[0]?document.getElementsByName("custom1")[0].value:null;obj.custom2=document.getElementsByName("custom2")[0]?document.getElementsByName("custom2")[0].value:null;obj.custom3=document.getElementsByName("custom3")[0]?document.getElementsByName("custom3")[0].value:null;obj.custom4=document.getElementsByName("custom4")[0]?document.getElementsByName("custom4")[0].value:null;obj.custom5=document.getElementsByName("custom5")[0]?document.getElementsByName("custom5")[0].value:null;if(!obj.custom1)obj.custom1=pageData.funnelData.name;if(!obj.custom2)obj.custom2=pageData.currentPage.title;if(document.getElementsByName("newPassword")[0]){if(document.getElementsByName("newPassword")[0].value!==document.getElementsByName("confirmPassword")[0].value){enableInteractions();$("#validationMessage").length?$("#validationMessage").show():alert("Passwords do not match");return}$("#validationMessage").hide();obj.eCommercePassword=document.getElementsByName("newPassword")[0].value;obj.eCommerceLogin=obj.emailAddress}var inputs=$("input, select");inputs.each(function(index,input){if(input.name.indexOf("custom_")>=0){if(input.type==="checkbox")obj[input.name]=input.checked?1:0;else if(input.type==="radio"){if(input.checked)obj[input.name]=input.value}else obj[input.name]=input.value}else if(input.type==="checkbox"&&!excludeInputs[input.name]){if(input.name==="doNotSellName"){obj[input.name]=input.checked?0:1}else{obj[input.name]=input.checked?1:0}}else if(input.type==="radio"&&!excludeInputs[input.name]&&!excludeClassName.hasOwnProperty(function(value){return input.classList.contains(value)})){if(input.checked)obj[input.name]=input.value}});var sessionKeys=Object.keys(sessionStorage);sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)obj[key]=sessionStorage.getItem(key)});obj.billShipSame=document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked?1:0;obj.salesUrl=getCurrentWindowLocation().href;obj.campaignId=parseInt(pageData.funnelData.campaign);fetchLeadDetails(obj);//getting variant products
getVariants();var orderItems=getOrderItems();var offer=getOfferFromNavigationItem(buttonId);if(offer){orderItems[offer]=getQuantity();orderItems=isSubscribeOn?swapSubscriptions(orderItems):orderItems;sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}var index=0;for(var sessionItemCpId in orderItems){index++;if(sessionItemCpId.indexOf(".")>0){var _productData5=sessionItemCpId.split(".");obj["product"+index+"_id"]=_productData5[0];obj["variant"+index+"_id"]=_productData5[1]}else{obj["product"+index+"_id"]=sessionItemCpId}obj["product"+index+"_qty"]=orderItems[sessionItemCpId]}var bundleStockParams=getBundleVariants(obj,index);obj=bundleStockParams.params;obj.isLeadSubmit=1;var session=sessionStorage.getItem("ccExternalSessionId");session?obj.sessionId=session:null;var data=JSON.stringify(obj);sessionStorage.setItem("userDetails",data);if(window.ccFacebookPixelID){window.triggerfacebookpixelEvent&&triggerfacebookpixelEvent("Lead")}ccTrackSygnalEvents&&window.rrq&&window.rrq("track","Lead",{});if(window.ltk&&obj.emailAddress)callLisTrakConversion(window.ltk,"CaptureEmail");var response=httpMethod("".concat(providerUrl,"/Import/Lead"),data).then(function(data){if(data.result==="SUCCESS"){registerClick(1,function(regClickData){sessionStorage.setItem("orderData",JSON.stringify(data.message));//setting orderId to be used globally
orderId=data.message.orderId;sessionStorage.setItem("orderId",JSON.stringify(orderId));sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)sessionStorage.removeItem(key)});if(route&&route.includes("__ORDERID__")){route=route.replace("__ORDERID__",orderId)}setCurrentWindowLocation(route)})}else{var tag=document.getElementById("error-"+buttonId);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+buttonId);tag.classList.add(commonErrorClass)}else{tag.innerHTML=""}tag.innerHTML=data.message;var color=tag.style.color="red";var pageForm=$("button[data-id='"+buttonId+"']").length?$("button[data-id='"+buttonId+"']"):$("a[data-id='"+buttonId+"']");showExceptionInPopupValue()?alert(data.message.replaceAll(breakTagRegex,"\n")):$(tag).insertAfter(pageForm);enableInteractions();return result=false}})}var ProductType={"offer":0,"upsell":1};var getCommonReferenceId=function getCommonReferenceId(){try{var _funnelJson;return(_funnelJson=funnelJson)===null||_funnelJson===void 0||(_funnelJson=_funnelJson.funnelData.pages.find(function(page){return page.pageView.find(function(pv){return pv.pageType==36})!=null}))===null||_funnelJson===void 0?void 0:_funnelJson.pageView[0].referenceId}catch(er){return null}};var getCommonElements=function getCommonElements(id){var commonReferenceId=getCommonReferenceId();if(commonReferenceId){return funnelJson.elements.find(function(element){return element.pageViewReferenceId===commonReferenceId&&element.elementId===id})}return null};function getNavigationItemFromPageData(buttonId){var _paySourceNavItem$lin,_navigation$linkDetai;// {
//     "elementId": "fkt-button-d312fcad-5eae-45f6-9e8d-4db6cd414ce0",
//     "href": "",
//     "status": null,
//     "pageViewReferenceId": "e4c34dc7-be70-4be4-8db7-6588ce552ec6",
//     "linkDetails": [],
//     "products": []
// },
//Use pageData from session if pageData hasn't loaded from ajax before 2 click Paypal upsale processing
var newButtonId=buttonId&&buttonId.split("_prodCol")[0];var selectedPaysource=sessionStorage.getItem("paySource");var paySourceNavItem=pageData.navigationItems.find(function(navItem){return navItem.elementId===newButtonId+"-"+selectedPaysource});var navigation=paySourceNavItem!==null&&paySourceNavItem!==void 0&&(_paySourceNavItem$lin=paySourceNavItem.linkDetails)!==null&&_paySourceNavItem$lin!==void 0&&_paySourceNavItem$lin.length?paySourceNavItem:pageData.navigationItems.find(function(navItem){return navItem.elementId===newButtonId});if(navigation&&(_navigation$linkDetai=navigation.linkDetails)!==null&&_navigation$linkDetai!==void 0&&_navigation$linkDetai.length){return navigation}return getCommonElements(newButtonId)||navigation}function getProductInfoFromNavigationItem(type,buttonId){var productButton=document.querySelector("[data-id="+buttonId+"]");var productButtonValue=productButton.getAttribute(type);if(productButtonValue&&parseInt(productButtonValue)>0){return productButtonValue}var item=getNavigationItemFromPageData(buttonId);if(item&&item.products&&item.products.length){return item.products[0]}return null}function getOfferFromNavigationItem(buttonId){return getProductInfoFromNavigationItem("offer",buttonId)}function getUpsellFromNavigationItem(buttonId){return getProductInfoFromNavigationItem("upsell",buttonId)}function rolebackSessionProducts(offer){var orderItems=getOrderItems();delete orderItems[offer];orderItems=isSubscribeOn?swapSubscriptions(orderItems,offer):orderItems;sessionStorage.setItem("fkCart",JSON.stringify(orderItems))}function addItemToCustomCart(itemKey,input,offer){var customCart=sessionStorage.getItem("customCart")!==null?JSON.parse(sessionStorage.getItem("customCart")):{};try{var customCartLength=Object.keys(customCart).length;var customInputName=input.name.replace("custom_item_","");var _productId4,customValue,qty;var _orderItems3=getOrderItems();if(itemKey){_productId4=itemKey}else{var keys=_orderItems3&&Object.keys(_orderItems3).length&&Object.keys(_orderItems3);_productId4=!keys&&offer?offer:keys&&keys.length?_productId4=keys[0]:""}qty=_productId4&&_orderItems3[_productId4]?_orderItems3[_productId4]:0;var productExistsInCC=false;var noMatchCount=0;if(customCartLength&&_productId4){var _loop7=function _loop7(_i53){var customCartValues=customCart[_i53].split("|");var customCartProductId=customCartValues[0];if(customCartProductId==_productId4){if(!customCart[_i53].includes("|"+customInputName+":")&&input.value){customValue=customInputName+":"+input.value;customCart[_i53]=customCart[_i53].concat("|"+customValue)}else{customCartValues.forEach(function(value,index){var customFieldName=value.split(":")[0];if(customFieldName==customInputName){var _index=customCartValues.indexOf(value);if(!input.value){customCartValues.splice(_index,1)}else{customCartValues[_index]=customInputName+":"+input.value}customCart[_i53]=customCartValues.join("|")}})}}else noMatchCount++};for(var _i53=0;_i53<customCartLength;_i53++){_loop7(_i53)}}else if(_productId4&&qty){noMatchCount=-1}if(noMatchCount===-1||noMatchCount==customCartLength){customValue=customInputName+":"+input.value;customCart[customCartLength]=_productId4+"|"+qty+"|"+customValue}return customCart}catch(err){err}}function importOrder(_x16,_x17,_x18,_x19,_x20){return _importOrder.apply(this,arguments)}function _importOrder(){_importOrder=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(buttonId,route,paypalSdkPrePaidType,paayDetails,openElementFormDetails){var outOfStockProducts,orderId,obj,orderData,paypalSmartButtonSdk,customCart,fullName,pos,preventDefaultCouponRemoval,defaultCouponCode,externalShipProfileSelected,shipData,cardNonce,ageVerificationPluginId,offer,buttonElement,buttonVariantValue,quantity,_orderItems28,orderItemsCopy,_rebillCart2,buttonReplacementValue,itemOfferKey,inputs,sessionKeys,cardDateVal,cardDateValueParsed,month,year,ccFraudSessionElement,ccFraudSessionId,isCardOnFileElementExists,loginCustomer,headers,checkoutResource,squareMerchantAccount,shopPayUrl,baseProductId,multiPayProductId,multiPayRebillsEnabled,multiPayProductMap,_loop38,_ret4,_productId18,shippableOrder,_loop39,sessionItemCpId,index,_sessionItemCpId,_item20,_productData19,customCartLength,_i146,bundleStockParams,paayEnabled,cardBin,paayError,cardErrorDetails,key,savedError,authenticateCards,paayCardType,paayItem,paayInitialData,paayRebillData,session,submitImportOrder,_JSON$parse5,salesTax,shipTotal,amazonName,_pos3,amazonEmail,payment,applePayMerchantAccount,details,merchantInitiatedRebills,fflNumber,orderItemsForDB,totals,tagElements,tag,pageForm,_message2,_data9,_response6;return _regeneratorRuntime().wrap(function _callee19$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:outOfStockProducts=[];orderId=sessionStorage.getItem("orderId");orderId=JSON.parse(orderId);obj={};//If import order is success and customer tries to checkout again just redirect to route
orderData=JSON.parse(sessionStorage.getItem("orderData"));paypalSmartButtonSdk=sessionStorage.getItem("paypalSdk");customCart=sessionStorage.getItem("customCart")!==null?JSON.parse(sessionStorage.getItem("customCart")):null;if(!(!orderData||orderData.orderStatus==="DECLINED"||orderData.orderStatus==="PARTIAL")){_context22.next=342;break}if(document.getElementsByName("fullName")[0]){fullName=document.getElementsByName("fullName")[0].value.trim();pos=fullName.indexOf(" ");obj.firstName=pos>-1?fullName.substring(0,pos):fullName;obj.lastName=pos>-1?fullName.substring(pos+1):null}else{obj.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;obj.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}obj.companyName=document.getElementsByName("companyName")[0]?document.getElementsByName("companyName")[0].value:null;obj.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;obj.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;obj.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;obj.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;obj.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;obj.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;obj.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){obj.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";obj.phoneNumber=obj.phoneNumber?obj.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{obj.phoneNumber=document.getElementsByName("phoneNumber")[0].value.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}}obj.gender=document.getElementsByName("gender")[0]?document.getElementsByName("gender")[0].value:null;obj.dob=document.getElementsByName("dob")[0]?document.getElementsByName("dob")[0].value:null;preventDefaultCouponRemoval=getAddOnKeyValue(findAddOn("PRE_COUPON_REMOVAL"))==="true";defaultCouponCode=pageData.selectedCampaign.defaultCouponCode;if(preventDefaultCouponRemoval&&defaultCouponCode&&!appliedCouponCode.includes(defaultCouponCode)){appliedCouponCode.splice(0,0,defaultCouponCode)}window.ccSendIdmeCouponCodeToImportOrder&&ccSendIdmeCouponCodeToImportOrder(appliedCouponCode,obj);obj.couponCode=appliedCouponCode.length>0?appliedCouponCode.toString():null;getShipProfile()&&getShipProfile().storePickupId?obj.storePickupId=getShipProfile().storePickupId:obj.shipProfileId=getCurrentShipProfile();externalShipProfileSelected=obj.shipProfileId&&obj.shipProfileId.indexOf(":")>0;shipData=externalShipProfileSelected&&obj.shipProfileId.split(":");if(shipData){obj.externalShipProfileId=obj.shipProfileId;obj.shipProfileId=null;obj.shipCarrier=shipData[3]=="OpenBorder"?"ob:"+shipData[0]:shipData[1];obj.shipMethod=shipData[3]=="OpenBorder"?shipData[1]:shipData[3];obj.totalShipping=shipData[4]}obj.achRoutingNumber=document.getElementsByName("achRoutingNumber")[0]?document.getElementsByName("achRoutingNumber")[0].value:null;obj.achAccountNumber=document.getElementsByName("achAccountNumber")[0]?document.getElementsByName("achAccountNumber")[0].value:null;obj.achAccountType=document.getElementsByName("achAccountType")[0]?document.getElementsByName("achAccountType")[0].value:null;obj.iban=document.getElementsByName("iban")[0]?document.getElementsByName("iban")[0].value:null;obj.ddbic=document.getElementsByName("ddbic")[0]?document.getElementsByName("ddbic")[0].value:null;cardNonce=document.getElementById("formCardNonce");if(cardNonce&&cardNonce.value!="")obj.formCardNonce=cardNonce.value;obj.custom1=document.getElementsByName("custom1")[0]?document.getElementsByName("custom1")[0].value:null;obj.custom2=document.getElementsByName("custom2")[0]?document.getElementsByName("custom2")[0].value:null;obj.custom3=document.getElementsByName("custom3")[0]?document.getElementsByName("custom3")[0].value:null;obj.custom4=document.getElementsByName("custom4")[0]?document.getElementsByName("custom4")[0].value:null;obj.custom5=document.getElementsByName("custom5")[0]?document.getElementsByName("custom5")[0].value:null;if(!obj.custom1)obj.custom1=pageData.funnelData.name;if(!obj.custom2)obj.custom2=pageData.currentPage.title;ageVerificationPluginId=parseInt(getAddOnKeyValue(findAddOn("AV_PLUGIN_ID")));if(ageVerificationPluginId)obj["custom_order_1Account"]=ageVerificationPluginId;//Parameters that might be needed for native 3DS
if(route.indexOf("V1/SplitTest/funnel/")>0||route.startsWith("https://"))obj.redirectsTo=route;else if(checkDomainForRoute())obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+pageData.funnelData.referenceId+"/"+route;else obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+route;obj.browserData=JSON.stringify(browserData);if(document.getElementsByName("billShipSame")[0]){obj.billShipSame=document.getElementsByName("billShipSame")[0].checked?1:0}else if(document.getElementsByName("address1")[0]&&!document.getElementsByName("shipAddress1")[0]){obj.billShipSame=1}obj.salesUrl=getCurrentWindowLocation().href;obj.cartId=sessionStorage.getItem("cartId");obj.campaignId=parseInt(pageData.funnelData.campaign);offer=getOfferFromNavigationItem(buttonId);buttonElement=document.querySelector("[data-id="+buttonId+"]");buttonVariantValue=buttonElement.getAttribute("variantvalue");quantity=buttonElement.getAttribute("quantity");//getting variant products
getVariants();_orderItems28=getOrderItems();orderItemsCopy=JSON.parse(JSON.stringify(_orderItems28));_rebillCart2=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):null;if(offer){buttonReplacementValue=buttonElement.getAttribute("replaceproductid");if(Object.keys(_orderItems28).length===0&&document.getElementsByName("price")[0]&&!buttonVariantValue){obj.product1_id=offer;obj.product1_qty=getQuantity();obj.product1_price=document.getElementsByName("price")[0].value}else if(buttonVariantValue){itemOfferKey=offer+"."+buttonVariantValue;_orderItems28[itemOfferKey]=quantity?quantity:getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems28))}else if(buttonReplacementValue&&buttonReplacementValue.toLowerCase()!=="none"&&_orderItems28[buttonReplacementValue]){_orderItems28[offer]=_orderItems28[buttonReplacementValue];delete _orderItems28[buttonReplacementValue];sessionStorage.setItem("fkCart",JSON.stringify(_orderItems28))}else{_orderItems28[offer]=quantity?quantity:getQuantity();updateReplacementProducts(_orderItems28);//remove the button product?
sessionStorage.setItem("fkCart",JSON.stringify(_orderItems28))}_orderItems28=isSubscribeOn?swapSubscriptions(_orderItems28):_orderItems28;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems28))}inputs=$("input, select");inputs.each(function(index,input){if(input.name.startsWith("custom_item_")){var section=$(input).closest("section.fk-product-section");customCart=!section.length&&input.value?addItemToCustomCart(0,input,offer):customCart;customCart&&Object.keys(customCart).length&&sessionStorage.setItem("customCart",JSON.stringify(customCart))}else if(input.name.startsWith("custom_")){if(input.type==="checkbox")obj[input.name]=input.checked?1:0;else if(input.type==="radio"){if(input.checked)obj[input.name]=input.value}else obj[input.name]=input.value}else if(input.type==="checkbox"&&!excludeInputs[input.name]){if(input.name==="doNotSellName"){obj[input.name]=input.checked?0:1}else{obj[input.name]=input.checked?1:0}}else if(input.type==="radio"&&!excludeInputs[input.name]&&!excludeClassName.hasOwnProperty(function(value){return input.classList.contains(value)})){if(input.checked)obj[input.name]=input.value}});sessionKeys=Object.keys(sessionStorage);sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)obj[key]=sessionStorage.getItem(key)});if(orderId){obj.orderId=orderId}fetchLeadDetails(obj);if(getInputValue("cardNumber")){obj.cardNumber=getInputValue("cardNumber").replace(/-/g,"").replace(/ /g,"")}cardDateVal=getInputValue("cardDate")?getInputValue("cardDate"):"";cardDateValueParsed=cardDateVal.replace("/","");if(cardDateValueParsed){month=cardDateValueParsed.substring(0,2);year=cardDateValueParsed.substr(cardDateValueParsed.length-2);obj.cardMonth=getInputValue("cardMonth")?parseInt(getInputValue("cardMonth")):parseInt(month)||null;obj.cardYear=getInputValue("cardYear")?parseInt(getInputValue("cardYear")):parseInt(year)||null}else{obj.cardMonth=getInputValue("cardMonth")?parseInt(getInputValue("cardMonth")):null;obj.cardYear=getInputValue("cardYear")?parseInt(getInputValue("cardYear")):null}ccFraudSessionElement=$("[name='fraudSessionId']").first(),ccFraudSessionId=ccFraudSessionElement.length&&ccFraudSessionElement.val();if(ccFraudSessionId){obj.fraudSessionId=ccFraudSessionId;sessionStorage.setItem("ccFraudSessionId",ccFraudSessionId)}obj.cardSecurityCode=getInputValue("cardSecurityCode");isCardOnFileElementExists=document.getElementById("acctOnFile");loginCustomer=null;headers=null;checkoutResource="Order";obj.paySource=sessionStorage.getItem("paySource")!==null?sessionStorage.getItem("paySource"):"CREDITCARD";if(isCardOnFileElementExists&&isCardOnFileElementExists.checked===true&&(obj.paySource==="CREDITCARD"||obj.paySource==="ACCTONFILE")||obj.cardNumber==null&&obj.paySource==="CREDITCARD"){obj.cardMonth="";obj.cardYear="";obj.cardNumber="";obj.cardSecurityCode="";loginCustomer=JSON.parse(sessionStorage.getItem("loginCustomer"));if(cookieData["access_token"]){checkoutResource="MemberOrder";headers=getMembershipHeaders();sessionStorage.setItem("paySource","ACCTONFILE");obj.paySource="ACCTONFILE"}}if(prepaidGateways.includes(obj.paySource)){obj.prepaidType=obj.paySource;obj.paySource="PREPAID"}if(obj.prepaidType==="WITHREACH_PAYPAL"){obj.forceMerchantId=parseInt(getAddOnKeyValue(findAddOn("Paypal_billerId")))}if(!(obj.paySource==="CREDITCARD"||obj.paySource==="ACCTONFILE")){_context22.next=85;break}obj.forceMerchantId=document.getElementsByName("forceMerchantId")[0]?getInputValue("forceMerchantId"):null;_context22.next=200;break;case 85:if(!(obj.paySource==="AFFIRM")){_context22.next=91;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref13){var keyName=_ref13.keyName;return keyName==="Affirm_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="AFFIRM";_context22.next=200;break;case 91:if(!(obj.paySource==="KLARNA")){_context22.next=97;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref14){var keyName=_ref14.keyName;return keyName==="Klarna_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="KLARNA";_context22.next=200;break;case 97:if(!(obj.paySource==="SEZZLE")){_context22.next=103;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref15){var keyName=_ref15.keyName;return keyName==="Sezzle_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SEZZLE";_context22.next=200;break;case 103:if(!(obj.paySource==="AFTERPAY")){_context22.next=109;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref16){var keyName=_ref16.keyName;return keyName==="Afterpay_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="AFTERPAY";_context22.next=200;break;case 109:if(!(obj.paySource==="BANCONTACT")){_context22.next=115;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref17){var keyName=_ref17.keyName;return keyName==="Bancontact_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BANCONTACT";_context22.next=200;break;case 115:if(!(obj.paySource==="IDEAL")){_context22.next=121;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref18){var keyName=_ref18.keyName;return keyName==="iDEAL_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="IDEAL";_context22.next=200;break;case 121:if(!(obj.paySource==="BLIK")){_context22.next=127;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref19){var keyName=_ref19.keyName;return keyName==="Blik_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BLIK";_context22.next=200;break;case 127:if(!(obj.paySource==="SOFORT")){_context22.next=133;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref20){var keyName=_ref20.keyName;return keyName==="Sofort_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SOFORT";_context22.next=200;break;case 133:if(!(obj.paySource==="P24")){_context22.next=139;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref21){var keyName=_ref21.keyName;return keyName==="P24_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="P24";_context22.next=200;break;case 139:if(!(obj.paySource==="SPLITIT")){_context22.next=145;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref22){var keyName=_ref22.keyName;return keyName==="SplitIt_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SPLITIT";_context22.next=200;break;case 145:if(!(obj.paySource==="RADOM")){_context22.next=151;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref23){var keyName=_ref23.keyName;return keyName==="Radom_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="RADOM";_context22.next=200;break;case 151:if(!(obj.paySource==="TRUSTLY")){_context22.next=157;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref24){var keyName=_ref24.keyName;return keyName==="Trustly_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="TRUSTLY";_context22.next=200;break;case 157:if(!(obj.paySource==="TWINT")){_context22.next=163;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref25){var keyName=_ref25.keyName;return keyName==="Twint_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="TWINT";_context22.next=200;break;case 163:if(!(obj.paySource==="BOLETO")){_context22.next=169;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref26){var keyName=_ref26.keyName;return keyName==="Boleto_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BOLETO";_context22.next=200;break;case 169:if(!(obj.paySource==="PIX")){_context22.next=175;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref27){var keyName=_ref27.keyName;return keyName==="PIX_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="PIX";_context22.next=200;break;case 175:if(!(obj.paySource==="SEPA_DEBIT")){_context22.next=181;break}obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref28){var keyName=_ref28.keyName;return keyName==="SEPA_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="SEPA_DEBIT";_context22.next=200;break;case 181:if(!(obj.paySource==="MOLLIE")){_context22.next=186;break}obj.paySource="PREPAID";obj.prepaidType="MOLLIE";_context22.next=200;break;case 186:if(!(obj.paySource==="SQUAREV2")){_context22.next=193;break}squareMerchantAccount=getAddOnKeyValue(findAddOn("squareBillerId"));if(squareMerchantAccount!==""){obj.forceMerchantId=squareMerchantAccount}obj.paySource="PREPAID";obj.prepaidType="SQUAREV2";_context22.next=200;break;case 193:if(!(obj.paySource==="SHOPPAY")){_context22.next=199;break}shopPayUrl=getShopPayCheckoutUrl(_orderItems28);if(shopPayUrl){setCurrentWindowLocation(shopPayUrl)}else{enableInteractions()}return _context22.abrupt("return");case 199:if(obj.paySource==="BITPAY"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref29){var keyName=_ref29.keyName;return keyName==="BitPay_billerId"}).keyValue);obj.paySource="PREPAID";obj.prepaidType="BITPAY"}else if(obj.paySource==="OPENPATH_IPAY"){obj.paySource="PREPAID";obj.prepaidType="OPENPATH_IPAY";obj.forceMerchantId=ccOpenPathId&&Number(ccOpenPathId)||null;openElementFormDetails?obj.formCardNonce=openElementFormDetails:obj.gatewaySdk=1}case 200:if(!obj.prepaidType){_context22.next=224;break}if(!(sessionStorage.getItem("multiPayProductId")&&sessionStorage.getItem("multiPayBaseProductId"))){_context22.next=208;break}baseProductId=sessionStorage.getItem("multiPayBaseProductId");multiPayProductId=sessionStorage.getItem("multiPayProductId");if(_orderItems28[baseProductId]){_orderItems28[multiPayProductId]=_orderItems28[baseProductId];delete _orderItems28[baseProductId];sessionStorage.setItem("fkCart",JSON.stringify(_orderItems28));captureLead()}if(sessionStorage.getItem("multiPayRebillProductId"))obj.redirectsTo=obj.salesUrl;_context22.next=224;break;case 208:if(!multiPayRebillGateways.includes(obj.prepaidType)){_context22.next=224;break}multiPayRebillsEnabled=getAddOnKeyValue(findAddOn("multiPayRebills"));if(!multiPayRebillsEnabled){_context22.next=224;break}multiPayProductMap=getAddOnKeyValue(findAddOn("multiPayProducts"));if(!multiPayProductMap){_context22.next=224;break}multiPayProductMap=JSON.parse(multiPayProductMap);_loop38=/*#__PURE__*/_regeneratorRuntime().mark(function _loop38(_productId18){var multiPayRebillMapping;return _regeneratorRuntime().wrap(function _loop38$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:multiPayRebillMapping=multiPayProductMap.find(function(_ref30){var baseProductId=_ref30.baseProductId;return baseProductId===_productId18.toString()});if(!multiPayRebillMapping){_context20.next=5;break}sessionStorage.setItem("multiPayRoute",route);if(checkRequiredInputs(null,buttonId)){sessionStorage.setItem("multiPayButtonId",buttonId);sessionStorage.setItem("multiPayBaseProductId",multiPayRebillMapping.baseProductId);sessionStorage.setItem("multiPayProductId",multiPayRebillMapping.multiPayProductId);sessionStorage.setItem("multiPayRebillProductId",multiPayRebillMapping.rebillProductId);sessionStorage.setItem("multiPayCode",obj.cardSecurityCode);validateCard()}else{sessionStorage.removeItem("multiPayRoute");enableInteractions()}return _context20.abrupt("return",{v:void 0});case 5:case"end":return _context20.stop()}},_loop38)});_context22.t0=_regeneratorRuntime().keys(_orderItems28);case 216:if((_context22.t1=_context22.t0()).done){_context22.next=224;break}_productId18=_context22.t1.value;return _context22.delegateYield(_loop38(_productId18),"t2",219);case 219:_ret4=_context22.t2;if(!_ret4){_context22.next=222;break}return _context22.abrupt("return",_ret4.v);case 222:_context22.next=216;break;case 224:shippableOrder=false;_loop39=/*#__PURE__*/_regeneratorRuntime().mark(function _loop39(sessionItemCpId){var productDetails;return _regeneratorRuntime().wrap(function _loop39$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:productDetails=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId.split(".")[0])});if(Object.keys(productDetails).length>0){shippableOrder=productDetails[0].cycle1_isShippable?true:shippableOrder}case 2:case"end":return _context21.stop()}},_loop39)});_context22.t3=_regeneratorRuntime().keys(_orderItems28);case 227:if((_context22.t4=_context22.t3()).done){_context22.next=232;break}sessionItemCpId=_context22.t4.value;return _context22.delegateYield(_loop39(sessionItemCpId),"t5",230);case 230:_context22.next=227;break;case 232:index=0;for(_sessionItemCpId in _orderItems28){index++;_item20=void 0;if(_sessionItemCpId.indexOf(".")>0){_productData19=_sessionItemCpId.split(".");_item20=verifyStock&&getOutStockedVariant(_productData19,"","","",_orderItems28[_sessionItemCpId]);obj["product"+index+"_id"]=_productData19[0];obj["variant"+index+"_id"]=_productData19[1]}else{_item20=verifyStock&&getOutStockedProduct(_sessionItemCpId,_orderItems28[_sessionItemCpId]);obj["product"+index+"_id"]=_sessionItemCpId}_item20&&_item20.length>0&&outOfStockProducts.push(_item20);obj["product"+index+"_qty"]=_orderItems28[_sessionItemCpId];if($("input[type=checkbox][freeshipping=true]").is(":checked")||!shippableOrder){obj["product"+index+"_shipPrice"]=0;obj.totalShipping=0}if(_rebillCart2&&_rebillCart2[_sessionItemCpId])obj["product"+index+"_recur"]=_rebillCart2[_sessionItemCpId];if(altValues[_sessionItemCpId+"|"+_orderItems28[_sessionItemCpId]])obj["product"+index+"_alt"]=getItemAlt(_sessionItemCpId,_orderItems28[_sessionItemCpId])}if(customCart){customCartLength=Object.keys(customCart).length;for(_i146=0;_i146<customCartLength;_i146++){obj["product_custom"+(_i146+1)]=customCart[_i146]}}bundleStockParams=getBundleVariants(obj,index);obj=bundleStockParams.params||obj;outOfStockProducts=outOfStockProducts.concat(bundleStockParams.outOfStockBundleVariants);_context22.next=240;return calculateTotals();case 240:paayEnabled=sessionStorage.getItem("paayEnabled")!==null;cardBin=obj.cardNumber&&obj.cardNumber.substring(0,6);if(!paayEnabled){_context22.next=262;break}$("#ccPAAYCardInfoAuthError").remove();if(!(ccCardBin!==cardBin||obj.cardSecurityCode!==ccCardCvv||obj.cardMonth!==ccCardMonth||obj.cardYear!==ccCardYear)){_context22.next=250;break}sessionStorage.removeItem("paayCompleted");sessionStorage.removeItem("paayInitialData");sessionStorage.removeItem("paayRebillData");_context22.next=262;break;case 250:paayError=paayDetails&&paayDetails.cc3DSError;cardErrorDetails=sessionStorage.getItem("ccPAAYAuthErrors");cardErrorDetails=cardErrorDetails?JSON.parse(cardErrorDetails):{};key=[cardBin,obj.cardMonth,obj.cardYear,obj.cardSecurityCode].join("|");savedError=cardErrorDetails[key];if(!savedError){_context22.next=261;break}$("<p id='ccPAAYCardInfoAuthError' class='"+commonErrorClass+"' style='color: red;'>"+savedError+"</p>").insertAfter($("[data-id='"+buttonId+"']"));enableInteractions();return _context22.abrupt("return");case 261:if(paayError){cardErrorDetails[key]=paayError;sessionStorage.setItem("ccPAAYAuthErrors",JSON.stringify(cardErrorDetails))}case 262:ccCardMonth=obj.cardMonth;ccCardYear=obj.cardYear;ccCardCvv=obj.cardSecurityCode;ccCardBin=cardBin;paayEnabled&&sessionStorage.setItem("paayCardBin",cardBin||"");if(!(paayEnabled&&sessionStorage.getItem("paayCompleted")===null&&obj.paySource==="CREDITCARD"&&sessionStorage.getItem("paay_page_option")!=="1"&&obj.cardNumber!==null&&Object.keys(_orderItems28).length>0)){_context22.next=280;break}authenticateCards=ccReturnPAAYCardsForAuth();paayCardType=ccReturnCardType(obj.cardNumber);if(!authenticateCards.includes(paayCardType)){_context22.next=279;break}sessionStorage.setItem("paay_buttonId",buttonId);sessionStorage.setItem("paay_route",route);paayItem=offer?offer:Object.keys(_orderItems28)[0];sessionStorage.setItem("paay_item",paayItem);triggerPAAY(paayCardType);return _context22.abrupt("return");case 279:sessionStorage.removeItem("paayEnabled");case 280:if(paayDetails){paayDetails.cc3DSError?obj["cc3DSError"]=paayDetails.cc3DSError:null;paayDetails.threeDSStatus?obj["threeDSStatus"]=paayDetails.threeDSStatus:null}paayInitialData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayInitialData")!==null?JSON.parse(sessionStorage.getItem("paayInitialData")):null;paayRebillData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayRebillData")!==null?JSON.parse(sessionStorage.getItem("paayRebillData")):null;if(sessionStorage.getItem("paayInitialAsRebill")==="1"){obj.rebill_eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.rebill_cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.rebill_xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null}else{obj.eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null;obj.rebill_eci=paayRebillData&&paayRebillData.eci?paayRebillData.eci:document.getElementsByName("rebill_eci")[0]?document.getElementsByName("rebill_eci")[0].value:null;obj.rebill_cavv=paayRebillData&&paayRebillData.authenticationValue?paayRebillData.authenticationValue:document.getElementsByName("rebill_authenticationValue")[0]?document.getElementsByName("rebill_authenticationValue")[0].value:document.getElementsByName("rebill_cavv")[0]?document.getElementsByName("rebill_cavv")[0].value:null;obj.rebill_xid=paayRebillData&&paayRebillData.dsTransId?paayRebillData.dsTransId:document.getElementsByName("rebill_dsTransId")[0]?document.getElementsByName("rebill_dsTransId")[0].value:document.getElementsByName("rebill_xid")[0]?document.getElementsByName("rebill_xid")[0].value:null}if(obj.paySource==="CREDITCARD"&&paayEnabled&&(obj.eci!==null||sessionStorage.getItem("paay_page_option")==="1")){sessionStorage.setItem("paay_pan",obj.cardNumber);sessionStorage.setItem("paay_month",obj.cardMonth);sessionStorage.setItem("paay_year",obj.cardYear)}session=sessionStorage.getItem("ccExternalSessionId");session?obj.sessionId=session:null;submitImportOrder=true;if(!(obj.paySource==="PAYPAL")){_context22.next=300;break}captureLead();_JSON$parse5=JSON.parse(sessionStorage.getItem("totals")),salesTax=_JSON$parse5.salesTax,shipTotal=_JSON$parse5.shipTotal;obj.salesTax=salesTax?salesTax.toString():"0.00";externalShipProfileSelected?obj.totalShipping=shipData[4]:Number(shipTotal)===0?obj.totalShipping=shipTotal.toString():null;obj.paypalBillerId=parseInt(pageData.funnelData.addOns.find(function(_ref31){var keyName=_ref31.keyName;return keyName==="Paypal_billerId"}).keyValue);if(document.getElementsByName("paypalClientMetadataId")[0]){obj.paypalClientMetadataId=document.getElementsByName("paypalClientMetadataId")[0].value;sessionStorage.setItem("paypalClientMetadataId",obj.paypalClientMetadataId)}sessionStorage.setItem("paypalSuccessRoute",route);sessionStorage.setItem("paypalCart",JSON.stringify(_orderItems28));sessionStorage.setItem("paypalButtonId",buttonId);_context22.next=307;break;case 300:if(!(obj.paySource==="GOOGLEPAY")){_context22.next=306;break}_context22.next=303;return googlePayImportOrder(obj,offer);case 303:submitImportOrder=_context22.sent;_context22.next=307;break;case 306:if(obj.paySource==="AMAZON"){obj.amazonBillerId=parseInt(sessionStorage.getItem("amazonBillerId"));obj.amazonOrderId=sessionStorage.getItem("amazonOrderId");obj.amazonAddressConsent=sessionStorage.getItem("amazonAccessToken");amazonName=sessionStorage.getItem("amazonName");if(amazonName){_pos3=amazonName.indexOf(" ");if(!obj.firstName)obj.firstName=_pos3>-1?amazonName.substring(0,_pos3):amazonName;if(!obj.lastName)obj.lastName=_pos3>-1?amazonName.substring(_pos3+1):null}amazonEmail=sessionStorage.getItem("amazonEmail");if(amazonEmail&&!obj.emailAddress)obj.emailAddress=amazonEmail}else if(obj.paySource==="APPLEPAY"){payment=JSON.parse(sessionStorage.getItem("applePayPayment"));//payment.shippingContact - shipping address
if(!obj.shipAddress1){setAppleAddress(payment.shippingContact,"shipping",obj)}//payment.billingContact - billing address
if(!obj.address1){setAppleAddress(payment.billingContact,"billing",obj)}obj.applePayToken=sessionStorage.getItem("applePayToken");applePayMerchantAccount=getAddOnKeyValue(findAddOn("applePayBillerId"));if(applePayMerchantAccount!==""){obj.forceMerchantId=applePayMerchantAccount}if(obj.address1&&obj.shipAddress1){obj.billShipSame=0}}case 307:obj.insureShipment=document.getElementsByName("insureShipment")[0]?document.getElementsByName("insureShipment")[0].checked:0;obj.insureShipment=obj.insureShipment===true?1:0;obj.shipmentInsurancePrice=document.getElementById("shipmentInsurancePrice")?document.getElementById("shipmentInsurancePrice").value:"";details=JSON.parse(JSON.stringify(obj));delete details.cardNumber;delete details.cardSecurityCode;sessionStorage.setItem("userDetails",JSON.stringify(details));merchantInitiatedRebills=getAddOnKeyValue(findAddOn("Merchant_Rebills"));if(merchantInitiatedRebills==="1"){obj.merchantInitiated=merchantInitiatedRebills;obj.funnelReferenceId=pageData.funnelData.referenceId}if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){obj.paypalSdk=true;if(paypalSdkPrePaidType){obj.prepaidType=paypalSdkPrePaidType}}obj.currencyCode=returnCurrencyCode();fflNumber=sessionStorage.getItem("fflNumber");if(fflNumber&&pageData.pageTypeId===4&&checkFFLProductsInCart()){obj["custom_order_fflNumber"]=fflNumber;if(document.getElementsByName("fflSplit")[0]&&document.getElementsByName("fflSplit")[0].checked===false)obj["custom_order_fflSplit"]=1}if(obj.cardNumber&&(window.fbq||window.rrq)){orderItemsForDB=[];Object.keys(orderItemsCopy).forEach(function(key){orderItemsForDB.push({id:key.split(".")[0].toString(),quantity:parseInt(orderItemsCopy[key])})});totals=JSON.parse(sessionStorage.getItem("totals"));if(window.ccFacebookPixelID){window.facebookpixelImportOrder&&facebookpixelImportOrder(orderItemsForDB,totals)}ccTrackSygnalEvents&&window.rrq&&window.rrq("track","AddPaymentInfo",{contents:orderItemsForDB,currency:returnCurrencyCode()||pageData.selectedCampaign.currency,value:totals.grandTotal})}confirmOptIn();if(submitImportOrder){window.clearInterval(captureLeadInterval)}if(!(outOfStockProducts.length>0&&verifyStock)){_context22.next=335;break}tagElements=generateErrorTag(buttonId,paypalSmartButtonSdk);tag=tagElements.tag;pageForm=tagElements.pageForm;outOfStockProducts=outOfStockProducts.join("<br>");_message2="Products are out of stock: <br>"+outOfStockProducts;tag.innerHTML=_message2;showExceptionInPopupValue()?alert(_message2.replaceAll(breakTagRegex,"\n")):$(tag).insertAfter(pageForm);obj.paySource==="PAYPAL"&&clearCCPayPalSessionData();enableInteractions();_context22.next=340;break;case 335:if(obj.paySource!="CREDITCARD"){obj.cardNumber="";obj.cardMonth="";obj.cardYear="";obj.cardSecurityCode=""}obj=ccRemoveEmptyKeysForPayload(obj);_data9=JSON.stringify(obj);_response6=submitImportOrder&&httpMethod("".concat(providerUrl,"/Import/")+checkoutResource,_data9,headers).then(function(data){if(data.result==="SUCCESS"){var gatewaySdkParams=data.message.gatewaySdkParams;if(gatewaySdkParams){return data}//if paySource === "PAYPAL" -> redirect to paypalURL
if(data.message.paypalUrl&&paypalSmartButtonSdk!=="true"){setCurrentWindowLocation(data.message.paypalUrl);return}if(data.message.paypalSdkParams){sessionStorage.setItem("paypalSmartButton",true);return data}if(orderData&&orderData.newCustomer!=data.message.newCustomer){route=routeByCustomer(data.message,route,buttonId);if(!route){routingNotFound();return}}registerClick(1,function(regClickData){var salesProduct=[];sessionStorage.setItem("orderData",JSON.stringify(data.message));sessionStorage.setItem("checkoutOrderData",JSON.stringify({items:data.message.items,totalAmount:data.message.totalAmount,taxTotal:data.message.taxTotal,shipTotal:data.message.shipTotal}));orderId=data.message.orderId;salesProduct.push(data.message.items);sessionStorage.setItem("orderId",JSON.stringify(orderId));sessionStorage.setItem("products",JSON.stringify(salesProduct[0]));sessionStorage.setItem("importOrderSuccess",true);ccTrackSygnalEvents&&sessionStorage.setItem("importOrderSuccessSygnal",true);pageData.funnelData.GA_MEASUREMENT_ID?sessionStorage.setItem("importOrderSuccessGA",true):"";pageData.funnelData.snapchatPixelID?sessionStorage.setItem("importOrderSuccessSC",true):"";sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)sessionStorage.removeItem(key)});sessionStorage.removeItem("cartId");sessionStorage.removeItem("currentItem");if(sessionStorage.getItem("applePayToken")&&window.session){var update={status:ApplePaySession.STATUS_SUCCESS};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}if(route&&route.includes("__ORDERID__")){route=route.replace("__ORDERID__",orderId)}if(loginCustomer)orderQuery();setCurrentWindowLocation(route)})}else{sessionStorage.removeItem("paay_pan");sessionStorage.removeItem("paay_month");sessionStorage.removeItem("paay_year");//handle merchant redirect for native 3DS
if(data.result==="MERC_REDIRECT"){var _route9=data.message&&data.message.url;sessionStorage.setItem("merchantRedirectfkCart",JSON.stringify(orderItemsCopy||{}));sessionStorage.setItem("cc3dsPageSubmitDetails",JSON.stringify({pageTypeId:pageData.pageTypeId,referenceId:pageData.currentPage.referenceId}));if(_route9){setCurrentWindowLocation(_route9)}else if(data.message&&data.message.script){eval(data.message.script)}return false}offer&&rolebackSessionProducts(offer);sessionStorage.removeItem("paySource");if(sessionStorage.getItem("applePayToken")&&window.session){var update={status:ApplePaySession.STATUS_FAILURE};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}var handleErrors=function handleErrors(data,buttonId){var showExceptionInPopup=showExceptionInPopupValue();var _data$message=data.message,message=_data$message===void 0?"":_data$message;var messageInLC=message.toLowerCase();var handleErrorMessage=document.getElementById("error-"+buttonId);// Handle handleErrorMessage element
if(!handleErrorMessage){handleErrorMessage=document.createElement("p");handleErrorMessage.setAttribute("id","error-"+buttonId);handleErrorMessage.classList.add(commonErrorClass)}else{handleErrorMessage.innerHTML=""}function handleErrorElement(element){handleErrorMessage.innerHTML=message;var color=handleErrorMessage.style.color="red";var pageForm=document.getElementsByName(element);if(pageForm&&pageForm.length>0){pageForm[0].style.outline="red solid 1px";!showExceptionInPopup&&$(handleErrorMessage).insertAfter(pageForm);$(pageForm[0]).focus();return true}return false}// Show error message next to button AND next to input
var handleButtonMessage=document.getElementById("error-"+buttonId+"x");if(!handleButtonMessage){handleButtonMessage=document.createElement("p");handleButtonMessage.setAttribute("id","error-"+buttonId+"x");handleButtonMessage.classList.add(commonErrorClass)}else{handleButtonMessage.innerHTML=""}handleButtonMessage.innerHTML=message;var color=handleButtonMessage.style.color="red";var actionBtn=$("button[data-id='"+buttonId+"']").length?$("button[data-id='"+buttonId+"']"):$("a[data-id='"+buttonId+"']");if(paypalSmartButtonSdk==="true"&&!actionBtn.length){actionBtn=$("div[data-id='"+buttonId+"']")}if(actionBtn&&actionBtn.length&&$(".fk-popup").find(actionBtn[0]).length){var popup=$(actionBtn[0]).closest(".fk-popup");var id=popup.attr("id");hidePopUpBlock(id);actionBtn=$("[openpopup='"+id+"']");actionBtn=actionBtn.length?actionBtn:$("[action=openPopup]")[0]}showExceptionInPopup?alert(message.replaceAll(breakTagRegex,"\n")):$(handleButtonMessage).insertAfter(actionBtn);if(messageInLC.includes("date")||messageInLC.includes("month")||messageInLC.includes("year")){// Display message inside date
if(handleErrorElement("cardDate")||handleErrorElement("cardMonth")||handleErrorElement("cardYear"))return}// Display a message below the card number
if(messageInLC.includes("card")&&handleErrorElement("cardNumber")){return}//Check for security errors
var hasSecurityError=["cvv","cvc","security"].some(function(input){return messageInLC.includes(input)});// Display error inside cardSecurityCode
if(hasSecurityError&&handleErrorElement("cardSecurityCode")){return}if(messageInLC.includes("emailaddress")&&handleErrorElement("emailAddress")){return}};if(data.result==="ERROR"){handleErrors(data,buttonId)}enableInteractions();return result=false}});return _context22.abrupt("return",_response6);case 340:_context22.next=343;break;case 342:if(paypalSmartButtonSdk!=="true"){setCurrentWindowLocation(route)}case 343:case"end":return _context22.stop()}},_callee19)}));return _importOrder.apply(this,arguments)}function ccGetRecommendation(products,prodOnPage,orderItemsIds,prevSuggestions){for(var index in products){var _product7=products[index];var _productId5=_product7&&(_product7.recommendedCampaignProductId||_product7.campaignProductId).toString();var productsOnPage=pageData.pageTypeId===3||prodOnPage&&(!prodOnPage.length||!prodOnPage.includes(_productId5));var productsOnOrder=orderItemsIds&&(!orderItemsIds.length||!orderItemsIds.includes(_productId5));var productsSuggested=!prevSuggestions.length||!prevSuggestions.includes(_productId5);var productFromCampaign=_product7.campaignId?pageData.selectedCampaign.campaignId==_product7.campaignId:true;if(productsOnPage&&productsOnOrder&&productsSuggested&&productFromCampaign){confirmOption=_product7.recommendedCampaignProductId||_product7.campaignProductId;return confirmOption}}}function ccHandleConfirmOption(confirmOption,prevSuggestions){confirmOption=ccProductId&&[2,4].includes(pageData.pageTypeId)&&ccDynamicProductSection?ccProductId:confirmOption;if(confirmOption){if(pageData.pageTypeId===3){var dynamicUpsellsByPageRef=sessionStorage.getItem("dynamicUpsellsByPageRef")!==null?JSON.parse(sessionStorage.getItem("dynamicUpsellsByPageRef")):{};confirmOption=dynamicUpsellsByPageRef[pageData.pageViewReferenceId]?dynamicUpsellsByPageRef[pageData.pageViewReferenceId]:confirmOption;dynamicUpsellsByPageRef[pageData.pageViewReferenceId]=confirmOption;sessionStorage.setItem("dynamicUpsellsByPageRef",JSON.stringify(dynamicUpsellsByPageRef))}sessionStorage.setItem("currentItem",confirmOption);recommendationFlag=true;!prevSuggestions.includes(confirmOption.toString())&&prevSuggestions.push(confirmOption.toString());sessionStorage.setItem("prevSuggestions",JSON.stringify(prevSuggestions))}return prevSuggestions}function ccSetRecommendationFromCart(orderItems,recommendationValue,prevSuggestions){var sortOnPrice=function sortOnPrice(productA,productB){var priceA=Number(productA.price);var priceB=Number(productB.price);if(priceA<priceB){return 1}if(priceA>priceB){return-1}return 0};var sortedProducts=orderItems.sort(sortOnPrice);sortedProducts=sortedProducts.filter(function(prod){return Number(prod.price)>0});var product=Number(recommendationValue)===3?sortedProducts[sortedProducts.length-1]:sortedProducts[0];var confirmOption=product.productId;prevSuggestions=ccHandleConfirmOption(confirmOption,prevSuggestions);return prevSuggestions}function ccSetRecommendation(prodOnPage,prevSuggestions,orderItemsIds,globalRecommendations){try{var campaignRecommendations=dynamicOrderBump?pageData.selectedCampaign.recommendedProducts:null;campaignRecommendations=campaignRecommendations&&campaignRecommendations.length?campaignRecommendations:null;var recommendations=globalRecommendations||campaignRecommendations||null;var productType=pageData.pageTypeId===3?"UPSALE":"OFFER";var campaignProducts=pageData.selectedCampaign.products.filter(function(prod){return prod.productType==productType});campaignProducts=campaignProducts.sort(function(a,b){return a.campaignProductId-b.campaignProductId});var _confirmOption;_confirmOption=recommendations?ccGetRecommendation(recommendations,prodOnPage,orderItemsIds,prevSuggestions):null;_confirmOption=!_confirmOption?ccGetRecommendation(campaignProducts,prodOnPage,orderItemsIds,prevSuggestions):_confirmOption;ccHandleConfirmOption(_confirmOption,prevSuggestions)}catch(e){e}}function hidePopUpBlock(popupId){var popupBlock=document.getElementById(popupId||"customizable_popup");if(popupBlock){popupBlock.style.display="none"}}function clearCCPayPalSessionData(){sessionStorage.removeItem("paySource");sessionStorage.removeItem("paypalSuccessRoute");sessionStorage.removeItem("paypalSdk");sessionStorage.removeItem("paypalButtonId");var pageTypeId=pageData&&pageData.pageTypeId;if(pageTypeId===4){sessionStorage.removeItem("paypalCart");sessionStorage.removeItem("paypalSmartButton")}else if(pageTypeId===3){sessionStorage.removeItem("paypalUpsaleSuccessRoute");sessionStorage.removeItem("paypalUpsaleCart");sessionStorage.removeItem("upsalefkCart")}}function confirmPaypal(token,payerID,baToken,paypalPrePaidType){//2 click Paypal upsells
var upsaleRoute=sessionStorage.getItem("paypalUpsaleSuccessRoute");var buttonId=sessionStorage.getItem("paypalButtonId");if(upsaleRoute&&buttonId){sessionStorage.setItem("upsalePaypalToken",token);sessionStorage.setItem("upsalePaypalPayerId",payerID);importUpsale(buttonId,upsaleRoute);return}var funnelData=JSON.parse(sessionStorage.getItem("funnelData"));data={};data.token=token;data.payerId=payerID;data.baToken=baToken;data.orderId=JSON.parse(sessionStorage.getItem("orderId"));var session=sessionStorage.getItem("ccExternalSessionId");session?data.sessionId=session:null;var fkCart=JSON.parse(sessionStorage.getItem("paypalCart"));var rebillCart=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):null;var index=0;var customerDetails=JSON.parse(sessionStorage.getItem("userDetails"));var totalShipping=customerDetails.totalShipping?parseFloat(customerDetails.totalShipping):null;for(var sessionItemCpId in fkCart){index++;if(sessionItemCpId.indexOf(".")>0){var _productData6=sessionItemCpId.split(".");data["product"+index+"_id"]=_productData6[0];data["variant"+index+"_id"]=_productData6[1]}else{data["product"+index+"_id"]=sessionItemCpId}data["product"+index+"_qty"]=fkCart[sessionItemCpId];if($("input[type=checkbox][freeshipping=true]").is(":checked")||totalShipping===0){data["product"+index+"_shipPrice"]=0;totalShipping=0}if(rebillCart&&rebillCart[sessionItemCpId])data["product"+index+"_recur"]=rebillCart[sessionItemCpId];if(altValues[sessionItemCpId+"|"+fkCart[sessionItemCpId]])data["product"+index+"_alt"]=getItemAlt(sessionItemCpId,fkCart[sessionItemCpId])}if(customCart){var customCartLength=Object.keys(customCart).length;for(var _i54=0;_i54<customCartLength;_i54++){data["product_custom"+(_i54+1)]=customCart[_i54]}}data=getBundleVariants(data,index).params;data.cartId=sessionStorage.getItem("cartId");data.campaignId=parseInt(funnelData.campaign);data.paypalBillerId=parseInt(funnelData.addOns.find(function(_ref6){var keyName=_ref6.keyName;return keyName==="Paypal_billerId"}).keyValue);data.paypalClientMetadataId=sessionStorage.getItem("paypalClientMetadataId");if(customerDetails.couponCode)data.couponCode=customerDetails.couponCode;data.shipProfileId=customerDetails.shipProfileId&&customerDetails.shipProfileId.includes("pickup-")?null:customerDetails.shipProfileId;if(customerDetails.externalShipProfileId){var shipData=customerDetails.externalShipProfileId.split(":");data.shipProfileId=null;data.shipCarrier=shipData[1];data.shipMethod=shipData[3];totalShipping=shipData[4]}window.ccSendIdmeCouponCodeToImportPayPal&&ccSendIdmeCouponCodeToImportPayPal(customerDetails,data);data.custom1=customerDetails.custom1;data.custom2=customerDetails.custom2;data.custom3=customerDetails.custom3;data.custom4=customerDetails.custom4;data.custom5=customerDetails.custom5;data.emailAddress=customerDetails.emailAddress;data.phoneNumber=customerDetails.phoneNumber;if(totalShipping===0||customerDetails.externalShipProfileId){data.totalShipping=totalShipping}data.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;var paypalSmartButtonSdk=sessionStorage.getItem("paypalSdk");if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){data.paypalSdk=true;if(paypalPrePaidType){data.prepaidType=paypalPrePaidType}}var customerDetailsKeys=Object.keys(customerDetails);customerDetailsKeys.forEach(function(key){if(key.indexOf("custom_")===0)data[key]=customerDetails[key]});var ageVerificationPluginId=parseInt(getAddOnKeyValue(findAddOn("AV_PLUGIN_ID")));if(ageVerificationPluginId)data["custom_order_1Account"]=ageVerificationPluginId;data=ccRemoveEmptyKeysForPayload(data);data=JSON.stringify(data);showOverlayEffect();sessionStorage.removeItem("ccConfirmPayPalCalled");var response=httpMethod("".concat(providerUrl,"/Import/Paypal"),data).then(function(data){if(data.result==="SUCCESS"){var _route3=sessionStorage.getItem("paypalSuccessRoute");_route3=routeByCustomer(data.message,_route3,buttonId,data.message.shipCountry,data.message.shipState);if(!_route3){routingNotFound();return}registerClick(1,function(regClickData){sessionStorage.setItem("orderData",JSON.stringify(data.message));sessionStorage.setItem("checkoutOrderData",JSON.stringify({items:data.message.items,totalAmount:data.message.totalAmount,taxTotal:data.message.taxTotal,shipTotal:data.message.shipTotal}));sessionStorage.setItem("orderId",JSON.stringify(data.message.orderId));sessionStorage.setItem("importOrderSuccess",true);ccTrackSygnalEvents&&sessionStorage.setItem("importOrderSuccessSygnal",true);pageData.funnelData.GA_MEASUREMENT_ID?sessionStorage.setItem("importOrderSuccessGA",true):"";pageData.funnelData.snapchatPixelID?sessionStorage.setItem("importOrderSuccessSC",true):"";sessionStorage.removeItem("cartId");sessionStorage.removeItem("currentItem");if(_route3&&_route3.includes("__ORDERID__")){_route3=_route3.replace("__ORDERID__",data.message.orderId)}replaceCurrentWindow(_route3)})}else{hideOverlayEffect();sessionStorage.removeItem("paySource");var tag=document.getElementById("error-paypal");if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-paypal");tag.classList.add(commonErrorClass)}else{tag.innerHTML=""}var _buttonId=sessionStorage.getItem("paypalButtonId");var payPalButton=$("button[data-id='"+_buttonId+"']").length?$("button[data-id='"+_buttonId+"']"):$("a[data-id='"+_buttonId+"']");var pageForm=payPalButton&&payPalButton[0]&&$(payPalButton[0]).closest("div");tag.innerHTML="Error Processing PayPal Payment: "+data.message;var color=tag.style.color="red";$(tag).insertAfter(pageForm);clearCCPayPalSessionData();enableInteractions();removePayPalQueryParams()}sessionStorage.removeItem("paypalSdk")})}function validateCard(){var params={};params.orderId=sessionStorage.getItem("orderId")?JSON.parse(sessionStorage.getItem("orderId")):null;if(!params.orderId){captureLead();validateCard();return}params.cardNumber=getInputValue("cardNumber");if(!params.orderId||!params.cardNumber)return false;else params.cardNumber=params.cardNumber.replace(/-/g,"").replace(/ /g,"");params.campaignId=pageData.selectedCampaign.campaignId;params.paySource="CREDITCARD";var cardDateVal=getInputValue("cardDate")?getInputValue("cardDate"):"";var cardDateValueParsed=cardDateVal.replace("/","");if(cardDateValueParsed){var month=cardDateValueParsed.substring(0,2);var year=cardDateValueParsed.substr(cardDateValueParsed.length-2);params.cardMonth=parseInt(month)||null;params.cardYear=parseInt(year)||null}else{params.cardMonth=getInputValue("cardMonth");params.cardYear=getInputValue("cardYear")}if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");params.firstName=pos>-1?fullName.substring(0,pos):fullName;params.lastName=pos>-1?fullName.substring(pos+1):null}else{params.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;params.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}params.companyName=document.getElementsByName("companyName")[0]?document.getElementsByName("companyName")[0].value:null;params.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;params.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;params.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;params.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;params.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;params.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;params.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){params.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";params.phoneNumber=params.phoneNumber?params.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{params.phoneNumber=document.getElementsByName("phoneNumber")[0].value.replace(/[^0-9+]/g,"").replace(/[+]{1,}/g,"+").replace(/[-]{1,}/g,"-")}}var data=JSON.stringify(params);var response=httpMethod("".concat(providerUrl,"/Import/Preauth"),data).then(function(data){var multiPayButtonId=sessionStorage.getItem("multiPayButtonId");if(data.result&&(data.result==="SUCCESS"||data.message=="Card is already preauthorized")){sessionStorage.setItem("cardValidated",true);var multiPayRoute=sessionStorage.getItem("multiPayRoute");if(multiPayButtonId&&multiPayRoute){importOrder(multiPayButtonId,multiPayRoute)}}else{sessionStorage.removeItem("multiPayButtonId");sessionStorage.removeItem("multiPayRoute");sessionStorage.removeItem("multiPayBaseProductId");sessionStorage.removeItem("multiPayProductId");sessionStorage.removeItem("multiPayRebillProductId");sessionStorage.removeItem("multiPayCode");sessionStorage.removeItem("paySource");var tag=document.getElementById("error-"+multiPayButtonId);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+multiPayButtonId);tag.classList.add(commonErrorClass)}else{tag.innerHTML=""}tag.innerHTML=data.message;var color=tag.style.color="red";var pageForm=$("button[data-id='"+multiPayButtonId+"']").length?$("button[data-id='"+multiPayButtonId+"']"):$("a[data-id='"+multiPayButtonId+"']");showExceptionInPopupValue()?alert(data.message.replaceAll(breakTagRegex,"\n")):$(tag).insertAfter(pageForm);enableInteractions()}})}function getInputValue(name){var pageInputs=document.getElementsByName(name);var pageInputsLength=pageInputs.length;if(pageInputsLength>0){for(var _i55=0;_i55<pageInputsLength;_i55++){var input=pageInputs[_i55];if(input.value){return input.value}}}return null}function processMultiPayRebill(orderData){var multiPayRoute=sessionStorage.getItem("multiPayRoute");if(!multiPayRoute)return;var productId=sessionStorage.getItem("multiPayRebillProductId");if(!productId){setCurrentWindowLocation(multiPayRoute);return}var params={};params.campaignId=orderData.campaignId;params.customerId=orderData.customerId;params.paySource="ACCTONFILE";params.cardSecurityCode=sessionStorage.getItem("multiPayCode");params.salesUrl=orderData.salesUrl;params.product1_id=productId;var data=JSON.stringify(params);var response=httpMethod("".concat(providerUrl,"/Import/Order"),data).then(function(data){if(data.result&&data.result==="SUCCESS"){sessionStorage.setItem("multiPayRebillOrderId",JSON.stringify(data.message.orderId));sessionStorage.setItem("multiPayRebillOrder",JSON.stringify(data.message))}sessionStorage.removeItem("multiPayRoute");sessionStorage.removeItem("multiPayButtonId");sessionStorage.removeItem("multiPayBaseProductId");sessionStorage.removeItem("multiPayProductId");sessionStorage.removeItem("multiPayRebillProductId");sessionStorage.removeItem("multiPayCode");setCurrentWindowLocation(multiPayRoute)})}function renderPopupCartDetails(){var visibility=$("#mySidepanel").css("visibility");var display=$("#rightPanelHTML").css("display");if(visibility!=="visible"||display==="none"){return}var cartProducts=getOrderItemDetails();var totals=JSON.parse(sessionStorage.getItem("totals"));var cartSubTotal=totals?totals.subTotal:0;var symbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";$(".cartPanelSubtotalClass").css({"float":"right","margin-right":"2%"}).html(ccFormatCurrency(cartSubTotal.toFixed(2),symbol));var cartPanelElement=$("#cartPanelId");if(cartPanelElement.length){$("#cartPanelId").html("");if(cartProducts&&Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length,checkoutFlow=[2,3,4].includes(pageData.pageTypeId);var productPercentagePrice=Number(sessionStorage.getItem("ccCartProductsPercentageTotal"))||0;var prevBundleProduct,bundleIndex=1;var bundleArray=[];for(var _i56=0;_i56<cartProductsEntriesLength;_i56++){var itemId=cartProductsEntries[_i56][0];var _product8=cartProductsEntries[_i56][1];var currentOrderQuantity=_product8.currentOrderQuantity;var stockStatus="";if(!_product8.variant){stockStatus=verifyStock&&_product8.cycle1_isShippable&&parseInt(_product8.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":""}else if(_product8.variant.length){stockStatus=verifyStock&&_product8.cycle1_isShippable&&parseInt(_product8.variant.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":""}var campaignProductId=cartProductsEntries[_i56][0];var isVariantBundle=_product8&&_product8.isVariantBundle;var showBundleInCart=isVariantBundle&&(!prevBundleProduct||prevBundleProduct!=_product8.campaignProductId&&!bundleArray[campaignProductId]);var imageUrl=_product8.variant&&_product8.variant.imageUrl!==""?_product8.variant.imageUrl:_product8.imageUrl?_product8.imageUrl:"".concat(defaultImagePlaceHolder);var title=_product8.variant?" "+_product8.variant.title:"";var unitPrice=_product8.variant&&parseFloat(_product8.variant.price)>0&&!_product8.isVariantBundle&&!_product8.isEditable?_product8.variant.price:_product8.cycle1_price;var itemPrice=void 0,currentHTML=void 0;var itemAltValue=altValues&&altValues[itemId+"|"+currentOrderQuantity];if(checkoutFlow&&_product8.isPricePercent===1){var percentagePrice=itemAltValue?itemAltValue.split("|")[0]:_product8.cycle1_price;itemPrice=(productPercentagePrice*(Number(percentagePrice)||0)*0.01).toFixed(2)}else{itemPrice=getItemPrice(itemId,parseFloat(unitPrice),itemAltValue?currentOrderQuantity:1,null).toFixed(2)}var productPrice=ccFormatCurrency(itemPrice,symbol);if(showBundleInCart){var bundleObj=ccBundleDisplay("sideCart",campaignProductId,_product8,bundleIndex);var caretIcon=bundleObj.caretIcon;var bundleItem=bundleObj.bundleItemsString;currentHTML="<div class='sticky' style='padding:1%;overflow:hidden'> <img class='image-quantity-container' style='width:50px' src='"+imageUrl+"' style='float:left'/> <span> <span class='cartPanelProductName'>"+caretIcon+_product8.productName+title+stockStatus+"</br>"+bundleItem+"</span><br/><span> Quantity </span><span class='cartPanelProductQuantity'>1</span> </span> <span style='float:right;margin-right:10%;font-size: 20px;margin-top:15px;cursor: pointer' class='gjs-pn-btn fa fa-trash' onclick='removeFromCart("+String.fromCharCode(34)+cartProductsEntries[_i56][0]+String.fromCharCode(34)+");'></span><br/><span>Unit Price </span><span class='cartPanelProductPrice'>"+productPrice+"</span><br/> </div> <br/><br/>";bundleArray.push(campaignProductId);bundleIndex++}else if(isVariantBundle){currentHTML="";continue}else{currentHTML="<div class='sticky' style='padding:1%;overflow:hidden'> <img class='image-quantity-container' style='width:50px' src='"+imageUrl+"' style='float:left'/> <span> <span class='cartPanelProductName'>"+_product8.productName+title+stockStatus+"</span><br/> <span> Quantity </span><span class='cartPanelProductQuantity'>"+_product8.currentOrderQuantity+"</span> </span> <span style='float:right;margin-right:10%;font-size: 20px;margin-top:15px;cursor: pointer' class='gjs-pn-btn fa fa-trash' onclick='removeFromCart("+String.fromCharCode(34)+cartProductsEntries[_i56][0]+String.fromCharCode(34)+");'></span><br/><span>Unit Price </span><span class='cartPanelProductPrice'>"+productPrice+"</span><br/> </div> <br/><br/>"}prevBundleProduct=_product8&&_product8.campaignProductId;currentHTML&&$("#cartPanelId").append(currentHTML)}}}}function openNav(){var quantityCircleBgColor=$(".panelCartCircle").css("background-color");var quantityCircleTextColor=$(".panelCartCircle").css("color");$(".cc-custom-right-panel").length===0&&$(".panel-checkout").css({"background-color":quantityCircleBgColor,"color":quantityCircleTextColor});$("#mySidepanel").css("visibility","visible");renderPopupCartDetails()}/* Set the width of the sidebar to 0 (hide it) */function closeNav(){document.getElementById("mySidepanel").style.visibility="hidden"}function getOutStockedVariant(productData,combination,customProductData,product,currentQty){try{var _item6=[];if(combination){var customData=customProductData.split("|");if(product&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(customData[1])){_item6.push(product.baseProductName)}else{var comboVariantOutStock,selectedComboProduct;var _loop8=function _loop8(){var checkVariant=customData[_i57]&&customData[_i57].split(":");checkVariant[0]=checkVariant[0].replace("  - OUT-OF-STOCK","");checkVariant[1]=checkVariant[1].replace("  - OUT-OF-STOCK","");selectedComboProduct=product.combinations.find(function(combination){return combination.comboProductName===checkVariant[0]});if(checkVariant[0]===checkVariant[1]){if(selectedComboProduct&&product.cycle1_isShippable&&parseInt(selectedComboVariant.stockQuantity)<parseInt(customData[1])){_item6.push("<br>"+selectedComboProduct.comboProductName)}}if(checkVariant[0]!==checkVariant[1]){selectedComboVariant=selectedComboProduct.variants.find(function(variant){return variant.title===checkVariant[1]});if(selectedComboVariant&&product.cycle1_isShippable&&parseInt(selectedComboVariant.stockQuantity)<parseInt(customData[1])){_item6.push("<br>"+selectedComboProduct.comboProductName+" - "+selectedComboVariant.title)}}};for(var _i57=2;_i57<customData.length-1;_i57++){_loop8()}}}else{var _product9=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId.toString()===productData[0].toString()});var variant=_product9.variants.find(function(variant){return variant.variantDetailId.toString()===productData[1].toString()});if(variant&&parseInt(variant.stockQuantity)<parseInt(currentQty)){_item6.push(_product9.baseProductName+" - "+variant.title)}}return _item6}catch(error){error}}function getOutStockedProduct(itemCpId,currentQty){var product=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId.toString()===itemCpId.toString()});var item;if(product&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(currentQty)){item=product.baseProductName}return item}function importUpsale(_x21,_x22,_x23){return _importUpsale.apply(this,arguments)}function _importUpsale(){_importUpsale=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(buttonId,route,paayDetails){var outOfStockProducts,outOfStockProductIds,obj,paypalSmartButtonSdk,upsell,upsellButtonElement,upsellButtonVariantValue,quantity,upsellButtonReplacementValue,prodSection,_upsellCount,upsellItems,upsellItemsLength,_i147,_item21,orderItems,itemOfferKey,orderData,orderFFLNumber,fflNumber,index,upsaleComboProducts,_loop40,upsaleItemCpId,bundleStockParams,orderId,authenticateCards,paayCardType,paayInitialData,paayRebillData,ccFraudSessionId,_token2,payerId,forceMerchantId,squareMerchantAccount,applePayMerchantAccount,merchantInitiatedRebills,data,_response7,tagElements,tag,pageForm,_message3,upsalefkCartItems;return _regeneratorRuntime().wrap(function _callee20$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:outOfStockProducts=[];outOfStockProductIds=[];obj={};// let upsell = pageData[buttonId].UPSELL;
// getting product from button
paypalSmartButtonSdk=sessionStorage.getItem("paypalSdk");upsell=getUpsellFromNavigationItem(buttonId);upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");quantity=upsellButtonElement.getAttribute("quantity");upsellButtonReplacementValue=upsellButtonElement.getAttribute("replaceproductid");if(upsellButtonReplacementValue&&upsellButtonReplacementValue.toLowerCase()!=="none"){obj.replaceProductId=upsellButtonReplacementValue}// getting variant products
prodSection=$(upsellButtonElement).closest("section.fk-product-section");if(!(prodSection&&prodSection.length>0)){_context24.next=29;break}_upsellCount=Object.keys(getUpsaleItems()).length;getVariants($(prodSection).attr("id"));upsellItems=Object.keys(getUpsaleItems());upsellItemsLength=upsellItems.length;if(_upsellCount<upsellItemsLength)upsell=null;if(!upsell){_context24.next=27;break}_i147=0;case 19:if(!(_i147<upsellItemsLength)){_context24.next=27;break}_item21=upsellItems[_i147].split(".")[0];if(!(_item21===upsell)){_context24.next=24;break}upsell=null;return _context24.abrupt("break",27);case 24:_i147++;_context24.next=19;break;case 27:_context24.next=30;break;case 29:getVariants();case 30:// getting products from radio button or check box
orderItems=getUpsaleItems();// use button product or cart products
if(upsell){if(upsellButtonVariantValue){itemOfferKey=upsell+"."+upsellButtonVariantValue;orderItems[itemOfferKey]=quantity?quantity:getQuantity()}else{orderItems[upsell]=quantity?quantity:getQuantity();updateReplacementProducts(orderItems);//remove the button product?
}sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems))}orderData=sessionStorage.getItem("multiPayRebillOrder")?JSON.parse(sessionStorage.getItem("multiPayRebillOrder")):JSON.parse(sessionStorage.getItem("orderData"));orderFFLNumber=orderData&&orderData.customFields&&orderData.customFields.fflNumber;if(orderFFLNumber){_context24.next=44;break}if(!fflPopUpRequired(buttonId)){_context24.next=42;break}updateFFLModalButtonCSS(buttonId);showFFLPopUp();$("[data-id="+buttonId+"]").attr("disabled",false);sessionStorage.removeItem("upsalefkCart");enableInteractions();return _context24.abrupt("return");case 42:fflNumber=sessionStorage.getItem("fflNumber");if(fflNumber&&pageData.pageTypeId===3&&checkFFLProductsInCart()){obj["custom_order_fflNumber"]=fflNumber;if(document.getElementsByName("fflSplit")[0]&&document.getElementsByName("fflSplit")[0].checked===false)obj["custom_order_fflSplit"]=1}else if(fflNumber&&!orderFFLNumber)removeFFLInfoFromPage();case 44:index=0;if(!Object.keys(orderItems).length){_context24.next=54;break}upsaleComboProducts=JSON.parse(sessionStorage.getItem("upsaleComboProducts"))||[];_loop40=/*#__PURE__*/_regeneratorRuntime().mark(function _loop40(upsaleItemCpId){var item,_productData20,comboProduct,customKeys,_i148,key,_productId19,customData,currentItem,discountEncryption,discountEncryptionValue;return _regeneratorRuntime().wrap(function _loop40$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:index++;if(upsaleItemCpId.includes("product_custom")){obj[upsaleItemCpId]=orderItems[upsaleItemCpId];upsaleComboProducts.push(orderItems[upsaleItemCpId]);sessionStorage.setItem("upsaleComboProducts",JSON.stringify(upsaleComboProducts))}else{if(upsaleItemCpId.indexOf(".")>0){_productData20=upsaleItemCpId.split(".");item=verifyStock&&getOutStockedVariant(_productData20,"","","",orderItems[upsaleItemCpId]);obj["product"+index+"_id"]=_productData20[0];obj["variant"+index+"_id"]=_productData20[1]}else{comboProduct=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==upsaleItemCpId});comboProductlength=comboProduct&&comboProduct.combinations.length>0;if(comboProductlength){customKeys=Object.keys(orderItems).filter(function(key){return key.includes("product_custom")});for(_i148=0;_i148<customKeys.length;_i148++){key=customKeys[_i148];_productId19=orderItems[key].split("|")[0];if(upsaleItemCpId.toString()===_productId19.toString()){customData=orderItems[key];item=verifyStock&&getOutStockedVariant(upsaleItemCpId,true,customData,comboProduct)}}}else{item=verifyStock&&getOutStockedProduct(upsaleItemCpId,orderItems[upsaleItemCpId])}obj["product"+index+"_id"]=upsaleItemCpId}if(item&&item.length>0){outOfStockProducts.push(item);outOfStockProductIds.push(upsaleItemCpId)}obj["product"+index+"_qty"]=orderItems[upsaleItemCpId];if(altValues[upsaleItemCpId+"|"+orderItems[upsaleItemCpId]])obj["product"+index+"_alt"]=getItemAlt(upsaleItemCpId,orderItems[upsaleItemCpId]);currentItem=sessionStorage.getItem("currentItem");if(ccDynamicProductSection&&currentItem&&currentItem.split(".")[0]===obj["product"+index+"_id"]){discountEncryption=pageData.currentPage.pageProperties.find(function(property){return property.pageAttributeName==="discountEncryption"});discountEncryptionValue=discountEncryption&&discountEncryption.pageAttributeValue;if(discountEncryptionValue){obj["product"+index+"_discount_alt"]=discountEncryptionValue}}}case 2:case"end":return _context23.stop()}},_loop40)});_context24.t0=_regeneratorRuntime().keys(orderItems);case 49:if((_context24.t1=_context24.t0()).done){_context24.next=54;break}upsaleItemCpId=_context24.t1.value;return _context24.delegateYield(_loop40(upsaleItemCpId),"t2",52);case 52:_context24.next=49;break;case 54:obj.salesUrl=getCurrentWindowLocation().href;bundleStockParams=getBundleVariants(obj,index);obj=bundleStockParams.params;outOfStockProducts=outOfStockProducts.concat(bundleStockParams.outOfStockBundleVariants);outOfStockProductIds=outOfStockProductIds.concat(bundleStockParams.outOfStockBundleProductIds);//Parameters that might be needed for native 3DS
if(route.indexOf("V1/SplitTest/funnel/")>0||route.startsWith("https://"))obj.redirectsTo=route;else if(checkDomainForRoute())obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+pageData.funnelData.referenceId+"/"+route;else obj.redirectsTo="https://"+getCurrentWindowLocation().hostname+"/"+route;obj.browserData=JSON.stringify(browserData);addFunnelPageRefId(obj);orderId=sessionStorage.getItem("multiPayRebillOrderId")?sessionStorage.getItem("multiPayRebillOrderId"):sessionStorage.getItem("orderId");orderId=orderId?JSON.parse(orderId):orderData.orderId;if(paayDetails){paayDetails.cc3DSError?obj["cc3DSError"]=paayDetails.cc3DSError:null;paayDetails.threeDSStatus?obj["threeDSStatus"]=paayDetails.threeDSStatus:null}if(orderId)obj.orderId=orderId;authenticateCards=ccReturnPAAYCardsForAuth();paayCardType=ccReturnCardType(sessionStorage.getItem("paayCardBin"));if(!(authenticateCards.includes(paayCardType)&&sessionStorage.getItem("paayEnabled")!==null&&sessionStorage.getItem("paayCompleted")===null&&orderData!==null&&orderData.paySource==="CREDITCARD"&&sessionStorage.getItem("paay_page_option")!=="0"&&sessionStorage.getItem("paay_pan")!==null)){_context24.next=74;break}sessionStorage.setItem("paay_buttonId",buttonId);sessionStorage.setItem("paay_route",route);sessionStorage.setItem("paay_item",obj.product1_id);triggerPAAY(paayCardType,orderItems);return _context24.abrupt("return");case 74:paayInitialData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayInitialData")!==null?JSON.parse(sessionStorage.getItem("paayInitialData")):null;paayRebillData=sessionStorage.getItem("paayCompleted")!==null&&sessionStorage.getItem("paayRebillData")!==null?JSON.parse(sessionStorage.getItem("paayRebillData")):null;if(sessionStorage.getItem("paayInitialAsRebill")==="1"){obj.rebill_eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.rebill_cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.rebill_xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null}else{obj.eci=paayInitialData&&paayInitialData.eci?paayInitialData.eci:document.getElementsByName("eci")[0]?document.getElementsByName("eci")[0].value:null;obj.cavv=paayInitialData&&paayInitialData.authenticationValue?paayInitialData.authenticationValue:document.getElementsByName("authenticationValue")[0]?document.getElementsByName("authenticationValue")[0].value:document.getElementsByName("cavv")[0]?document.getElementsByName("cavv")[0].value:null;obj.xid=paayInitialData&&paayInitialData.dsTransId?paayInitialData.dsTransId:document.getElementsByName("dsTransId")[0]?document.getElementsByName("dsTransId")[0].value:document.getElementsByName("xid")[0]?document.getElementsByName("xid")[0].value:null;obj.rebill_eci=paayRebillData&&paayRebillData.eci?paayRebillData.eci:document.getElementsByName("rebill_eci")[0]?document.getElementsByName("rebill_eci")[0].value:null;obj.rebill_cavv=paayRebillData&&paayRebillData.authenticationValue?paayRebillData.authenticationValue:document.getElementsByName("rebill_authenticationValue")[0]?document.getElementsByName("rebill_authenticationValue")[0].value:document.getElementsByName("rebill_cavv")[0]?document.getElementsByName("rebill_cavv")[0].value:null;obj.rebill_xid=paayRebillData&&paayRebillData.dsTransId?paayRebillData.dsTransId:document.getElementsByName("rebill_dsTransId")[0]?document.getElementsByName("rebill_dsTransId")[0].value:document.getElementsByName("rebill_xid")[0]?document.getElementsByName("rebill_xid")[0].value:null}ccFraudSessionId=sessionStorage.getItem("ccFraudSessionId");ccFraudSessionId?obj.fraudSessionId=ccFraudSessionId:null;if(!(orderData.paySource==="PAYPAL")){_context24.next=88;break}sessionStorage.setItem("paySource","PAYPAL");obj.paypalBillerId=parseInt(pageData.funnelData.addOns.find(function(_ref32){var keyName=_ref32.keyName;return keyName==="Paypal_billerId"}).keyValue);//2 click Paypal upsells
_token2=sessionStorage.getItem("upsalePaypalToken");payerId=sessionStorage.getItem("upsalePaypalPayerId");if(_token2&&payerId){obj.token=_token2;obj.payerId=payerId;paypalSmartButtonSdk&&showOverlayEffect()}else{sessionStorage.setItem("paypalUpsaleSuccessRoute",route);sessionStorage.setItem("paypalButtonId",buttonId);sessionStorage.setItem("paypalUpsaleCart",JSON.stringify(orderItems))}if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){sessionStorage.setItem("paypalSuccessRoute",route)}_context24.next=93;break;case 88:if(!(orderData.prepaidType==="GOOGLEPAY")){_context24.next=93;break}_context24.next=91;return googlePayImportUpsell(obj,buttonId,upsellButtonElement);case 91:if(_context24.sent){_context24.next=93;break}return _context24.abrupt("return");case 93:forceMerchantId=document.getElementsByName("forceMerchantId")[0]&&document.getElementsByName("forceMerchantId")[0].value;forceMerchantId?obj.forceMerchantId=forceMerchantId:null;if(orderData.prepaidType&&orderData.prepaidType==="WITHREACH_PAYPAL"){obj.forceMerchantId=parseInt(getAddOnKeyValue(findAddOn("Paypal_billerId")))}if(orderData.prepaidType&&orderData.prepaidType==="AFFIRM"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref33){var keyName=_ref33.keyName;return keyName==="Affirm_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="KLARNA"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref34){var keyName=_ref34.keyName;return keyName==="Klarna_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SEZZLE"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref35){var keyName=_ref35.keyName;return keyName==="Sezzle_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="AFTERPAY"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref36){var keyName=_ref36.keyName;return keyName==="Afterpay_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="BANCONTACT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref37){var keyName=_ref37.keyName;return keyName==="Bancontact_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="IDEAL"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref38){var keyName=_ref38.keyName;return keyName==="iDEAL_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="BLIK"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref39){var keyName=_ref39.keyName;return keyName==="Blik_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SOFORT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref40){var keyName=_ref40.keyName;return keyName==="Sofort_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="P24"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref41){var keyName=_ref41.keyName;return keyName==="P24_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SPLITIT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref42){var keyName=_ref42.keyName;return keyName==="SplitIt_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="RADOM"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref43){var keyName=_ref43.keyName;return keyName==="Radom_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="TRUSTLY"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref44){var keyName=_ref44.keyName;return keyName==="Trustly_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="TWINT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref45){var keyName=_ref45.keyName;return keyName==="Twint_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="BOLETO"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref46){var keyName=_ref46.keyName;return keyName==="Boleto_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="PIX"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref47){var keyName=_ref47.keyName;return keyName==="PIX_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="SEPA_DEBIT"){obj.forceMerchantId=parseInt(pageData.funnelData.addOns.find(function(_ref48){var keyName=_ref48.keyName;return keyName==="SEPA_billerId"}).keyValue)}if(orderData.prepaidType&&orderData.prepaidType==="OPENPATH_IPAY"){obj.forceMerchantId=ccOpenPathId&&Number(ccOpenPathId)||null}if(orderData.prepaidType&&orderData.prepaidType==="SQUAREV2"){squareMerchantAccount=getAddOnKeyValue(findAddOn("squareBillerId"));if(squareMerchantAccount!==""){obj.forceMerchantId=squareMerchantAccount}}if(orderData.paySource==="AMAZON"){obj.amazonBillerId=parseInt(sessionStorage.getItem("amazonBillerId"));obj.amazonOrderId=sessionStorage.getItem("amazonOrderId");obj.amazonAddressConsent=sessionStorage.getItem("amazonAccessToken")}else if(orderData.prepaidType&&orderData.prepaidType==="APPLEPAY"){obj.applePayToken=sessionStorage.getItem("applePayToken");applePayMerchantAccount=getAddOnKeyValue(findAddOn("applePayBillerId"));if(applePayMerchantAccount!==""){obj.forceMerchantId=applePayMerchantAccount}}merchantInitiatedRebills=getAddOnKeyValue(findAddOn("Merchant_Rebills"));if(merchantInitiatedRebills==="1"){obj.merchantInitiated=merchantInitiatedRebills;obj.funnelReferenceId=pageData.funnelData.referenceId}if(paypalSmartButtonSdk&&paypalSmartButtonSdk==="true"){obj.paypalSdk=true}obj=ccRemoveEmptyKeysForPayload(obj);data=JSON.stringify(obj);if(!(obj.product1_id&&outOfStockProducts.length===0)){_context24.next=125;break}_response7=httpMethod("".concat(providerUrl,"/Import/Upsale"),data).then(function(data){if(data.result==="SUCCESS"){//if paySource === "PAYPAL" and reference transactions not enabled -> redirect to paypalURL
if(data.message.paypalUrl&&paypalSmartButtonSdk!=="true"){setCurrentWindowLocation(data.message.paypalUrl);return}if(data.message.paypalSdkParams){return data}registerClick(1,function(regClickData){if(sessionStorage.getItem("multiPayRebillOrder")){sessionStorage.setItem("multiPayRebillOrder",JSON.stringify(data.message))}else{sessionStorage.setItem("orderData",JSON.stringify(data.message));sessionStorage.removeItem("products");sessionStorage.setItem("products",JSON.stringify(data.message.items))}//clear out 2-click PayPal upsale session storage items
sessionStorage.removeItem("paypalUpsaleSuccessRoute");sessionStorage.removeItem("paypalUpsaleButtonId");sessionStorage.removeItem("upsalePaypalToken");sessionStorage.removeItem("upsalePaypalPayerId");sessionStorage.removeItem("paypalCart");sessionStorage.removeItem("paypalUpsaleCart");if(sessionStorage.getItem("applePayToken")&&window.session){var update={status:ApplePaySession.STATUS_SUCCESS};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}if(orderPurchaseEvent){sessionStorage.setItem("preUpsalefkCart",JSON.stringify(orderItems||{}));sessionStorage.setItem("importUpsellSuccess",true);pageData.funnelData.snapchatPixelID&&sessionStorage.setItem("importUpsellSuccessSC",true);ccTrackSygnalEvents&&sessionStorage.setItem("importUpsellSuccessSygnal",true);pageData.funnelData.GA_MEASUREMENT_ID&&sessionStorage.setItem("importUpsellSuccessGA",true);if(orderData){sessionStorage.setItem("preUpsellOrderDataItems",JSON.stringify({totalAmount:orderData.totalAmount,taxTotal:orderData.taxTotal,shipTotal:orderData.shipTotal,couponCode:""}))}}// showing list of product in thanks page - merge on successful upsell
mergeOfferUpsale(orderItems);setCurrentWindowLocation(route)});return data}else{// removing the upsellfkCart from session
sessionStorage.removeItem("upsalefkCart");//handle merchant redirect for native 3DS
if(data.result==="MERC_REDIRECT"){sessionStorage.setItem("merchantRedirectUpsalefkCart",JSON.stringify(orderItems||{}));sessionStorage.setItem("cc3dsPageSubmitDetails",JSON.stringify({pageTypeId:pageData.pageTypeId,referenceId:pageData.currentPage.referenceId}));if(orderPurchaseEvent){if(orderData){sessionStorage.setItem("preUpsellOrderDataItems",JSON.stringify({totalAmount:orderData.totalAmount,taxTotal:orderData.taxTotal,shipTotal:orderData.shipTotal,couponCode:""}))}}if(data.message&&data.message.url){setCurrentWindowLocation(data.message.url)}else if(data.message&&data.message.script){eval(data.message.script)}return false}if(sessionStorage.getItem("applePayToken")&&window.session){var appleErrors=[data.message];var update={status:ApplePaySession.STATUS_FAILURE,errors:appleErrors};window.session.completePayment(update);sessionStorage.removeItem("applePayToken")}paypalSmartButtonSdk&&hideOverlayEffect();var tagElements=generateErrorTag(buttonId,paypalSmartButtonSdk);var tag=tagElements.tag;var pageForm=tagElements.pageForm;orderData.paySource==="PAYPAL"&&clearCCPayPalSessionData();var declineNavItem=pageData.navigationItems.find(function(element){return element.elementId===buttonId+"-Decline"});var approveNavItem=pageData.navigationItems.find(function(element){return element.elementId===buttonId});if(data.message=="This upsale was already taken."&&approveNavItem){route=redirectPath(approveNavItem.linkDetails[0],true);disableInteractions(buttonId,true,true);setCurrentWindowLocation(route)}else if(declineNavItem&&declineNavItem.linkDetails[0]){route=redirectPath(declineNavItem.linkDetails[0],true);disableInteractions(buttonId,true,true);setCurrentWindowLocation(route)}else{tag.innerHTML=data.message;showExceptionInPopupValue()?alert(data.message.replaceAll(breakTagRegex,"\n")):$(tag).insertAfter(pageForm);enableInteractions()}return result=false}});return _context24.abrupt("return",_response7);case 125:if(outOfStockProducts.length>0&&verifyStock){tagElements=generateErrorTag(buttonId,paypalSmartButtonSdk);tag=tagElements.tag;pageForm=tagElements.pageForm;outOfStockProducts=outOfStockProducts.join("<br>");_message3="Products are out of stock: <br>"+outOfStockProducts;upsalefkCartItems=JSON.parse(sessionStorage.getItem("upsalefkCart"));outOfStockProductIds.length>0&&outOfStockProductIds.forEach(function(prodId){for(var key in upsalefkCartItems){if(key.toString()===prodId){delete upsalefkCartItems[key]}}});sessionStorage.setItem("upsalefkCart",JSON.stringify(upsalefkCartItems));tag.innerHTML=_message3;showExceptionInPopupValue()?alert(_message3.replaceAll(breakTagRegex,"\n")):$(tag).insertAfter(pageForm);orderData.paySource==="PAYPAL"&&clearCCPayPalSessionData();enableInteractions()}else{setCurrentWindowLocation(route)}case 126:case"end":return _context24.stop()}},_callee20)}));return _importUpsale.apply(this,arguments)}function generateErrorTag(buttonId,paypalSmartButtonSdk){var tag=document.getElementById("error-"+buttonId);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+buttonId);tag.classList.add(commonErrorClass)}else{tag.innerHTML=""}tag.style.color="red";var pageForm=$("button[data-id='"+buttonId+"']").length?$("button[data-id='"+buttonId+"']"):$("a[data-id='"+buttonId+"']");if(paypalSmartButtonSdk==="true"&&!pageForm.length){pageForm=$("div[data-id='"+buttonId+"']")}var elements={tag:tag,pageForm:pageForm};return elements}function constructComboProducts(product,variant,combo,breakTag,i){var comboProducts="";if(product===variant){comboProducts=product+breakTag}else{comboProducts=combo?combo[i]+breakTag:product+" : "+variant+breakTag}return comboProducts}function comboDisplay(confirmation,productCombo,prodId,prodQty,product,collapseIndex,matchUpsale,newSymbol,itemPrice,purchases,isPurchaseQuery){try{$("head").append(comboStyles);var listOfItem="";var productsLength=productCombo?productCombo.length:1;for(var j=0;j<productsLength;j++){var combo=productsLength&&productCombo[j];var customization=purchases&&(isPurchaseQuery?purchases.customization:purchases.customization[0]);var comboProducts="";combo=combo&&combo.split("|");var breakTag=confirmation?"<br>":"<br><br>";if(combo&&combo[0]&&combo[0]===prodId&&combo[1]===prodQty){for(var _i58=2;_i58<combo.length;_i58++){var checkVariant=combo[_i58].split(":");comboProducts+=constructComboProducts(checkVariant[0],checkVariant[1],combo,breakTag,_i58)}matchUpsale=true;if(confirmation===false){listOfItem="<a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+collapseIndex+"\"  onClick=\"rotateCaret(event)\"><i class=\"fas fa-caret-right combo-caret\"></i></a>"+" "+product.productName+"<tr><td ><div id=\"index"+collapseIndex+"\" class=\"collapse combo\"> "+comboProducts+" </div></td></tr>"}else if(confirmation===true){var productVariant=(pageData.pageTypeId===9?product.variantName:product.title)||"";listOfItem="<tr><td><a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+collapseIndex+"\"  onClick=\"rotateCaret(event)\"><i class=\"fas fa-caret-right combo-caret\"></i></a>"+" "+product.name+" "+productVariant+"</td><td style=\"text-align:center;\">"+product.qty+"</td><td style=\"text-align:right;\"> "+ccFormatCurrency(itemPrice,newSymbol)+" </td></tr><tr><td><div id=\"index"+collapseIndex+"\" class=\"collapse combo\"> "+comboProducts+" </div></td></tr>"}break}else if(customization){var _breakTag="<hr>";var customizationLength=isPurchaseQuery?customization.length:customization.attributes&&customization.attributes.length;for(var _i59=0;_i59<customizationLength;_i59++){comboProducts+=constructComboProducts(isPurchaseQuery?customization[_i59].key:customization.attributes[_i59].key,isPurchaseQuery?customization[_i59].value:customization.attributes[_i59].value,combo,_breakTag)}var productName=purchases.name||purchases.product;listOfItem="<a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+collapseIndex+"\" onClick=\"rotateCaret(event)\"><i class=\"fas fa-caret-right combo-caret\"></i></a>"+" "+productName+"<tr><td ><div id=\"index"+collapseIndex+"\" class=\"collapse combo\"> Quantity: "+(customization.quantity||purchases.currentQty)+"<br>"+comboProducts+" </div></td></tr>"}else{matchUpsale=false}}var comboResult={matchUpsale:matchUpsale,listOfItem:listOfItem};return comboResult}catch(error){error}}function rotateCaret(e){e.currentTarget.classList.toggle("rotateComboCaret")}function getLoginOrderDetails(){try{var loginOrderData=sessionStorage.getItem("orderStatusInfo")||sessionStorage.getItem("loginOrder");loginOrderData=loginOrderData&&JSON.parse(loginOrderData);if(loginOrderData){var currencySymbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol||"";var checkUpdateFreeLabel=function checkUpdateFreeLabel(price,selector){var element=$(selector),showFreeLabel=element.hasClass("cc-cart-row-free-label")&&Number(price)===0;element.html(showFreeLabel?"FREE":currencySymbol+price)};var _price3=isVatOnOrder?parseFloat(loginOrderData.price||0)+parseFloat(loginOrderData.salesTax||0):parseFloat(loginOrderData.price||0);var salesTax=isVatOnOrder?"0.00":loginOrderData.salesTax?loginOrderData.salesTax:"0.00";checkUpdateFreeLabel((_price3+parseFloat(loginOrderData.discountPrice||0)).toFixed(2),".dynamic-price-total");$(".salesTax").html(currencySymbol+salesTax);var shippingCharge=(parseFloat(loginOrderData.baseShipping||0)+parseFloat(loginOrderData.shipUpcharge||0)).toFixed(2);checkUpdateFreeLabel(shippingCharge,".dynamic-shipping-total");var discount=loginOrderData.totalDiscount;discount&&$(".discount").html((parseFloat(discount)>0?"-":"")+currencySymbol+discount);checkUpdateFreeLabel(loginOrderData.totalAmount||"0.00",".grandTotal");return loginOrderData}return{}}catch(error){return{}}}function ccProductAttrToString(product){var customization=product&&product.customization&&product.customization[0];if(customization&&customization.attributes&&customization.attributes.length){var productAttrString=product.productId+(product.variantDetailId?"."+product.variantDetailId:"")+"|"+(customization.quantity||product.qty);customization.attributes.forEach(function(item){productAttrString=productAttrString+"|"+item.key+":"+item.value});return productAttrString}return""}function ccGetComparePriceForOrderProduct(product,itemPrice,gatewayCurrency,sessionExchangeRate,shopifyProducts,orderProducts){var comparePrice=0;var orderId=product.productId+(product.variantDetailId?"."+product.variantDetailId:"");var qty=Number(product.qty||1);var unitPrice=Number((Number(itemPrice)/(qty*(gatewayCurrency?sessionExchangeRate:1))).toFixed(2));var item=orderProducts[orderId];if(item){var shopifyProduct=shopifyProducts&&gatewayCurrency&&shopifyProducts.itemsInfo&&shopifyProducts.itemsInfo[orderId];comparePrice=item.compareAtPrice&&parseFloat(item.compareAtPrice)>0?item.compareAtPrice:unitPrice;comparePrice=item.variant&&item.variant.compareAtPrice&&parseFloat(item.variant.compareAtPrice)>0&&!item.isVariantBundle?item.variant.compareAtPrice:comparePrice;comparePrice=unitPrice>Number(comparePrice)?unitPrice:Number(comparePrice);comparePrice=getItemPrice(null,comparePrice,qty,null,shopifyProduct)}return comparePrice}function confirmation(){var symbol=pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";var newSymbol=sessionStorage.getItem("currencyCodeSymbol")?sessionStorage.getItem("currencyCodeSymbol"):symbol;var memberAreaPage=pageData.pageTypeId===9;var orderData=memberAreaPage?getLoginOrderDetails():JSON.parse(sessionStorage.getItem("orderData"));var userDetails=JSON.parse(sessionStorage.getItem("userDetails"));var listOfItem="";var bundleIndex=1,prevBundleProduct,bundleList;var subTotal=0;var totalShipping=0;var totalDiscount=0;var priceDiscount=0;var vat=0;var salesTax=0;var compareAtTotal=0;var savings=0;for(var key in userDetails){if(orderData&&!userDetails[key])userDetails[key]=orderData[key];if(key==="state"||key==="shipState"||key==="country"||key==="shipCountry"){var element=document.getElementById(key+"-field");element?element.innerHTML=userDetails[key]:""}else{var _element=document.getElementById(key);_element?_element.innerHTML=userDetails[key]:""}}var invoiceCellFormat=[];var currentInvoiceRow=document.querySelector("tr[id='fk-dynamic-invoice-row']");if(currentInvoiceRow){invoiceCellFormat=Array.prototype.slice.call(currentInvoiceRow.cells)}var elementIds=[];var invoiceCellFormatLength=invoiceCellFormat.length;for(var _i60=0;_i60<invoiceCellFormatLength;_i60++){var cell=invoiceCellFormat[_i60];elementIds[_i60]=cell.id}var exchangeRate=1;var checkoutFlow=[3,5].includes(pageData.pageTypeId);var checkoutCurrency=returnCurrencyCode()||pageData.selectedCampaign.currency;var orderProducts={},shopifyProducts=sessionStorage.getItem("ccShopifyProducts");var gatewayCurrency=orderData&&orderData.currencyCode===checkoutCurrency;var sessionExchangeRate=Number(sessionStorage.getItem("exchangeRate"))||exchangeRate;shopifyProducts=shopifyProducts?JSON.parse(shopifyProducts):{};if(checkoutFlow){exchangeRate=gatewayCurrency?exchangeRate:sessionExchangeRate;orderProducts=getOrderItemDetails()||{}}if(orderData){var orderDataItems=memberAreaPage?Object.values(orderData.items||{}):orderData.items;totalDiscount=orderData.totalDiscount?parseFloat(orderData.totalDiscount):0;totalShipping=parseFloat(memberAreaPage?(parseFloat(orderData.baseShipping||0)+parseFloat(orderData.shipUpcharge||0)).toFixed(2):orderData.shipTotal);salesTax=parseFloat(memberAreaPage?orderData.salesTax:orderData.taxTotal);if(sessionStorage.getItem("multiPayRebillOrder")){var multiPayRebillOrder=JSON.parse(sessionStorage.getItem("multiPayRebillOrder"));var multiPayRebillItems=multiPayRebillOrder.items;var multiPayRebillOrderDiscount=multiPayRebillOrder.totalDiscount?parseFloat(multiPayRebillOrder.totalDiscount):0;totalDiscount+=multiPayRebillOrderDiscount;totalShipping+=parseFloat(multiPayRebillOrder.shipTotal);salesTax+=parseFloat(multiPayRebillOrder.taxTotal);delete multiPayRebillItems[0];orderDataItems=orderDataItems.concat(multiPayRebillItems)}if(isVatOnOrder){var discountPrice=0;var apiDiscounts=sessionStorage.getItem("apiDiscounts")!==null&&JSON.parse(sessionStorage.getItem("apiDiscounts"));for(var discount in apiDiscounts){discountPrice+=parseFloat(apiDiscounts[discount])}vat=parseFloat(orderData.taxTotal||0);subTotal=parseFloat(orderData.vatSubTotal.replaceAll(",",""))-discountPrice;salesTax=0;totalDiscount-=discountPrice;subTotal=(subTotal*(gatewayCurrency?1:sessionExchangeRate)).toFixed(2)}var productCombo=JSON.parse(sessionStorage.getItem("upsaleComboProducts")||"{}");var isCombo=productCombo&&productCombo.length>0;(isCombo||$("#items-list").length)&&$("head").append(comboStyles);var addedProducts=[];var collapseIndex=1;var matchUpsale,comboResult;if(orderDataItems.length>0){var _loop9=function _loop9(){var order=orderDataItems[_i61];var product=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==order.productId});var itemPrice=order.isPreauthVoid=="1"?"0.00":order.vatPrice||order.price;compareAtTotal+=checkoutFlow?ccGetComparePriceForOrderProduct(order,itemPrice,gatewayCurrency,sessionExchangeRate,shopifyProducts,orderProducts):0;if(itemPrice&&isVatOnOrder){var _productId6=order.variantDetailId?order.productId+"."+order.variantDetailId:order.productId;var vatPrices=sessionStorage.getItem("vatPrices")!==null&&JSON.parse(sessionStorage.getItem("vatPrices"));var productVatPrice=vatPrices&&parseFloat(vatPrices[_productId6]&&vatPrices[_productId6].replaceAll(",",""));itemPrice=productVatPrice||order.vatPrice||itemPrice}itemPrice=(parseFloat(itemPrice)*parseFloat(exchangeRate)).toFixed(2);if(!isVatOnOrder)subTotal+=parseFloat(itemPrice);if(memberAreaPage){var customAttrString=ccProductAttrToString(order);isCombo=false;if(customAttrString){isCombo=true;productCombo=[customAttrString]}}var isVariantBundle=product&&product.isVariantBundle;var showBundleInCart=isVariantBundle&&(!prevBundleProduct||prevBundleProduct!=product.campaignProductId);prevBundleProduct=product&&product.campaignProductId;if(showBundleInCart){listOfItem+=ccBundleDisplay(true,order.productId,product,bundleIndex,newSymbol,itemPrice,order.qty);bundleIndex++}else if(isVariantBundle){return 1;// continue
}else if(isCombo){var _productId7=memberAreaPage?order.productId+(order.variantDetailId?"."+order.variantDetailId:""):order.productId;comboResult=comboDisplay(true,productCombo,_productId7,order.qty,order,collapseIndex,matchUpsale,newSymbol,itemPrice);matchUpsale=comboResult.matchUpsale;listOfItem+=comboResult.listOfItem}else{matchUpsale=false}if(!isVariantBundle){if(matchUpsale===false){var variantTitle=(memberAreaPage?order.variantName:order.title)||"";listOfItem+="<tr><td id=\""+elementIds[0]+"\">"+order.name+" "+variantTitle+"</td><td id=\""+elementIds[1]+"\" style=\"text-align:center;\">"+order.qty+"</td><td id=\""+elementIds[2]+"\" style=\"text-align:right;\"> "+ccFormatCurrency(itemPrice,newSymbol)+"</td></tr>"}else if(matchUpsale===true){collapseIndex++}}};for(var _i61 in orderDataItems){if(_loop9())continue}}}else{var currencyObj=fetchCurrentCurrencyObj(checkoutCurrency);var sendingCurrency=currencyObj?currencyObj.sendToGateway:checkoutCurrency===pageData.selectedCampaign.currency;var _products=JSON.parse(sessionStorage.getItem("products"));_products&&_products.length>0&&_products.forEach(function(product){var itemPrice=product.isPreauthVoid=="1"?"0.00":product.vatPrice||product.price;compareAtTotal+=checkoutFlow?ccGetComparePriceForOrderProduct(product,itemPrice,sendingCurrency,sessionExchangeRate,shopifyProducts,orderProducts):0;subTotal+=parseFloat((parseFloat(itemPrice)*(sendingCurrency?1:sessionExchangeRate)).toFixed(2));totalShipping+=parseFloat(product.shipping);listOfItem+="<tr><td id=\""+elementIds[0]+"\">"+product.name+"</td><td id=\""+elementIds[1]+"\" style=\"text-align:center;\">"+product.qty+"</td><td id=\""+elementIds[2]+"\" style=\"text-align:right;\"> "+ccFormatCurrency(getItemPrice(0,itemPrice,1,1,sendingCurrency).toFixed(2),newSymbol)+"</td></tr>"})}var displaySavings=$("#items-list").find("#savings, .savings").length;var displayNegativeSavings=$("#items-list").find(".cc-negative-savings").length;var displayCompareAtTotal=$("#items-list").find("#compareAtTotal, .compareAtTotal").length;$("#items-list").html("");$("#items-list").prepend(listOfItem);$("#fk-dynamic-invoice-row").remove();var paid=parseFloat(subTotal);compareAtTotal=Number(compareAtTotal.toFixed(2));if(paid>compareAtTotal){ccSavings=savings=0;ccCompareAtTotal=compareAtTotal=paid}else{savings=parseFloat((compareAtTotal-paid).toFixed(2));ccSavings=savings;ccCompareAtTotal=compareAtTotal}var ccCustomInvoiceTable=$(".cc-invoice-details-block");if($("#fk-dynamic-invoice-price-row").length||ccCustomInvoiceTable.length){var totalCalc=paid+Number((Number(salesTax)*exchangeRate).toFixed(2))+Number((Number(totalShipping)*exchangeRate).toFixed(2))-Number((Number(totalDiscount)*exchangeRate).toFixed(2));var priceElementClassMap=[["subTotal",paid,".dynamic-price-total"],["sAndHFee",totalShipping,".dynamic-shipping-total"],["vat",vat,".vat"],["tax",salesTax,".salesTax"],["grandTotal",totalCalc,".grandTotal"],["discount",totalDiscount,".discount"],["savings",savings,".savings"],["compareAtTotal",compareAtTotal,".compareAtTotal"],[".cc-negative-savings",savings]];var priceElementClassMapLength=priceElementClassMap.length;for(var _i62=0;_i62<priceElementClassMapLength;_i62++){var _key=priceElementClassMap[_i62][0];var value=priceElementClassMap[_i62][1];var className=priceElementClassMap[_i62][2];var displayElements=_key&&_key[0]==="."?$("#fk-dynamic-invoice-price-row").find(_key):$("#fk-dynamic-invoice-price-row").find("#"+_key);displayElements=[].concat(_toConsumableArray(displayElements),_toConsumableArray(ccCustomInvoiceTable.find(className)));if(displayElements.length){var displayElementsLength=displayElements.length;for(var j=0;j<displayElementsLength;j++){var _element2=displayElements[j];var finalValue=ccFormatCurrency(checkoutFlow&&["subTotal","grandTotal"].includes(_key)?value:(exchangeRate*parseFloat(value)).toFixed(2),newSymbol);if(["discount",".cc-negative-savings"].includes(_key)&&parseFloat(value)>0){_element2.innerHTML=" -"+finalValue}else{_element2.innerHTML=" "+finalValue}}}}if(totalDiscount===0){$("#items-list").find("#discount").closest("div").remove()}if(salesTax<=0){$("#items-list").find("#tax").closest("div").remove()}if(vat<=0){$("#items-list").find("#vat",".vat").closest("div").remove()}}else{var subTotalCal=paid.toFixed(2),totalShippingCal=(totalShipping*exchangeRate).toFixed(2);var vatTaxCal=(vat*exchangeRate).toFixed(2);var salesTaxCal=(salesTax*exchangeRate).toFixed(2),discountCal=(totalDiscount*exchangeRate).toFixed(2);var totalCal=(parseFloat(subTotalCal)+parseFloat(salesTaxCal)+parseFloat(totalShippingCal)).toFixed(2);var totalWithDiscountCal=(totalCal-parseFloat(discountCal)).toFixed(2);var savingsCal=checkoutFlow&&(displaySavings||displayNegativeSavings)?"<div class='each-price'><label>Savings :</label><span id='savings'> "+(displayNegativeSavings?"-":"")+ccFormatCurrency(savings,newSymbol)+"</span></div>":"";var compareAtTotalCal=checkoutFlow&&displayCompareAtTotal?"<div class='each-price'><label>Compare At Total :</label><span id='compareAtTotal'> "+ccFormatCurrency(compareAtTotal,newSymbol)+"</span></div>":"";var isDiscountInactive="<tr><td colspan=\"3\"><div class=\"total-prices\"><div class=\"each-price\"><label>Sub Total :</label> <span id=\"subTotal\">"+ccFormatCurrency(subTotalCal,newSymbol)+"</span></div><div class=\"each-price\"><label>Shipping :</label> <span id=\"sAndHFee\"> "+ccFormatCurrency(totalShippingCal,newSymbol)+"</span></div>[tax]"+compareAtTotalCal+savingsCal+"<div class=\"each-price\"><label>Grand Total: </label><span id=\"grandTotal\"> "+ccFormatCurrency(totalCal,newSymbol)+"</span></div></div></td></tr><style>.total-prices .each-price label { margin: 0;font-weight: 700;font-size: 18px;}.total-prices{margin-top:15px;padding-top:15px;text-align: right;border-top: 1px solid #277098;}</style>";var isDiscountActive="<tr><td colspan=\"4\"><div class=\"total-prices\"><div class=\"each-price\"><label>Sub Total :</label> <span id=\"subTotal\">"+ccFormatCurrency(subTotalCal,newSymbol)+"</span></div><div class=\"each-price\"><label>Shipping :</label> <span id=\"sAndHFee\"> "+ccFormatCurrency(totalShippingCal,newSymbol)+"</span></div>[tax]"+compareAtTotalCal+savingsCal+"<div class=\"each-price\"><label>Discount :</label> <span id=\"discount\"> "+"-"+ccFormatCurrency(discountCal,newSymbol)+"</span></div><div class=\"each-price\"><label>Grand Total: </label><span id=\"grandTotal\"> "+ccFormatCurrency(totalWithDiscountCal,newSymbol)+"</span></div></div></td></tr><style>.total-prices .each-price label { margin: 0;font-weight: 700;font-size: 18px;}.total-prices{margin-top:15px;padding-top:15px;text-align: right;border-top: 1px solid #277098;}</style>";var invoiceFinal=totalDiscount===0?isDiscountInactive:isDiscountActive;var taxDiv=salesTax>0?"<div class=\"each-price\"><label>Sales Tax :</label> <span id=\"tax\"> "+ccFormatCurrency(salesTaxCal,newSymbol)+"</span></div>":"";var vatTaxDiv=vat>0?"<div class=\"each-price\"><label>Vat Tax :</label> <span id=\"vat\"> "+ccFormatCurrency(vatTaxCal,newSymbol)+"</span></div>":"";taxDiv=taxDiv||vatTaxDiv;invoiceFinal=invoiceFinal.replace("[tax]",taxDiv);$("#items-list").append(invoiceFinal)}var productsContainer=document.getElementById("productsContainer");var elem=document.getElementById("products");elem&&elem.remove();var productsEL=document.createElement("tbody");productsEL.setAttribute("id","products");productsContainer&&productsContainer.appendChild(productsEL);var total=0;products&&products.length>0&&products.map(function(product,i){var tr=document.createElement("tr");var th=document.createElement("th");var td=document.createElement("td");var td1=document.createElement("td");var productPrice=product.isPreauthVoid=="1"?"0.00":product.vatPrice||product.price;th.innerHTML=i+1;td.innerHTML=product.name;td1.innerHTML=productPrice;total=total+parseInt(productPrice);tr.appendChild(th);tr.appendChild(td);tr.appendChild(td1);productsEL.appendChild(tr)});var tr=document.createElement("tr");var th=document.createElement("th");var td=document.createElement("td");var td1=document.createElement("td");td.innerHTML="Total";td1.innerHTML=total.toFixed(2);tr.appendChild(th);tr.appendChild(td);tr.appendChild(td1);productsEL.appendChild(tr);enableInteractions();if(pageData.selectedCampaign.currencies&&pageData.selectedCampaign.currencies.length){loadStaticCurrencyValues();convertStaticCurrencyValues()}}function UpdateProduct(id){productId=id}function closePopup(elem,type){if(type==="id"){var popup=document.getElementById(elem);var showOnScroll="true";if(popup){popup.setAttribute("style","display:none;");showOnScroll=popup.dataset.showonscroll}if(!isVisitedOnScroll||!isVisited||!isVisitedOnLoad||showOnScroll!=="true"||!ccIsVisitedOnScrollUp){document.getElementsByTagName("html")[0].style.removeProperty("overflow-y")}}else if(type==="tag"){document.getElementsByTagName(elem)[0].setAttribute("style","display:none;")}}function membershipRouteForPreview(route){setCurrentWindowLocation(route)}function getClubMembershipProducts(){var membershipInfo=JSON.parse(sessionStorage.getItem("clubMemberships"));return membershipInfo?membershipInfo.map(function(product){return product.productId}):[]}function getMembershipDetails(){return JSON.parse(sessionStorage.getItem("membership"))}function checkCartProductsAndVariants(link,productKeys,isCheckoutPage,shipCountryElement,shipStateElement,customerStatus,filteredPurchaseProducts,productTags){var _link$customLinkViewE;var linkProductsAndVariants=link.pageVariants?JSON.parse(link.pageVariants):"";var offerCart=JSON.parse(sessionStorage.getItem("fkCart"))||{};var upsellCart=JSON.parse(sessionStorage.getItem("upsalefkCart"))||{};if(link.previouslyPurchasedProducts&&filteredPurchaseProducts!==null&&filteredPurchaseProducts!==void 0&&filteredPurchaseProducts.length){productKeys=_toConsumableArray(new Set([].concat(_toConsumableArray(productKeys),_toConsumableArray(filteredPurchaseProducts))))}var cartProductsAndVariants=[].concat(_toConsumableArray(Object.keys(offerCart)),_toConsumableArray(Object.keys(upsellCart)));var variantList={};function checkVariants(elementId){elementId=elementId.toString();if(linkProductsAndVariants&&linkProductsAndVariants[elementId]){if(variantList&&variantList[elementId]){return variantList[elementId].includes(linkProductsAndVariants[elementId])}else{return false}}else{return true}}cartProductsAndVariants&&cartProductsAndVariants.forEach(function(ele){var productKey=ele.split(".")[0];var variantKey=ele.split(".")[1];if(variantList.hasOwnProperty(productKey)){variantList[productKey]=variantList[productKey].toString()+","+variantKey.toString()}else{if(variantKey){variantList[productKey]=variantKey.toString()}}});var linkProductTagList=(link===null||link===void 0||(_link$customLinkViewE=link.customLinkViewEntities[0])===null||_link$customLinkViewE===void 0||(_link$customLinkViewE=_link$customLinkViewE.Value)===null||_link$customLinkViewE===void 0?void 0:_link$customLinkViewE.toLowerCase().split(","))||[];var mappedProduct=link.isAllProducts?link.products.every(function(prod){return productKeys.indexOf(prod.toString())>-1})&&linkProductTagList.every(function(prod){return productTags.indexOf(prod.toString().toLowerCase())>-1}):link.products.find(function(product){return productKeys.includes(product.toString())})||linkProductTagList.find(function(product){return productTags===null||productTags===void 0?void 0:productTags.includes(product.toString().toLowerCase())});var result=mappedProduct;if(mappedProduct){if(!link.isAllProducts){var _product10=mappedProduct.toString();if(linkProductsAndVariants&&linkProductsAndVariants[_product10]){var productVariantList=variantList[_product10]&&variantList[_product10].split(",")||[];var variantsOnButton=linkProductsAndVariants[_product10].split(",")||[];var variantCount=0;productVariantList.forEach(function(variant){if(variantsOnButton.indexOf(variant)!==-1){variantCount++}});result=variantCount===productVariantList.length?mappedProduct:null}else{if(customerStatus||customerStatus==0){return checkCountryAndState(link,shipCountryElement,shipStateElement)&&link.customerType==customerStatus&&result}else{return checkCountryAndState(link,shipCountryElement,shipStateElement)&&result}}}else{result=link.products.every(function(elementId){return checkVariants(elementId)})}}if(customerStatus||customerStatus==0){return checkCountryAndState(link,shipCountryElement,shipStateElement)&&link.customerType==customerStatus&&result}else{return checkCountryAndState(link,shipCountryElement,shipStateElement)&&result}}function sortLinkDetailsForDynamicRoutes(){var linkDetails=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var linkData=[].concat(linkDetails);linkData.sort(function(a,b){return b.products.length-a.products.length});linkData.sort(function(a,b){return b.isAllProducts-a.isAllProducts});return linkData}function checkCountryAndState(link,country,state){var parsedLinkCountries=link.countryStates&&link.countryStates!=="{}"?JSON.parse(link.countryStates):"";if(!parsedLinkCountries){return true}if(parsedLinkCountries[country]){var parsedStates=parsedLinkCountries[country];if(parsedStates!=="all"){var statesArray=parsedStates.split(",");if(statesArray.includes(state)){return true}return false}return true}}function getLinkProductTags(link){var _link$customLinkViewE2;var tagsList=(link===null||link===void 0||(_link$customLinkViewE2=link.customLinkViewEntities[0])===null||_link$customLinkViewE2===void 0||(_link$customLinkViewE2=_link$customLinkViewE2.Value)===null||_link$customLinkViewE2===void 0?void 0:_link$customLinkViewE2.split(","))||[];var result=tagsList.length>0?true:false;return result}function getProductObj(){var result=ccCampaignProductsData&&Object.fromEntries(ccCampaignProductsData.map(function(prod){return[prod.campaignProductId,prod]}));return result}function getButtonOrLinkData(buttonOrLink,pageType,response,shipCountry,shipState){try{if(!buttonOrLink){throw"Missing routing information. Please check button or link configuration."}var targetElement=$("[data-id="+buttonOrLink.elementId+"]")[0];var buttonOrLinkString=targetElement&&(targetElement.getAttribute("data-text-value")||targetElement.textContent||"");var buttonOrLinkText=buttonOrLinkString&&buttonOrLinkString.trimStart();var buttonOrLinkData,_fkCart,upsalefkCart,cartProductsTagList=[],cartProducts=[],productCheck=false;var checkoutPage=pageType===4,upsellPage=pageType===3,checkoutOrUpsellPage=checkoutPage||upsellPage;var _orderData3=JSON.parse(sessionStorage.getItem("orderData"));var shipCountryElement=shipCountry||(document.getElementsByName("shipCountry")[0]?document.getElementsByName("shipCountry")[0].value:_orderData3&&_orderData3.shipCountry?_orderData3.shipCountry:null);var shipStateElement=shipState||(document.getElementsByName("shipState")[0]?document.getElementsByName("shipState")[0].value:_orderData3&&_orderData3.shipState?_orderData3.shipState:null);var customerType=response?response.newCustomer:_orderData3?_orderData3.newCustomer:null;var purchasedProducts=response?response.productsPurchased:_orderData3?_orderData3.productsPurchased:null;var filteredPurchaseProducts=purchasedProducts?purchasedProducts.split(","):[];var purchasedProductList=getProductObj();var customerStatus=customerType!==null?customerType==0?2:1:null;if(checkoutOrUpsellPage){if(upsellPage){var prodSection=$(targetElement).closest("section.fk-product-section");var id=prodSection&&prodSection.length>0&&prodSection.attr("id");buttonOrLinkText&&!buttonOrLinkText.toLowerCase().startsWith("no")&&getVariants(id);upsalefkCart=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};var upsell=getUpsellFromNavigationItem(buttonOrLink.elementId);if(upsell)upsalefkCart[upsell]=1}else{getVariants();upsalefkCart={}}_fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):{};var cart=_objectSpread(_objectSpread({},_fkCart),upsalefkCart);cartProducts=Object.keys(cart).map(function(cartKey){return cartKey.split(".")[0]})}if(purchasedProductList){cartProducts.forEach(function(prod){var _purchasedProductList;var tags=((_purchasedProductList=purchasedProductList[prod])===null||_purchasedProductList===void 0||(_purchasedProductList=_purchasedProductList.productTags)===null||_purchasedProductList===void 0?void 0:_purchasedProductList.toLowerCase().split(","))||[];cartProductsTagList=_toConsumableArray(new Set([].concat(_toConsumableArray(cartProductsTagList),_toConsumableArray(tags))))})}if(getMembershipDetails()){var routingProducts=cartProducts.concat(getClubMembershipProducts());var linkWithNoProductsAndTags=buttonOrLink.linkDetails.find(function(linkDetail){var _linkDetail$customLin;return(!linkDetail.products||!linkDetail.products.length)&&!((_linkDetail$customLin=linkDetail.customLinkViewEntities[0])!==null&&_linkDetail$customLin!==void 0&&_linkDetail$customLin.Value)});if(checkoutOrUpsellPage){if(buttonOrLink.linkDetails.find(function(link){return link.products&&link.products.length>0||link.previouslyPurchasedProducts&&(filteredPurchaseProducts===null||filteredPurchaseProducts===void 0?void 0:filteredPurchaseProducts.length)||getLinkProductTags(link)})){if(cartProducts.length){productCheck=true;var linkData=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);buttonOrLinkData=linkData.find(function(link){return checkCartProductsAndVariants(link,routingProducts,checkoutPage,shipCountryElement,shipStateElement,customerStatus,filteredPurchaseProducts,cartProductsTagList)})||linkWithNoProductsAndTags}else if(linkWithNoProductsAndTags){buttonOrLinkData=linkWithNoProductsAndTags}else{buttonOrLinkData=buttonOrLink.linkDetails[0]}}else{buttonOrLinkData=linkWithNoProductsAndTags?linkWithNoProductsAndTags:buttonOrLink.linkDetails[0]}}else{var linkWithProducts=buttonOrLink.linkDetails.find(function(linkDetail){return routingProducts.some(function(productId){return linkDetail.products.includes(productId)})});buttonOrLinkData=linkWithProducts?linkWithProducts:linkWithNoProductsAndTags}if(!buttonOrLinkData){throw membershipNoProductError}}else if(checkoutOrUpsellPage&&buttonOrLink.linkDetails.find(function(link){return link.products&&link.products.length>0||link.previouslyPurchasedProducts&&(filteredPurchaseProducts===null||filteredPurchaseProducts===void 0?void 0:filteredPurchaseProducts.length)||getLinkProductTags(link)})){var _linkWithNoProductsAndTags=buttonOrLink.linkDetails.find(function(link){var _link$customLinkViewE3;return(!link.products||!link.products.length)&&!((_link$customLinkViewE3=link.customLinkViewEntities[0])!==null&&_link$customLinkViewE3!==void 0&&_link$customLinkViewE3.Value)})||{};if(cartProducts.length){productCheck=true;var _linkData=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);buttonOrLinkData=_linkData.find(function(link){return checkCartProductsAndVariants(link,cartProducts,checkoutPage,shipCountryElement,shipStateElement,customerStatus,filteredPurchaseProducts,cartProductsTagList)})||_linkWithNoProductsAndTags}else if(Object.keys(_linkWithNoProductsAndTags).length){buttonOrLinkData=_linkWithNoProductsAndTags}else{buttonOrLinkData=buttonOrLink.linkDetails[0]}}else{buttonOrLinkData=buttonOrLink.linkDetails[0]||{}}if(checkoutOrUpsellPage&&productCheck){var _linkData2=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);if(buttonOrLinkData.countryStates&&buttonOrLinkData.countryStates!=="{}"){buttonOrLinkData=checkCountryAndState(buttonOrLinkData,shipCountryElement,shipStateElement)?buttonOrLinkData:{}}else{buttonOrLinkData=_linkData2.find(function(link){return link.countryStates&&link.countryStates!=="{}"&&checkCartProductsAndVariants(link,cartProducts,checkoutPage,shipCountryElement,shipStateElement,customerStatus,filteredPurchaseProducts,cartProductsTagList)})||buttonOrLinkData}}if(!productCheck&&checkoutOrUpsellPage&&buttonOrLink.linkDetails.find(function(link){return link.countryStates})){buttonOrLinkData=buttonOrLink.linkDetails.find(function(link){return checkCountryAndState(link,shipCountryElement,shipStateElement)})||{};if(!buttonOrLinkData.countryStates||buttonOrLinkData.countryStates==="{}"){buttonOrLinkData=buttonOrLink.linkDetails.find(function(link){return link.countryStates&&link.countryStates!=="{}"&&checkCountryAndState(link,shipCountryElement,shipStateElement)})||buttonOrLinkData}}if(checkoutOrUpsellPage&&productCheck&&customerStatus){var _linkData3=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);if(buttonOrLinkData.customerType&&buttonOrLinkData.customerType!=0){buttonOrLinkData=buttonOrLinkData.customerType===customerStatus?buttonOrLinkData:_linkData3.find(function(link){return checkCartProductsAndVariants(link,cartProducts,checkoutPage,shipCountryElement,shipStateElement,0,filteredPurchaseProducts,cartProductsTagList)})||{}}else{buttonOrLinkData=_linkData3.find(function(link){return checkCartProductsAndVariants(link,cartProducts,checkoutPage,shipCountryElement,shipStateElement,0,filteredPurchaseProducts,cartProductsTagList)})||buttonOrLinkData}}if(!productCheck&&customerStatus&&checkoutOrUpsellPage&&!buttonOrLink.linkDetails.find(function(link){return link.countryStates&&link.countryStates!=="{}"})){var _linkData4=sortLinkDetailsForDynamicRoutes(buttonOrLink.linkDetails);buttonOrLinkData=_linkData4.find(function(link){return link.customerType===customerStatus})||{};if(!buttonOrLinkData||Object.keys(buttonOrLinkData).length===0){buttonOrLinkData=_linkData4.find(function(link){return link.customerType===0})||{}}}return buttonOrLinkData}catch(e){pageType===3&&sessionStorage.removeItem("upsalefkCart");throw e}}function ccGetCountryStates(country){var states=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.states||[];return states[country]||[]}function checkRequiredInputs(containerId,buttonId){var paySource=sessionStorage.getItem("paySource");if(paySource==="SHOPPAY"){return true}var cardFields=["cardNumber","cardSecurityCode","cardMonth","cardYear","cardDate"];/*
    * TBD: "cardMonth", "cardYear" are of type 'select-one' -> Unselected value can include "select", "choose", "pick".  Need to find the proper filter/filter list and do validation.
    */var required=$("input, select").filter(function(index){return $(this).is(":visible")&&($(this).attr("required")||$(this).attr("requiredtype"))});var cardNumberDetails=$("input[name=\"cardNumber\"]");var cardSecurityCodeDetails=$("input[name=\"cardSecurityCode\"]");var ibanElement=document.getElementsByName("iban")[0];var cardNumberValue="";var cvvFlag=false;var paySources=["PAYPAL","GOOGLEPAY","AFFIRM","AMAZON","APPLEPAY","KLARNA","SEZZLE","AFTERPAY","BANCONTACT","IDEAL","BLIK","SOFORT","P24","BOLETO","PIX","SEPA_DEBIT","SQUAREV2","SHOPPAY","BITPAY","COD","WITHREACH_PAYPAL","SPLITIT","RADOM","TRUSTLY","TWINT"];if(paySource&&paySources.includes(paySource.toUpperCase())&&!sessionStorage.getItem("multiPayRoute")){required=required.filter(function(index,field){return!cardFields.includes(field.name)})}if(paySource==="PAYPAL"){required=required.filter(function(index,field){return field.type==="checkbox"||field.type==="radio"});var requireAddress=getAddOnKeyValue(findAddOn("PAYPAL_ADDRESS"));verifyShippingRequiredFields(required,paySource,requireAddress)}if(paySource==="SEPA_DEBIT"&&ibanElement){required.push(ibanElement)}if(paySource==="GOOGLEPAY"){required=IsFieldRequiredForGooglePay(required)}if(paySource==="AMAZON"){var amazonRebill=sessionStorage.getItem("amazonRebillEnabled");if(amazonRebill){var amazonConsent=sessionStorage.getItem("amazonConsentReceived");if(!amazonConsent)return false}}if(paySource==="APPLEPAY"){var applePayToken=sessionStorage.getItem("applePayToken");if(!applePayToken){return false}required=required.filter(function(index,field){var fieldName=field.name;if(fieldName==="emailAddress"||fieldName==="phoneNumber"||ship.includes(fieldName)||ccBillingFields.includes(fieldName)){return false}return true});var _requireAddress=getAddOnKeyValue(findAddOn("APPLEPAY_ADDRESS"));if(_requireAddress==="true"){verifyShippingRequiredFields(required,paySource,_requireAddress)}}if(paySource==="SQUAREV2"){var squareBtn=document.getElementById("square-card-button");var squareNonce=document.getElementById("formCardNonce");if(squareBtn&&squareNonce&&squareNonce.value==""){squareBtn.click();return}}cardNumberDetails.each(function(index){if(this.name=="cardNumber"){cardNumberValue=$(this).val()}});var inputValue=new Array;var inputWithNoVal=new Array;var checkboxValue=new Array;var phValidationFlag=true,externalShipProfileIdCheck=true;if(phFormatByCountry==="true"){var _input3=document.querySelector(".intelPhoneInput");if(_input3){var errorDisplay=function errorDisplay(){_input3.focus();_input3.classList.add("error");errorMsg.classList.remove("hide");validPhoneNumberFlag="false";$(".intelPhoneInput").css("outline","1px solid red");phValidationFlag=false};var errorMsg=document.querySelector("#error-msg");var placeholder=_input3.getAttribute("placeholder").replace(/[\(\)\-\s]/g,"");placeholder=placeholder.replace(integerRegex,"");var phLength=placeholder.length;var valueLength=_input3.value.replace(/[\(\)\-\s]/g,"").length;if(validPhoneNumberFlag==="false"){_input3.focus();phValidationFlag=false}else if(valueLength&&phLength&&phLength>=4&&phInputCode!="49"&&valueLength!==phLength){errorDisplay();errorMsg?errorMsg.innerHTML="Please correct the number":""}}}var shipEngine=getAddOnKeyValue(findAddOn("shipEngineEnabled")),input=document.getElementsByName("shipProfileId")[0];if(shipEngine==="1"&&input&&buttonId){var requireShipping=false;if(!$("input[type=checkbox][freeshipping=true]").is(":checked")){var _orderItems4=getOrderItemDetails()||{};for(var id in _orderItems4){var _product11=_orderItems4[id];requireShipping=_product11&&_product11.cycle1_isShippable?true:requireShipping}}$("#ccShipProfileMissingError").remove();if(requireShipping){if(input.type==="select-one"){var params=getShipProfileAddress();var requiredShipFields={};requiredShipFields.city=params.city;requiredShipFields.state=params.state;requiredShipFields.postalCode=params.postalCode;requiredShipFields.profileId=input.value;var _loop10=function _loop10(){//Modified key for finding shipping inputs
var shippingInput="ship"+field.charAt(0).toUpperCase()+field.slice(1);if(!required.filter(function(index,fieldName){return fieldName.name===shippingInput||fieldName.name!=="profileId"&&fieldName.name===field}).length){var requiredElement=document.getElementsByName(shippingInput)[0]||field!=="profileId"&&document.getElementsByName(field)[0];requiredElement&&required.push(requiredElement)}};for(field in requiredShipFields){_loop10()}}var isShipRadio=input.type==="radio";var value=isShipRadio?$("[name='shipProfileId']:checked").val():input.value;if(!value||value==="0"){var errorMessage="Ship to information is not valid for your address. Please double-check your shipping information.";var target;if(input.offsetHeight>0){target=isShipRadio?input.closest(".fk-form-radio-button-parent"):input}else{target=$("[data-id='"+buttonId+"']")}$("<div class='"+commonErrorClass+"' id='ccShipProfileMissingError' style='color: red;'>"+errorMessage+"</div>").insertAfter(target);externalShipProfileIdCheck=false}}}var shipCountryValue=$("[name='shipCountry']").val(),countryValue=$("[name='country']").val();if(containerId){required=$("#"+containerId).find("input, select").filter(function(index){return $(this).is(":visible")&&($(this).attr("required")||$(this).attr("requiredtype"))})}required.each(function(index){var requiredElement=false;var recurring="recurring";var recurringUpperCase="RECURRING";var trial="trial";var elementName=$(this).attr("name");var skipErrorDisplay=!(elementName==="shipProfileId"&&!externalShipProfileIdCheck);if(this.type=="checkbox"||this.type=="radio"){if(this.checked==false){if(this.type==="checkbox"){var requiredType=this.getAttribute("requiredtype");if(requiredType&&(requiredType===recurring||requiredType===trial)){var _fkCart2=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;var _products2=pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products;if(_fkCart2&&Object.keys(_fkCart2).length>0){var _loop11=function _loop11(sessionItemCpId){_products2.forEach(function(product){if(product.campaignProductId==sessionItemCpId.split(".")[0]){if(requiredType===recurring&&product.billingCycleType===recurringUpperCase||requiredType===trial&&product.trialEnabled){requiredElement=true}}})};for(var sessionItemCpId in _fkCart2){_loop11(sessionItemCpId)}}}else{requiredElement=true}}else{requiredElement=true}if(requiredElement&&skipErrorDisplay){$(this).css("outline","1px solid red");inputWithNoVal.push(this);checkboxValue.push(this.checked);var uniqueId="error-"+(this.getAttribute("name")||getUniqueId());var nextElement=$(this).parent().next()[0];if(!nextElement||!nextElement.innerHTML.includes("Checkbox is required")){$("<div class='"+commonErrorClass+"' id='"+uniqueId+"' style='color: red;'>Checkbox is required</div>").insertAfter($(this).parent())}}}else{$(this).css("outline","1px solid green");var _nextElement=$(this).parent().next()[0];if(_nextElement&&_nextElement.innerHTML.includes("Checkbox is required")){_nextElement.remove()}}}else{var requiredField=true;var countryVal=elementName==="state"?countryValue:elementName==="shipState"?shipCountryValue:null;if(countryVal&&ccGetCountryStates(countryVal).length===0)requiredField=false;requiredField&&inputValue.push($(this).val()||$(this)[0].value);var fieldName=$(this).attr("placeholder")?$(this).attr("placeholder"):elementName;var _nextElement2=$(this).next()[0];var phonePluginEnabled=elementName==="phoneNumber"&&phFormatByCountry==="true";if(phonePluginEnabled){var parentElement=this.closest(".iti--separate-dial-code");_nextElement2=$(parentElement).next()[0];fieldName="Phone Number"}if(requiredField&&($(this).val()==""||$(this)[0].value=="")){$(this).css("outline","1px solid red");inputWithNoVal.push(this);if(skipErrorDisplay&&(!_nextElement2||!_nextElement2.innerHTML.includes(fieldName))){var _uniqueId="error-"+(elementName||getUniqueId());if(phonePluginEnabled){$("<span class='"+commonErrorClass+"' id='"+_uniqueId+"' style='color: red;'>"+fieldName+" is required</span>").insertAfter(this.parentElement)}else{$("<div class='"+commonErrorClass+"' id='"+_uniqueId+"' style='color: red;'>"+fieldName+" is required</div>").insertAfter(this);$(this).attr("fieldValue",fieldName)}}}else{$(this).css("outline","1px solid green");if(_nextElement2&&$(this).attr("fieldValue")&&_nextElement2.innerHTML.includes($(this).attr("fieldValue"))){_nextElement2.remove();$(this).removeAttr("fieldValue")}}}});cardSecurityCodeDetails.each(function(index){var _this=this;if(cardNumberValue!==""&&this.name=="cardSecurityCode"&&$(this).val()!=""&&$(this).val().length<3){alert("Card Security Code must be at least 3 characters");cvvFlag=true;setTimeout(function(){$(_this).focus();$(_this).css("outline","1px solid red")},0)}});var firstReqInput=$(inputWithNoVal[0]);if(firstReqInput.val()==""||firstReqInput.is("[type=checkbox], [type=radio]")&&firstReqInput.prop("checked")===false){firstReqInput.focus()}if(!inputValue.includes("")&&!checkboxValue.includes(false)&&cvvFlag===false&&phValidationFlag===true&&externalShipProfileIdCheck){return true}else{return false}}function getLoginPageButtonData(funnelData,pageType,buttonItem){if(funnelData&&pageType===7)return buttonItem&&buttonItem.status==="Active"&&getButtonOrLinkData(buttonItem)}function addFFLPopUp(){try{if(document.getElementById("fflWrapper")){return}$("head").append(fflStyles);$("body").append(fflHTML)}catch(err){console.log("Error: Unable to add FFL popup")}}function defaultFFLZipCodeSearch(){var shipPostalCode=pageData&&pageData.pageTypeId===3?globalOrderData&&globalOrderData.shipPostalCode:$("[name=shipPostalCode]").val();var fflZipCodeElement=$("[name=fflZipCode]");if(shipPostalCode&&fflZipCodeElement&&fflZipCodeElement.length){var defaultRadius=$("[name=fflRadius]").val()||10;$("[name=fflZipCode]").val(shipPostalCode);$("[name=fflRadius]").val(defaultRadius);$(".ffl-btn-styles").prop("disabled",true);$(".ffl-icon-container").css("display","block");updateFFLSelectOptions({"zipcode":shipPostalCode,"radius":defaultRadius}).then(function(){$(".ffl-btn-styles").prop("disabled",false);$(".ffl-icon-container").css("display","none")})}}function showFFLPopUp(){$("#fflWrapper").css("display","block");defaultFFLZipCodeSearch()}function hideFFLPopUp(){$(".ffl-btn-styles").prop("disabled",false);$(".ffl-icon-container").css("display","none");$("#fflWrapper").css("display","none")}function evaluateFFLSectionDisplay(){var pageTypeId=pageData&&pageData.pageTypeId;if([4,3].includes(pageTypeId)&&checkFFLProductsInCart(pageTypeId===3?ccUpsellPageFFLProducts:null)){$(".ffl-number").show()}else{$(".ffl-number").hide();pageTypeId!==5&&!(globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber)&&removeFFLInfoFromPage()}}function checkFFLProductsInCart(fflProductsObj){var campaign=pageData&&pageData.selectedCampaign;var campaignFFL=campaign&&campaign.ffl||[];var campaignFFLSize=campaignFFL.length;if(!campaignFFLSize){return false}var upsellPage=pageData&&pageData.pageTypeId===3;var orderItems=upsellPage?fflProductsObj?fflProductsObj:getUpsaleItems():getOrderItems(true);var orderItemsWithoutVariants={};for(var key in orderItems){var id=key.split(".")[0];orderItemsWithoutVariants[id]=orderItems[key]}var products=campaign&&campaign.products.filter(function(item){return orderItemsWithoutVariants[item.campaignProductId]});var orderData=sessionStorage.getItem("orderData");orderData=orderData&&upsellPage?JSON.parse(orderData):{};var shipCountry=upsellPage?orderData.shipCountry:$("[name=shipCountry]").val();var shipState=upsellPage?orderData.shipState:$("[name=shipState]").val();var productCollectionLength=products.length;for(var _i63=0;_i63<productCollectionLength;_i63++){var _item7=products[_i63];var tags=_item7&&_item7.productTags&&_item7.productTags.split(",")||[];if(!tags.length){continue}for(var j=0;j<campaignFFLSize;j++){var _item8=campaignFFL[j];var stateCode=_item8.stateCode;if(tags.indexOf(_item8.productTag)!==-1&&_item8.countryCode===shipCountry&&(stateCode==="*"||stateCode===shipState)){return true}}}}function updateFFLSelectOptions(_x24){return _updateFFLSelectOptions.apply(this,arguments)}function _updateFFLSelectOptions(){_updateFFLSelectOptions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(params){var _data10,res,fflSelect,fflCollection,selectOptionString,_message4;return _regeneratorRuntime().wrap(function _callee21$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:_context25.prev=0;_data10=JSON.stringify(params);_context25.next=4;return httpMethod("".concat(providerUrl,"/Plugin/FFLSearch"),_data10);case 4:res=_context25.sent;if(res.result==="SUCCESS"){$("#fflContainer").css("display","block");fflSelect=$("[name=fflOptions]");fflSelect.empty();fflCollection=res.message||[];selectOptionString="<option value=''>"+"Select FFL"+"</option>";fflCollection.forEach(function(item){var licenseName=item.licenseName||item.businessName;if(licenseName){selectOptionString=selectOptionString+"<option value='"+item.fflNumber+"'>"+(licenseName+", "+item.premiseStreet+", "+item.premiseCity+" ("+item.premiseZipCode+")")+"</option>"}});fflSelect.append(selectOptionString)}else{_message4=res.message;showExceptionInPopupValue()?alert(_message4):console.log(_message4)}_context25.next=11;break;case 8:_context25.prev=8;_context25.t0=_context25["catch"](0);console.log(_context25.t0);case 11:case"end":return _context25.stop()}},_callee21,null,[[0,8]])}));return _updateFFLSelectOptions.apply(this,arguments)}function searchFFL(){return _searchFFL.apply(this,arguments)}function _searchFFL(){_searchFFL=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(){var fflFieldOptions,params,fflNumber,fflZipCode,fflRadius,withDecimalRegEx,withOutDecimalRegEx,radiusData,radius,fflName;return _regeneratorRuntime().wrap(function _callee22$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:$(".ffl-btn-styles").prop("disabled",true);$(".ffl-icon-container").css("display","block");fflFieldOptions=document.getElementsByName("fflFieldOptions")[0].value;params={};if(fflFieldOptions==="fflNumber"){fflNumber=document.getElementsByName("fflNumber")[0]&&document.getElementsByName("fflNumber")[0].value;params["fflNumber"]=fflNumber||""}else if(fflFieldOptions==="fflZipCode"){fflZipCode=document.getElementsByName("fflZipCode")[0]&&document.getElementsByName("fflZipCode")[0].value;fflRadius=document.getElementsByName("fflRadius")[0]&&document.getElementsByName("fflRadius")[0].value;withDecimalRegEx=/^[0-9]+.{1}[0-9]+$/;withOutDecimalRegEx=/^[0-9]+$/;params["zipcode"]=fflZipCode||"";if(fflRadius&&(withDecimalRegEx.test(fflRadius)||withOutDecimalRegEx.test(fflRadius))){radiusData=fflRadius.split(".");radius=radiusData[0]+(radiusData[1]?"."+radiusData[1].slice(0,2):"");params["radius"]=parseFloat(radius)}}else if(fflFieldOptions==="fflName"){fflName=document.getElementsByName("fflName")[0]&&document.getElementsByName("fflName")[0].value;params["name"]=fflName||""}_context26.next=7;return updateFFLSelectOptions(params);case 7:$(".ffl-btn-styles").prop("disabled",false);$(".ffl-icon-container").css("display","none");case 9:case"end":return _context26.stop()}},_callee22)}));return _searchFFL.apply(this,arguments)}function addFFLInfoOnPage(){var fflNumber=sessionStorage.getItem("fflNumber");var pageTypeId=pageData&&pageData.pageTypeId;var fflOptionText=sessionStorage.getItem("fflAddress");var popUpButtonDataId=sessionStorage.getItem("popUpButtonDataId");if([3,4].includes(pageTypeId)&&fflNumber&&fflOptionText&&popUpButtonDataId){var targetButton=$("[data-id='"+popUpButtonDataId+"']");$(".selected-ffl-text").remove();if(targetButton&&targetButton.length){var fflLabel=document.createElement("p");fflLabel.classList.add("selected-ffl-text");fflLabel.innerHTML="FFL: "+fflOptionText+" "+"<i class='fa fa-edit' style='cursor: pointer;' onclick='showFFLPopUp()'></i>"+" <i class='fa fa-times' style='cursor: pointer;' onclick='removeFFLInfoFromPage()'></i>";fflLabel.style.cssText="color:#008000;";$(fflLabel).insertAfter(targetButton)}}}function removeFFLInfoFromPage(){$(".selected-ffl-text").remove();sessionStorage.removeItem("popUpButtonDataId");sessionStorage.removeItem("fflAddress");sessionStorage.removeItem("fflNumber")}function addFFL(){var fflNumber=$("[name=\"fflOptions\"]").val();if(fflNumber){var fflOptionText=$("[name=\"fflOptions\"]").find(":selected").text();sessionStorage.setItem("fflNumber",fflNumber);sessionStorage.setItem("fflAddress",fflOptionText)}addFFLInfoOnPage();hideFFLPopUp()}function handleFFLSearchTypeChange(){var searchByFieldValue=$("[name=fflFieldOptions]").val();var searchFieldBlockObj=$("#fflSearchFieldBlock");$(searchFieldBlockObj).empty();$("[name=fflOptions]").empty();$("[name=fflOptions]").append("<option value=''> Select FFL </option>");var elementString="";switch(searchByFieldValue){case"fflNumber":elementString="<div class='ffl-fields-spacing'><div class='ffl-modal-field-label'>FFL Number</div><div><input type='text' class='form-control' name='fflNumber'/></div></div>";$(searchFieldBlockObj).append(elementString);break;case"fflName":elementString="<div class='ffl-fields-spacing'><div class='ffl-modal-field-label'>FFL Name</div><div><input type='text' class='form-control' name='fflName'/></div><div>";$(searchFieldBlockObj).append(elementString);break;default:elementString="<div class='ffl-fields-spacing' style='display: flex;'><div class='ffl-input-field-side-spacing'><div class='ffl-modal-field-label'>Zip Code</div><div><input type='text' class='form-control' oninput='fflRadiusChange()' name='fflZipCode'/></div></div><div class='ffl-input-field-side-spacing'><div class='ffl-modal-field-label'>Radius (Miles) <span style='font-size:12px;'>Optional</span></div><div><input type='text' class='form-control' name='fflRadius'/></div></div></div>";$(searchFieldBlockObj).append(elementString);defaultFFLZipCodeSearch()}}function fflRadiusChange(){var regex=/^[0-9]*[.]{0,1}[0-9]*$/;var fflRadius=$("[name=fflRadius]").val();if(regex.test(fflRadius)){var radiusData=fflRadius.split(".");var radius=radiusData[0]+(typeof radiusData[1]==="string"?"."+radiusData[1].slice(0,2):"");$("[name=fflRadius]").val(radius);return}var len=fflRadius.length;len&&$("[name=fflRadius]").val(fflRadius.slice(0,len-1))}function fflPopUpRequired(buttonId){var pageType=pageData&&pageData.pageTypeId;if(![4,3].includes(pageType))return false;var fflNumber=sessionStorage.getItem("fflNumber");if(!fflNumber&&checkFFLProductsInCart()){buttonId&&sessionStorage.setItem("popUpButtonDataId",buttonId);sessionStorage.removeItem("paySource");return true}return false}function updateFFLModalButtonCSS(dataSetId){if(!dataSetId){return}var targetBtn=$("[data-id="+dataSetId+"]");if(targetBtn&&targetBtn.length){var bgColor=targetBtn.css("background-color");var color=targetBtn.css("color");if(targetBtn.find(".paypal-buttons").length){bgColor="#0d6efd";color="#ffffff"}else{var btnClassesLength=btnClasses.length;for(var _i64=0;_i64<btnClassesLength;_i64++){if(targetBtn.hasClass(btnClasses[_i64])){bgColor="#0d6efd";color="#ffffff";break}}}$(".ffl-btn-styles").css({"background-color":bgColor,"color":color})}}function callFFLPopUp(event){if(pageData&&pageData.pageTypeId===3&&globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber)return;event.preventDefault();event.stopPropagation();var datasetId=event.target.dataset.id;updateFFLModalButtonCSS(datasetId);datasetId&&sessionStorage.setItem("popUpButtonDataId",datasetId);showFFLPopUp()}function setPaySourceFromPaymentRadios(buttonTitle,btnDatasetId){var btnTitle=buttonTitle&&buttonTitle.toUpperCase();var paymentButtonTitles=["PAYPAL","GOOGLEPAY","AFFIRM","AMAZON","APPLE PAY","KLARNA","SEZZLE","AFTERPAY","BANCONTACT","IDEAL","BLIK","SOFORT","P24","BOLETO","PIX","SEPA","SQUAREV2","SHOPPAY","BITPAY","COD","SPLITIT","RADOM","TRUSTLY","TWINT"];var paymentButtonClicked=paymentButtonTitles.find(function(item){return btnTitle&&btnTitle.includes(item)});if(paymentButtonClicked){return}var paySourceRadios=[].concat(stripeAlternateGateways,multiPayRebillGateways,pagBrasilGateways,["PAYPAL","TRUSTLY","TWINT","COD","GOOGLEPAY","APPLEPAY","MOLLIE"]);var paymentRadios=$("[name=payment_method], [name=fk-payment-option-toggler]");var paymentRadiosLength=paymentRadios.length;if(paymentRadiosLength){for(var _i65=0;_i65<paymentRadiosLength;_i65++){var radio=$(paymentRadios[_i65]);if(radio.is(":checked")){var paySource=radio.attr("value")||radio.prop("value");paySource=paySource&&paySource.toUpperCase();if(paySource==="CREDITCARD"){sessionStorage.removeItem("paySource")}else if(paySourceRadios.includes(paySource)){if(paySource==="PAYPAL"&&getAddOnKeyValue(findAddOn("PayPal_WithReach"))==="true"){paySource="WITHREACH_PAYPAL"}if(paySource==="GOOGLEPAY"){window.configureGooglePay&&configureGooglePay()}if(paySource==="APPLEPAY"){configureApplePay(btnDatasetId)}sessionStorage.setItem("paySource",paySource)}break}}}}function routeByCustomer(response,route,buttonId,shipCountry,shipState){if(response){var targetUrl=route;var buttonOrLinkElement=getNavigationItemFromPageData(buttonId);var pageType=pageData.pageTypeId;var buttonData=getButtonOrLinkData(buttonOrLinkElement,pageType,response,shipCountry,shipState);var targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===buttonData.targetPageViewReferenceId});var targetPageType=targetData&&targetData.pageView[0].pageType;var splitReferenceId=targetData&&targetData.splitReferenceId||"";var funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;targetUrl=targetData&&targetData.splitEnabled?determineSplit(funnelReferenceId,splitReferenceId):redirectPath(buttonData,true);if(targetPageType===32||targetPageType===27){targetUrl=targetData.externalURL;var _orderId4=sessionStorage.getItem("orderId");if(_orderId4){targetUrl=addOrderIdInExternalURL(targetUrl,_orderId4)}else if(pageType==15||pageType==4){targetUrl=addOrderIdInExternalURL(targetUrl,"__ORDERID__")}}if(targetUrl&&targetUrl.includes("__ORDERID__")){targetUrl=targetUrl.replace("__ORDERID__",response.orderId)}return targetUrl}}function callMethod(e){e.preventDefault();if(e.currentTarget.title==="submitOnSubscribe"){isSubscribeOn=true;sessionStorage.setItem("isSubscribeOn",isSubscribeOn);displayPrices()}if(e.detail!==1){return}var dataSetId=e.currentTarget.dataset.id;e.currentTarget.disabled=true;var title=e.currentTarget.title;title=title&&title.toUpperCase();if(title&&prepaidGateways.includes(title)){sessionStorage.setItem("paySource",title)}else{title==="AMAZONPAY"&&sessionStorage.setItem("paySource","AMAZON")}var squareBtn=document.getElementById("square-card-button");if(squareBtn){sessionStorage.setItem("paySource","SQUAREV2");localStorage.setItem("squareSubmitBtnId",dataSetId)}callMethodApply(dataSetId)}function callMethodApply(_x25,_x26,_x27,_x28){return _callMethodApply.apply(this,arguments)}function _callMethodApply(){_callMethodApply=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(btnId,paypalSdkType,openElementFormDetails,uniqueBtnId){var targetButton,targetBtnTitle,callMethodApplyMain,_callMethodApplyMain,recaptchaPageId,btnPaySource,uniqueId;return _regeneratorRuntime().wrap(function _callee25$(_context29){while(1)switch(_context29.prev=_context29.next){case 0:_callMethodApplyMain=function _callMethodApplyMain3(){_callMethodApplyMain=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(buttonId,paypalSdkPrePaidType){var clubId,BreakException,route,pageType,buttonItem,buttonData,isBuildOrTemplate,loginButtonData,_response8,pageReferenceId,targetData,targetUrl,isMemberPageType,splitReferenceId,funnelReferenceId,targetPageType,_orderId8,actionBtn,popup,popupRequiredInputs,id;return _regeneratorRuntime().wrap(function _callee24$(_context28){while(1)switch(_context28.prev=_context28.next){case 0:if(!(pageData.pageTypeId===4&&fflPopUpRequired(buttonId))){_context28.next=5;break}updateFFLModalButtonCSS(buttonId);showFFLPopUp();$("[data-id="+buttonId+"]").attr("disabled",false);return _context28.abrupt("return");case 5:clubId=cookieData["clubId"]?parseInt(cookieData["clubId"]):[];BreakException={};_context28.prev=7;if(_typeof(clubId)=="object"){pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){if(product.clubPluginId&&!clubId.includes(product.clubPluginId)){clubId.push(product.clubPluginId)}})}_context28.next=16;break;case 11:_context28.prev=11;_context28.t0=_context28["catch"](7);enableInteractions();if(!(_context28.t0!==BreakException)){_context28.next=16;break}throw _context28.t0;case 16:route=null;pageType=pageData.pageTypeId;buttonItem=getNavigationItemFromPageData(buttonId);_context28.prev=19;buttonData=getButtonOrLinkData(buttonItem,pageType);_context28.next=28;break;case 23:_context28.prev=23;_context28.t1=_context28["catch"](19);if(pageType===8&&buttonData===undefined){updateMember(route=null,clubId,function(){alert(_context28.t1)})}else{alert(_context28.t1)}enableInteractions();return _context28.abrupt("return");case 28:isBuildOrTemplate=checkBuildOrTemplate();if(isBuildOrTemplate){loginButtonData=getLoginPageButtonData(pageData.funnelData,pageType,buttonItem);if(loginButtonData)buttonData=loginButtonData}if(!checkRequiredInputs(null,buttonId)){_context28.next=97;break}disableInteractions(buttonId,true,false,uniqueBtnId);if(!isBuildOrTemplate){_context28.next=48;break}route=redirectPath(buttonData,true);_context28.t2=pageType;_context28.next=_context28.t2===2?37:_context28.t2==="leadPage"?37:_context28.t2===15?37:_context28.t2===4?39:_context28.t2==="checkoutPage"?39:_context28.t2===3?41:_context28.t2==="upsellPage"?41:_context28.t2===7?43:_context28.t2==="login"?43:_context28.t2===8?43:_context28.t2==="Profile"?43:_context28.t2===9?43:_context28.t2==="memberAreaPage"?43:_context28.t2===10?43:_context28.t2==="cancelMembership"?43:_context28.t2===11?43:_context28.t2==="restartMembership"?43:_context28.t2===12?43:_context28.t2==="updateCard"?43:_context28.t2===13?43:_context28.t2==="changeProduct"?43:45;break;case 37:importLead(buttonId,route);return _context28.abrupt("break",46);case 39:importOrder(buttonId,route);return _context28.abrupt("break",46);case 41:importUpsale(buttonId,route);return _context28.abrupt("break",46);case 43:membershipRouteForPreview(route);return _context28.abrupt("break",46);case 45:setCurrentWindowLocation(route);case 46:_context28.next=95;break;case 48:pageReferenceId=pageData.currentPage.referenceId;targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===buttonData.targetPageViewReferenceId});//element.targetPageViewReferenceId or targetPage
isMemberPageType=isMembershipPage(pageType);if(isMemberPageType){productData=buttonItem;targetUrl=redirectPath(buttonData,true)}else{splitReferenceId=targetData&&targetData.splitReferenceId||"";funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;if(targetData&&targetData.splitEnabled){targetUrl=determineSplit(funnelReferenceId,splitReferenceId)}else{targetUrl=redirectPath(buttonData)}}// let route = pageData[buttonId].NEXT_PAGE.value.pageView[0].url;
route=targetUrl;targetPageType=targetData&&targetData.pageView[0].pageType||pageType===3&&pageType;pageType===9&&targetPageType!==13&&sessionStorage.getItem("ccChangeProductCampaignId")&&sessionStorage.removeItem("ccChangeProductCampaignId");if(targetPageType===32||targetPageType===27){route=targetData.externalURL;_orderId8=sessionStorage.getItem("orderId");if(_orderId8){route=addOrderIdInExternalURL(route,_orderId8)}else if(pageType==15||pageType==4){route=addOrderIdInExternalURL(route,"__ORDERID__")}}if(!(targetPageType===23)){_context28.next=61;break}openPopupIFrame(route);enableInteractions();_context28.next=94;break;case 61:_context28.t3=pageType;_context28.next=_context28.t3===1?64:_context28.t3===21?64:_context28.t3===2?66:_context28.t3==="leadPage"?66:_context28.t3===15?66:_context28.t3===4?68:_context28.t3==="checkoutPage"?68:_context28.t3===3?72:_context28.t3==="upsellPage"?72:_context28.t3===7?76:_context28.t3==="login"?76:_context28.t3===8?78:_context28.t3==="Profile"?78:_context28.t3===9?80:_context28.t3==="memberAreaPage"?80:_context28.t3===10?82:_context28.t3==="cancelMembership"?82:_context28.t3===11?84:_context28.t3==="restartMembership"?84:_context28.t3===12?86:_context28.t3==="updateCard"?86:_context28.t3===13?88:_context28.t3==="changeProduct"?88:_context28.t3===31?90:_context28.t3==="pauseMembership"?90:92;break;case 64:navigationFromPresell(targetPageType,route);return _context28.abrupt("break",94);case 66:importLead(buttonId,route);return _context28.abrupt("break",94);case 68:_context28.next=70;return importOrder(buttonId,route,paypalSdkPrePaidType,null,openElementFormDetails);case 70:_response8=_context28.sent;return _context28.abrupt("break",94);case 72:_context28.next=74;return importUpsale(buttonId,route);case 74:_response8=_context28.sent;return _context28.abrupt("break",94);case 76:clubLogin(buttonId,clubId,productData);return _context28.abrupt("break",94);case 78:updateMember(route,clubId);return _context28.abrupt("break",94);case 80:memberRoute(productData);return _context28.abrupt("break",94);case 82:cancelMembership(route);return _context28.abrupt("break",94);case 84:restartMembership(route);return _context28.abrupt("break",94);case 86:updateCard(productData);return _context28.abrupt("break",94);case 88:changeProduct(route);return _context28.abrupt("break",94);case 90:pauseMembership(route);return _context28.abrupt("break",94);case 92:logPageAnalyticsOnNavigation(pageType,targetPageType);setCurrentWindowLocation(route);case 94:return _context28.abrupt("return",_response8);case 95:_context28.next=100;break;case 97:actionBtn=$("button[data-id='"+buttonId+"'], a[data-id='"+buttonId+"'], div[data-id='"+buttonId+"']");if(actionBtn&&actionBtn.length&&$(".fk-popup").find(actionBtn[0]).length){popup=$(actionBtn[0]).closest(".fk-popup");popupRequiredInputs=popup.find("input, select").filter(function(index){return $(this).is(":visible")&&($(this).attr("required")||$(this).attr("requiredtype"))&&$(this).val()===""});if(popupRequiredInputs&&popupRequiredInputs.length===0){id=popup.attr("id");hidePopUpBlock(id)}}enableInteractions();case 100:case"end":return _context28.stop()}},_callee24,null,[[7,11],[19,23]])}));return _callMethodApplyMain.apply(this,arguments)};callMethodApplyMain=function _callMethodApplyMain2(_x44,_x45){return _callMethodApplyMain.apply(this,arguments)};targetButton=$("[data-id="+btnId+"]");targetBtnTitle=targetButton.attr("title")||targetButton.prop("title");setPaySourceFromPaymentRadios(targetBtnTitle,btnId);_context29.prev=5;recaptchaPageId=pageData&&pageData.pageTypeId;btnPaySource=sessionStorage.getItem("paySource");if(!(window.grecaptcha&&window.grecaptcha.enterprise&&captchaProjectId&&captchaSiteKey&&captchaAssessmentKey&&captchaTrigger==="2"&&(recaptchaPageId===7||recaptchaPageId===4&&(!btnPaySource||btnPaySource==="CREDITCARD")))){_context29.next=29;break}if(checkRequiredInputs(null,btnId)){_context29.next=11;break}return _context29.abrupt("return",enableInteractions());case 11:targetButton.attr("disabled",true);if(!(captchaType==="2")){_context29.next=26;break}if(!($("[id^='"+"ccCaptcha"+"']").length&&grecaptcha.enterprise.getResponse())){_context29.next=19;break}_context29.next=16;return callMethodApplyMain(btnId,paypalSdkType);case 16:return _context29.abrupt("return",_context29.sent);case 19:$("[id^='"+"ccCaptcha"+"']").remove();uniqueId="ccCaptcha"+Math.random().toString(36).substring(7);$("<div id='"+uniqueId+"'></div>").insertBefore(targetButton);$("[id='"+uniqueId+"']").css("margin","10px 0");ccGenerateCaptchaToken(uniqueId,false,enableInteractions,function(){window.grecaptcha&&window.grecaptcha.enterprise&&window.grecaptcha.enterprise.reset&&window.grecaptcha.enterprise.reset()});case 24:_context29.next=27;break;case 26:ccGenerateCaptchaToken(null,true,/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(){return _regeneratorRuntime().wrap(function _callee23$(_context27){while(1)switch(_context27.prev=_context27.next){case 0:_context27.next=2;return callMethodApplyMain(btnId,paypalSdkType);case 2:case"end":return _context27.stop()}},_callee23)})),enableInteractions);case 27:_context29.next=32;break;case 29:_context29.next=31;return callMethodApplyMain(btnId,paypalSdkType);case 31:return _context29.abrupt("return",_context29.sent);case 32:_context29.next=38;break;case 34:_context29.prev=34;_context29.t0=_context29["catch"](5);enableInteractions();console.log(_context29.t0);case 38:;case 39:case"end":return _context29.stop()}},_callee25,null,[[5,34]])}));return _callMethodApply.apply(this,arguments)}function ccSetPopupDimensions(ccdesktoppopupheight,ccdesktoppopupwidth,ccmobilepopupheight,ccmobilepopupwidth){ccPopupConfigData["ccdesktoppopupheight"]=ccdesktoppopupheight;ccPopupConfigData["ccdesktoppopupwidth"]=ccdesktoppopupwidth;ccPopupConfigData["ccmobilepopupheight"]=ccmobilepopupheight;ccPopupConfigData["ccmobilepopupwidth"]=ccmobilepopupwidth}function ccValidatePopupDimesions(dimension){if(!dimension)return 0.75;var value=Number(dimension);if(isNaN(value)||value<1||value>100)return 0.75;return value/100}function ccPopupPageIframeLoad(){try{var iframe=document.getElementById("ccDialogPopupIframe");var iframeDocument=iframe&&(iframe.contentDocument||iframe.contentWindow.document);var popConfigElement=iframeDocument&&iframeDocument.getElementById("ccPopupConfigDetails");if(popConfigElement){var desktopWidth=ccValidatePopupDimesions(popConfigElement.getAttribute("ccdesktoppopupwidth"));var desktopHeight=ccValidatePopupDimesions(popConfigElement.getAttribute("ccdesktoppopupheight"));var mobileHeight=ccValidatePopupDimesions(popConfigElement.getAttribute("ccmobilepopupheight"));var mobileWidth=ccValidatePopupDimesions(popConfigElement.getAttribute("ccmobilepopupwidth"));ccSetPopupDimensions(desktopHeight,desktopWidth,mobileHeight,mobileWidth)}var popupHeight=ccPopupConfigData["ccdesktoppopupheight"],popupWidth=ccPopupConfigData["ccdesktoppopupwidth"];if(window.innerWidth<=600){popupHeight=ccPopupConfigData["ccmobilepopupheight"];popupWidth=ccPopupConfigData["ccmobilepopupwidth"]}$("#dialogIframeDiv").dialog({height:$(window).height()*popupHeight,width:$(window).width()*popupWidth})}catch(err){ccSetPopupDimensions(0.75,0.75,0.75,0.75);console.log(err)}finally{$("#dialogIframeDiv").dialog&&$("#dialogIframeDiv").dialog("open")}}function ccPopupPageIframeLoadFailure(){$("#dialogIframeDiv").dialog&&$("#dialogIframeDiv").dialog("open")}function openPopupIFrame(route){// Open target as Popup
ccSetPopupDimensions(0.75,0.75,0.75,0.75);$("#dialogIframeDiv").html("<iframe id='ccDialogPopupIframe' onerror='ccPopupPageIframeLoadFailure()' onload='ccPopupPageIframeLoad()' class='dialogPopupIframe' src="+getAbsolutePathByUrl(getCurrentWindowLocation().href)+"/"+route+"></iframe>");$(".dialogPopupIframe").css({"height":"100%","width":"100%","max-height":"90%","border-width":"0"})}function navigationFromPresell(targetPageType,route){// If Navigating to Lead page or Checkout page
if(targetPageType===2||targetPageType===4||targetPageType===15||targetPageType===1){registerClick(1,function(regClickData){setCurrentWindowLocation(route)})}else{setCurrentWindowLocation(route)}}function navigationFromLeadOrCheckout(targetPageType,route,pageType){// If Navigating to Lead page or Checkout page
if(targetPageType===2||targetPageType===4||targetPageType===1){registerClick(1,function(){setCurrentWindowLocation(route)})}else{setCurrentWindowLocation(route)}}function customItemCheck(customInputs,productId,section){customInputs.each(function(index,input){if(section&&document.getElementsByName("cardNumber").length){input.removeEventListener("change",getVariantsAndDisplay);input.addEventListener("change",getVariantsAndDisplay)}var checkThisInput=!$(input).closest(".fk-product-section")[0];if(section||input.value&&checkThisInput){var _customCart=addItemToCustomCart(productId,input);_customCart&&Object.keys(_customCart).length&&sessionStorage.setItem("customCart",JSON.stringify(_customCart))}})}function generateCustomItemData(buttonId,customInputs){if([4].includes(pageData.pageTypeId)){var currentItem=sessionStorage.getItem("currentItem");var _orderItems5=getOrderItems();for(var key in _orderItems5){currentItem=currentItem&&currentItem.split(".")[0];if(key.startsWith(currentItem+".")){currentItem=key}}var navProduct=getOfferFromNavigationItem(buttonId);var _productId8=currentItem?currentItem:navProduct?navProduct:"";customItemCheck(customInputs,_productId8)}}function ccSetPhoneDialCode(){if(phFormatByCountry==="true"){var dialCodeValue=$(".iti__selected-dial-code").first().html();if(dialCodeValue&&$("[name='phoneNumber']").first().val()){var _orderData4=sessionStorage.getItem("orderData");_orderData4=_orderData4?JSON.parse(_orderData4):{};if(!["COMPLETE","PENDING","COD_PENDING"].includes(_orderData4.orderStatus)){sessionStorage.setItem("ccPhoneDialCode",(dialCodeValue||"").replace(/\D/ig,""))}}}}function route(_x29){return _route4.apply(this,arguments)}function _route4(){_route4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(e){var elementTagName,pageType,buttonDataID,buttonString,buttonText,button,customName,custom,buttonId,containerId,buttonItem,buttonData,targetData,targetPageType,offer,offerButtonElement,offerButtonVariantValue,_orderItems29,itemOfferKey,_itemOfferKey4,upsell,upsellButtonElement,upsellButtonVariantValue,_orderItems30,_itemOfferKey5,_offerButtonElement,_offerButtonVariantValue2,_orderItems31,_itemOfferKey6,_orderItems32,customInputs,_orderId9,url,isBuildOrTemplate,loginButtonData,_route10,funnelReferenceId,pageReferenceId,splitReferenceId,currentUrl,splitUrl,_pageReferenceId,_splitReferenceId,_funnelReferenceId2,isMembershipPageType;return _regeneratorRuntime().wrap(function _callee26$(_context30){while(1)switch(_context30.prev=_context30.next){case 0:e.preventDefault();e.stopPropagation();elementTagName=e.target.tagName.toLowerCase();if(!(elementTagName==="button"&&e.detail!==1)){_context30.next=5;break}return _context30.abrupt("return");case 5:pageType=pageData.pageTypeId;buttonDataID=e.currentTarget.dataset.id;buttonString=e.currentTarget.textContent||"";buttonText=buttonString.trimStart();if(elementTagName==="button"&&buttonDataID&&buttonDataID!==""){button=$("button[data-id='"+buttonDataID+"']")[0];if(button.parentNode.nodeName==="SECTION"){customName=button.parentNode.attributes.customName?button.parentNode.attributes.customName.value:"";if(customName!==""){customName=customName.replace(" ","_");custom="custom_"+customName;sessionStorage.setItem(custom,button.innerHTML)}}}buttonId=e.currentTarget.dataset.id;containerId=ccCheckSubmitLeadOnPopup(buttonId);if(!containerId){_context30.next=17;break}if(!(containerId===true)){_context30.next=15;break}return _context30.abrupt("return");case 15:_context30.next=17;return captureLead(true,containerId);case 17:buttonItem=getNavigationItemFromPageData(buttonId);_context30.prev=18;buttonData=getButtonOrLinkData(buttonItem,pageType);_context30.next=26;break;case 22:_context30.prev=22;_context30.t0=_context30["catch"](18);alert(_context30.t0);return _context30.abrupt("return");case 26:targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===buttonData.targetPageViewReferenceId});if(targetData){_context30.next=30;break}routingNotFound();return _context30.abrupt("return");case 30:targetPageType=targetData.pageView[0].pageType;pageType===9&&targetPageType!==4&&sessionStorage.getItem("ccCampaignId")&&sessionStorage.removeItem("ccCampaignId");if(!(targetPageType===4&&!checkRequiredInputs(null,buttonId))){_context30.next=35;break}enableInteractions();return _context30.abrupt("return");case 35:if(pageType===17||pageType===18){sessionStorage.removeItem("currentItem");offer=getOfferFromNavigationItem(buttonId);if(offer){offerButtonElement=document.querySelector("[data-id="+buttonId+"]");offerButtonVariantValue=offerButtonElement.getAttribute("variantvalue");if(targetPageType===33){_orderItems29=getOrderItems();if(offerButtonVariantValue){itemOfferKey=offer+"."+offerButtonVariantValue}else{itemOfferKey=offer}itemOfferKey=isSubscribeOn?swapSubscriptions(_orderItems29,"",itemOfferKey).sectionValue:itemOfferKey;_orderItems29[itemOfferKey]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems29));callAddToCartEvent(itemOfferKey)}else{if(offerButtonVariantValue){_itemOfferKey4=offer+"."+offerButtonVariantValue;sessionStorage.setItem("currentItem",_itemOfferKey4)}else{sessionStorage.setItem("currentItem",offer)}buttonId&&buttonId.indexOf("_prodCol")!==-1&&sessionStorage.removeItem("currentItem")}}}else if(pageType===3){if(!buttonText.toLowerCase().startsWith("no")){getVariants()}}else{getBundleVariants({},0);getVariants()}if(pageType===3&&targetPageType===3){upsell=getUpsellFromNavigationItem(buttonId);upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");_orderItems30=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};if(upsell){if(upsellButtonVariantValue){_itemOfferKey5=upsell+"."+upsellButtonVariantValue;_orderItems30[_itemOfferKey5]=getQuantity()}else{_orderItems30[upsell]=getQuantity()}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems30))}}if(!(targetPageType===4)){_context30.next=47;break}_context30.t1=!containerId&&[4,7].includes(pageType);if(!_context30.t1){_context30.next=42;break}_context30.next=42;return captureLead(true);case 42:offer=getOfferFromNavigationItem(buttonId);_offerButtonElement=document.querySelector("[data-id="+buttonId+"]");_offerButtonVariantValue2=_offerButtonElement.getAttribute("variantvalue");_orderItems31=getOrderItems();if(offer){if(_offerButtonVariantValue2){_itemOfferKey6=offer+"."+_offerButtonVariantValue2}else{_itemOfferKey6=offer}_itemOfferKey6=isSubscribeOn?swapSubscriptions(_orderItems31,"",_itemOfferKey6).sectionValue:_itemOfferKey6;_orderItems31[_itemOfferKey6]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems31));callAddToCartEvent(_itemOfferKey6)}else if(pageType===34&&buttonText.toLowerCase()!="proceed to checkout"){_orderItems32=getOrderItems();offer=sessionStorage.getItem("currentItem");offer=isSubscribeOn?swapSubscriptions(_orderItems32,"",offer).sectionValue:offer;_orderItems32[offer]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems32));callAddToCartEvent(offer)}else if(pageType===4&&document.getElementsByName("cardNumber").length&&$(e.target).closest(".popup_content").length)sessionStorage.removeItem("fkCart");case 47:customInputs=$(document).find("input[name^='custom_item_']");customInputs.length&&generateCustomItemData(buttonId,customInputs);if(!(targetPageType===32||targetPageType===27)){_context30.next=55;break}_orderId9=sessionStorage.getItem("orderId");url=addValuesInExternalURL(targetData.externalURL);if(pageType===5){url=addOrderIdInExternalURL(url,_orderId9)}setCurrentWindowLocation(url);return _context30.abrupt("return");case 55:isBuildOrTemplate=checkBuildOrTemplate();if(isBuildOrTemplate){loginButtonData=getLoginPageButtonData(pageData.funnelData,pageType,buttonItem);if(loginButtonData){buttonData=loginButtonData}_route10=redirectPath(buttonData,true);setCurrentWindowLocation(_route10)}else{funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;pageReferenceId=pageData.currentPage.referenceId;splitReferenceId=targetData&&targetData.splitReferenceId||"";currentUrl=getCurrentWindowLocation().href;splitUrl=targetData.splitEnabled?determineSplit(funnelReferenceId,splitReferenceId):redirectPath(buttonData);if(targetPageType===23){openPopupIFrame(splitUrl)}else{_pageReferenceId=pageData.currentPage.referenceId;_splitReferenceId=targetData.splitReferenceId;_funnelReferenceId2=pageData.funnelData?pageData.funnelData.referenceId:null;isMembershipPageType=isMembershipPage(pageType);if(isMembershipPageType){memberRoute(buttonItem)}else if(pageType===1){navigationFromPresell(targetPageType,splitUrl)}else if(pageType===2||pageType===4){navigationFromLeadOrCheckout(targetPageType,splitUrl,pageType)}else{logPageAnalyticsOnNavigation(pageType,targetPageType);setCurrentWindowLocation(splitUrl)}}}case 57:case"end":return _context30.stop()}},_callee26,null,[[18,22]])}));return _route4.apply(this,arguments)}function ccCheckSubmitLeadOnPopup(dataId){if(!dataId||(pageData&&pageData.pageTypeId)!==4)return;var routeBtn=$("[data-id="+dataId+"]");var containerId=routeBtn.attr("action")==="submitLeadRoute"&&routeBtn.closest(".popup_content").attr("id");if(containerId){var _orderData5=sessionStorage.getItem("orderData");_orderData5=_orderData5?JSON.parse(_orderData5):null;if(_orderData5&&_orderData5.orderStatus&&_orderData5.orderStatus.toLowerCase()!=="partial"){return}else if(!checkRequiredInputs(containerId)){return true}}return containerId}function linkMethod(event,submitAction,loginRedirectUrl,uniqueBtnId){event.preventDefault();var elementDataId=event.currentTarget&&event.currentTarget.dataset.id;if(event.detail!==1||event.target.tagName==="IMG"&&event.target.getAttribute("href")||event.target.getAttribute("action")==="addToCart"){return}if(submitAction){event.target.style.pointerEvents="none";var title=event.target.title;setPaySourceFromPaymentRadios(title,elementDataId);if(title&&prepaidGateways.includes(title.toUpperCase())){sessionStorage.setItem("paySource",title.toUpperCase())}}var elementTextContent=event.currentTarget&&event.currentTarget.textContent;function linkMethodMain(_x30,_x31,_x32,_x33,_x34,_x35){return _linkMethodMain.apply(this,arguments)}function _linkMethodMain(){_linkMethodMain=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e,submit,loginRedirect,elementDataId,elementTextContent,uniqueBtnId){var pageType,buttonId,linkString,linkText,buttonItem,buttonData,linkId,linkData,linkObj,containerId,linkTarget,loginLinkHref,_route5,currentUrl,_pageType,pageReferenceId,requiredPageRefId,targetData,splitReferenceId,targetPageType,funnelReferenceId,_route6,_orderId5,customInputs,upsell,upsellButtonElement,upsellButtonVariantValue,_orderItems6,itemOfferKey,offer,offerButtonElement,_offerButtonVariantValue,_orderItems7,_itemOfferKey,productCardContainerParent,offerButtonVariantValue,_itemOfferKey2,linkHref,_funnelReferenceId;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:pageType=pageData.pageTypeId;buttonId=elementDataId;linkString=elementTextContent||"";linkText=linkString.trimStart();// let buttonData = pageData[buttonId].NEXT_PAGE;
// const linkId = e.target.dataset.id ? e.target.dataset.id : e.target.parentNode.getAttribute("data-id");
// let linkData = pageData[linkId].NEXT_PAGE;
buttonItem=getNavigationItemFromPageData(buttonId);containerId=ccCheckSubmitLeadOnPopup(buttonId);if(!containerId){_context4.next=11;break}if(!(containerId===true)){_context4.next=9;break}return _context4.abrupt("return");case 9:_context4.next=11;return captureLead(true,containerId);case 11:_context4.prev=11;buttonData=getButtonOrLinkData(buttonItem,pageType);linkId=buttonId?buttonId:$(e.target).closest("[data-id]")[0]?$($(e.target).closest("[data-id]")[0]).attr("data-id"):undefined;linkObj=getNavigationItemFromPageData(linkId);linkData=getButtonOrLinkData(linkObj,pageType);_context4.next=22;break;case 18:_context4.prev=18;_context4.t0=_context4["catch"](11);alert(_context4.t0);return _context4.abrupt("return");case 22:if(!(submit&&pageData.pageTypeId===4&&fflPopUpRequired(linkId))){_context4.next=27;break}enableInteractions();updateFFLModalButtonCSS(linkId);showFFLPopUp();return _context4.abrupt("return");case 27:linkTarget=linkObj?linkObj.target||$("[data-id="+linkObj.elementId+"]").attr("target"):null;if(!(linkObj&&linkObj.href&&loginRedirect)){_context4.next=32;break}loginLinkHref=linkObj.href+"?redirectToMe="+getCurrentWindowLocation().href;linkTarget==="_blank"?window.open(loginLinkHref,""):setCurrentWindowLocation(loginLinkHref);return _context4.abrupt("return");case 32:submit&&disableInteractions(linkId,false,true,uniqueBtnId);if(!(pageData.funnelData&&pageData.funnelData.isFunnelTemplate)){_context4.next=54;break}if(!submit){_context4.next=51;break}if(!checkRequiredInputs(null,linkId)){_context4.next=48;break}_context4.t1=pageType;_context4.next=_context4.t1===2?39:_context4.t1==="leadPage"?39:_context4.t1===15?39:_context4.t1===4?41:_context4.t1==="checkoutPage"?41:_context4.t1===3?43:_context4.t1==="upsellPage"?43:45;break;case 39:importLead(linkId,route);return _context4.abrupt("break",46);case 41:importOrder(linkId,route);return _context4.abrupt("break",46);case 43:importUpsale(linkId,route);return _context4.abrupt("break",46);case 45:setCurrentWindowLocation(route);case 46:_context4.next=49;break;case 48:enableInteractions();case 49:_context4.next=52;break;case 51:if(linkObj.href){linkTarget==="_blank"?window.open(linkObj.href,""):setCurrentWindowLocation(linkObj.href)}else{_route5=redirectPath(buttonData,true);linkTarget==="_blank"?window.open(_route5,""):setCurrentWindowLocation(_route5)}case 52:_context4.next=97;break;case 54:currentUrl=getCurrentWindowLocation().href;_pageType=pageData.pageTypeId;pageReferenceId=pageData.currentPage.referenceId;requiredPageRefId=!linkData.targetPageViewReferenceId&&_pageType===3&&submit?pageData.pageViewReferenceId:linkData.targetPageViewReferenceId;targetData=pageData.funnelData.pages.find(function(item){return item.pageView[0].referenceId===requiredPageRefId});if(targetData){_context4.next=62;break}routingNotFound();return _context4.abrupt("return");case 62:splitReferenceId=targetData.splitReferenceId;targetPageType=targetData.pageView[0].pageType;funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;_route6=targetData.splitEnabled?determineSplit(funnelReferenceId,splitReferenceId):redirectPath(linkData);if(targetPageType===32||targetPageType===27){_route6=targetData.externalURL;_orderId5=sessionStorage.getItem("orderId");if(_orderId5){_route6=addOrderIdInExternalURL(_route6,_orderId5)}else if(_pageType==15||_pageType==4){_route6=addOrderIdInExternalURL(_route6,"__ORDERID__")}}if(!submit){_context4.next=93;break}if(!checkRequiredInputs(null,linkId)){_context4.next=90;break}if(!(targetPageType===23)){_context4.next=74;break}openPopupIFrame(_route6);enableInteractions();_context4.next=88;break;case 74:_context4.t2=_pageType;_context4.next=_context4.t2===1?77:_context4.t2===21?77:_context4.t2===2?79:_context4.t2==="leadPage"?79:_context4.t2===15?79:_context4.t2===4?81:_context4.t2==="checkoutPage"?81:_context4.t2===3?83:_context4.t2==="upsellPage"?83:_context4.t2===13?85:_context4.t2==="changeProduct"?85:87;break;case 77:navigationFromPresell(targetPageType,_route6);return _context4.abrupt("break",88);case 79:importLead(linkId,_route6);return _context4.abrupt("break",88);case 81:importOrder(linkId,_route6);return _context4.abrupt("break",88);case 83:importUpsale(linkId,_route6);return _context4.abrupt("break",88);case 85:changeProduct(_route6);return _context4.abrupt("break",88);case 87:setCurrentWindowLocation(_route6);case 88:_context4.next=91;break;case 90:enableInteractions();case 91:_context4.next=97;break;case 93:customInputs=$(document).find("input[name^='custom_item_']");customInputs.length&&generateCustomItemData(buttonId,customInputs);_pageType===9&&targetPageType!==4&&sessionStorage.getItem("ccCampaignId")&&sessionStorage.removeItem("ccCampaignId");if(targetPageType===23){openPopupIFrame(_route6)}else{if(_pageType===3&&targetPageType===3){upsell=getUpsellFromNavigationItem(buttonId);upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");if(!linkText.toLowerCase().startsWith("no")){getVariants()}_orderItems6=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};if(upsell){if(upsellButtonVariantValue){itemOfferKey=upsell+"."+upsellButtonVariantValue;_orderItems6[itemOfferKey]=getQuantity()}else{_orderItems6[upsell]=getQuantity()}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems6))}}if(targetPageType===4){offer=getOfferFromNavigationItem(buttonId);offerButtonElement=document.querySelector("[data-id="+buttonId+"]");_offerButtonVariantValue=offerButtonElement.getAttribute("variantvalue");getVariants();_orderItems7=getOrderItems();if(offer){if(_offerButtonVariantValue){_itemOfferKey=offer+"."+_offerButtonVariantValue}else{_itemOfferKey=offer}_itemOfferKey=isSubscribeOn?swapSubscriptions(_orderItems7,"",_itemOfferKey):_itemOfferKey;_orderItems7[_itemOfferKey]=getQuantity();sessionStorage.setItem("fkCart",JSON.stringify(_orderItems7));callAddToCartEvent(_itemOfferKey)}else if(_pageType===4&&document.getElementsByName("cardNumber").length&&$(e.target).closest(".popup_content").length)sessionStorage.removeItem("fkCart")}if(_pageType===17||_pageType===18||_pageType===33){offer="";productCardContainerParent=$(e.target).closest(".fk-product-card-container").parent();if((_pageType===17||_pageType===18)&&(e.target.parentElement.tagName=="A"||productCardContainerParent.prop("tagName")==="A")){offer=productCardContainerParent.length?productCardContainerParent.attr("offer"):e.target.parentElement.attributes.offer.value}else{offer=e.target.attributes.offer&&e.target.attributes.offer.value||""}sessionStorage.removeItem("currentItem");if(offer!==""){offerButtonVariantValue="";if((_pageType===17||_pageType===18)&&e.target.parentElement.tagName=="A"){offerButtonVariantValue=e.target.parentElement.attributes.variantvalue.value}else{offerButtonVariantValue=e.target.attributes.variantvalue&&e.target.attributes.variantvalue.value||""}if(offerButtonVariantValue!=""){_itemOfferKey2=offer+"."+offerButtonVariantValue;sessionStorage.setItem("currentItem",_itemOfferKey2)}else{sessionStorage.setItem("currentItem",offer)}}}if(_pageType===2||_pageType===4){getBundleVariants({},0);if(targetPageType===2||targetPageType===4){registerClick(1)}}if(_pageType===1){getVariants();getBundleVariants({},0)}logPageAnalyticsOnNavigation(_pageType,targetPageType);linkHref=linkObj&&linkObj.href;if(linkHref){linkHref=loginRedirect?linkHref+"?redirectToMe="+currentUrl:linkHref;linkTarget==="_blank"?window.open(linkHref,""):setCurrentWindowLocation(linkHref)}else{_route6=loginRedirect?_route6+"?redirectToMe="+currentUrl:_route6;_funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;linkTarget==="_blank"?window.open(_route6,""):setCurrentWindowLocation(_route6)}}case 97:case"end":return _context4.stop()}},_callee4,null,[[11,18]])}));return _linkMethodMain.apply(this,arguments)}try{var recaptchaPageId=pageData&&pageData.pageTypeId;var btnPaySource=sessionStorage.getItem("paySource");if(submitAction&&window.grecaptcha&&window.grecaptcha.enterprise&&captchaProjectId&&captchaSiteKey&&captchaAssessmentKey&&captchaTrigger==="2"&&(recaptchaPageId===7||recaptchaPageId===4&&(!btnPaySource||btnPaySource==="CREDITCARD"))){if(!checkRequiredInputs(null,elementDataId))return enableInteractions();var targetButton=$("[data-id='"+elementDataId+"']");targetButton.attr("disabled",true);if(captchaType==="2"){if($("[id^='"+"ccCaptcha"+"']").length&&grecaptcha.enterprise.getResponse()){linkMethodMain(event,submitAction,loginRedirectUrl,elementDataId,elementTextContent,uniqueBtnId)}else{$("[id^='"+"ccCaptcha"+"']").remove();var uniqueId="ccCaptcha"+Math.random().toString(36).substring(7);$("<div id='"+uniqueId+"'></div>").insertBefore(targetButton);$("[id='"+uniqueId+"']").css("margin","10px 0");ccGenerateCaptchaToken(uniqueId,false,enableInteractions,function(){window.grecaptcha&&window.grecaptcha.enterprise&&window.grecaptcha.enterprise.reset&&window.grecaptcha.enterprise.reset()})}}else{ccGenerateCaptchaToken(null,true,function(){linkMethodMain(event,submitAction,loginRedirectUrl,elementDataId,elementTextContent,uniqueBtnId)},enableInteractions)}}else{linkMethodMain(event,submitAction,loginRedirectUrl,elementDataId,elementTextContent,uniqueBtnId)}}catch(err){enableInteractions();console.log(err)};}function fetchLeadDetails(obj){var addressField=$("[name=address1]");var useShippingInputs=$("[name=shipAddress1]").length&&addressField.length&&addressField[0].offsetHeight===0;if(obj.billShipSame===1&&obj.address1&&!useShippingInputs){if(document.getElementsByName("fullName")[0]){var fullName=document.getElementsByName("fullName")[0].value.trim();var pos=fullName.indexOf(" ");obj.shipFirstName=pos>-1?fullName.substring(0,pos):fullName;obj.shipLastName=pos>-1?fullName.substring(pos+1):null}else{obj.shipFirstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;obj.shipLastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}obj.shipAddress1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;obj.shipAddress2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;obj.shipCity=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;obj.shipState=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;obj.shipPostalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;obj.shipCountry=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:null}else{var _orderData6=JSON.parse(sessionStorage.getItem("orderData"));if(document.getElementsByName("shipFullName")[0]){var _fullName=document.getElementsByName("shipFullName")[0].value.trim();var _pos=_fullName.indexOf(" ");obj.shipFirstName=_pos>-1?_fullName.substring(0,_pos):_fullName;obj.shipLastName=_pos>-1?_fullName.substring(_pos+1):null}else{obj.shipFirstName=document.getElementsByName("shipFirstName")[0]?document.getElementsByName("shipFirstName")[0].value:_orderData6&&_orderData6.shipFirstName?_orderData6.shipFirstName:null;obj.shipLastName=document.getElementsByName("shipLastName")[0]?document.getElementsByName("shipLastName")[0].value:_orderData6&&_orderData6.shipLastName?_orderData6.shipLastName:null}obj.shipAddress1=document.getElementsByName("shipAddress1")[0]?document.getElementsByName("shipAddress1")[0].value:_orderData6&&_orderData6.shipAddress1?_orderData6.shipAddress1:null;obj.shipAddress2=document.getElementsByName("shipAddress2")[0]?document.getElementsByName("shipAddress2")[0].value:_orderData6&&_orderData6.shipAddress2?_orderData6.shipAddress2:null;obj.shipCity=document.getElementsByName("shipCity")[0]?document.getElementsByName("shipCity")[0].value:_orderData6&&_orderData6.shipCity?_orderData6.shipCity:null;obj.shipState=document.getElementsByName("shipState")[0]?document.getElementsByName("shipState")[0].value:_orderData6&&_orderData6.shipState?_orderData6.shipState:null;obj.shipPostalCode=document.getElementsByName("shipPostalCode")[0]?document.getElementsByName("shipPostalCode")[0].value:_orderData6&&_orderData6.shipPostalCode?_orderData6.shipPostalCode:null;obj.shipCountry=document.getElementsByName("shipCountry")[0]?document.getElementsByName("shipCountry")[0].value:_orderData6&&_orderData6.shipCountry?_orderData6.shipCountry:defaultCountryCode;if(obj.billShipSame===1){obj.country=obj.shipCountry;if(document.getElementsByName("state")[0])obj.state=obj.shipState;//override the geo-located state if no address is entered
}}}function handlePopUpOnScroll(popupBlock){var popupId=popupBlock.getAttribute("id");var minutesDelay=popupBlock.querySelector("[data-minutesdelay]")?Number(popupBlock.querySelector("[data-minutesdelay]").getAttribute("data-minutesdelay")):0;var secondsDelay=popupBlock.querySelector("[data-secondsdelay]")?popupBlock.querySelector("[data-secondsdelay]").getAttribute("data-secondsdelay"):0;var delay=minutesDelay>0?minutesDelay*60+secondsDelay+"000":secondsDelay+"000";document.getElementById(popupId).setAttribute("style","display:none");document.getElementsByTagName("html")[0].style="overflow-y: unset";setTimeout(function(delay){document.getElementById(popupId).setAttribute("style","display:block");document.getElementsByTagName("html")[0].style="overflow-y: hidden"},delay)}window.onscroll=function(){var stickyBar=document.getElementById("stickyBarCustom");var toShowOnScroll=stickyBar&&stickyBar.getAttribute("data-showonscroll")==="yes"?true:false;if(toShowOnScroll){if(window.scrollY>100){document.getElementById("stickyBarCustom").setAttribute("style","display:block")}else{document.getElementById("stickyBarCustom").setAttribute("style","display:none")}}var popupBlock=$(".fk-popup").has("[trigger-on='trigger_on_scroll']")[0];if(popupBlock&&popupBlock.querySelector("[data-showonscroll]")&&popupBlock&&popupBlock.querySelector("[data-showonscroll]").getAttribute("data-showonscroll")==="true"){if(isVisitedOnScroll){handlePopUpOnScroll(popupBlock);isVisitedOnScroll=false}}if(ccIsVisitedOnScrollUp){var offset=window.pageYOffset||document.documentElement.scrollTop;if(offset<ccScrollOffset){var scrollUpPopupBlock=$(".fk-popup").has("[trigger-on='trigger_on_scroll_up']")[0];var scrollUpPopupBody=scrollUpPopupBlock&&scrollUpPopupBlock.querySelector("[data-showonscroll]");if(scrollUpPopupBody&&scrollUpPopupBody.getAttribute("data-showonscrollup")==="true"){handlePopUpOnScroll(scrollUpPopupBlock);ccIsVisitedOnScrollUp=false}}ccScrollOffset=offset<=0?0:offset}if($(".fk-product-row").first().attr("lazyload")==="1"&&fkCollectionSize&&scrolledCardsCount<fkCollectionSize&&!fkCollectionLoader){if(window.scrollY+window.innerHeight>=$(".fk-product-row").prop("scrollHeight")){fkCollectionLoader=true;$(productCardLoaderHTML).insertAfter($(".fk-product-row"));var nextIndex=scrolledCardsCount+scrollCardsSlotSize;sessionStorage.setItem("productRowCardsCount",nextIndex);setTimeout(function(){populateProductRow(fkProductCollection.slice(scrolledCardsCount,nextIndex));scrolledCardsCount=nextIndex;$("#infiniteCardLoader").remove();fkCollectionLoader=false},2000)}}};function calcTheProductInvoiceAmount(ele,key){$("input[name^=\"product\"]").each(function(){if($(this).is(":checked")){var id=$(this).val();var product=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==id});if(product.length===1&&product.length>0){price+=product[0][key]!=null?parseFloat(product[0][key]):0}else{$.each(product,function(i,product){price+=product[key]!=null?parseFloat(product[0][key]):0})}}});ele.innerText=parseFloat(price).toFixed(2)}function downloadURL(event,buttonObj){event.preventDefault();if(event.detail!==1){return}var URL=$(buttonObj).attr("data-downloadurl");if(URL){var linkElement=document.createElement("a");linkElement.href=URL;linkElement.download=true;linkElement.target="blank";document.body.appendChild(linkElement);linkElement.click();document.body.removeChild(linkElement)}else{alert("No URL found")}}function registerPageAnalytics(clickType,pageReferenceId){try{var _response=false;var analyticsReference=sessionStorage.getItem("analyticsReference");analyticsReference=analyticsReference?JSON.parse(analyticsReference):{};var pageRefData=analyticsReference[pageReferenceId];if(pageRefData){if(clickType===1&&pageRefData===1){analyticsReference[pageReferenceId]=2;_response=true}}else{analyticsReference[pageReferenceId]=1;_response=true}sessionStorage.setItem("analyticsReference",JSON.stringify(analyticsReference));return _response}catch(error){console.log(error)}}function registerClick(clickType,callback,pageInfo){var validCallback=callback&&typeof callback==="function";var pageId=pageInfo?pageInfo.pageTypeId:pageData&&pageData.pageTypeId;var pagesWithMissingOrderData=[3,5];var stringifyOrderData=sessionStorage.getItem("orderData");stringifyOrderData=stringifyOrderData!==null?stringifyOrderData:"";var orderDataOnUpsellAndThankYouPage=pagesWithMissingOrderData.includes(pageId)&&!stringifyOrderData;if(orderDataOnUpsellAndThankYouPage){validCallback&&callback();return}var stringifysessionId=sessionStorage.getItem("sessionId");stringifysessionId=stringifysessionId!==null?stringifysessionId:"";var sessionIdValue=sessionStorage.getItem("ccExternalSessionId")||"";var funnelReferenceId=pageData.funnelData?pageData.funnelData.referenceId:null;var pageReferenceId=pageInfo?pageInfo.referenceId:pageData.currentPage.referenceId;var logPageAnalytics=registerPageAnalytics(clickType,pageReferenceId+"-"+sessionIdValue);if(!document.URL.includes("funnels-build")&&logPageAnalytics){var pageTrackerData=JSON.stringify({"sessionStartDateTime":sessionStorage.getItem("sessionStartDateTime")||"","sessionId":stringifysessionId,"requestUri":sessionStorage.getItem("requestUri")||"","httpReferer":sessionStorage.getItem("httpReferer")||"","orderData":stringifyOrderData,"customerOrders":sessionStorage.getItem("customerOrders")||"","products":sessionStorage.getItem("products")||"","userDetails":sessionStorage.getItem("userDetails")||"","dateTimeNow":new Date().toJSON()});var url="".concat(rootUrl,"/SplitTest/clicks/")+funnelReferenceId+"/"+pageReferenceId+"/"+clickType;var MAX_PAYLOAD_SIZE=64*1024;var blobData=new Blob([pageTrackerData]);var beaconSuccess=false;if(blobData.size<=MAX_PAYLOAD_SIZE&&navigator.sendBeacon){beaconSuccess=navigator.sendBeacon(url,pageTrackerData)}if(beaconSuccess){validCallback&&callback()}else{fallBackAnalytics(url,pageTrackerData,validCallback,callback)}return}validCallback&&callback()}function fallBackAnalytics(url,pageTrackerData,validCallback,callback){httpMethod(url,pageTrackerData,getDefaultHeaders(true)).then(function(data){validCallback&&callback(data)})["catch"](function(err){validCallback&&callback(err)})}function previewURL(event){var URL=$(event).attr("data-previewurl");window.open(URL,"_blank")}var prevProdSelectValue=null;function loadProductsToCart(orderItems){var productSelects=_toConsumableArray(document.getElementsByName("productSelect"));var productInputs=[].concat(_toConsumableArray(document.getElementsByName("product")),_toConsumableArray(productSelects));if(productInputs){var deletedItems=[];//set the unchecked boxes
productInputs.forEach(function(product){var productValue=product.getAttribute("value");var variantValue=product.getAttribute("variantvalue");var quantity=product.getAttribute("quantity");if(productValue&&product.tagName.toLowerCase()==="input"){if(variantValue){productValue=productValue+"."+variantValue}if(!product.checked){if(orderItems[productValue]&&(!quantity||orderItems[productValue]==quantity)){deletedItems[productValue]=orderItems[productValue];delete orderItems[productValue]}orderItems=isSubscribeOn?swapSubscriptions(orderItems,productValue):orderItems}}});//set the checked boxes
productInputs.forEach(function(product){var productSelectValue=product.value;var productValue=product.getAttribute("value");var variantValue=product.getAttribute("variantvalue");var quantity=product.getAttribute("quantity");if(product.name==="productSelect"){var productSection=$(product).closest(".fk-product-section")[0];var orderBump=productSection&&$(productSection).closest(".bump-div-class")[0];var isOrderBumpChecked=orderBump&&$(orderBump).find("input[type='checkbox']")[0].checked;var productVariants=productSection&&$(productSection).find("[name='variant1'], [name='variant2'], [name='variant3']").filter("select");if((!productSection&&!orderBump||isOrderBumpChecked&&!productVariants.length)&&productSelectValue!==""&&!orderItems[productSelectValue]){var _quantity=productSection&&productSection.querySelectorAll("input[name='quantity'], select[name='quantity']");orderItems[productSelectValue]=_quantity&&_quantity[0]?_quantity[0].value:1;prevProdSelectValue&&prevProdSelectValue!==productSelectValue&&delete orderItems[prevProdSelectValue];prevProdSelectValue=productSelectValue}}if(productValue&&product.tagName.toLowerCase()==="input"){if(variantValue){productValue=productValue+"."+variantValue}if(product.checked){var productVariantElement=product.closest(".fk-product-variant-select");if(productVariantElement&&(!checkedElement||checkedElement.id!==product.id)){constructProductVariantElement(product,productVariantElement);checkedElement=product;var productTile=$(product).closest("section")[0];productValue=productTile&&productTile.value+"."+productTile.variantvalue}if(!orderItems[productValue]||quantity&&orderItems[productValue]!=quantity){orderItems[productValue]=quantity?quantity:deletedItems[productValue]?deletedItems[productValue]:1}}}});updateReplacementProducts(orderItems)}return orderItems}function getOrderItems(){var loadProducts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var orderItems={};var fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(fkCart&&Object.keys(fkCart).length>0){for(var sessionItemCpId in fkCart){orderItems[sessionItemCpId]=fkCart[sessionItemCpId]}}var notAnUpsellPage=pageData&&pageData.pageTypeId!==3;if(loadProducts&&notAnUpsellPage){orderItems=loadProductsToCart(orderItems)}orderItems=isSubscribeOn||isSubscribeOn===false?swapSubscriptions(orderItems):orderItems;notAnUpsellPage&&sessionStorage.setItem("fkCart",JSON.stringify(orderItems));return orderItems}function getUpsaleItems(){var paySource=sessionStorage.getItem("paySource");var orderItems=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};orderItems=loadProductsToCart(orderItems);if(paySource==="PAYPAL"&&sessionStorage.getItem("paypalUpsaleCart")){if(sessionStorage.getItem("upsalePaypalToken")&&sessionStorage.getItem("upsalePaypalPayerId")){orderItems=JSON.parse(sessionStorage.getItem("paypalUpsaleCart"))}}sessionStorage.setItem("upsalefkCart",JSON.stringify(orderItems));return orderItems}function mergeOfferUpsale(upsaleItems){var orderItems={};var fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(fkCart&&Object.keys(fkCart).length){for(var sessionItemCpId in fkCart){orderItems[sessionItemCpId]=fkCart[sessionItemCpId]}}if(upsaleItems&&Object.keys(upsaleItems).length){for(var upsaleItem in upsaleItems){orderItems[upsaleItem]=upsaleItems[upsaleItem]}}sessionStorage.setItem("fkCart",JSON.stringify(orderItems));sessionStorage.removeItem("upsalefkCart")}function getOrderItemDetails(){var loadProducts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var orderItems=getOrderItems(loadProducts);var stringOrderItems=JSON.stringify(orderItems);if(glOrderItems==stringOrderItems){return glDetailedOrderItems}glOrderItems=stringOrderItems;var products=pageData&&pageData.selectedCampaign?pageData.selectedCampaign.products:null;var detailedOrderItems={};if(products&&Object.keys(orderItems).length>0){var _loop12=function _loop12(){var sessionItemCpId=campaignProductId;var sessionItemVarId=0;if(sessionItemCpId.indexOf(".")>0){var _productData7=sessionItemCpId.split(".");sessionItemCpId=_productData7[0];sessionItemVarId=_productData7[1]}var productDetails=products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId)});if(Object.keys(productDetails).length>0){var obj=JSON.parse(JSON.stringify(productDetails[0]));//deep clone
obj=getMemberPrice(obj);detailedOrderItems[campaignProductId]=obj;detailedOrderItems[campaignProductId]["currentOrderQuantity"]=orderItems[campaignProductId];if(obj.variants&&sessionItemVarId>0){var variantDetails=obj.variants.filter(function(data){return data.variantDetailId===parseInt(sessionItemVarId)});if(Object.keys(variantDetails).length>0){variantDetails[0]=getMemberPrice(variantDetails[0]);detailedOrderItems[campaignProductId]["variant"]=variantDetails[0];if(obj.isEditable){detailedOrderItems[campaignProductId]["variant"]["price"]=obj.cycle1_price;detailedOrderItems[campaignProductId]["variant"]["shippingPrice"]=obj.cycle1_shipPrice}}}}else{delete orderItems[campaignProductId]}};for(var campaignProductId in orderItems){_loop12()}var _orderData7=JSON.stringify(orderItems);sessionStorage.setItem("fkCart",_orderData7);var multiPayRebillsEnabled=getAddOnKeyValue(findAddOn("multiPayRebills"));if(!multiPayRebillsEnabled&&prevOrderItems!==_orderData7){prevOrderItems=_orderData7;var afterpayButton=document.querySelectorAll(".afterpayButton");var afterPayPara=document.querySelectorAll("afterpay-placement");var display="block";if((afterpayButton||afterPayPara)&&orderItems&&Object.keys(orderItems).length>0){for(var itemId in orderItems){for(var _i66=0;_i66<Object.keys(products).length;_i66++){if(products[_i66].campaignProductId==itemId.split(".")[0]){if(products[_i66].billingCycleType==="RECURRING"){display="none";break}}}if(display==="none")break}}afterpayButton&&afterpayButton.forEach(function(btn){btn.style.display=display==="block"?"inline-block":"none"});afterPayPara&&afterPayPara.forEach(function(ele){ele.style.display=display})}}glDetailedOrderItems=detailedOrderItems;return detailedOrderItems}function populateProductVariants(variants){if(variants.length>0){for(var key in variants){var productvariants=pageData.selectedCampaign.products.find(function(data){return data.productId===parseInt(variants[key].productId)});if(productvariants){if(!productvariants.variants){pageData.selectedCampaign.products.find(function(data){return data.productId===parseInt(variants[key].productId)}).variants=[]}pageData.selectedCampaign.products.find(function(data){return data.productId===parseInt(variants[key].productId)}).variants.push(variants[key])}}}}function setOrderItemDetails(){var variationIds=[];var orderItems=getOrderItems();var products=pageData&&pageData.selectedCampaign?pageData.selectedCampaign.products:null;if(products&&Object.keys(orderItems).length>0){var _loop13=function _loop13(){var sessionItemCpId=campaignProductId;var sessionItemVarId=0;if(sessionItemCpId.indexOf(".")>0){var _productData8=sessionItemCpId.split(".");sessionItemCpId=_productData8[0];sessionItemVarId=_productData8[1]}var productDetails=products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId)});if(Object.keys(productDetails).length>0){var obj=JSON.parse(JSON.stringify(productDetails[0]));//deep clone
if((!obj.variants||obj.variants.length===0)&&sessionItemVarId>0){variationIds.push(sessionItemVarId)}}};for(var campaignProductId in orderItems){_loop13()}}return variationIds}function populateVariantAsync(variantDetailId){var params={};params.variantDetailId=variantDetailId;var variantParam=JSON.stringify(params);return httpMethod("".concat(providerUrl,"/Import/Product/Variant"),variantParam)}function getMemberPrice(obj){//look through all the cart products. Do any of them have a club?
obj.isMemberShipping=false;if(obj.memberPricing&&obj.memberPricing.length>0){var clubId=cookieData["clubId"];var membershipInfo=JSON.parse(sessionStorage.getItem("clubMemberships"));var clubProductId=membershipInfo?membershipInfo.map(function(product){return product.actualProductId})[0]:null;var _orderData8=JSON.parse(sessionStorage.getItem("orderData"));var activeMembership=false;if(_orderData8){activeMembership=_orderData8.activeMembership?_orderData8.activeMembership:null;if(activeMembership){clubId=clubId?clubId:activeMembership.clubId;clubProductId=clubProductId?clubProductId:activeMembership.clubProductId}}if(!clubProductId){var purchases=sessionStorage.getItem("customerPurchases")?JSON.parse(sessionStorage.getItem("customerPurchases")):null;if(purchases&&Object.keys(purchases).length>0){var purchaseEntries=Object.entries(purchases);var purchaseEntriesLength=purchaseEntries.length;for(var _i67=0;_i67<purchaseEntriesLength;_i67++){var purchase=purchaseEntries[_i67][1];if(["ACTIVE","TRIAL"].includes(purchase.status)&&purchase.clubPluginId==clubId){clubProductId=purchase.actualProductId;break}}}}fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(!clubProductId&&fkCart&&Object.keys(fkCart).length>0){var _loop14=function _loop14(sessionItemCpId){var productDetails=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(sessionItemCpId.split(".")[0])});if(Object.keys(productDetails).length>0){if(productDetails[0].clubPluginId){clubId=productDetails[0].clubPluginId;clubProductId=productDetails[0].productId;return 1;// break
}}};for(var sessionItemCpId in fkCart){if(_loop14(sessionItemCpId))break}}if(clubId&&clubProductId){var memberPrice=obj.memberPricing.find(function(data){return data.clubPluginId==clubId&&data.clubProductId==clubProductId});if(memberPrice){if(obj.variantDetailId){obj.compareAtPrice=obj.price;obj.price=memberPrice.price;obj.shippingPrice=memberPrice.shipPrice}else{obj.compareAtPrice=obj.cycle1_price;obj.cycle1_price=memberPrice.price;obj.cycle1_shipPrice=memberPrice.shipPrice}obj.isMemberShipping=memberPrice.isMemberShipping;if(memberPrice.isFreeShipping)obj.isFreeShipping=memberPrice.isFreeShipping}}}return obj}function getDiscounts(couponCode,orderItems,defaultCoupon,preventDefaultCouponRemoval,defaultCouponApplied,vatExists){if(!couponCode||Object.keys(orderItems).length===0)return new Promise(function(resolve,reject){resolve(false)});var validCouponCodes=couponCode;if(defaultCouponApplied&&preventDefaultCouponRemoval){validCouponCodes=defaultCoupon+","+validCouponCodes.split(",").filter(function(item){return item!==defaultCoupon}).join(",")}var params={};var index=0;var orderItemEntries=Object.entries(orderItems);var orderItemEntriesLength=orderItemEntries.length;for(var _i68=0;_i68<orderItemEntriesLength;_i68++){var campaignProductId=orderItemEntries[_i68][0];var _item9=orderItemEntries[_i68][1];index++;if(campaignProductId.indexOf(".")>0){var _productData9=campaignProductId.split(".");params["product"+index+"_id"]=_productData9[0];params["variant"+index+"_id"]=_productData9[1]}else{params["product"+index+"_id"]=campaignProductId}params["product"+index+"_qty"]=_item9.currentOrderQuantity;if(altValues[campaignProductId+"|"+_item9.currentOrderQuantity])params["product"+index+"_alt"]=getItemAlt(campaignProductId,_item9.currentOrderQuantity)}params=getBundleVariants(params,index).params;params.campaignId=pageData.selectedCampaign.campaignId;params.couponCode=validCouponCodes;var shippingProfileId=getCurrentShipProfile();params.shipProfileId=shippingProfileId&&shippingProfileId.includes("pickup-")?null:shippingProfileId;if(params.shipProfileId&&params.shipProfileId.indexOf(":")>0){var shipData=params.shipProfileId.split(":");params.shipProfileId=null;params.shipCarrier=shipData[1];params.shipMethod=shipData[3]}var shipAddress=getShipProfileAddress();params.shipState=shipAddress.state;params.shipCountry=shipAddress.country;if(cookieData["access_token"]&&cookieData["customerId"]){params.customerId=cookieData["customerId"]}params.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;params.cartId=pageData.pageTypeId===4?sessionStorage.getItem("cartId"):null;var couponParams=JSON.stringify(params);var existingParams=sessionStorage.getItem("couponParams");if(couponParams!==existingParams&&params.shipCountry){ccHandleLoader();sessionStorage.setItem("couponParams",couponParams);var _response2=httpMethod("".concat(providerUrl,"/Import/Coupon"),couponParams).then(function(data){if(data.result==="SUCCESS"){var couponCodes=validCouponCodes&&validCouponCodes.trim().split(",");var couponCodesLength=couponCodes.length;var amtToReduce=0;var apiDiscounts=sessionStorage.getItem("apiDiscounts")!==null&&JSON.parse(sessionStorage.getItem("apiDiscounts"));var responseCoupons=data.message.coupons;var couponsExist=responseCoupons&&Object.keys(responseCoupons).length>0;if(vatExists&&apiDiscounts&&couponsExist){var apiProdIds=apiDiscounts&&Object.keys(apiDiscounts);var apiProdIdsLength=apiProdIds.length;for(var coupon in responseCoupons){if(responseCoupons[coupon].appliesTo!=="shipping"){if(responseCoupons[coupon].products==="whole order"){for(var id in apiDiscounts){amtToReduce+=parseFloat(apiDiscounts[id])}}else{var prodIdArray=responseCoupons[coupon].products.split(",");var prodIdArrayLength=prodIdArray.length;for(var _i69=0;_i69<apiProdIdsLength;_i69++){for(var j=0;j<prodIdArrayLength;j++){var comparableId=void 0;if(apiProdIds[_i69]&&apiProdIds[_i69].indexOf(".")>0){var _productId9=apiProdIds[_i69].split(".");comparableId=_productId9[0]}else{comparableId=apiProdIds[_i69]}if(comparableId==prodIdArray[j]){amtToReduce+=parseFloat(apiDiscounts[apiProdIds[_i69]])}}}}}}}var discountCal=data.message.priceDiscount&&data.message.priceDiscount-amtToReduce;var ret={couponCode:"",priceDiscount:discountCal>=0?discountCal:0,shipDiscount:data.message.shipDiscount?data.message.shipDiscount:0,coupMessage:"",coupons:[]};if(couponsExist){var _i70=0;var _products3=pageData.selectedCampaign.products;var couponEntries=Object.entries(responseCoupons);var couponEntriesLength=couponEntries.length;for(var _j=0;_j<couponEntriesLength;_j++){var code=couponEntries[_j][0];var isDefaultCoupon=code===defaultCoupon&&preventDefaultCouponRemoval;var _coupon=couponEntries[_j][1];ret.coupMessage+="<span style='color:green;font-weight:bold;'>"+code+"</span> ";var coupProd=_coupon.products==="whole order"?"Order":getCouponProductNames(_products3,_coupon);ret.coupMessage+=_coupon.discount+" off "+(_coupon.appliesTo=="shipping"?"shipping ":"")+"on "+coupProd+(isDefaultCoupon||$("input[type=checkbox][name=product][coupon='"+code+"' i]:checked").length?"<br>":" <span style='color:red;font-weight:bold;cursor:pointer;' onclick='removeCoupon("+_i70+")'>X</span><br>");ret.coupons.push(code);_i70++}}if(responseCoupons&&Object.keys(responseCoupons).length!==couponCodesLength||!responseCoupons){var validCoupons=Object.keys(responseCoupons||[]);var invalidCoupons=[];for(var _i71=0;_i71<pageData.selectedCampaign.couponMax;_i71++){if(couponCodes[_i71]&&!validCoupons.includes(couponCodes[_i71].trim().toUpperCase())){invalidCoupons.push(couponCodes[_i71])}}var invalidCouponsLength=invalidCoupons.length;if(invalidCouponsLength>0){for(var _j2=0;_j2<invalidCouponsLength;_j2++){var _code=invalidCoupons[_j2];if(!(_code===defaultCoupon)){ret.coupMessage+="<span class='"+commonErrorClass+"' style='color:red;font-weight:bold;'>"+_code+"</span><span>, please enter a valid coupon code.</span><br>"}}}}sessionStorage.setItem("discountsObj",JSON.stringify(ret));return ret}else{alert(data.message);return sessionStorage.getItem("discountsObj")?JSON.parse(sessionStorage.getItem("discountsObj")):false}});return _response2}var discounts=sessionStorage.getItem("discountsObj")?JSON.parse(sessionStorage.getItem("discountsObj")):{couponCode:"",priceDiscount:0,shipDiscount:0,coupMessage:"",coupons:appliedCouponCode};return Promise.resolve(discounts)}function getCouponProductNames(products,coupon){var couponProducts=coupon.products.trim().split(",");var couponLabel="";var _loop15=function _loop15(key){var productName=products.find(function(row){return row.campaignProductId===parseInt(couponProducts[key])}).productName;if(productName)couponLabel+=productName+", "};for(var key in couponProducts){_loop15(key)}return couponLabel.slice(0,-2)}function applyCoupon(e){e.preventDefault();var existingCouponCodes=appliedCouponCode;var isEmptyCoupon=true;appliedCouponCode=[];var couponInputs=document.getElementsByName("couponCode");couponInputs.forEach(function(input){if(input.value){isEmptyCoupon=false;var couponCodes=input.value.trim().split(",");couponCodes=couponCodes.concat(existingCouponCodes);couponCodes=couponCodes.filter(function(couponCode){return couponCode.trim().length>0});couponCodes=couponCodes.map(function(couponCode){return couponCode.trim()});// remove whitespaces
couponCodes=couponCodes.filter(function(couponCode,index,coupons){return coupons.indexOf(couponCode)==index});// remove duplicates
if(couponCodes.length>0){appliedCouponCode=couponCodes}else{var coupMessage=document.getElementsByName("coupMessage");if(coupMessage.length){removeItems(coupMessage)}}input.value=""}});if(isEmptyCoupon)appliedCouponCode=existingCouponCodes;else displayPrices()}function removeCoupon(index){var revisedCouponCodes=[];var cCodes=appliedCouponCode?appliedCouponCode:[];for(var i in cCodes){if(i!=index)revisedCouponCodes.push(cCodes[i])}appliedCouponCode=revisedCouponCodes.length>0?revisedCouponCodes:[];document.getElementsByName("couponCode")[0].value=revisedCouponCodes.length>0?revisedCouponCodes.join():[];document.getElementsByName("coupMessage").forEach(function(messageArea){messageArea.innerHTML=""});displayPrices()}//returns shipping profile settings and rules based on selected shipProfileId or campaign's default shipping profile
//used in calculateTotals function as part of price display calculations
function getCurrentShipProfile(){//use shipProfileId input value if available
var profileInputs=document.getElementsByName("shipProfileId");var shipProfileId=profileInputs[0]&&(profileInputs[0].type!=="checkbox"||profileInputs[0].checked)?profileInputs[0].value:null;if(profileInputs.length>1){profileInputs.forEach(function(profile){if(profile.type==="radio"&&profile.checked){shipProfileId=profile.value}})}return shipProfileId}function getShipProfile(){var shipProfileId=getCurrentShipProfile();if(shipProfileId&&shipProfileId.indexOf(":")>0){return shipProfileId}//selectedCampaign shipProfiles property will be empty array when no shipping profiles configured in campaign
if(pageData.selectedCampaign.shipProfiles.length===0&&!globalStoreDetails.length)return null;//use campaign's default shipping profile if configured when no shipping profile selected
if((shipProfileId===""||shipProfileId===null)&&pageData.selectedCampaign.defaultShipProfileId!==null){shipProfileId=pageData.selectedCampaign.defaultShipProfileId}if(shipProfileId){var profile=pageData.selectedCampaign.shipProfiles.find(function(data){return data.shipProfileId===parseInt(shipProfileId)});if(typeof shipProfileId=="string"&&shipProfileId.startsWith("pickup-")){shipProfileId=shipProfileId.substring(7);profile=globalStoreDetails.find(function(data){return data.storePickupId===parseInt(shipProfileId)})}return profile?profile:null}else{return null}}//returns shipping address object with country, state, and continent properties
//used by applyShipProfileProductRules and getShipProfileOrderPrice functions to determine application of shipping profile regional price rules
function getShipProfileAddress(){var shipAddress={};var orderData=JSON.parse(sessionStorage.getItem("orderStatusInfo")||sessionStorage.getItem("orderData"));//use shipCountry input if available OR country input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipCountry")[0]){shipAddress.country=document.getElementsByName("shipCountry")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("country")[0]){shipAddress.country=document.getElementsByName("country")[0].value}else if(orderData&&orderData.shipCountry){shipAddress.country=orderData.shipCountry}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("country")[0]){shipAddress.country=document.getElementsByName("country")[0].value}else if(orderData&&orderData.country){shipAddress.country=orderData.country}else{shipAddress.country=defaultCountryCode}//use shipState input if available OR state input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipState")[0]){shipAddress.state=document.getElementsByName("shipState")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("state")[0]){shipAddress.state=document.getElementsByName("state")[0].value}else if(orderData&&orderData.shipState){shipAddress.state=orderData.shipState}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("state")[0]){shipAddress.state=document.getElementsByName("state")[0].value}else if(orderData&&orderData.state){shipAddress.state=orderData.state}else{shipAddress.state=""}//use shipCity input if available OR city input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipCity")[0]){shipAddress.city=document.getElementsByName("shipCity")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("city")[0]){shipAddress.city=document.getElementsByName("city")[0].value}else if(orderData&&orderData.shipCity){shipAddress.city=orderData.shipCity}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("city")[0]){shipAddress.city=document.getElementsByName("city")[0].value}else if(orderData&&orderData.city){shipAddress.city=orderData.city}else{shipAddress.city=""}//use shipAddress1 input if available OR address1 input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipAddress1")[0]){shipAddress.address1=document.getElementsByName("shipAddress1")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("address1")[0]){shipAddress.address1=document.getElementsByName("address1")[0].value}else if(orderData&&orderData.shipAddress1){shipAddress.address1=orderData.shipAddress1}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("address1")[0]){shipAddress.address1=document.getElementsByName("address1")[0].value}else if(orderData&&orderData.address1){shipAddress.address1=orderData.address1}else{shipAddress.address1=""}if(document.getElementsByName("shipAddress2")[0]){shipAddress.address2=document.getElementsByName("shipAddress2")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("address2")[0]){shipAddress.address2=document.getElementsByName("address2")[0].value}else if(orderData&&orderData.shipAddress2){shipAddress.address2=orderData.shipAddress2}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("address2")[0]){shipAddress.address2=document.getElementsByName("address2")[0].value}else if(orderData&&orderData.address2){shipAddress.address2=orderData.address2}else{shipAddress.address2=""}//use shipPostalCode input if available OR postalCode input if available and billing and shipping addresses are the same OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("shipPostalCode")[0]){shipAddress.postalCode=document.getElementsByName("shipPostalCode")[0].value}else if(document.getElementsByName("billShipSame")[0]&&document.getElementsByName("billShipSame")[0].checked&&document.getElementsByName("postalCode")[0]){shipAddress.postalCode=document.getElementsByName("postalCode")[0].value}else if(orderData&&orderData.shipPostalCode){shipAddress.postalCode=orderData.shipPostalCode}else if(!document.getElementsByName("billShipSame")[0]&&document.getElementsByName("postalCode")[0]){shipAddress.postalCode=document.getElementsByName("postalCode")[0].value}else if(orderData&&orderData.postalCode){shipAddress.postalCode=orderData.postalCode}else{shipAddress.postalCode=""}//use phoneNumber input if available OR use value set on previous page OR empty string when no value already set
if(document.getElementsByName("phoneNumber")[0]){if(phFormatByCountry==="true"){shipAddress.phoneNumber=document.getElementsByClassName("iti__selected-dial-code")[0]?document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML+document.getElementsByName("phoneNumber")[0].value:"";shipAddress.phoneNumber=shipAddress.phoneNumber?shipAddress.phoneNumber.replace(/^\+?1-?/g,"").replace(/[\(\)\-\s]/g,""):""}else{shipAddress.phoneNumber=document.getElementsByName("phoneNumber")[0].value}}else if(orderData&&orderData.phoneNumber){shipAddress.phoneNumber=orderData.phoneNumber}else{shipAddress.phoneNumber=""}//set the continent from selectedCampaign countries based on shipping address country
shipAddress.continent="";if(shipAddress.country){var selectedCampaignCountry=pageData.selectedCampaign.countries.find(function(data){return data.countryCode===shipAddress.country});if(selectedCampaignCountry)shipAddress.continent=selectedCampaignCountry.continent}if(orderData&&orderData.firstName){shipAddress.firstName=orderData.firstName}if(orderData&&orderData.lastName){shipAddress.lastName=orderData.lastName}return shipAddress}//returns orderItems array with updated shipping prices after applying ship profile rules
//used by calculateTotals function when a shipping profile is set and does not apply one shipping price to the entire order
function applyShipProfileProductRules(shipProfile,items){var shipProfileRules=shipProfile.rules;var update=false;//skip this block when ship profile has no regional or product price rules
if(shipProfileRules!==null){//get the shipping address state, country, and continent needed to determine application of regional price rules
var shipAddress=getShipProfileAddress();//loop through the order items and update cycle1_shipPrice based on any applicable price rules
var itemsEntries=Object.entries(items);var itemsEntriesLength=itemsEntries.length;for(var _i72=0;_i72<itemsEntriesLength;_i72++){var prod=itemsEntries[_i72][1];prod.itemCountThreshold=null;var appliedRule=null;//the ship profile with the most specific applicable price rule that will be applied to item's shipping price
var maxPStrength=0;//used to determine the most specific product price rule - Ex: campaign product specific rule has higher strength (5) than rule that applies to all products (1)
var maxRStrength=0;//used to determine the most specific regional rule - Ex: rule that applies only to state of Georgia has higher strength (3) than rule that applies to all of North America (1)
//loop through shipProfile rules and determine the most specific applicable rule if any
var shipProfileRulesLength=shipProfileRules&&shipProfileRules.length;var _loop16=function _loop16(){var rule=shipProfileRules[j];if(!verifyShipProfileThresholds(rule))return 0;// continue
var tags=prod.productTags&&prod.productTags.split(",")||[];var ruleTags=rule.productTypeSelect==="TAGS"&&rule.productTags&&rule.productTags.split(",")||[];var tag=tags.filter(function(ele){return ruleTags.includes(ele)});if(ruleTags.length&&!tag.length)return 0;// continue
var pStrength=0;//rule's product strength
var rStrength=0;//rule's region strength
//if rule matches shipping address continent OR country and/or state, assign that regional strength value
if(rule.region){//region value of rules that apply to entire continent all start with "REG_"
if(rule.region.substr(0,4)==="REG_"){if(rule.region.substr(4,2)!==shipAddress.continent)return 0;// continue
rStrength=1}else if(rule.zoneId){var zone=pageData.selectedCampaign.zones.find(function(data){return data.zoneId==rule.zoneId});if(zone&&zone.countryCodes.indexOf(shipAddress.country)>-1){rStrength=2;if(zone.stateCodes){if(shipAddress.state&&zone.stateCodes.indexOf(shipAddress.state)>-1){rStrength=3}else{return 0;// continue
}}}else{return 0;// continue
}}else{if(rule.region===shipAddress.country){rStrength=2;if(rule.state){if(rule.state===shipAddress.state){rStrength=3}else{return 0;// continue
}}}else{return 0;// continue
}}}if(rStrength>=maxRStrength){maxRStrength=rStrength}else{return 0;// continue
}if(rule.productTypeSelect==="SINGLE"&&prod.campaignProductId==rule.campaignProductId){pStrength=5}else if(rule.productTypeSelect==="TAGS"){pStrength=4}else if(rule.productTypeSelect==="CATEGORY"&&prod.productCategoryId==rule.productCategoryId){pStrength=4}else if(rule.productTypeSelect==="OFFERS"&&prod.productType==="OFFER"){pStrength=3}else if(rule.productTypeSelect==="UPSELLS"&&prod.productType==="UPSALE"){pStrength=2}else if(rule.productTypeSelect==="PRODUCTS"){pStrength=1}if(pStrength>maxPStrength){appliedRule=rule;maxPStrength=pStrength}else if(pStrength>0&&pStrength==maxPStrength&&evaluateShipThresholds(appliedRule,rule)){appliedRule=rule;maxPStrength=pStrength}},_ret;for(var j=0;j<shipProfileRulesLength;j++){_ret=_loop16();if(_ret===0)continue}//apply any applicable price rule - if upcharge, rule price is added to current item shipping price - otherwise, rule price overrides current item shipping price
prod.isUpcharge=false;if(appliedRule&&prod.cycle1_isShippable){update=true;var variantShipPrice=void 0;if(!prod.isMemberShipping){if(shipProfile.isUpcharge){prod.isUpcharge=true;prod.cycle1_shipPrice=parseFloat(prod.shippingPrice)+parseFloat(appliedRule.shipPrice);if(prod.variant&&parseFloat(prod.variant.shippingPrice)>0){variantShipPrice=prod.variant["shipPrice"]=prod.variant.shipPrice||prod.variant.shippingPrice;prod.variant.shippingPrice=parseFloat(variantShipPrice)+parseFloat(appliedRule.shipPrice)}}else{prod.cycle1_shipPrice=parseFloat(appliedRule.shipPrice);if(prod.variant&&parseFloat(prod.variant.shippingPrice)>0){prod.variant.shippingPrice=parseFloat(appliedRule.shipPrice)}prod.itemCountThreshold=appliedRule.itemCountThreshold?appliedRule.itemCountThreshold:null}}}}}//shipProfiles that only bill the highest shipping price item
if(shipProfile.highestShipPriceOnly){var maxShipCampaignProductId=null;//campaign product ID of item with highest shipping price
var maxShipPrice=0;//highest item shipping price
//loop through order items and determine which item has the highest shipping price
for(var _i73 in items){var _prod=items[_i73];var shipPrice=_prod.variant&&parseFloat(_prod.variant.shippingPrice)>0&&!_prod.isVariantBundle?_prod.variant.shippingPrice:_prod.cycle1_shipPrice;shipPrice=parseFloat(shipPrice);if(shipPrice>maxShipPrice){maxShipCampaignProductId=_i73;maxShipPrice=shipPrice}}//set the shipping price of all other items to zero
for(var _i74 in items){if(_i74!==maxShipCampaignProductId){items[_i74].cycle1_shipPrice=0;if(items[_i74].variant){items[_i74].variant.shippingPrice=0}}}}return{update:update,items:items}}//returns shipping price for the entire order
//used by calculateTotals function when a shipping profile is set and applies one shipping price to the entire order
function getShipProfileOrderPrice(shipProfile){var shipProfileRules=shipProfile.rules;if(shipProfileRules===null)return 0;//get the shipping address state, country, and continent needed to determine application of regional price rules
var shipAddress=getShipProfileAddress();var appliedRule=null;//the ship profile with the most specific applicable price rule that will be applied to item's shipping price
var maxRStrength=0;//used to determine the most specific regional rule - Ex: rule that applies only to state of Georgia has higher strength (3) than rule that applies to all of North America (1)
//loop through shipProfile rules and determine the most specific applicable rule if any
var shipProfileRulesLength=shipProfileRules.length;var _loop17=function _loop17(){var rule=shipProfileRules[_i75];if(!verifyShipProfileThresholds(rule))return 0;// continue
var rStrength=0;//rule's region strength
//if rule matches shipping address continent OR country and/or state, assign that regional strength value
if(rule.region){//region value of rules that apply to entire continent all start with "REG_"
if(rule.region.substr(0,4)==="REG_"){if(rule.region.substr(4,2)!==shipAddress.continent){return 0;// continue
}rStrength=1}else if(rule.zoneId){var zone=pageData.selectedCampaign.zones.find(function(data){return data.zoneId==rule.zoneId});if(zone&&zone.countryCodes.indexOf(shipAddress.country)>-1){rStrength=2;if(zone.stateCodes){if(shipAddress.state&&zone.stateCodes.indexOf(shipAddress.state)>-1){rStrength=3}else{return 0;// continue
}}}else{return 0;// continue
}}else{if(rule.region===shipAddress.country){rStrength=2;if(rule.state){if(rule.state===shipAddress.state){rStrength=3}else{return 0;// continue
}}}else{return 0;// continue
}}}if(rStrength>maxRStrength||rStrength==maxRStrength&&evaluateShipThresholds(appliedRule,rule)){maxRStrength=rStrength;appliedRule=rule}},_ret2;for(var _i75=0;_i75<shipProfileRulesLength;_i75++){_ret2=_loop17();if(_ret2===0)continue}return appliedRule?appliedRule.shipPrice:null}function evaluateShipThresholds(appliedRule,rule){//are the rule thresholds more applicable than the currently matched rule?
if(!appliedRule)return true;var valueThreshold=parseFloat(rule.valueThreshold);var weightThreshold=parseFloat(rule.weightThreshold);var maxWeightThreshold=parseFloat(rule.maxWeightThreshold);if(valueThreshold>0&&weightThreshold>0&&maxWeightThreshold>0)return valueThreshold>parseFloat(appliedRule.valueThreshold)&&weightThreshold>parseFloat(appliedRule.weightThreshold)&&maxWeightThreshold<parseFloat(appliedRule.maxWeightThreshold);if(valueThreshold>0&&weightThreshold>0)return valueThreshold>parseFloat(appliedRule.valueThreshold)&&weightThreshold>parseFloat(appliedRule.weightThreshold);if(valueThreshold>0&&maxWeightThreshold>0)return valueThreshold>parseFloat(appliedRule.valueThreshold)&&maxWeightThreshold<parseFloat(appliedRule.maxWeightThreshold);if(weightThreshold>0&&maxWeightThreshold>0)return weightThreshold>parseFloat(appliedRule.weightThreshold)&&maxWeightThreshold<parseFloat(appliedRule.maxWeightThreshold);if(valueThreshold>0)return valueThreshold>parseFloat(appliedRule.valueThreshold);if(weightThreshold>0)return weightThreshold>parseFloat(appliedRule.weightThreshold);if(maxWeightThreshold>0)return maxWeightThreshold<parseFloat(appliedRule.maxWeightThreshold);return false}function verifyShipProfileThresholds(rule){if(parseFloat(rule.valueThreshold)>0){var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;var valueThreshold=parseFloat((parseFloat(rule.valueThreshold)*exchangeRate).toFixed(2));var subTotal=0;var cartProducts=getOrderItemDetails();if(Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i76=0;_i76<cartProductsEntriesLength;_i76++){var _item10=cartProductsEntries[_i76][1];var unitPrice=_item10.variant&&parseFloat(_item10.variant.price)>0&&!_item10.isVariantBundle&&!_item10.isEditable?_item10.variant.price:_item10.cycle1_price;subTotal+=parseFloat(getItemPrice(cartProductsEntries[_i76][0],unitPrice,_item10.currentOrderQuantity).toFixed(2))}}if(valueThreshold>subTotal)return false}if(parseFloat(rule.weightThreshold)>0||parseFloat(rule.maxWeightThreshold)>0){var _subTotal=0;var _cartProducts=getOrderItemDetails();if(Object.keys(_cartProducts).length>0){var _cartProductsEntries=Object.entries(_cartProducts);var _cartProductsEntriesLength=_cartProductsEntries.length;for(var _i77=0;_i77<_cartProductsEntriesLength;_i77++){var _item11=_cartProductsEntries[_i77][1];var weight=_item11.variant&&parseFloat(_item11.variant.weight)>0&&!_item11.isVariantBundle?_item11.variant.weight:_item11.weight;var qty=_item11.variant&&parseFloat(_item11.variant.productQty)>1&&!_item11.isVariantBundle?_item11.variant.productQty:_item11.productQty;_subTotal+=parseFloat((weight*_item11.currentOrderQuantity*qty).toFixed(3))}}if(parseFloat(rule.weightThreshold)>_subTotal)return false;if(parseFloat(rule.maxWeightThreshold)>0&&parseFloat(rule.maxWeightThreshold)<=_subTotal)return false}return true}function getTaxRate(){var taxRate=0;var stateTaxRate=null;var allStatesTaxRate=null;var isVat;var vatTaxRate=1;//selectedCampaign taxes property will be empty array when no tax rates configured in campaign
if(pageData.selectedCampaign.taxes.length===0)return{isVat:isVat,vatTaxRate:vatTaxRate};//get the shipping address needed to figure out which regional tax rules apply
var shipAddress=getShipProfileAddress();if(shipAddress.country!==""){//filter to only tax profiles for shipping address country
var countryTaxRates=pageData.selectedCampaign.taxes.filter(function(data){return data.countryCode===shipAddress.country});if(countryTaxRates.length!==0){if(shipAddress.state!=="")stateTaxRate=countryTaxRates.find(function(data){return data.stateCode===shipAddress.state});//use specific state if available - otherwise, look for tax profile that applies to all states
if(stateTaxRate){isVat=stateTaxRate.isVat;taxRate=parseFloat(stateTaxRate.taxRate)}else{allStatesTaxRate=countryTaxRates.find(function(data){return data.stateCode==="*"});if(allStatesTaxRate){isVat=allStatesTaxRate.isVat;taxRate=parseFloat(allStatesTaxRate.taxRate)}}}else{//look for tax profile that applies to all countries
var allCountryTaxRates=pageData.selectedCampaign.taxes.filter(function(data){return data.countryCode==="*"});if(allCountryTaxRates.length!==0){isVat=allCountryTaxRates.isVat;taxRate=parseFloat(allCountryTaxRates.taxRate)}}}if(isVat){vatTaxRate=!pageData.selectedCampaign.taxServiceId?1+taxRate:1}var taxParams={isVat:isVat,vatTaxRate:vatTaxRate,taxRate:taxRate};return taxParams}function ccHandleLoader(){var loader=document.getElementsByClassName("ccGrandTotalLoader")[0];!loader&&$(".grandTotal").append("<span class='ccGrandTotalLoader fa fa-spinner fa-pulse fa-lg m-r-xs'></span>")}function calculateTax(_x36,_x37,_x38){return _calculateTax.apply(this,arguments)}function _calculateTax(){_calculateTax=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee27(orderItems,vatExists,discount){var _params,fullName,pos,failValidation,shipProfile,_JSON$parse6,shipTotal,index,sessionItemCpId,taxParams,existingParams,_data11,totals,finalSalesTax,subTotal,grandTotal,_shipTotal2,vat,vatPrices,vatShipPrices,exchangeRate,currencyCode,matchedCurrency,apiDiscounts,taxes,key,vatPrice,_key4,vatShipPrice,_key5,_key6,_totals;return _regeneratorRuntime().wrap(function _callee27$(_context31){while(1)switch(_context31.prev=_context31.next){case 0:_context31.prev=0;discount=discount||0;if(!(pageData.selectedCampaign&&pageData.pageTypeId===4&&Object.keys(orderItems).length>0&&!sessionStorage.getItem("ccConfirmPayPalCalled"))){_context31.next=62;break}_params={};if(document.getElementsByName("fullName")[0]){fullName=document.getElementsByName("fullName")[0].value.trim();pos=fullName.indexOf(" ");_params.firstName=pos>-1?fullName.substring(0,pos):fullName;_params.lastName=pos>-1?fullName.substring(pos+1):null}else{_params.firstName=document.getElementsByName("firstName")[0]?document.getElementsByName("firstName")[0].value:null;_params.lastName=document.getElementsByName("lastName")[0]?document.getElementsByName("lastName")[0].value:null}_params.emailAddress=document.getElementsByName("emailAddress")[0]?document.getElementsByName("emailAddress")[0].value:null;_params.shipProfileId=getCurrentShipProfile()||null;_params.address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;_params.address2=document.getElementsByName("address2")[0]?document.getElementsByName("address2")[0].value:null;_params.postalCode=document.getElementsByName("postalCode")[0]?document.getElementsByName("postalCode")[0].value:null;_params.city=document.getElementsByName("city")[0]?document.getElementsByName("city")[0].value:null;_params.state=document.getElementsByName("state")[0]?document.getElementsByName("state")[0].value:null;_params.country=document.getElementsByName("country")[0]?document.getElementsByName("country")[0].value:defaultCountryCode;if(document.getElementsByName("billShipSame")[0]){_params.billShipSame=document.getElementsByName("billShipSame")[0].checked?1:0}else if(document.getElementsByName("address1")[0]&&!document.getElementsByName("shipAddress1")[0]){_params.billShipSame=1}fetchLeadDetails(_params);if(pageData.selectedCampaign.taxServiceId){failValidation=!_params.shipAddress1||!_params.shipCity||!_params.shipPostalCode||!_params.shipCountry||ccGetCountryStates(_params.shipCountry).length&&!_params.shipState}else{failValidation=!_params.shipCountry}if(!failValidation){_context31.next=18;break}return _context31.abrupt("return",false);case 18:_params.campaignId=pageData.selectedCampaign.campaignId;_params.couponCode=appliedCouponCode.length>0?appliedCouponCode.toString():null;shipProfile=pageData.selectedCampaign?getShipProfile():null;if(shipProfile&&shipProfile.applyEntireOrder){_JSON$parse6=JSON.parse(sessionStorage.getItem("totals")),shipTotal=_JSON$parse6.shipTotal;_params.profileShipPrice=shipTotal.toString()}index=0;for(sessionItemCpId in orderItems){index++;_params["product"+index+"_id"]=orderItems[sessionItemCpId].campaignProductId;_params["product"+index+"_qty"]=orderItems[sessionItemCpId].currentOrderQuantity;if(orderItems[sessionItemCpId].variant!==undefined)_params["variant"+index+"_id"]=orderItems[sessionItemCpId].variant.variantDetailId;if(altValues[sessionItemCpId+"|"+orderItems[sessionItemCpId].currentOrderQuantity])_params["product"+index+"_alt"]=getItemAlt(sessionItemCpId,orderItems[sessionItemCpId].currentOrderQuantity)}_params=getBundleVariants(_params,index).params;if(cookieData["access_token"]&&cookieData["customerId"]){_params.customerId=cookieData["customerId"]}_params.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;_params.cartId=pageData.pageTypeId===4?sessionStorage.getItem("cartId"):null;if(vatExists){_params.getVatPrices=true}taxParams=JSON.stringify(_params);existingParams=sessionStorage.getItem("taxParams");if(!(taxParams!==existingParams)){_context31.next=57;break}ccHandleLoader();sessionStorage.setItem("taxParams",taxParams);_context31.next=36;return httpMethod("".concat(providerUrl,"/SalesTax/order"),taxParams);case 36:_data11=_context31.sent;if(!(_data11.result==="SUCCESS")){_context31.next=55;break}totals=JSON.parse(sessionStorage.getItem("totals"));finalSalesTax=0,subTotal=parseFloat(totals.subTotal),grandTotal=parseFloat(totals.grandTotal),_shipTotal2=parseFloat(totals.shipTotal),vat=0;vatPrices=_data11.message.vatPrices;vatShipPrices=_data11.message.vatShipPrices;exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;exchangeRate=parseFloat(exchangeRate);currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;matchedCurrency=pageData.selectedCampaign.currencies&&pageData.selectedCampaign.currencies.find(function(currency){return currency.currencyCode==currencyCode});if(!vatPrices){sessionStorage.removeItem("vatPrices");sessionStorage.removeItem("apiDiscounts");finalSalesTax=matchedCurrency&&!matchedCurrency.sendToGateway?parseFloat(_data11.message)*exchangeRate:parseFloat(_data11.message)}else{apiDiscounts=_data11.message.discounts;taxes=_data11.message.taxes;vatPrices&&sessionStorage.setItem("vatPrices",JSON.stringify(vatPrices));apiDiscounts&&sessionStorage.setItem("apiDiscounts",JSON.stringify(apiDiscounts));grandTotal-=subTotal+_shipTotal2;subTotal=0;_shipTotal2=0;for(key in vatPrices){vatPrice=parseFloat(vatPrices[key]&&vatPrices[key].replaceAll(",",""));subTotal+=vatPrice}for(_key4 in vatShipPrices){vatShipPrice=parseFloat(vatShipPrices[_key4]&&vatShipPrices[_key4].replaceAll(",",""));_shipTotal2+=vatShipPrice}for(_key5 in apiDiscounts){discount=Math.max(discount-parseFloat(apiDiscounts[_key5]),0)}for(_key6 in taxes){vat+=parseFloat(taxes[_key6])}grandTotal+=subTotal+_shipTotal2;if(matchedCurrency&&!matchedCurrency.sendToGateway){grandTotal*=exchangeRate;subTotal*=exchangeRate;discount*=exchangeRate;_shipTotal2*=exchangeRate;vat*=exchangeRate}totals.subTotal=subTotal.toFixed(2);totals.shipTotal=_shipTotal2.toFixed(2)}totals.grandTotal=(grandTotal-totals.salesTax+finalSalesTax).toFixed(2);totals.vat=vat.toFixed(2);totals.salesTax=finalSalesTax.toFixed(2);totals.discount=discount.toFixed(2);sessionStorage.setItem("ccExternalTax",totals.salesTax);sessionStorage.setItem("totals",JSON.stringify(totals));displayPricesApply();return _context31.abrupt("return",totals);case 55:_context31.next=62;break;case 57:_totals=JSON.parse(sessionStorage.getItem("totals"));_totals.discount=discount.toFixed(2);_totals.salesTax=(Number(sessionStorage.getItem("ccExternalTax"))||0).toFixed(2);sessionStorage.setItem("totals",JSON.stringify(_totals));return _context31.abrupt("return",_totals);case 62:return _context31.abrupt("return",false);case 65:_context31.prev=65;_context31.t0=_context31["catch"](0);console.log(_context31.t0);case 68:case"end":return _context31.stop()}},_callee27,null,[[0,65]])}));return _calculateTax.apply(this,arguments)}function getExternalShipping(){return _getExternalShipping.apply(this,arguments)}function _getExternalShipping(){_getExternalShipping=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee28(){var input,shipEngine,_params2,ip,_orderItems33,index,sessionItemCpId,_productData21,checkoutCurrency,symbol,shipParams,existingParams,_response9;return _regeneratorRuntime().wrap(function _callee28$(_context32){while(1)switch(_context32.prev=_context32.next){case 0:input=document.getElementsByName("shipProfileId")[0];if(!(!input||input.type!=="select-one")){_context32.next=3;break}return _context32.abrupt("return");case 3:shipEngine=getAddOnKeyValue(findAddOn("shipEngineEnabled"));if(!(shipEngine==="1")){_context32.next=33;break}_params2=getShipProfileAddress();_params2.shipAddress1=_params2.address1;_params2.shipCity=_params2.city;_params2.shipState=_params2.state;_params2.shipCountry=_params2.country;_params2.shipPostalCode=_params2.postalCode;_params2.shipFirstName="John";_params2.shipLastName="Smith";if(!(!_params2.shipCity&&!_params2.shipPostalCode&&!_params2.shipState)){_context32.next=18;break}_context32.next=16;return getIpPhysicalAddress();case 16:ip=_context32.sent;if(ip&&ip.zip_code){_params2.shipCity=ip.city;_params2.shipState=ip.region_code;_params2.shipCountry=ip.country_code;_params2.shipPostalCode=ip.zip_code}case 18:if(!(!_params2.shipCity||!_params2.shipPostalCode||!_params2.shipCountry||ccGetCountryStates(_params2.shipCountry).length&&!_params2.shipState)){_context32.next=20;break}return _context32.abrupt("return",false);case 20:_orderItems33=getOrderItems();index=0;for(sessionItemCpId in _orderItems33){index++;if(sessionItemCpId.indexOf(".")>0){_productData21=sessionItemCpId.split(".");_params2["product"+index+"_id"]=_productData21[0];_params2["variant"+index+"_id"]=_productData21[1]}else{_params2["product"+index+"_id"]=sessionItemCpId}_params2["product"+index+"_qty"]=_orderItems33[sessionItemCpId];if(altValues[sessionItemCpId+"|"+_orderItems33[sessionItemCpId]])_params2["product"+index+"_alt"]=getItemAlt(sessionItemCpId,_orderItems33[sessionItemCpId])}_params2=getBundleVariants(_params2,index).params;if(cookieData["access_token"]&&cookieData["customerId"]){_params2.customerId=cookieData["customerId"]}_params2.campaignId=pageData.selectedCampaign.campaignId;checkoutCurrency=returnCurrencyCode()||pageData.selectedCampaign.currency;_params2.currencyCode=checkoutCurrency;_params2.cartId=pageData.pageTypeId===4?sessionStorage.getItem("cartId"):null;symbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";shipParams=JSON.stringify(_params2);existingParams=sessionStorage.getItem("shipParams");if(shipParams!==existingParams){sessionStorage.setItem("shipParams",shipParams);_response9=httpMethod("".concat(providerUrl,"/SalesTax/Shiprate"),shipParams).then(function(data){$("[name=shipProfileId] option").each(function(){if($(this).val().includes(":")){$(this).remove()}});if(data.result==="SUCCESS"){var dataMessage=data.message;var dataMessageLen=dataMessage&&dataMessage.length;if(dataMessageLen){var updateShipProfileOptions=function updateShipProfileOptions(dataMessage,dataMessageLength,exchangeRate,isGatewaySendingCurrency,globalExchangeRate){for(var _i149=0;_i149<dataMessageLength;_i149++){var profile=dataMessage[_i149];var option=document.createElement("OPTION");var shipProfilePriceCal=parseFloat(profile.shippingAmount)*parseFloat(exchangeRate);var shipProfileDisplayPrice=shipProfilePriceCal.toFixed(2);option.value=profile.rateId+":"+profile.serviceType+":"+profile.shippingAmount+":"+profile.carrierName+":"+shipProfileDisplayPrice;option.innerHTML=profile.serviceType+" ("+ccFormatCurrency(shipProfileDisplayPrice,symbol)+")";input.add(option)}if(input.options.length>0&&input.value==""){var selectedIndex=input.options[0].value!=""?0:1;input.value=input.options[selectedIndex].value}};var ccExchangeRateList=JSON.parse(sessionStorage.getItem("ccExchangeRateList"))||{};var shipRateCurrencyCode=dataMessage[0].currencyCode;if(shipRateCurrencyCode&&shipRateCurrencyCode!==checkoutCurrency){var shipAndCheckoutCurrency=shipRateCurrencyCode+"|"+checkoutCurrency;if(!ccExchangeRateList[shipAndCheckoutCurrency]){httpMethod("".concat(providerUrl,"/Currency/exchangerate"),JSON.stringify({"currencyCode":checkoutCurrency,"baseCurrencyCode":shipRateCurrencyCode})).then(function(res){if(res.result==="SUCCESS"){updateShipProfileOptions(dataMessage,dataMessageLen,res.message);displayPrices();ccExchangeRateList[shipAndCheckoutCurrency]=res.message;sessionStorage.setItem("ccExchangeRateList",JSON.stringify(ccExchangeRateList))}})["catch"](function(err){err});return}else{updateShipProfileOptions(dataMessage,dataMessageLen,ccExchangeRateList[shipAndCheckoutCurrency])}}else{updateShipProfileOptions(dataMessage,dataMessageLen,1)}}}displayPrices()})}case 33:return _context32.abrupt("return",false);case 34:case"end":return _context32.stop()}},_callee28)}));return _getExternalShipping.apply(this,arguments)}function calculateTotals(){return _calculateTotals.apply(this,arguments)}function _calculateTotals(){_calculateTotals=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee29(){var subTotal,salesTax,shipTotal,discount,insurance,savings,compareAtTotal,totals,vat,pageTypeId,orderDataString,orderData,orderDiscount,skipConvert,discountPrice,apiDiscounts,_discount,totalShipping,shippableOrder,shipProfile,exchangeRate,currentOrderItems,taxParams,vatExists,shipData,orderStatus,checkoutFlow,currentOrderItemsLength,currentOrderItemsEntries,currentOrderItemsEntriesLength,shopifyItems,prevBundle,_ccProductPercentageValue,_i150,campaignProductId,_item22,unitPrice,shipPrice,currentOrderQuantity,_exchangeRate,sendingCurrencyTxn,productAltValue,productPrice,productQty,qty,storePickOpt,productShipPrice,compareAtPrice,freeShipThreshold,entireOrderShipPrice,defaultCoupon,checkoutPage,shippableCheckout,loadPayPalSdk,preventDefaultCouponRemoval,defaultCouponApplied,discounts,coupMessage,_exchangeRate2,applyCouponButton,couponCodeInput,_defaultCoupon,newTotalParams,discountedPrice,_newTotalParams;return _regeneratorRuntime().wrap(function _callee29$(_context33){while(1)switch(_context33.prev=_context33.next){case 0:subTotal=0;salesTax=0;shipTotal=0;discount=0;insurance=0;savings=0;compareAtTotal=0;totals=sessionStorage.getItem("totals")!==null&&JSON.parse(sessionStorage.getItem("totals"));vat=parseFloat(totals.vat||0);pageTypeId=pageData&&pageData.pageTypeId;if(document.getElementsByName("insureShipment")[0]&&document.getElementsByName("insureShipment")[0].checked===true){insurance=parseFloat(document.getElementById("shipmentInsurancePrice").value)}orderDataString=sessionStorage.getItem("orderData");orderData=orderDataString&&JSON.parse(orderDataString);if(!(pageTypeId==5)){_context33.next=23;break}if(!orderData){_context33.next=23;break}orderDiscount=orderData.discountPrice>=0?orderData.discountPrice:0;subTotal=parseFloat(orderData.subTotal)+parseFloat(orderDiscount);salesTax=parseFloat(orderData.taxTotal);shipTotal=parseFloat(orderData.shipTotal);discount=parseFloat(orderData.totalDiscount);skipConvert=orderData.currencyCode===(returnCurrencyCode()||pageData.selectedCampaign.currency);if(orderData.vatSubTotal){discountPrice=0;apiDiscounts=sessionStorage.getItem("apiDiscounts")!==null&&JSON.parse(sessionStorage.getItem("apiDiscounts"));if(apiDiscounts){for(_discount in apiDiscounts){discountPrice+=parseFloat(apiDiscounts[_discount])}}subTotal=parseFloat(orderData.vatSubTotal.replaceAll(",",""))-discountPrice;salesTax=0;discount-=discountPrice}return _context33.abrupt("return",prepareTotals(subTotal,vat,salesTax,shipTotal,discount,0,0,0,skipConvert));case 23:getExternalShipping();loadShipProfiles();totalShipping=0;shippableOrder=false;shipProfile=pageData.selectedCampaign?getShipProfile():null;exchangeRate=sessionStorage.getItem("exchangeRate")!==null?parseFloat(sessionStorage.getItem("exchangeRate")):1;currentOrderItems=getOrderItemDetails();taxParams=getTaxRate();vatExists=taxParams.isVat;if(shipProfile&&typeof shipProfile==="string"&&shipProfile.indexOf(":")>0){shipData=shipProfile.split(":");totalShipping=parseFloat(shipData[4]);shipProfile=null;if(pageData.selectedCampaign.defaultShipProfileId!==null){shipProfile=pageData.selectedCampaign.shipProfiles.find(function(data){return data.shipProfileId===parseInt(pageData.selectedCampaign.defaultShipProfileId)});if(shipProfile){shipProfile.applyEntireOrder=1}}}orderStatus=orderData&&["COMPLETE","PENDING","COD_PENDING"].includes(orderData.orderStatus),checkoutFlow=[2,3,4].includes(pageTypeId);currentOrderItemsLength=Object.keys(currentOrderItems).length;if(currentOrderItemsLength){//when shipping profile is set and does not apply to entire order, get currentOrderItems with updated shipping prices after applying ship profile rules
if(shipProfile&&!shipProfile.applyEntireOrder)currentOrderItems=applyShipProfileProductRules(shipProfile,currentOrderItems).items;//total up subTotal (price) and shipTotal (shipping)
currentOrderItemsEntries=Object.entries(currentOrderItems);currentOrderItemsEntries.sort(function(list1,list2){return(list1[1].isPricePercent||0)-(list2[1].isPricePercent||0)});currentOrderItemsEntriesLength=currentOrderItemsEntries.length,shopifyItems=pageData.cartData&&pageData.cartData.itemsInfo||{};_ccProductPercentageValue=null;for(_i150=0;_i150<currentOrderItemsEntriesLength;_i150++){campaignProductId=currentOrderItemsEntries[_i150][0];_item22=currentOrderItemsEntries[_i150][1];unitPrice=0,shipPrice=0;if(!_item22.isVariantBundle||!prevBundle||prevBundle!=_item22.campaignProductId){unitPrice=_item22.variant&&parseFloat(_item22.variant.price)>0&&!_item22.isVariantBundle&&!_item22.isEditable?_item22.variant.price:_item22.cycle1_price;shipPrice=_item22.variant&&parseFloat(_item22.variant.shippingPrice)>0&&!_item22.isVariantBundle?_item22.variant.shippingPrice:_item22.cycle1_shipPrice}prevBundle=_item22.campaignProductId;currentOrderQuantity=!_item22.isVariantBundle?_item22.currentOrderQuantity:1;if(checkoutFlow&&_item22.isPricePercent===1&&!shopifyItems[campaignProductId]){if(_ccProductPercentageValue===null){if(orderStatus){_exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||1;sendingCurrencyTxn=orderData.currencyCode===(returnCurrencyCode()||pageData.selectedCampaign.currency);_ccProductPercentageValue=Number((Number(orderData.subTotal)*(sendingCurrencyTxn?1:_exchangeRate)).toFixed(2))||0}else{_ccProductPercentageValue=Number(subTotal)||0}sessionStorage.setItem("ccCartProductsPercentageTotal",_ccProductPercentageValue)}productAltValue=altValues[campaignProductId+"|"+currentOrderQuantity];productPrice=Number(_item22.cycle1_price)||0,productQty=currentOrderQuantity;if(productAltValue){productPrice=Number(productAltValue.split("|")[0])||0;productQty=1}subTotal+=parseFloat(((_ccProductPercentageValue||0)*productPrice*.01*productQty).toFixed(2))}else{subTotal+=parseFloat(getItemPrice(campaignProductId,unitPrice,currentOrderQuantity).toFixed(2));sessionStorage.setItem("ccCartProductsPercentageTotal",Number(subTotal))}qty=shipProfile&&!shipProfile.applyEntireOrder&&_item22.isUpcharge?1:_item22.currentOrderQuantity;shipPrice=shipProfile&&!shipProfile.applyEntireOrder&&_item22.isUpcharge&&_item22.currentOrderQuantity>1?shipPrice+parseFloat(_item22.shippingPrice*(_item22.currentOrderQuantity-1)):shipPrice;storePickOpt=shipProfile&&shipProfile.storePickupId&&_item22.allowStorePickup=="1"&&_item22.billingCycleType==="ONE_TIME";productShipPrice=_item22.isFreeShipping||storePickOpt?0:parseFloat(getShipPrice(shipPrice,qty,true,_item22));shipTotal+=productShipPrice;shippableOrder=_item22.cycle1_isShippable?true:shippableOrder;compareAtPrice=_item22.compareAtPrice&&parseFloat(_item22.compareAtPrice)>0?_item22.compareAtPrice:unitPrice;compareAtPrice=_item22.variant&&_item22.variant.compareAtPrice&&parseFloat(_item22.variant.compareAtPrice)>0&&!_item22.isVariantBundle?_item22.variant.compareAtPrice:compareAtPrice;compareAtTotal+=parseFloat(getItemPrice(campaignProductId,compareAtPrice,_item22.currentOrderQuantity).toFixed(2));savings=compareAtTotal>subTotal?compareAtTotal-subTotal:0}}else if(!orderStatus){sessionStorage.setItem("ccCartProductsPercentageTotal",0)}if(shipProfile){//when shipping profile applies one shipping price to the entire order
freeShipThreshold=shipProfile.freeShipThreshold?parseFloat((parseFloat(shipProfile.freeShipThreshold)*exchangeRate).toFixed(2)):0;if(shipProfile.applyEntireOrder){entireOrderShipPrice=totalShipping>0?totalShipping:parseFloat(getShipProfileOrderPrice(shipProfile)*exchangeRate);//if upcharge, shipping profile price is added to current order shipping total
if(shipProfile.isUpcharge){shipTotal+=entireOrderShipPrice}else if((entireOrderShipPrice||entireOrderShipPrice===0)&&(shipProfile.rules!==null||freeShipThreshold==0)){//otherwise, shipping profile price overrides current order shipping total
shipTotal=entireOrderShipPrice}}//when shipping profile freeShipThreshold is set, if order subTotal is greater than or equal to freeShipThreshold, order's shipping is free - Ex: Free shipping for orders $50 and over
if(!shipProfile.includeCoupons&&freeShipThreshold>0&&subTotal>=freeShipThreshold)shipTotal=0}else if(totalShipping>0){shipTotal=totalShipping}if($("input[type=checkbox][freeshipping=true]").is(":checked")||!shippableOrder)shipTotal=0;//total amount (price) without shipping or discounts is taxable
defaultCoupon=pageData.selectedCampaign.defaultCouponCode,checkoutPage=pageTypeId==4;if(currentOrderItemsLength&&$(".btnPayPal, .btnPayPal2").length&&Number(pageData.selectedCampaign.captureOnShipment)&&checkoutPage){shippableCheckout=sessionStorage.getItem("ccShippableCheckout");loadPayPalSdk=shippableCheckout===null?shippableOrder===false:shippableOrder!==(shippableCheckout==="true");if(loadPayPalSdk){sessionStorage.setItem("ccShippableCheckout",shippableOrder);configurePayPalSmartButtons()}}preventDefaultCouponRemoval=getAddOnKeyValue(findAddOn("PRE_COUPON_REMOVAL"))==="true";defaultCouponApplied=appliedCouponCode.includes(defaultCoupon);$("input[type=checkbox][name=product][coupon]:checked").each(function(){var coupon=this.getAttribute("coupon");coupon=coupon&&coupon.trim().toUpperCase();if(coupon&&!appliedCouponCode.includes(coupon))appliedCouponCode.splice(0,0,coupon)});if(checkoutPage){if(preventDefaultCouponRemoval&&defaultCoupon&&!defaultCouponApplied){appliedCouponCode.splice(0,0,defaultCoupon);defaultCouponApplied=true}if(window.ccApplyIdmeCouponOnAppliedCoupons){appliedCouponCode=ccApplyIdmeCouponOnAppliedCoupons(appliedCouponCode,defaultCouponApplied,preventDefaultCouponRemoval)}}if(!(appliedCouponCode&&checkoutPage)){_context33.next=62;break}prepareTotals(subTotal,vat,salesTax,shipTotal,discount,insurance,savings,compareAtTotal);_context33.next=48;return getDiscounts(appliedCouponCode.toString(),currentOrderItems,defaultCoupon,preventDefaultCouponRemoval,defaultCouponApplied,vatExists);case 48:discounts=_context33.sent;coupMessage=document.getElementsByName("coupMessage");if(discounts){discount+=discounts.priceDiscount+discounts.shipDiscount;//Reduce taxable by price discount
_exchangeRate2=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;if(discounts.coupMessage){if(coupMessage.length){removeItems(coupMessage)}applyCouponButton=$("button[action=applyCoupon]");couponCodeInput=$("[name=couponCode]");if(applyCouponButton.length&&couponCodeInput.length){applyCouponButton.after("<span name='coupMessage'><br>"+discounts.coupMessage+"</span>")}else if(couponCodeInput.length){couponCodeInput.after("<span name='coupMessage'><br>"+discounts.coupMessage+"</span>")}}else if(coupMessage.length){removeItems(coupMessage)}appliedCouponCode=discounts.coupons}else{if(coupMessage.length){removeItems(coupMessage)}_defaultCoupon=pageData.selectedCampaign.defaultCouponCode;appliedCouponCode=_defaultCoupon&&appliedCouponCode.includes(_defaultCoupon)?handleCouponSplit(_defaultCoupon):[]}_context33.next=53;return calculateTax(currentOrderItems,vatExists,discount);case 53:newTotalParams=_context33.sent;if(newTotalParams){vat=parseFloat(newTotalParams.vat);salesTax=parseFloat(newTotalParams.salesTax);subTotal=parseFloat(newTotalParams.subTotal);discount=parseFloat(newTotalParams.discount);shipTotal=parseFloat(newTotalParams.shipTotal);savings=compareAtTotal>subTotal?compareAtTotal-subTotal:0}if(freeShipThreshold>0){discountedPrice=!pageData.selectedCampaign.ccCurrencySendToGateway?parseFloat((discount*exchangeRate).toFixed(2)):discount;shipProfile&&shipProfile.includeCoupons&&subTotal-discountedPrice>=freeShipThreshold?shipTotal=0:null}calculateShipInsurance(subTotal);prepareTotals(subTotal,vat,salesTax,shipTotal,discount,insurance,savings,compareAtTotal);displayPricesApply();return _context33.abrupt("return",true);case 62:_context33.next=64;return calculateTax(currentOrderItems,vatExists,discount);case 64:_newTotalParams=_context33.sent;if(_newTotalParams){vat=parseFloat(_newTotalParams.vat);salesTax=parseFloat(_newTotalParams.salesTax);subTotal=parseFloat(_newTotalParams.subTotal);discount=parseFloat(_newTotalParams.discount);shipTotal=parseFloat(_newTotalParams.shipTotal);savings=compareAtTotal>subTotal?compareAtTotal-subTotal:0}freeShipThreshold>0&&shipProfile&&shipProfile.includeCoupons&&subTotal>=freeShipThreshold?shipTotal=0:null;calculateShipInsurance(subTotal);return _context33.abrupt("return",prepareTotals(subTotal,vat,salesTax,shipTotal,discount,insurance,savings,compareAtTotal));case 69:case"end":return _context33.stop()}},_callee29)}));return _calculateTotals.apply(this,arguments)}function removeItems(items,limit,removeLabel){var index=limit?limit:0;for(var _i78=items.length-1;_i78>=index;_i78--){!removeLabel&&items[_i78].remove();removeLabel&&$(items[_i78]).closest(".fk-element-container").remove()}}function prepareTotals(subTotal,vat,salesTax,shipTotal,discount,insurance,savings,compareAtTotal,skipConvert){subTotal=parseFloat(subTotal.toFixed(2));vat=parseFloat(vat.toFixed(2));salesTax=parseFloat(salesTax.toFixed(2));shipTotal=parseFloat(shipTotal.toFixed(2));discount=parseFloat(discount.toFixed(2));insurance=parseFloat(insurance.toFixed(2));savings=parseFloat(savings.toFixed(2));compareAtTotal=parseFloat(compareAtTotal.toFixed(2));if(sessionStorage.getItem("exchangeRate")&&!skipConvert){var exchangeRate=sessionStorage.getItem("exchangeRate");subTotal=pageData.pageTypeId===5?parseFloat((subTotal*exchangeRate).toFixed(2)):subTotal;discount=!pageData.selectedCampaign.ccCurrencySendToGateway?parseFloat((discount*exchangeRate).toFixed(2)):discount;shipTotal=pageData.pageTypeId===5?parseFloat((shipTotal*exchangeRate).toFixed(2)):shipTotal;salesTax=pageData.pageTypeId===5?parseFloat((salesTax*exchangeRate).toFixed(2)):salesTax;vat=pageData.pageTypeId===5?parseFloat((vat*exchangeRate).toFixed(2)):vat}var grandTotal=(subTotal+shipTotal+salesTax+insurance-discount).toFixed(2);var totals={subTotal:subTotal,vat:vat,salesTax:salesTax,shipTotal:shipTotal,grandTotal:grandTotal,discount:discount,insurance:insurance,savings:savings,compareAtTotal:compareAtTotal};sessionStorage.setItem("totals",JSON.stringify(totals));return totals}function displayPrices(_x39){return _displayPrices.apply(this,arguments)}function _displayPrices(){_displayPrices=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee30(evaluateFFL){var upsellProduct,upsellVariant,upsellQuantity,buttonsAndLinks,_orderItems34;return _regeneratorRuntime().wrap(function _callee30$(_context34){while(1)switch(_context34.prev=_context34.next){case 0:if(!(pageData.pageTypeId==3)){_context34.next=22;break}if(!($(".dynamic-price-total, .dynamic-shipping-total, .vat, .salesTax, .grandTotal, .discount, .insurance, .savings, .compareAtTotal").length==0)){_context34.next=3;break}return _context34.abrupt("return");case 3:upsellQuantity=getQuantity();buttonsAndLinks=document.querySelectorAll("button,a");buttonsAndLinks.forEach(function(element){var productButtonValue=element.getAttribute("upsell");if(productButtonValue&&parseInt(productButtonValue)>0){upsellProduct=productButtonValue;upsellVariant=parseInt(element.getAttribute("variant"));if(parseInt(element.getAttribute("quantity"))>0)upsellQuantity=parseInt(element.getAttribute("quantity"))}});if(!upsellProduct){_context34.next=19;break}_orderItems34={};upsellProduct+=upsellVariant?"."+upsellVariant:"";_orderItems34[upsellProduct]=upsellQuantity;sessionStorage.setItem("fkCartSave",sessionStorage.getItem("fkCart"));sessionStorage.setItem("fkCart",JSON.stringify(_orderItems34));_context34.next=14;return calculateTotals();case 14:displayPricesApply();sessionStorage.setItem("fkCart",sessionStorage.getItem("fkCartSave"));sessionStorage.removeItem("fkCartSave");_context34.next=20;break;case 19:displayPricesApply();case 20:_context34.next=26;break;case 22:_context34.next=24;return calculateTotals();case 24:if(!appliedCouponCode||appliedCouponCode.length===0||[5,9].includes(pageData.pageTypeId))displayPricesApply();if(window.ltk){callLisTrakConversion(window.ltk,"CaptureEmail");callLisTrakConversion(window.ltk,"UpdateCart")}case 26:!evaluateFFL&&evaluateFFLSectionDisplay();renderPopupCartDetails();case 28:case"end":return _context34.stop()}},_callee30)}));return _displayPrices.apply(this,arguments)}function displayPricesApplyMethod(){convertStaticCurrencyValues();ccUpdateTokenSpanValues();ccUpdateTokenSpanValues("[data-cc-perc-prod]");var _JSON$parse=JSON.parse(sessionStorage.getItem("totals")),subTotal=_JSON$parse.subTotal,vat=_JSON$parse.vat,salesTax=_JSON$parse.salesTax,shipTotal=_JSON$parse.shipTotal,grandTotal=_JSON$parse.grandTotal,discount=_JSON$parse.discount,insurance=_JSON$parse.insurance,savings=_JSON$parse.savings,compareAtTotal=_JSON$parse.compareAtTotal;var symbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol?pageData.selectedCampaign.currencySymbol:"$";if(cellFormat.length>0){cartDisplay()}var pageTypeId=pageData.pageTypeId;$(".cc-cart-container").length&&ccDisplayCustomCart();pageTypeId===9&&confirmation();if(document.getElementsByClassName("panelCartCircle")[0]){panelCartCircleUpdate()}var totalAmountElement=document.getElementById("totalAmountIs");if(totalAmountElement)totalAmountElement.innerHTML=ccFormatCurrency(parseFloat(subTotal).toFixed(2),symbol);var shippingChargesElement=document.getElementById("shippingCharges");if(shippingChargesElement)shippingChargesElement.innerHTML=ccFormatCurrency(parseFloat(shipTotal).toFixed(2),symbol);var thankyouPage=pageTypeId===5;var orderSavings=thankyouPage?ccSavings:savings;var priceElementClassMap=[["dynamic-price-total",subTotal],["dynamic-shipping-total",shipTotal],["vat",vat],["salesTax",salesTax],["grandTotal",grandTotal],["discount",discount],["insurance",insurance],["savings",orderSavings],["cc-negative-savings",orderSavings],["compareAtTotal",thankyouPage?ccCompareAtTotal:compareAtTotal]];if(pageTypeId===4){var taxObj=getTaxRate();priceElementClassMap.push(["salesTaxPercent",(taxObj.isVat?0:taxObj.taxRate*100)+"%"])}var priceElementClassMapLength=priceElementClassMap.length;for(var _i79=0;_i79<priceElementClassMapLength;_i79++){var key=priceElementClassMap[_i79][0];var value=priceElementClassMap[_i79][1];var displayElements=document.getElementsByClassName(key);var displayElementsLength=displayElements.length;if(displayElementsLength>0){for(var j=0;j<displayElementsLength;j++){var element=displayElements[j];var replaceTax=!element.classList.contains("vat")||parseFloat(salesTax)>0;if($(element).closest(".cc-invoice-details-block").length)continue;if(["discount","cc-negative-savings"].includes(key)&&parseFloat(value)>0){element.innerHTML="-"+ccFormatCurrency(parseFloat(value).toFixed(2),symbol)}else if(key==="salesTaxPercent"){element.innerHTML=value}else if(key!=="salesTax"||replaceTax){var _price4=parseFloat(value).toFixed(2);var showFreeLabel=$(element).hasClass("cc-cart-row-free-label")&&Number(_price4)===0&&["dynamic-price-total","dynamic-shipping-total","grandTotal"].includes(key)?"FREE":null;element.innerHTML=showFreeLabel?showFreeLabel:ccFormatCurrency(_price4,symbol)}}}}pageTypeId===9&&getLoginOrderDetails();displayGatewayScripts()}function addProduct(event){displayPrices()}function addToCart(event){var campaignProductId=event.target.value;var orderItems=getOrderItems();orderItems[campaignProductId]=1;sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices()}function deselectVariantRadioTiles(campaignProductId){var productId=campaignProductId&&campaignProductId.split(".")[0];if(!productId){return}var section=$("section[name='product'][value='"+productId+"']");var tilesInputs=section&&section.length&&section.find("input[type='radio'][class='variant-radio']");var tilesInputLength=tilesInputs&&tilesInputs.length||0;for(var _i80=0;_i80<tilesInputLength;_i80++){var _item12=tilesInputs[_i80];_item12.checked=false;var styleObj={"box-shadow":"none"};var radioName=_item12.name.toLowerCase();radioName=radioName.split("-")[0];if(radioName==="color"&&!$(_item12).closest("[varianttype]").hasClass("ccNoColorTile")){styleObj["border"]="2px solid rgb(197, 202, 205)"}else{styleObj["background-color"]="transparent"}$(_item12.parentElement).css(styleObj);_item12.parentElement.dataset.selected="false"};}function removeFromCart(campaignProductId){ccHandleButtonStylesForRemovedProducts(campaignProductId);var orderItems=getOrderItems();delete orderItems[campaignProductId];sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices();deselectVariantRadioTiles(campaignProductId);openNav()}function ccQtyInputHandler(e,increment){e.preventDefault();var fieldName=$(e.target).data("field");var parent=$(e.target).closest("div");var currentVal=parseInt(parent.find("input[name="+fieldName+"]").val(),10);var input=parent.find("input[name="+fieldName+"]");if(!isNaN(currentVal)){increment?input.val(currentVal+1):currentVal>0?input.val(currentVal-1):null}else{input.val(1)}}function plusQuantity(campaignProductId,sectionId,fromSection,event){var orderItems=getOrderItems();var isVariantBundle1=event&&$(event.target).closest(".fk-variant-bundle1")[0];var isFinalCheckout=pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length;if(fromSection){ccQtyInputHandler(event,true);getVariants(sectionId,true)}campaignProductId=campaignProductId||sessionStorage.getItem("productAndVariantId");var currentQty=parseInt(orderItems[campaignProductId]);if(orderItems[campaignProductId]){if(orderItems[campaignProductId]<999){orderItems[campaignProductId]=(currentQty+1).toString()}}else orderItems[campaignProductId]=1;if(!fromSection||!isVariantBundle1&&isFinalCheckout){sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices()}sessionStorage.removeItem("productAndVariantId")}function minusQuantity(campaignProductId,element,sectionId,fromSection,event){var orderItems=getOrderItems();var isVariantBundle1=event&&$(event.target).closest(".fk-variant-bundle1")[0];var isFinalCheckout=pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length;if(fromSection){ccQtyInputHandler(event);getVariants(sectionId,true)}campaignProductId=sessionStorage.getItem("productAndVariantId")||campaignProductId;if(parseInt(orderItems[campaignProductId])>1||$(element).closest(".fk-shopping-cart-quantity-wrapper-class").length===0){if(orderItems[campaignProductId]){var currentQty=parseInt(orderItems[campaignProductId]);orderItems[campaignProductId]=(currentQty-1).toString();if(orderItems[campaignProductId]<1)delete orderItems[campaignProductId]}if(!fromSection||!isVariantBundle1&&isFinalCheckout){sessionStorage.setItem("fkCart",JSON.stringify(orderItems));displayPrices()}}else{element.setAttribute("disabled","true")}sessionStorage.removeItem("productAndVariantId")}function panelCartCircleUpdate(){var cartProducts=getOrderItemDetails();var numberOfCartItems=0;if(cartProducts&&Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;var prevBundleProduct;var bundleArray=[];for(var _i81=0;_i81<cartProductsEntriesLength;_i81++){var _product12=cartProductsEntries[_i81][1];var isVariantBundle=_product12&&_product12.isVariantBundle;var campaignProductId=cartProductsEntries[_i81][0];var showBundleInCart=isVariantBundle&&(!prevBundleProduct||prevBundleProduct!=_product12.campaignProductId&&!bundleArray[campaignProductId]);if(showBundleInCart){numberOfCartItems+=1;bundleArray.push(campaignProductId)}else if(isVariantBundle){continue}else{numberOfCartItems+=parseInt(cartProductsEntries[_i81][1].currentOrderQuantity)}prevBundleProduct=_product12&&_product12.campaignProductId}document.getElementsByClassName("panelCartCircle")[0].innerHTML=numberOfCartItems}else{document.getElementsByClassName("panelCartCircle")[0].innerHTML=0}}function updateCSSForShoppingCartSections(element){$(element).css({"overflow-wrap":"normal","word-wrap":"normal","word-break":"normal"})}function createCustomProperties(customCartProperty,accordionDynamicCartRow,accordionEmptyDynamicCartData,accordionDynamicCartData,customProperties,firstProperty,rebillCartFrequency,trialOfferLabel){if(customCartProperty){var quantity;var newDynamicHorizontalLine=document.createElement("hr");var productDetails=customCartProperty.split("|");productDetails.splice(0,1);var productDetailsLength=productDetails.length;for(var j=0;j<productDetailsLength;j++){if(j==0){quantity=document.createElement("p");quantity.innerHTML="<b>Quantity</b>"+": "+productDetails[j];customProperties.appendChild(quantity)}else{var customPropertiesData=document.createElement("p");var productDetailsCollection=productDetails[j].split(":");if(productDetailsCollection.length>2){productDetailsCollection=productDetailsCollection.slice(0,2)}var productDetailsString=productDetailsCollection.join(":");var highlightPropertyName="<b>"+productDetailsCollection[0]+"</b>";var formattedProperty=productDetailsString.replace(productDetailsCollection[0],highlightPropertyName);customPropertiesData.innerHTML=formattedProperty.replaceAll(":",": ");customProperties.appendChild(customPropertiesData)}!firstProperty&&j==0&&quantity.prepend(newDynamicHorizontalLine);accordionDynamicCartData.appendChild(customProperties);accordionDynamicCartRow.appendChild(accordionEmptyDynamicCartData);accordionDynamicCartRow.appendChild(accordionDynamicCartData)}}var createAccordionCartRow=function createAccordionCartRow(message){var customPropertiesData=document.createElement("p");customPropertiesData.innerHTML=message;customProperties.append(customPropertiesData);accordionDynamicCartData.appendChild(customProperties);accordionDynamicCartRow.appendChild(accordionEmptyDynamicCartData);accordionDynamicCartRow.appendChild(accordionDynamicCartData)};trialOfferLabel&&createAccordionCartRow(trialOfferLabel);rebillCartFrequency&&createAccordionCartRow(rebillCartFrequency)}function ccDisplayCustomCart(){var pageId=pageData&&pageData.pageTypeId;var memberAreaPage=pageId===9;var thankyouPage=pageId===5,checkoutFlow=[2,3,4].includes(pageId),ccIsVat=getTaxRate().isVat!==1;var disableActions=[3,5,9].includes(pageId);var cartProducts=memberAreaPage?getLoginOrderDetails().items||{}:getOrderItemDetails();var sessionOrderData=sessionStorage.getItem("orderData"),invoiceExchangeRate=1;sessionOrderData=sessionOrderData&&JSON.parse(sessionOrderData);if(thankyouPage&&sessionOrderData&&!(cartProducts&&Object.keys(cartProducts).length)){cartProducts=sessionOrderData&&sessionOrderData.items||{};memberAreaPage=true}if(thankyouPage||pageId===3){invoiceExchangeRate=Number(sessionStorage.getItem("exchangeRate"))||invoiceExchangeRate;if((sessionOrderData&&sessionOrderData.currencyCode)===(returnCurrencyCode()||pageData.selectedCampaign.currency))invoiceExchangeRate=1}var cartProductsLength=Object.keys(cartProducts).length;var cartElement=$(".cc-cart-container");if(!cartProductsLength){cartElement.css("display","none")}else{cartElement.css("display","block")}var cartElementLength=cartElement.length;if(cartElementLength){var _customCart2=sessionStorage.getItem("customCart");_customCart2=_customCart2&&JSON.parse(_customCart2)||{};var upsaleComboProducts=sessionStorage.getItem("upsaleComboProducts");upsaleComboProducts=upsaleComboProducts&&JSON.parse(upsaleComboProducts)||[];var bundleItems=sessionStorage.getItem("bundleItems")!==null?JSON.parse(sessionStorage.getItem("bundleItems")):{};if(Object.keys(bundleItems).length){ccConstructBundleItem("","",bundleItems);var bundleStringArray=sessionStorage.getItem("bundleStringArray")!==null?JSON.parse(sessionStorage.getItem("bundleStringArray")):{};for(var _i82 in bundleStringArray){upsaleComboProducts.push(bundleStringArray[_i82])}}if(upsaleComboProducts&&upsaleComboProducts.length){var customCartCount=_customCart2?Object.keys(_customCart2).length:0;upsaleComboProducts.forEach(function(item,index){_customCart2[customCartCount+index]=item})}var processedCustomCart={};if(_customCart2){var _loop18=function _loop18(){var customCartValue=_customCart2[item];customCartValue=customCartValue.split("|");var productData={};customCartValue.forEach(function(item,index){if(index===1){productData[index]=["Quantity",item]}if(index>1){var itemData=item.split(":");if(itemData[0]){productData[index]=[itemData[0],itemData[1]||""]}}});var cartKey=customCartValue[0].split(".")[0];processedCustomCart[cartKey]=productData};for(item in _customCart2){_loop18()}}var _rebillCart=sessionStorage.getItem("rebillCart");_rebillCart=_rebillCart&&JSON.parse(_rebillCart);var tempCartProducts=cartProducts;var currencySymbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol||"";var productPercentagePrice=Number(sessionStorage.getItem("ccCartProductsPercentageTotal"))||0;var shopifyItems=pageData.cartData&&pageData.cartData.itemsInfo||{};for(var _i83=0;_i83<cartElementLength;_i83++){var cartObj=$(cartElement[_i83]);cartProducts=tempCartProducts;memberAreaPage=pageId==9?true:false;var invoiceElement=cartObj.hasClass("cc-invoice-container")&&[3,5].includes(pageId);if(invoiceElement){cartProducts=sessionOrderData&&sessionOrderData.items||{};memberAreaPage=true}cartObj.find(".cc-cart-items-count").html(cartProductsLength);var cartRow=cartObj.find(".cc-cart-row").first();var cartRowCloner=cartRow.clone(true);cartRow.css("display","none");cartObj.find(".cc-cart-row").slice(1).remove();var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;var prevProd=void 0;var _loop19=function _loop19(){var cartRowClone=cartRowCloner.clone(true);var campaignProductId=cartProductsEntries[j][0];var product=cartProductsEntries[j][1];var customAttrs=product.customization;var prodId=campaignProductId.split(".")[0];var itemAltValue=altValues&&altValues[campaignProductId+"|"+product.currentOrderQuantity];var productPercentageItemPrice;if(ccIsVat&&checkoutFlow&&product.isPricePercent===1&&!shopifyItems[campaignProductId]){var itemAltValuePrice=itemAltValue&&itemAltValue.split("|")[0];productPercentageItemPrice=(productPercentagePrice*(Number(itemAltValuePrice?itemAltValuePrice:product.cycle1_price)||0)*0.01).toFixed(2)}if(!product.isVariantBundle||!prevProd||prevProd!=prodId){if(memberAreaPage&&customAttrs){var customAttrsObj=customAttrs&&customAttrs.length&&customAttrs[0];var _productData10={};if(customAttrsObj&&customAttrsObj.quantity){_productData10[0]=["Quantity",customAttrsObj.quantity]}var productAttributes=customAttrsObj&&customAttrsObj.attributes;productAttributes&&productAttributes.length&&productAttributes.forEach(function(item,index){_productData10[index+1]=[item.key,item.value]});processedCustomCart[campaignProductId]=_productData10}var currentOrderQuantity=memberAreaPage?product.qty:product.currentOrderQuantity;var image=cartRowClone.find(".cc-cart-row-img");var prodQtyBubble=cartRowClone.find(".cc-cart-prod-qty-bubble");if(image.length){var imageUrl=product.variant&&product.variant.imageUrl!==""?product.variant.imageUrl:product.imageUrl;if(!imageUrl&&invoiceElement){var campaignProduct=pageData.selectedCampaign.products.find(function(item){return item.campaignProductId.toString()===product.productId});if(campaignProduct){imageUrl=campaignProduct.imageUrl;var productVariantId=product.variantDetailId;if(productVariantId){var productVariants=campaignProduct.variants;var _productVariant=productVariants&&productVariants.length&&productVariants.find(function(item){return item.variantDetailId.toString()===productVariantId});imageUrl=_productVariant&&_productVariant.imageUrl||imageUrl}}}image.attr("src",imageUrl);image.attr("data-src",imageUrl);prodQtyBubble.html(currentOrderQuantity);if(!imageUrl){cartRowClone.find(".cc-cart-row-img").remove();prodQtyBubble.remove()}}else{prodQtyBubble.remove()}var prodSavingPrice=cartRowClone.find(".cc-cart-row-prod-saving");var prodSavingPerc=cartRowClone.find(".cc-cart-row-prod-saving-perc");var savingElement=prodSavingPrice.length||prodSavingPerc.length;var tempProductPrice=0;var prodPrice=cartRowClone.find(".cc-cart-row-prod-price");if(prodPrice.length||savingElement){var showLabel;var showFreeLabel=prodPrice.hasClass("cc-cart-row-free-label");if(memberAreaPage){tempProductPrice=Number((Number(product.vatPrice||product.price)*invoiceExchangeRate).toFixed(2));showLabel=showFreeLabel&&Number(tempProductPrice)===0;prodPrice.html(showLabel?"FREE":ccFormatCurrency(tempProductPrice,currencySymbol))}else{var unitPrice=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;tempProductPrice=productPercentageItemPrice?productPercentageItemPrice:getItemPrice(campaignProductId,unitPrice,1).toFixed(2);showLabel=showFreeLabel&&Number(tempProductPrice)===0;prodPrice.html(showLabel?"FREE":ccFormatCurrency(tempProductPrice,currencySymbol))}!showLabel&&prodPrice.removeClass("cc-cart-row-free-label")}var prodTotalPrice=cartRowClone.find(".cc-cart-row-prod-total");if(prodTotalPrice.length&&!memberAreaPage){var _unitPrice=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var totalPrice=productPercentageItemPrice?(Number(productPercentageItemPrice)*(itemAltValue?1:product.currentOrderQuantity)).toFixed(2):getItemPrice(campaignProductId,_unitPrice,product.currentOrderQuantity).toFixed(2);var _showLabel=prodPrice.hasClass("cc-cart-row-free-label")&&Number(totalPrice)===0;!_showLabel&&prodTotalPrice.removeClass("cc-cart-row-free-label");prodTotalPrice.html(_showLabel?"FREE":ccFormatCurrency(totalPrice,currencySymbol))}var tempProductComparePrice=0;var prodComparePrice=cartRowClone.find(".cc-cart-row-prod-compare");if((prodComparePrice.length||savingElement)&&!memberAreaPage){var _unitPrice2=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var compareAtPrice=product.compareAtPrice&&parseFloat(product.compareAtPrice)>0?product.compareAtPrice:null;compareAtPrice=product.variant&&product.variant.compareAtPrice&&parseFloat(product.variant.compareAtPrice)>0&&!product.isVariantBundle?product.variant.compareAtPrice:compareAtPrice;if(compareAtPrice){tempProductComparePrice=parseFloat(getItemPrice(campaignProductId,compareAtPrice,1).toFixed(2));compareAtPrice=ccFormatCurrency(tempProductComparePrice,currencySymbol);prodComparePrice.html(compareAtPrice)}else{prodComparePrice.html("");prodSavingPrice.html("");prodSavingPerc.html("")}}if(tempProductComparePrice&&savingElement&&!disableActions){var savingPrice=parseFloat((tempProductComparePrice-parseFloat(tempProductPrice)).toFixed(2));var savingPerc=parseFloat(savingPrice)/tempProductComparePrice*100;prodSavingPrice.html(ccFormatCurrency(savingPrice<0?"0.00":savingPrice),currencySymbol);prodSavingPerc.html((savingPerc<0?0:savingPerc.toFixed(0))+"%")}var prodQty=cartRowClone.find(".cc-cart-row-prod-qty");if(prodQty.length){prodQty.html(currentOrderQuantity)}var productVariant=product.variant;var maxVariantSupport=3;var variantContainer=cartRowClone.find(".cc-cart-row-variant");var outOfStock=false;if(productVariant&&!product.isVariantBundle){outOfStock=verifyStock&&product.cycle1_isShippable&&parseInt(productVariant.stockQuantity)<parseInt(currentOrderQuantity);for(var k=1;k<=maxVariantSupport;k++){if(!productVariant.hasOwnProperty("variantName"+k)){break}var variantName=productVariant["variantName"+k];if(variantName){var variantContainerClone=variantContainer.clone(true);variantContainerClone.find(".cc-cart-row-prod-variant").html(productVariant["variantOptionName"+k]);variantContainerClone.find(".cc-cart-row-prod-variant-label").html(variantName);variantContainerClone.insertBefore(variantContainer)}}}else{outOfStock=verifyStock&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(currentOrderQuantity)}var createVariantContainer=function createVariantContainer(label,variant,removeLabel,removeVariantClasses){var variantContainerClone=variantContainer.clone(true);var variantElement=variantContainerClone.find(".cc-cart-row-prod-variant");variantElement.html(variant);label&&variantContainerClone.find(".cc-cart-row-prod-variant-label").html(label);removeLabel&&variantContainerClone.find(".cc-cart-row-prod-variant-label").remove();removeVariantClasses&&removeVariantClasses.forEach(function(item){variantElement.removeClass(item)});variantContainerClone.insertBefore(variantContainer)};var processedCustomCartProduct=processedCustomCart[campaignProductId]||processedCustomCart[prodId];if(processedCustomCartProduct){var classesToRemove=["cc-cart-row-frequency","cc-cart-row-show-trial"];for(var _item13 in processedCustomCartProduct){createVariantContainer(processedCustomCartProduct[_item13][0],processedCustomCartProduct[_item13][1],null,classesToRemove)}}if(variantContainer.find(".cc-cart-row-prod-variant").hasClass("cc-cart-row-show-trial")&&product.trialEnabled&&product.cycle1_billDelay&&product.cycle2_price){var billDelay=product.cycle1_billDelay,showTrialProdLabel="Trial: "+ccFormatCurrency(getItemPrice(null,product.cycle2_price,1).toFixed(2))+" in "+billDelay+" "+"day"+(Number(billDelay)>1?"s":"");createVariantContainer(null,showTrialProdLabel,true,["cc-cart-row-frequency"])}var rebillFrequency=_rebillCart&&_rebillCart[campaignProductId];if(variantContainer.find(".cc-cart-row-prod-variant").hasClass("cc-cart-row-frequency")&&!rebillFrequency&&product.billingCycleType==="RECURRING"&&!product.cycle2_billDelay&&product.cycle1_billDelay){var variantBillDelay=product.variant&&product.variant.billDelay;rebillFrequency=variantBillDelay?variantBillDelay:product.cycle1_billDelay;rebillFrequency=rebillFrequency===1?rebillFrequency+" day":rebillFrequency+" days";rebillFrequency=(product.cycle1_isShippable?"Delivery every":"Billing every")+" "+rebillFrequency}rebillFrequency&&createVariantContainer(null,rebillFrequency,true,["cc-cart-row-show-trial"]);variantContainer.remove();var productTitle=cartRowClone.find(".cc-cart-row-prod-title");if(productTitle.length){var productVariantName=product.variantName||product.title;var productName=memberAreaPage?product.name+(productVariantName?"<br>"+productVariantName:""):product.productName;productTitle.html(productName+(!memberAreaPage&&outOfStock?"  - OUT-OF-STOCK":""))}var plusIcon=cartRowClone.find(".cc-cart-row-prod-qty-plus");product.isVariantBundle?plusIcon[0].style.visibility="hidden":null;if(plusIcon.length){disableActions?plusIcon.css({"pointer-events":"none","filter":"opacity(0.5)"}):plusIcon[0].setAttribute("onclick","plusQuantity('"+campaignProductId+"');")}var minusIcon=cartRowClone.find(".cc-cart-row-prod-qty-minus");product.isVariantBundle?minusIcon[0].style.visibility="hidden":null;if(minusIcon.length){if(parseInt(product.currentOrderQuantity)===1||disableActions){minusIcon.css({"pointer-events":"none","filter":"opacity(0.5)"})}else{minusIcon[0].onclick=function(e){e.target.style.pointerEvents="none";minusQuantity(campaignProductId,e.target)}}}var _productId10=campaignProductId&&campaignProductId.split(".")[0];var trashIcon=cartRowClone.find(".cc-cart-row-trash-icon");if(_productId10&&fkCheckboxAndRadioProductIdHashMap[_productId10]||disableActions){trashIcon.remove()}else if(trashIcon.length){trashIcon[0].setAttribute("onclick","removeFromCart('"+campaignProductId+"');")}var toggleIcon=cartRowClone.find(".cc-toggle-row-details");if(toggleIcon.length){var variantElements=cartRowClone.find(".cc-cart-row-variant");if(variantElements.length){variantElements.css("display","none");toggleIcon[0].onclick=function(){if(toggleIcon.hasClass("cc-rotate-row-icon")){variantElements.first().css("display")==="none"?toggleIcon.css("transform","rotate(90deg)"):toggleIcon.css("transform","rotate(0deg)")}variantElements.toggle()}}else{toggleIcon.remove()}}cartRowClone.css("display","block");cartObj.append(cartRowClone)}prevProd=prodId};for(var j=0;j<cartProductsEntriesLength;j++){_loop19()}}}}function ccConstructBundleItem(productId,product,bundleItems,breakTag){var bundleStringArray=sessionStorage.getItem("bundleStringArray")!==null?JSON.parse(sessionStorage.getItem("bundleStringArray")):{};;var bundleVariantAndQty="";var _loop20=function _loop20(){var bundleProdId=bundleItems[_i84].split(".")[0];if(!productId||productId==bundleProdId){product=pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==bundleProdId});var bundleString=bundleProdId+"|1|";var bundleProdArray=bundleItems[_i84].split("|");var _loop21=function _loop21(){if(bundleProdArray[_i85]!=""){var qty=bundleProdArray[_i85].split(":")[1];var bundleProdData=bundleProdArray[_i85].split(":")[0];var variantId=bundleProdData.split(".")[1];var variant=product&&product.variants.find(function(data){return data.variantDetailId==variantId});productId&&variant?bundleVariantAndQty+=variant.title+" :  "+qty+breakTag:null;variant?bundleString+=variant.title+":"+qty+"|":null}};for(var _i85 in bundleProdArray){_loop21()}bundleStringArray[bundleProdId]=bundleString}};for(var _i84 in bundleItems){_loop20()}sessionStorage.setItem("bundleStringArray",JSON.stringify(bundleStringArray));return bundleVariantAndQty}function ccBundleDisplay(confirmation,productData,product,bundleIndex,newSymbol,itemPrice,qty){var productId=productData.split(".")[0];$("head").append(comboStyles);var listOfItem="";var breakTag=confirmation?"<br>":"<br><br>";var bundleItems=sessionStorage.getItem("bundleItems")!==null?JSON.parse(sessionStorage.getItem("bundleItems")):{};var bundleVariantAndQty=ccConstructBundleItem(productId,product,bundleItems,breakTag);if(confirmation===false){listOfItem="<a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+bundleIndex+"\" onClick=\"rotateCaret(event)\"><i class=\"fas fa-caret-right combo-caret\"></i></a>"+" "+product.productName+"<tr><td ><div id=\"index"+bundleIndex+"\" class=\"collapse combo\"> "+bundleVariantAndQty+" </div></td></tr>"}else if(confirmation===true){var productVariant=(pageData.pageTypeId===9?product.variantName:product.title)||"";var prodName=product.name||product.productName;listOfItem="<tr><td><a type=\"button\" data-toggle=\"collapse\" data-target=\"#index"+bundleIndex+"\" onClick=\"rotateCaret(event)\"><i class=\"fas fa-caret-right combo-caret\"></i></a>"+" "+prodName+" "+productVariant+"</td><td style=\"text-align:center;\">"+qty+"</td><td style=\"text-align:right;\"> "+ccFormatCurrency(itemPrice,newSymbol)+" </td></tr><tr><td><div id=\"index"+bundleIndex+"\" class=\"collapse combo\"> "+bundleVariantAndQty+" </div></td></tr>"}else if(confirmation==="sideCart"){var caretIcon="<a type='button' class='bundleAnchor' data-toggle='collapse' data-target='#index"+bundleIndex+"' onClick='rotateCaret(event)'><i class='fas fa-caret-right combo-caret'></i></a>";var bundleItemsString="<span id='index"+bundleIndex+"' class='collapse combo popUpCartBundle'> "+bundleVariantAndQty+"</span>";listOfItem={caretIcon:caretIcon,bundleItemsString:bundleItemsString}}return listOfItem}function cartDisplay(){var cartTable=document.getElementById("fk-dynamic-cart-table"),pageTypeId=pageData&&pageData.pageTypeId;var showTrialOffer=cellFormat&&cellFormat.find(function(item){return $(item).hasClass("cc-cart-row-show-trial")});if(cartTable&&(sessionStorage.getItem("customCart")!==null||sessionStorage.getItem("rebillCart")!==null||showTrialOffer))!cartTable.classList.contains("fold-table")&&cartTable.classList.add("fold-table");var dynamicCartBody=document.querySelector("tbody[id='fk-dynamic-cart-body']");var cartHeader=document.querySelector("thead[id='fk-dynamic-cart-head']");if(!cartTable)return;var memberAreaPage=pageTypeId===9;var cartProducts=memberAreaPage?getLoginOrderDetails().items||{}:getOrderItemDetails();dynamicCartBody.innerHTML="";if(pageTypeId===33){cartHeader.style.borderBottom="1px solid #808080"}if(cartProducts&&Object.keys(cartProducts).length>0){var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;var productCombo=JSON.parse(sessionStorage.getItem("upsaleComboProducts")||"{}");var isCombo=productCombo&&productCombo.length>0;isCombo&&$("head").append(comboStyles);var collapseIndex=1,bundleIndex=1;var listOfItem="";var comboResult,matchUpsale,prevBundleProduct,bundleList;var shopifyItems=pageData.cartData&&pageData.cartData.itemsInfo||{},checkoutFlow=[2,3,4].includes(pageTypeId);var productPercentagePrice=Number(sessionStorage.getItem("ccCartProductsPercentageTotal"))||0;var ccIsVat=getTaxRate().isVat!==1;var bundleArray=[];var _loop22=function _loop22(){var product=cartProductsEntries[_i86][1];var campaignProductId=memberAreaPage&&product&&product.variantDetailId?cartProductsEntries[_i86][0]+"."+product.variantDetailId:cartProductsEntries[_i86][0];var combosList=[];var isVariantBundle=product&&product.isVariantBundle;var showBundleInCart=isVariantBundle&&(!prevBundleProduct||prevBundleProduct!=product.campaignProductId&&!bundleArray[campaignProductId]);if(showBundleInCart){listOfItem=ccBundleDisplay(false,campaignProductId,product,bundleIndex);bundleArray.push(campaignProductId);bundleIndex++}else if(isVariantBundle){listOfItem="";return 1;// continue
}prevBundleProduct=product&&product.campaignProductId;if(isCombo){comboResult=comboDisplay(false,productCombo,campaignProductId,product.currentOrderQuantity,product,collapseIndex,matchUpsale);listOfItem=comboResult.listOfItem;matchUpsale=comboResult.matchUpsale;if(matchUpsale){combosList.push(campaignProductId);collapseIndex++}}var newDynamicCartRow=document.createElement("TR");newDynamicCartRow.classList.add("fk-custom-cart-view");var accordionDynamicCartRow=document.createElement("TR");accordionDynamicCartRow.classList.add("fk-custom-cart-fold");var accordionEmptyDynamicCartData=document.createElement("TD");accordionEmptyDynamicCartData.style.visibility="hidden";var accordionDynamicCartData=document.createElement("TD");accordionDynamicCartData.colSpan="3";var customProperties=document.createElement("div");customProperties.classList.add("fold-content");var customCartData=sessionStorage.getItem("customCart")!==null?JSON.parse(sessionStorage.getItem("customCart")):{};var customAttrString=ccProductAttrToString(product);if(memberAreaPage&&customAttrString){customCartData[0]=customAttrString}var customProductIds=[];var isCustomProperty=false,showTrialProdLabel;for(var _productData11 in customCartData){customProductIds.push(customCartData[_productData11].split("|")[0])}var trialProd=showTrialOffer&&product.trialEnabled&&product.cycle1_billDelay&&product.cycle2_price;if(trialProd){var billDelay=product.cycle1_billDelay;showTrialProdLabel="Trial: "+ccFormatCurrency(getItemPrice(null,product.cycle2_price,1).toFixed(2))+" in "+billDelay+" "+"day"+(Number(billDelay)>1?"s":"")}var rebilCartData=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):{};var rebilCartDetails=rebilCartData[campaignProductId];if(customProductIds.includes(campaignProductId)){isCustomProperty=true;for(var _productData12 in customCartData){var firstProperty=_productData12==0&&_i86==0?true:false;if(customCartData[_productData12].split("|")[0]==campaignProductId){createCustomProperties(customCartData[_productData12],accordionDynamicCartRow,accordionEmptyDynamicCartData,accordionDynamicCartData,customProperties,firstProperty,rebilCartDetails,showTrialProdLabel)}}}else if(rebilCartDetails||showTrialProdLabel){isCustomProperty=true;var _firstProperty=_i86==0?true:false;createCustomProperties(null,accordionDynamicCartRow,accordionEmptyDynamicCartData,accordionDynamicCartData,customProperties,_firstProperty,rebilCartDetails,showTrialProdLabel)}var caretIcon=document.createElement("i");caretIcon.innerHTML="&nbsp;";caretIcon.style.cssText="cursor:pointer;transition:all .3s ease";caretIcon.id="caretIcon";caretIcon.classList="fa fa-caret-right";if(pageTypeId===33){newDynamicCartRow.style.borderBottom="1px solid #808080"}var cellFormatLength=cellFormat.length;var itemAltValue=altValues&&altValues[campaignProductId+"|"+product.currentOrderQuantity];var _loop23=function _loop23(){var cell=cellFormat[j];var isQuantityCirclePresent=cell.getElementsByClassName("quantity-circle");if(cell.title.toLowerCase()==="image"){var newDynamicImage=document.createElement("TD");cell.id!==""&&newDynamicImage.setAttribute("id",cell.id);newDynamicImage.className="table-cell image-quantity";var imageUrl=product.variant&&product.variant.imageUrl!==""?product.variant.imageUrl:product.imageUrl;if(imageUrl!==""&&!memberAreaPage){//put the image here
var productImage=document.createElement("img");productImage.src=imageUrl;productImage.className="product-cart-image";if(cell.firstChild!==null&&cell.firstChild.tagName==="IMG"){productImage.className=cell.firstChild.className;if(cell.firstChild.id!=="")productImage.setAttribute("id",cell.firstChild.id)}if(isQuantityCirclePresent&&isQuantityCirclePresent.length>0){var imageQuantityContainer=document.createElement("div");imageQuantityContainer.className="image-quantity-container";var quantityText=document.createElement("div");quantityText.innerText=product.currentOrderQuantity;quantityText.className="quantity-circle";imageQuantityContainer.appendChild(productImage);if(cell.childNodes&&cell.childNodes[0]&&cell.childNodes[0].childElementCount>1){if(cell.childNodes[0].lastChild&&cell.childNodes[0].lastChild.id!==""){quantityText.setAttribute("id",cell.childNodes[0].lastChild.id)}imageQuantityContainer.appendChild(quantityText)}newDynamicImage.appendChild(imageQuantityContainer)}else{newDynamicImage.appendChild(productImage)}}newDynamicCartRow.appendChild(newDynamicImage)}if(cell.title.toLowerCase()==="item"){var newDynamicItem=document.createElement("TD");var newDynamicItemNewLine=document.createElement("BR");newDynamicItem.innerHTML=cell.innerHTML;cell.id!==""&&newDynamicItem.setAttribute("id",cell.id);newDynamicItem.className="table-cell";var currentOrderQuantity=product.currentOrderQuantity;var productStockStatus="";if(!product.variant){productStockStatus=verifyStock&&product.cycle1_isShippable&&parseInt(product.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":""}if(combosList.includes((product.campaignProductId||campaignProductId).toString())||isVariantBundle){newDynamicItem.innerHTML=listOfItem+productStockStatus}else{newDynamicItem.innerHTML=memberAreaPage?product.name+(product.variantName?"<br>"+product.variantName:""):product.productName+productStockStatus}isCustomProperty&&newDynamicItem.prepend(caretIcon);if(product.variant&&product.variant.title&&!isVariantBundle){var variantStockStatus=verifyStock&&product.cycle1_isShippable&&parseInt(product.variant.stockQuantity)<parseInt(currentOrderQuantity)?"  - OUT-OF-STOCK":"";var newDynamicTitle=document.createElement("span");newDynamicTitle.innerText=product.variant.title+variantStockStatus;newDynamicItem.appendChild(document.createElement("BR"));newDynamicItem.appendChild(newDynamicTitle)}newDynamicItem.appendChild(newDynamicItemNewLine);if(cell.classList.contains("fk-shopping-cart-item")&&cell.getElementsByTagName("I")[0]){var _productId11=campaignProductId&&campaignProductId.split(".")[0];if(_productId11&&!fkCheckboxAndRadioProductIdHashMap[_productId11]&&!memberAreaPage){var trashElement=document.createElement("I");trashElement.className=cell.getElementsByTagName("I")[0].classList.toString();trashElement.style.cursor="pointer";newDynamicItem.appendChild(trashElement);trashElement.setAttribute("onclick","removeFromCart('"+campaignProductId+"');")}}newDynamicCartRow.appendChild(newDynamicItem)}if(cell.title.toLowerCase()==="quantity"){var newDynamicQuantity=document.createElement("TD");updateCSSForShoppingCartSections(newDynamicQuantity);newDynamicQuantity.innerHTML=cell.innerHTML;newShoppingCart=$(newDynamicQuantity).find(".fk-shopping-cart-quantity-wrapper-class")[0];childElement=newShoppingCart?newShoppingCart.childNodes:newDynamicQuantity.childNodes;newDynamicQuantity.setAttribute("id",cell.id);newDynamicQuantity.className="table-cell";newDynamicQuantity.style.textAlign="center";var _currentOrderQuantity=!isVariantBundle?product.currentOrderQuantity:"1";if(childElement){childElement.forEach(function(ele){if($(ele).text().length>0&&ele.tagName!=="I"){if(ele.tagName==="DIV"){ele.textContent=null;var newQuantitySpan=document.createElement("SPAN");$(newQuantitySpan).css({"margin":"0 auto"});newQuantitySpan.textContent=memberAreaPage?product.qty:_currentOrderQuantity;ele.appendChild(newQuantitySpan)}else{ele.textContent=memberAreaPage?product.qty:_currentOrderQuantity}}var minusHide=product.isVariantBundle&&ele&&ele.classList&&(ele.classList.contains("fk-shopping-cart-minus")||ele.classList.contains("minus-style"));var plusHide=product.isVariantBundle&&ele&&ele.classList&&(ele.classList.contains("fk-shopping-cart-plus")||ele.classList.contains("plus-style"));minusHide||plusHide?ele.style.visibility="hidden":null;if(!minusHide&&ele&&ele.classList&&(ele.classList.contains("fk-shopping-cart-minus")||ele.classList.contains("minus-style"))){ele.textContent=!ele.classList.contains("minus-style")?"-":"";if(ele.classList.contains("fk-shopping-cart-minus")){var _orderItems8=getOrderItems();if(parseInt(_orderItems8[campaignProductId])>1){ele.setAttribute("onclick","minusQuantity('"+campaignProductId+"',this);")}else{ele.setAttribute("disabled","true")}}else{ele.setAttribute("onclick","minusQuantity('"+campaignProductId+"',this);")}if(memberAreaPage){ele.setAttribute("onclick","");ele.setAttribute("disabled","true")}}if(!plusHide&&ele&&ele.classList&&(ele.classList.contains("fk-shopping-cart-plus")||ele.classList.contains("plus-style"))){ele.textContent=!ele.classList.contains("plus-style")?"+":"";if(memberAreaPage){ele.setAttribute("onclick","");ele.setAttribute("disabled","true")}else{ele.setAttribute("onclick","plusQuantity('"+campaignProductId+"');")}}})}newDynamicCartRow.appendChild(newDynamicQuantity)}var productPercentageItemPrice;if(ccIsVat&&checkoutFlow&&product.isPricePercent===1&&!shopifyItems[campaignProductId]){var itemAltValuePrice=itemAltValue&&itemAltValue.split("|")[0];productPercentageItemPrice=(productPercentagePrice*(Number(itemAltValuePrice?itemAltValuePrice:product.cycle1_price)||0)*0.01).toFixed(2)}var currencySymbol=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currencySymbol||"";if(cell.title.toLowerCase()==="price"){var freeLabel=$(cell).hasClass("cc-cart-row-free-label");var newDynamicPrice=document.createElement("TD");updateCSSForShoppingCartSections(newDynamicPrice);cell.id!==""&&newDynamicPrice.setAttribute("id",cell.id);newDynamicPrice.className="table-cell";if(memberAreaPage){var _price5=product.vatPrice||product.price;newDynamicPrice.innerHTML=freeLabel&&Number(_price5)===0?"FREE":ccFormatCurrency(_price5,currencySymbol);newDynamicCartRow.appendChild(newDynamicPrice)}else{var unitPrice=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var prodPrice=productPercentageItemPrice?productPercentageItemPrice:getItemPrice(campaignProductId,unitPrice,1).toFixed(2);newDynamicPrice.innerHTML=freeLabel&&Number(prodPrice)===0?"FREE":ccFormatCurrency(prodPrice,currencySymbol);newDynamicCartRow.appendChild(newDynamicPrice)}}if(cell.title.toLowerCase()==="total"&&!memberAreaPage){var _newDynamicPrice=document.createElement("TD");updateCSSForShoppingCartSections(_newDynamicPrice);cell.id!==""&&_newDynamicPrice.setAttribute("id",cell.id);_newDynamicPrice.className="table-cell";var _unitPrice3=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var _prodPrice=productPercentageItemPrice?(Number(productPercentageItemPrice)*Number(itemAltValue?1:product.currentOrderQuantity)).toFixed(2):getItemPrice(campaignProductId,_unitPrice3,product.currentOrderQuantity).toFixed(2);_newDynamicPrice.innerHTML=Number(_prodPrice)===0&&$(cell).hasClass("cc-cart-row-free-label")?"FREE":ccFormatCurrency(_prodPrice,currencySymbol);newDynamicCartRow.appendChild(_newDynamicPrice)}if(cell.title.toLowerCase()==="compare"&&!memberAreaPage){var _newDynamicPrice2=document.createElement("TD");updateCSSForShoppingCartSections(_newDynamicPrice2);cell.id!==""&&_newDynamicPrice2.setAttribute("id",cell.id);_newDynamicPrice2.className="table-cell";var _unitPrice4=product.variant&&parseFloat(product.variant.price)>0&&!product.isVariantBundle&&!product.isEditable?product.variant.price:product.cycle1_price;var compareAtPrice=product.compareAtPrice&&parseFloat(product.compareAtPrice)>0?product.compareAtPrice:null;compareAtPrice=product.variant&&product.variant.compareAtPrice&&parseFloat(product.variant.compareAtPrice)>0&&!product.isVariantBundle?product.variant.compareAtPrice:compareAtPrice;_newDynamicPrice2.innerHTML=compareAtPrice?ccFormatCurrency(getItemPrice(campaignProductId,compareAtPrice,1).toFixed(2),currencySymbol):"";newDynamicCartRow.appendChild(_newDynamicPrice2)}if(cell.title.toLowerCase()==="action"){var newDynamicAction=document.createElement("TD");cell.id!==""&&newDynamicAction.setAttribute("id",cell.id);newDynamicAction.className="table-cell";newDynamicAction.style.textAlign="center";newDynamicAction.innerHTML=cell.innerHTML;var _trashElement=newDynamicAction.querySelectorAll("i");if(_trashElement&&_trashElement.length>0){_trashElement[0].setAttribute("onclick","removeFromCart('"+campaignProductId+"');")}memberAreaPage&&_trashElement[0]&&$(_trashElement[0]).remove();var linkElement=newDynamicAction.querySelectorAll("a");if(linkElement&&linkElement.length>0){linkElement[0].setAttribute("offer",product.campaignProductId);product.variant&&linkElement[0].setAttribute("variantvalue",product.variant.variantDetailId)}newDynamicCartRow.appendChild(newDynamicAction)}};for(var j=0;j<cellFormatLength;j++){_loop23()}dynamicCartBody.appendChild(newDynamicCartRow);dynamicCartBody.appendChild(accordionDynamicCartRow);$(".fold-content p:first-child > hr").remove()},newShoppingCart,childElement;for(var _i86=0;_i86<cartProductsEntriesLength;_i86++){if(_loop22())continue}}$(".fold-table tr.fk-custom-cart-view td:nth-child(2)").on("click",function(){$(this).find("i").toggleClass("fk-caret-rotate");$(this).parents(".fold-table tr.fk-custom-cart-view").toggleClass("fk-custom-open").next(".fk-custom-cart-fold").toggleClass("fk-custom-open")})}function initializeCountryStates(callback){//initialize array of campaign states indexed by countryCode - ex: ["US"] => [{stateCode:"AL",stateName:"Alabama"}]
pageData.selectedCampaign.states=[];//pageData.selectedCampaign.countries = array of campaign country objects - ex: {countryName:"United States", countryCode:"US"}
//loop through campaign countries array and add empty array at countryCode index
pageData.selectedCampaign.countries.forEach(function(country){pageData.selectedCampaign.states[country.countryCode]=[]});if(checkElementExist("country")||checkElementExist("shipCountry")){//get all possible countries/states data - then loop through and add the campaign country states to the campaignStates array
//countries array entry looks like this: {countryCode:"US",countryName:"United States",stateCode:"GA",stateName:"Georgia"}
$.getJSON("".concat(assetsUrl,"/countries.json"),function(data){data.forEach(function(state){if(pageData.selectedCampaign.states[state.countryCode])pageData.selectedCampaign.states[state.countryCode].push({stateCode:state.stateCode,stateName:state.stateName})});var loadFromURL=sessionStorage.getItem("orderData")?false:true;loadCountries("country",loadFromURL);loadCountries("shipCountry",loadFromURL);if((pageData.pageTypeId===4||pageData.pageTypeId===2)&&ccUrlParams.get("orderId")){orderQueryWithOrderId()}setGeoFromIP();callback&&callback()})}else{setGeoFromIP();callback&&callback()}}function checkElementExist(inputName){var input=document.getElementsByName(inputName)[0];if(!input||input.type!=="select-one"){return false}return true}function loadCountries(inputName,loadFromURL){var input=document.getElementsByName(inputName)[0];var urlParams=new URLSearchParams(getCurrentWindowLocation().search);var sessionAddressInfo=sessionStorage.getItem("ccCountryAndStateInfoTracker");sessionAddressInfo=sessionAddressInfo?JSON.parse(sessionAddressInfo):{};var paramValue=loadFromURL&&urlParams.has(inputName)?urlParams.get(inputName):null;if(!input||input.type!=="select-one")return;var chooseOptionText=input.options.length>0&&input.options[0].value===""?input.options[0].text:null;pageData.selectedCampaign.countries.sort(function(a,b){return a.countryName.localeCompare(b.countryName)});input.innerHTML="";var orderData=JSON.parse(sessionStorage.getItem("orderData"));//Set the default value to the saved session value if it exists
var sessionVal=orderData&&orderData.hasOwnProperty(inputName)&&orderData[inputName]!==null?orderData[inputName]:sessionAddressInfo[inputName]||null;var defaultVal=paramValue?paramValue:sessionVal!==null?sessionVal:null;var countriesLength=pageData.selectedCampaign.countries.length;for(var _i87=0;_i87<countriesLength;_i87++){var country=pageData.selectedCampaign.countries[_i87];var option=document.createElement("OPTION");option.value=country.countryCode;option.innerHTML=country.countryName;//Make US the first option if in campaign, then Canada, then list campaign countries alphabetically
if(country.countryCode==="US"||country.countryCode==="CA")input.prepend(option);else input.add(option);//if Canada is in campaign, set Canada as default value - US will override as default value if US is in campaign
defaultVal=sessionVal===null&&paramValue===null&&(country.countryCode==="CA"||country.countryCode==="US")?country.countryCode:defaultVal}defaultVal=!defaultVal?input.options[0].value:defaultVal;var stateName=inputName==="country"?"state":"shipState";var stateInput=document.getElementsByName(stateName)[0];if(!stateInput||stateInput.type!=="select-one")return;input.addEventListener("change",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var countryValue,productVariantElement,countryName,countryInputValue,shopifyCurrency,baseCurrency,billShipSameObj,billShipSameValue,currencySelect,countryObj,currencyObj,currency;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:countryValue=this.value;loadStates(stateName,countryValue,true);_context5.next=4;return displayPrices();case 4:productVariantElement=document.getElementsByClassName("fk-product-variant-select")[0];productVariantElement&&variantSelectFlag===1&&changeTilePrices(productVariantElement);if(spEnable){countryName=this.name;countryInputValue=$("[name='country']").val();if(countryName==="country"&&countryInputValue){countryInputValue&&ccTriggerSocialProof(countryInputValue)}else if(countryName==="shipCountry"&&(!countryInputValue||$("[name='billShipSame']").prop("checked"))){countryValue&&ccTriggerSocialProof(countryValue)}}if(!(getAddOnKeyValue(findAddOn("EN_CURR_CG_BY_CNTY"))==="true"&&[2,4].includes(pageData.pageTypeId))){_context5.next=13;break}shopifyCurrency=pageData.cartData&&pageData.cartData.currency,baseCurrency=pageData.selectedCampaign.currency,billShipSameObj=$("[name='billShipSame']");billShipSameValue=billShipSameObj.length?billShipSameObj.prop("checked"):orderData&&orderData.billShipSame;if(!(this.name==="shipCountry"&&!billShipSameValue)){_context5.next=12;break}return _context5.abrupt("return");case 12:if(!shopifyCurrency||shopifyCurrency===baseCurrency){currencySelect=$("select[name=currency]").first();countryObj=pageData.selectedCampaign.countries.find(function(item){return item.countryCode===countryValue});currencyObj=countryObj&&countryObj.currencyCode&&fetchCurrentCurrencyObj(countryObj.currencyCode);currency=currencyObj&&currencyObj.currencyCode||baseCurrency;currencySelect.length?currencySelect.val(currency).change():setPriceAndCurrency(currency)}case 13:case"end":return _context5.stop()}},_callee5,this)})));if(defaultVal!==null){var stateValue=loadFromURL&&urlParams.has(stateName)?urlParams.get(stateName):sessionAddressInfo[stateName]||null;input.value=defaultVal;loadStates(stateName,defaultVal,"",stateValue)}}function loadStates(inputName,countryCode,isCountryChanged,stateValue){var input=document.getElementsByName(inputName)[0];if(!input||input.type!=="select-one")return;var chooseOptionText=input.options.length>0&&input.options[0].value===""?input.options[0].text:null;input.innerHTML="";if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption)}var statesArray=pageData.selectedCampaign.states[countryCode];var blackListedStates=pageData.selectedCampaign.blacklist;if(blackListedStates){var stateEntries=blackListedStates.split(",").filter(Boolean).reduce(function(acc,next){var _next$split=next.split(":"),_next$split2=_slicedToArray(_next$split,2),key=_next$split2[0],value=_next$split2[1];if(acc.hasOwnProperty(key)){acc[key].push(value)}else{acc[key]=new Array;acc[key].push(value)}return acc},{});if(stateEntries.hasOwnProperty(countryCode)){stateEntries[countryCode].forEach(function(ele){statesArray=statesArray.filter(function(state){return ele!==state.stateCode})})}}if(typeof statesArray==="undefined"||statesArray.length===0)return;var defaultVal=null;var orderData=JSON.parse(sessionStorage.getItem("orderData"));var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));//Set the default value to the saved session value if it exists
if(orderData&&orderData.hasOwnProperty(inputName)&&orderData[inputName]!==null)defaultVal=orderData[inputName];else if(customerOrders&&customerOrders[0].hasOwnProperty(inputName)&&customerOrders[0][inputName]!==null)defaultVal=customerOrders[0][inputName];var statesArrayLength=statesArray.length;for(var _i88=0;_i88<statesArrayLength;_i88++){var state=statesArray[_i88];var option=document.createElement("OPTION");option.value=state.stateCode;option.innerHTML=state.stateName;input.add(option)}defaultVal=stateValue?stateValue:defaultVal?defaultVal:null;if(defaultVal!==null&&!isCountryChanged){input.value=defaultVal}else if(isCountryChanged||chooseOptionText){input.value=""}input.addEventListener("change",function(){displayPrices();var productVariantElement=document.getElementsByClassName("fk-product-variant-select")[0];productVariantElement&&variantSelectFlag===1&&changeTilePrices(productVariantElement)})}function changeCountry(){return}function changeCountry2(){return}function loadMonth(){var input=document.getElementsByName("cardMonth")[0];if(!input||input.type!=="select-one")return;if(input.options.length<12){var chooseOptionText=input.options.length>0&&input.options[0].text.toLowerCase().indexOf("month")>-1?input.options[0].text:null;input.innerHTML="";var months=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var _i89=0;_i89<12;_i89++){var option=document.createElement("OPTION");option.value=(_i89+1).toString();option.innerHTML=months[_i89];input.add(option)}if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption);input.value=""}}}function loadYear(){var input=document.getElementsByName("cardYear")[0];if(!input||input.type!=="select-one")return;var chooseOptionText=input.options.length>0&&input.options[0].text.toLowerCase().indexOf("year")>-1?input.options[0].text:null;input.innerHTML="";var d=new Date;var year=d.getFullYear();for(var _i90=0;_i90<16;_i90++){var option=document.createElement("OPTION");option.value=(year+_i90).toString();option.innerHTML=(year+_i90).toString();input.add(option)}if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption);input.value=""}}function loadShipProfiles(){var allowStorePickup=false;globalStoreDetails=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.storePickup||[];var input=document.getElementsByName("shipProfileId")[0];var disableShowShipProfilePrices=getAddOnKeyValue(findAddOn("DIS_SHOW_SHIP_PRICES"));if(!input)return;var validShipProfilesCollection=[];var shipProfile=pageData.selectedCampaign?getShipProfile():null;var pageDataShipProfiles=pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.shipProfiles||[];var shipProfilesLength=pageDataShipProfiles.length;if(shipProfilesLength===0)return;var items=getOrderItemDetails();var itemSave=JSON.stringify(items);var totals=JSON.parse(sessionStorage.getItem("totals"));for(var _i91=0;_i91<shipProfilesLength;_i91++){var profile=pageDataShipProfiles[_i91];//determine all valid profiles
if(parseFloat(profile.freeShipThreshold)>0&&profile.rules===null&&totals&&parseFloat(totals.subTotal)>=parseFloat(profile.freeShipThreshold)){profile.sortedShipPrice=0;validShipProfilesCollection.push(profile)}else if(profile.applyEntireOrder){var shipPrice=getShipProfileOrderPrice(profile);if(shipPrice!=null){profile.sortedShipPrice=shipPrice;validShipProfilesCollection.push(profile)}}else if(Object.keys(items).length>0){var itemClone=JSON.parse(JSON.stringify(items));//deep clone
var shipItems=applyShipProfileProductRules(profile,itemClone);if(shipItems.update){profile.sortedShipPrice=0;validShipProfilesCollection.push(profile)}}}if(Object.keys(items).length&&globalStoreDetails.length){for(var _i92 in items){if(items[_i92].allowStorePickup=="1"&&items[_i92].billingCycleType==="ONE_TIME"){allowStorePickup=true;break}}if(allowStorePickup){for(var _i93 in globalStoreDetails){validShipProfilesCollection.push({"shipProfileId":"pickup-"+globalStoreDetails[_i93].storePickupId,"profileName":"Pickup: "+globalStoreDetails[_i93].title+" "+globalStoreDetails[_i93].address})}}else if(shipProfile&&shipProfile.storePickupId){shipProfile=null}}validShipProfilesCollection=validShipProfilesCollection.sort(function(a,b){var sp1=parseFloat(a.sortedShipPrice),sp2=parseFloat(b.sortedShipPrice);return sp1-sp2});if(input.type==="select-one"){$("[name=shipProfileId] option").each(function(){if($(this).val().includes(":")){validShipProfilesCollection.push({"shipProfileId":$(this).val(),"profileName":$(this).text()})}});var chooseOptionText=input.options.length>0&&input.options[0].value==""?input.options[0].text:null;input.innerHTML="";var validShipProfileLength=validShipProfilesCollection.length;for(var _i94=0;_i94<validShipProfileLength;_i94++){var shipProfileId=validShipProfilesCollection[_i94].shipProfileId;var option=document.createElement("OPTION");option.value=shipProfileId;var shipLabel="";if(disableShowShipProfilePrices==="true"){shipLabel=validShipProfilesCollection[_i94].profileName}else{shipLabel=addShippingDisplay(validShipProfilesCollection[_i94],shipLabel,totals)}option.innerHTML=shipLabel;input.add(option);if(shipProfile){if(typeof shipProfile==="string"){if(shipProfile==shipProfileId)input.value=shipProfileId}else if(shipProfile.shipProfileId==shipProfileId){input.value=shipProfileId}else if(shipProfile.storePickupId&&"pickup-"+shipProfile.storePickupId==shipProfileId){input.value=shipProfileId}}}if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;input.prepend(chooseOption);if(input.options.length==1)input.value=""}if(input.options.length>0&&input.value==""){//choose an external value if no profiles are valid
for(var i=0;i<input.options.length;i++){if(input.options[i].value.indexOf(":")>0){input.value=input.options[i].value;break}}}}else if(input.type==="radio"){var currentProfileId=shipProfile?shipProfile.shipProfileId||"pickup-"+shipProfile.storePickupId:null;populateRadioShipProfiles(validShipProfilesCollection,currentProfileId)}input.removeEventListener("change",displayPrices);input.addEventListener("change",displayPrices)}function populateRadioShipProfiles(validProfiles,currentProfileId){var disableShowShipProfilePrices=getAddOnKeyValue(findAddOn("DIS_SHOW_SHIP_PRICES"));var totals=JSON.parse(sessionStorage.getItem("totals"));try{var shipRadioBtnContainers=$(".fk-form-radio-button-parent").has("input[name='shipProfileId']");if(!shipRadioBtnContainers.length){return}shipRadioBtnContainers.attr("shipradio",true);var shipProfileDiv=shipRadioBtnContainers.first();shipProfileDiv.find("[name='shipProfileId']").attr({"value":0});shipProfileDiv.find(".form-check-label").text("None");shipProfileDiv.attr("shipradio",false);$("[shipradio=true]").remove();var validProfilesLength=validProfiles.length;for(var _i95=0;_i95<validProfilesLength;_i95++){//add radio button for each valid profile
var cloned=shipProfileDiv.clone(true);cloned.find("[name='shipProfileId']").attr({"value":validProfiles[_i95].shipProfileId});var shipLabel="";if(disableShowShipProfilePrices==="true"){shipLabel=validProfiles[_i95].profileName}else{shipLabel=addShippingDisplay(validProfiles[_i95],shipLabel,totals)}cloned.find(".form-check-label").text(shipLabel);cloned.insertBefore(shipProfileDiv)}validProfilesLength&&shipProfileDiv.remove();if(currentProfileId)$("input[name=shipProfileId][value="+currentProfileId+"]").prop("checked",true);else shipRadioBtnContainers.first().prop("checked",true)}catch(error){console.log(error)}}function addShippingDisplay(shipProfile,label,totals){var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?parseFloat(sessionStorage.getItem("exchangeRate")):1;var freeShipThreshold=shipProfile.freeShipThreshold?parseFloat((parseFloat(shipProfile.freeShipThreshold)*exchangeRate).toFixed(2)):0;var shipDisplay="";var shipPrice="";if(shipProfile.applyEntireOrder){shipPrice=getShipProfileOrderPrice(shipProfile);shipPrice=shipPrice>0?parseFloat(shipPrice*exchangeRate).toFixed(2):shipPrice;shipDisplay=shipPrice=="0.00"?"FREE":ccFormatCurrency(shipPrice,pageData.selectedCampaign.currencySymbol)}if(freeShipThreshold){if(freeShipThreshold>0&&totals&&(shipProfile.includeCoupons?parseFloat(totals.subTotal)-parseFloat(totals.discount||0):parseFloat(totals.subTotal))>=freeShipThreshold){shipDisplay="FREE"}else if(shipPrice=="0.00"){shipPrice=getShipProfileOrderPrice(shipProfile);shipDisplay=""}}label=shipDisplay?shipProfile.profileName+" - "+shipDisplay:shipProfile.profileName;return label}function navigate(attributes){var URL=attributes.href.value;var target=attributes.target.value;if(target!==null&&target!==""){window.open(URL,target)}else{getCurrentWindowLocation().replace(URL)}}function checkBoxChange(attributes){if(attributes&&attributes["name"]&&attributes["onclick"]){var name=attributes["name"].value.toLowerCase();var checked=attributes["onclick"].ownerElement.checked;var orderBumpParent=$(attributes["onclick"].ownerElement).closest(".bump-div-class");var bill=["firstName","lastName","address1","address2","city","country","state","postalCode","fullName"];var _ship=["shipFirstName","shipLastName","shipAddress1","shipAddress2","shipCity","shipCountry","shipState","shipPostalCode","shipFullName"];var setBillShipInputs=0;if(name==="billshipsame"&&attributes.openCheckBoxSection&&attributes.openCheckBoxSection.value!=""){//determine if checkbox opens bill or ship inputs
var shippingSectionID="#"+attributes.openCheckBoxSection.value;var shippingSectionIDElement=$(shippingSectionID);if(shippingSectionIDElement&&shippingSectionIDElement.length>0){var findShipAddress=$(shippingSectionID).find("[name=shipAddress1]");setBillShipInputs=findShipAddress&&findShipAddress.length>0?1:2}}if(name==="billshipsame"&&checked){var billLength=bill.length;for(var _i96=0;_i96<billLength;_i96++){var billInput=document.getElementsByName(bill[_i96])[0];var shipInput=document.getElementsByName(_ship[_i96])[0];if(billInput&&shipInput){if(setBillShipInputs!=2&&billInput.value!==undefined&&billInput.value!==""&&billInput.value!==shipInput.value){shipInput.value=billInput.value;if(_ship[_i96]==="shipCountry"){loadStates("shipState",shipInput.value);continue}}if(setBillShipInputs!=1&&shipInput.value!==undefined&&shipInput.value!==""&&shipInput.value!==billInput.value){billInput.value=shipInput.value;if(bill[_i96]==="country"){loadStates("state",billInput.value);continue}}}}}else if(name==="billshipsame"&&!checked){var parentForm=attributes["name"].ownerElement&&attributes["name"].ownerElement.form?_toConsumableArray(attributes["name"].ownerElement.form):null;var billIndex=-1;var shipIndex=-1;if(parentForm){parentForm.forEach(function(formElement,index){if(formElement.name==="address1"){billIndex=index}if(formElement.name==="shipAddress1"){shipIndex=index}});if(shipIndex==-1||billIndex<shipIndex&&billIndex>-1){clearAddressValues(_ship)}else{clearAddressValues(bill)}}if(!$("[name=\"country\"]").val()){$("[name=\"country\"] option:eq(0)").prop("selected",true);loadStates("state",$("[name=\"country\"]").val())}if(!$("[name=\"shipCountry\"]").val()){$("[name=\"shipCountry\"] option:eq(0)").prop("selected",true);loadStates("shipState",$("[name=\"shipCountry\"]").val())}}else if(name==="orderbump"){adjustVariantOrderBump(orderBumpParent,checked)}}displayShipSection(attributes);displayPrices()}function adjustVariantOrderBump(orderBumpParent,checked){if(orderBumpParent){var productSectionElement=$(orderBumpParent).find(".fk-product-section");var productVariants=$(productSectionElement).find("[name='variant1'], [name='variant2'], [name='variant3']").filter("select");var _product13=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==$(productSectionElement).attr("value")});var campaignProductId=_product13&&_product13[0]&&_product13[0].campaignProductId;var quantityInput=productSectionElement[0]&&productSectionElement[0].querySelectorAll("input[name='quantity'], select[name='quantity']")[0];if(!$(quantityInput).val()){$(quantityInput).val(1)}if(campaignProductId){var _orderItems9=getOrderItems();if(checked){getVariants(productSectionElement[0]&&productSectionElement[0].id)}else{if(_orderItems9&&Object.keys(_orderItems9).length>0){var orderItemsEntries=Object.entries(_orderItems9);var orderItemsEntriesLength=orderItemsEntries.length;for(var _i97=0;_i97<orderItemsEntriesLength;_i97++){var key=orderItemsEntries[_i97][0];campaignProductId=isSubscribeOn?swapSubscriptions(_orderItems9,"",campaignProductId).sectionValue:campaignProductId;if(key.includes(campaignProductId.toString()))delete _orderItems9[key]}sessionStorage.setItem("fkCart",JSON.stringify(_orderItems9))}}}}}// Method created for sliding inputs (JIRA Ticket #FUN2-1745)
function slideForm(attributes,e){e.preventDefault();var openID="";var dataType="";if(attributes.openid.value!==""){openID="#"+attributes.openid.value;dataType=attributes.openiddatatype?attributes.openiddatatype.value:""}var buttonHideID="#"+e.currentTarget.id;if(openID!==""&&$(openID).is(":hidden")){getCurrentWindowLocation().hash=openID;$(openID).slideDown("slow");if(dataType!=="form"){smoothScrolling(e)}}$(buttonHideID).hide()}//Method to slide button and link without hiding it
function slideWithoutHideForm(attributes,e){e.preventDefault();var openID="";var dataType="";var openSectionElements=$("button[action=\"openSectionWithoutHide\"], a[action=\"openSectionWithoutHide\"]");if(attributes.openid.value!==""){openID="#"+attributes.openid.value;dataType=attributes.openiddatatype?attributes.openiddatatype.value:""}if(openID!==""){var elementDisplayProp=$(openID).css("display");openSectionElements.each(function(){var elementOpenId="#"+$(this).attr("openid");if($("#"+attributes.id.value).closest(elementOpenId).length===0){$(elementOpenId).hide()}});if(elementDisplayProp!=="none"){return}getCurrentWindowLocation().hash=openID;$(openID).slideDown("slow");if(dataType!=="form"){smoothScrolling(e,hideCheckBoxSection)}}}// Method created for sliding inputs - calling import lead functionality on a sliding input (JIRA Ticket #FUN2-1745)
function slideMethod(_x40,_x41){return _slideMethod.apply(this,arguments)}function _slideMethod(){_slideMethod=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee31(attributes,e){var openID,dataType,buttonId,buttonHideID,windowLocation,route,errorID,tag;return _regeneratorRuntime().wrap(function _callee31$(_context35){while(1)switch(_context35.prev=_context35.next){case 0:e.preventDefault();if(!(e.detail!==1)){_context35.next=3;break}return _context35.abrupt("return");case 3:openID="";dataType="";if(attributes.openid.value!==""){openID="#"+attributes.openid.value;dataType=attributes.openiddatatype?attributes.openiddatatype.value:""}buttonId=e.currentTarget.dataset.id;buttonHideID="#"+e.currentTarget.id;windowLocation=getCurrentWindowLocation().href;route=windowLocation+openID;if(!checkRequiredInputs(null,buttonId)){_context35.next=20;break}disableInteractions(buttonId,true,true);_context35.next=14;return importLead(buttonId,route);case 14:errorID="error-"+buttonId;tag=document.getElementById(errorID);if(tag){tag.setAttribute("id","");tag.innerHTML=""}if(openID!==""&&$(openID).is(":hidden")){getCurrentWindowLocation().hash=openID;$(openID).slideDown("slow");if(dataType!=="form"){smoothScrolling(e)}autoLoadInputs()}$(buttonHideID).hide();enableInteractions();case 20:case"end":return _context35.stop()}},_callee31)}));return _slideMethod.apply(this,arguments)}function smoothScrolling(e,callback){var target=$(getCurrentWindowLocation().hash);target=target.length?target:$("[name="+getCurrentWindowLocation().hash.slice(1)+"]");if(target.length){if(e){e.preventDefault()}$("html, body").animate({scrollTop:target.offset().top},1000,function(){var $target=$(target);$target.focus();if($target.is(":focus")){return false}else{$target.attr("tabindex","-1");callback&&callback();$target.focus()};})}}function initializePAAY(paayApiKey){var campaignData=pageData.selectedCampaign;if(!campaignData){$.ajax({url:"campaign.json?"+Date.now(),method:"get",success:function success(results){campaignData=results.selectedCampaign}})}var orderData=globalOrderData||{};//add PAAY attributes to required page inputs
var inputArray={"cardNumber":"pan","cardMonth":"month","cardYear":"year"};var inputFields={"paayccCardHolderName":"cardHolderName","paayemailAddress":"email","paayaddress1":"billingLine1","paayaddress2":"billingLine2","paaypostalCode":"billingPostCode","paaycity":"billingCity","paaystate":"billingState","paaycountry":"billingCountry","paayshipAddress1":"shippingLine1","paayshipAddress2":"shippingLine2","paayshipPostalCode":"shippingPostCode","paayshipCity":"shippingCity","paayshipState":"shippingState","paayshipCountry":"shippingCountry","paayccAddrMatch":"addrMatch","paayshipIndicator":"shipIndicator","paaydeliveryTimeFrame":"deliveryTimeFrame","paayreorderItemsInd":"reorderItemsInd","paaymobileCC":"mobileCC","paaymobilePhoneNum":"mobilePhoneNum"};var parent;var cardInputDetails={"cardMonth":"month","cardYear":"year"};var cardMonth=document.getElementsByName("cardMonth");var cardYear=document.getElementsByName("cardYear");var pageTypeId=pageData.pageTypeId;if(pageTypeId===4){for(var key in inputArray){var input=document.getElementsByName(key)[0];if(input){input.setAttribute("data-threeds",inputArray[key]);parent=input.form;if(!parent){parent=document.createElement("form");document.body.append(parent)}}}if(cardMonth.length===0&&cardYear.length===0){for(var hiddenInput in cardInputDetails){var _input4=document.createElement("input");_input4.type="hidden";_input4.name=hiddenInput;_input4.value=sessionStorage.getItem("paay_"+cardInputDetails[hiddenInput]);_input4.setAttribute("data-threeds",cardInputDetails[hiddenInput]);parent&&parent.append(_input4)}}}else{parent=document.forms.length!==0?document.forms[0]:null;if(!parent){parent=document.createElement("form");document.body.append(parent)}var _inputArray={"cardNumber":"pan","cardMonth":"month","cardYear":"year"};for(var _hiddenInput in _inputArray){var _input5=document.createElement("input");_input5.type="hidden";_input5.name=_hiddenInput;_input5.value=sessionStorage.getItem("paay_"+_inputArray[_hiddenInput]);_input5.setAttribute("data-threeds",_inputArray[_hiddenInput]);parent&&parent.append(_input5)}}for(var _hiddenInput2 in inputFields){var inputName=_hiddenInput2.substring(4);var inputElement=document.getElementsByName(inputName)[0];var _input6=document.createElement("input");_input6.type="hidden";_input6.readonly="readonly";_input6.name=_hiddenInput2;_input6.value=inputElement?inputElement.value:orderData[inputName]||"";_input6.setAttribute("data-threeds",inputFields[_hiddenInput2]);parent&&parent.append(_input6)}if(parent&&campaignData&&campaignData.products){if(!parent.id){parent.id="kform"};var paayTransIdInput=document.createElement("input");paayTransIdInput.type="hidden";paayTransIdInput.name="x_transaction_id";paayTransIdInput.value="1234";paayTransIdInput.setAttribute("data-threeds","id");parent.append(paayTransIdInput);var url="https://cdn.3dsintegrator.com/threeds.2.2.20230608.min.js";var sandboxUrl="https://api-sandbox.3dsintegrator.com/v2.2";var paayRebill=getAddOnKeyValue(findAddOn("PAAY_fetch_rebill"));if(paayRebill==="1")sessionStorage.setItem("paayRebill",1);var showChallenges=getAddOnKeyValue(findAddOn("PAAY_show_challenge"));$.getScript(url,function(){var options="";if(document.URL.includes("dev-funnels"))options="endpoint:\""+sandboxUrl+"\", verbose:true, ";if(showChallenges){if(parseInt(showChallenges)>0)options+="showChallenge: true, timeout: \"40\", popup: false, ";if(showChallenges==="0")options+="challengeIndicator: \"02\", ";else if(showChallenges==="2")options+="challengeIndicator: \"04\", ";else options+="challengeIndicator: \"01\", "}options+="autoSubmit:false";if(options)options=",{"+options+"}";var innerText="var tds = new ThreeDS('kform','apikey',null,options);";innerText=innerText.replace("kform",parent.id);innerText=innerText.replace("apikey",paayApiKey);innerText=innerText.replace(",options",options);var paayScript=document.createElement("script");paayScript.innerHTML=innerText;document.body.append(paayScript);var paayScript2=document.createElement("script");paayScript2.setAttribute("type","application/javascript");paayScript2.innerHTML="var id = document.querySelector('[data-threeds=id]'); var uniqueId = function() { return 'id-' + Math.random().toString(36).substr(2, 16); }; id.value = uniqueId();";document.body.append(paayScript2)})}}function ccGetCurrencyNumber(){var campaign=pageData&&pageData.selectedCampaign;if(!campaign)return;var currencyCode=returnCurrencyCode();if(!currencyCode||currencyCode===campaign.currency){return campaign.currencyNumber}else{var currencyObj=campaign.currencies&&campaign.currencies.find(function(item){return item.currencyCode===currencyCode});return currencyObj&&currencyObj.currencyNumber}}function ccReturnCardType(number){var cardNum=number&&number.toString().replace(/ /g,"").replace(/-/g,"");var cardType="";if(cardNum){var visaRegex=new RegExp("^4[0-9]*");var mastercardRegex=new RegExp("^5[1-5][0-9]*|^222[1-9][0-9]*|^22[3-9][0-9]*|^2[3-6][0-9]*|^27[0-1][0-9]*|^2720[0-9]*");var _amexRegex=new RegExp("^3[47][0-9]*");var discoverRegex=new RegExp("^6011[0-9]*|^65[0-9]*|^64[4-9][0-9]*|^6221[2-9][6-9][0-9]*|^622[2-8][0-9]*|^6229[0-2][0-5][0-9]*");if(cardNum.match(visaRegex)){cardType="visa"}else if(cardNum.match(mastercardRegex)){cardType="mastercard"}else if(cardNum.match(_amexRegex)){cardType="amex"}else if(cardNum.match(discoverRegex)){cardType="discover"}}return cardType}function ccReturnPAAYCardsForAuth(){var authenticateCards=[];var authMasterCard=getAddOnKeyValue(findAddOn("PAAY_AUTH_MSTR")),authVisaCard=getAddOnKeyValue(findAddOn("PAAY_AUTH_VISA"));authMasterCard=authMasterCard?authMasterCard==="1"?authenticateCards.push("mastercard"):false:authenticateCards.push("mastercard");authVisaCard=authVisaCard?authVisaCard==="1"?authenticateCards.push("visa"):false:authenticateCards.push("visa");getAddOnKeyValue(findAddOn("PAAY_AUTH_AMEX"))==="1"?authenticateCards.push("amex"):null;getAddOnKeyValue(findAddOn("PAAY_AUTH_DISC"))==="1"?authenticateCards.push("discover"):null;return authenticateCards}function triggerPAAY(paayCardType,upsellOrderItems){if(typeof tds==="undefined")return;tds.token=null;sessionStorage.removeItem("ccPaayChallengePromptShown");var currencyNumber=ccGetCurrencyNumber();if(currencyNumber)tds.options.currency=currencyNumber;tds.options.iframeId="paayIframeId";tds.options.forcedTimeout="60";var itemId=sessionStorage.getItem("paay_item");var items=null,recurringProduct=null;var item=null;var initialAmount=null;var variant={};var productId=itemId&&itemId.split(".");$("#ccPAAYNonAuthError").remove();var paayRejectNonAuthCards=getAddOnKeyValue(findAddOn("PAAY_REJECT_CARDS"))==="1";var amexCard=paayCardType==="amex",orderData=globalOrderData||{};var checkoutCompleted=orderData&&["COMPLETE","PENDING","COD_PENDING"].includes(orderData.orderStatus);var isShippable=false,billShipSame=false;var shipAddress=getShipProfileAddress();var paayRebill=getAddOnKeyValue(findAddOn("PAAY_fetch_rebill"))==="1";if(pageData.pageTypeId===4){items=getOrderItemDetails();var cartItemsLength=Object.keys(items).length;item=items[itemId];if(!cartItemsLength||cartItemsLength===1&&!item)return;for(var _i98 in items){if(items[_i98].cycle1_isShippable===1){isShippable=true}if(paayRebill&&!recurringProduct&&items[_i98].billingCycleType==="RECURRING"){item=items[_i98];recurringProduct=items[_i98]}}if($("[name=billShipSame]").length){billShipSame=$("[name=billShipSame]").prop("checked")}else if($("[name='country']").length&&$("[name='shipCountry']").length){billShipSame=$("[name='country']").val()===$("[name='shipCountry']").val()&&$("[name='state']").val()===$("[name='shipState']").val()&&$("[name='address1']").val()===$("[name='shipAddress1']").val()&&$("[name='address2']").val()===$("[name='shipAddress2']").val()}else if($("[name='country']").length){billShipSame=true;shipAddress.address1=$("[name=address1]").val()||"";shipAddress.address2=$("[name=address2]").val()||"";shipAddress.city=$("[name=city]").val()||"";shipAddress.postalCode=$("[name=postalCode]").val()||"";shipAddress.country=$("[name=country]").val()||"";shipAddress.state=$("[name=state]").val()||""}variant=item.variant||{};var itemPrice=!item.isVariantBundle&&!item.isEditable&&variant&&parseFloat(variant.price)>0?parseFloat(variant.price):parseFloat(item.cycle1_price);if(cartItemsLength>1||itemPrice>0){var _JSON$parse2=JSON.parse(sessionStorage.getItem("totals")),grandTotal=_JSON$parse2.grandTotal;initialAmount=grandTotal}else if(item.billingCycleType==="ONE_TIME"){var buttonId=sessionStorage.getItem("paay_buttonId");var _route7=sessionStorage.getItem("paay_route");sessionStorage.removeItem("paayEnabled");sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");importOrder(buttonId,_route7);return}else{var recurringPrice=!item.isVariantBundle&&!item.isEditable&&variant&&parseFloat(variant.price)>0?parseFloat(variant.price):parseFloat(item.cycle2_price);var recurringShipPrice=!item.isVariantBundle&&variant&&parseFloat(variant.shippingPrice)>0?parseFloat(variant.shippingPrice):parseFloat(item.cycle2_shipPrice);initialAmount=(getItemPrice(itemId,recurringPrice,item.currentOrderQuantity)+getShipPrice(recurringShipPrice,item.currentOrderQuantity)).toFixed(2);sessionStorage.removeItem("paayRebill");if(item.trialAuthType!=="HOLDTRIALCHARGE"){sessionStorage.setItem("paayInitialAsRebill","1")}}}else{//items = getOrderItemDetails();
item=productId&&pageData.selectedCampaign.products.find(function(data){return data.campaignProductId===parseInt(productId[0])});isShippable=item&&item.cycle1_isShippable===1;if(upsellOrderItems&&Object.keys(upsellOrderItems).length){var _loop24=function _loop24(){var campaignProductId=id&&id.split(".")[0];var product=pageData.selectedCampaign.products.find(function(data){return data.campaignProductId===Number(campaignProductId)});if(product){if(!item)item=product;if(paayRebill&&!recurringProduct&&product.billingCycleType==="RECURRING"){item=product;recurringProduct=product}if(product.cycle1_isShippable===1)isShippable=true}};for(var id in upsellOrderItems){_loop24()}}if(!item)return;billShipSame=orderData["country"]===orderData["shipCountry"]&&orderData["state"]===orderData["shipState"]&&orderData["address1"]===orderData["shipAddress1"]&&orderData["address2"]===orderData["shipAddress2"];variant=!item.isVariantBundle&&productId.length>1&&item.variants&&item.variants.find(function(data){return data.variantDetailId===parseInt(productId[1])})||{};var variantPrice=variant&&!item.isEditable&&parseFloat(variant.price)>0?parseFloat(variant.price):null;var variantShipPrice=variant&&parseFloat(variant.shippingPrice)>0?parseFloat(variant.shippingPrice):null;var productPrice=variant.price||parseFloat(item.cycle1_price);if(productPrice>0){initialAmount=(getItemPrice(itemId,productPrice,1)+getShipPrice(variantShipPrice||item.cycle1_shipPrice,1)).toFixed(2)}else if(item.billingCycleType==="ONE_TIME"){var _buttonId2=sessionStorage.getItem("paay_buttonId");var _route8=sessionStorage.getItem("paay_route");sessionStorage.removeItem("paayEnabled");sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");importUpsale(_buttonId2,_route8);return}else{initialAmount=(getItemPrice(itemId,variantPrice||item.cycle2_price,1)+getShipPrice(variantShipPrice||item.cycle2_shipPrice,1)).toFixed(2);sessionStorage.removeItem("paayRebill");if(item.trialAuthType!=="HOLDTRIALCHARGE"){sessionStorage.setItem("paayInitialAsRebill","1")}}}var buyerName="",phoneNumberValue="",phoneDialCodeValue="";if(pageData.pageTypeId===4){if($("[name='fullName']").val()){buyerName=$("[name='fullName']").val();buyerName=buyerName&&buyerName.replace(/\s+/g," ").trim()||""}else if($("[name='firstName']").val()&&$("[name='lastName']").val()){var firstName=$("[name='firstName']").val().trim(),lastName=$("[name='lastName']").val().trim();buyerName=firstName&&lastName?firstName+" "+lastName:""}else if($("[name='shipFullName']").val()){buyerName=$("[name='shipFullName']").val();buyerName=buyerName&&buyerName.replace(/\s+/g," ").trim()||""}else if($("[name='shipFirstName']").val()&&$("[name='shipLastName']").val()){var _firstName=$("[name='shipFirstName']").val().trim(),_lastName=$("[name='shipLastName']").val().trim();buyerName=_firstName&&_lastName?_firstName+" "+_lastName:""}else if(orderData["firstName"]&&orderData["lastName"]){var _firstName2=orderData["firstName"].trim(),_lastName2=orderData["lastName"].trim();buyerName=_firstName2&&_lastName2?_firstName2+" "+_lastName2:""}else if(orderData["shipFirstName"]&&orderData["shipLastName"]){var _firstName3=orderData["shipFirstName"].trim(),_lastName3=orderData["shipLastName"].trim();buyerName=_firstName3&&_lastName3?_firstName3+" "+_lastName3:""}}else{var _firstName4=(orderData["firstName"]||"").trim(),_lastName4=(orderData["lastName"]||"").trim();buyerName=_firstName4&&_lastName4?_firstName4+" "+_lastName4:""}$("[name='paayccCardHolderName']").val(buyerName);if(phFormatByCountry==="true"){if(pageData.pageTypeId===4){var dialCodeValue=($(".iti__selected-dial-code").first().html()||sessionStorage.getItem("ccPhoneDialCode")||"").replace(/\D/ig,"");var phoneInputValue=($("[name='phoneNumber']").first().val()||orderData.phoneNumber||"").replace("+"+dialCodeValue,"").replace(/\D/ig,"");if(phoneInputValue&&dialCodeValue&&dialCodeValue.length<=3){!checkoutCompleted&&sessionStorage.setItem("ccPhoneDialCode",dialCodeValue);phoneNumberValue=phoneInputValue;phoneDialCodeValue=dialCodeValue}}else{var phoneDialCode=sessionStorage.getItem("ccPhoneDialCode"),orderPhoneNumber=(orderData.phoneNumber||"").replace("+"+phoneDialCode,"").replace(/\D/ig,"");if(orderPhoneNumber&&phoneDialCode&&phoneDialCode.length<=3){phoneNumberValue=phoneNumber;phoneDialCodeValue=phoneDialCode}}}$("[name='paaymobileCC']").val(phoneDialCodeValue);$("[name='paaymobilePhoneNum']").val(phoneNumberValue);function getCountryISOCode(countryCode){var countryObj=countryCode&&pageData.selectedCampaign&&pageData.selectedCampaign.countries&&pageData.selectedCampaign.countries.find(function(item){return item.countryCode===countryCode});return countryObj&&countryObj.numericCode||"840"}if(isShippable||amexCard){$("[name='paayshipCity']").val(shipAddress.city);$("[name='paayshipCountry']").val(getCountryISOCode(shipAddress.country));$("[name='paayshipAddress1']").val(shipAddress.address1);$("[name='paayshipAddress2']").val(shipAddress.address2);$("[name='paayshipPostalCode']").val(shipAddress.postalCode);$("[name='paayshipState']").val(shipAddress.state)}else{$("[name='paayshipCity']").val("");$("[name='paayshipCountry']").val("");$("[name='paayshipAddress1']").val("");$("[name='paayshipAddress2']").val("");$("[name='paayshipPostalCode']").val("");$("[name='paayshipState']").val("")}if(billShipSame){$("[name='paaycity']").val(shipAddress.city);$("[name='paaycountry']").val(getCountryISOCode(shipAddress.country));$("[name='paayaddress1']").val(shipAddress.address1);$("[name='paayaddress2']").val(shipAddress.address2);$("[name='paaypostalCode']").val(shipAddress.postalCode);$("[name='paaystate']").val(shipAddress.state)}else{$("[name='paaycity']").val($("[name='city']").val()||orderData["city"]);$("[name='paaycountry']").val(getCountryISOCode($("[name='country']").val()||orderData["country"]));$("[name='paayaddress1']").val($("[name='address1']").val()||orderData["address1"]);$("[name='paayaddress2']").val($("[name='address2']").val()||orderData["address2"]);$("[name='paaypostalCode']").val($("[name='postalCode']").val()||orderData["postalCode"]);$("[name='paaystate']").val($("[name='state']").val()||orderData["state"])}$("[name='paayemailAddress']").val($("[name='emailAddress']").val()||orderData["emailAddress"]);$("[name='paayccAddrMatch']").val(billShipSame?"Y":"N");if(amexCard){$("[name='paayshipIndicator']").val(isShippable?billShipSame?"01":"03":"05");$("[name='paaydeliveryTimeFrame']").val(isShippable?"04":"01");$("[name='paayreorderItemsInd']").val(cookieData["access_token"]?"02":"01")}tds.init&&tds.init();if(!amexCard){tds.formFields.merchantRiskIndicator={deliveryTimeFrameInput:null,reorderItemsIndInput:null,shipIndicatorInput:null}}if(sessionStorage.getItem("paayRebill")==="1"){if(item.billingCycleType==="ONE_TIME")sessionStorage.setItem("paayRebill",0);else{var rebillCycle=item.cycle2_price===null&&item.cycle2_shipPrice===null?1:2;var rebillAmount=(getItemPrice(itemId,Number(item["cycle2_price"])||Number(variant.price)||Number(item["cycle1_price"]),1)+getShipPrice(variant.shippingPrice||item["cycle"+rebillCycle+"_shipPrice"],1)).toFixed(2);tds.options.rebill=rebillAmount}}var paayCallback=function paayCallback(data,isRebill){var paayDetails={cc3DSError:null,threeDSStatus:null};try{var errorObj=typeof data==="string"?JSON.parse(data):{};var pollingErrorMessage="No result found for transaction as yet. Please subscribe again";paayDetails.cc3DSError=errorObj.error;if(errorObj.error&&errorObj.error.startsWith(pollingErrorMessage))return}catch(err){err}var buttonId=sessionStorage.getItem("paay_buttonId");var nonAuthECI=["00","07"].includes(data.eci);$("#ccPAAYNonAuthError").remove();var challengeTimedout=data.cardholderInfo&&data.cardholderInfo.includes("timed out");var sessionPaayChallengePromptValue=sessionStorage.getItem("ccPaayChallengePromptShown");sessionStorage.removeItem("ccPaayChallengePromptShown");if((paayRejectNonAuthCards||sessionPaayChallengePromptValue||challengeTimedout)&&(!data.eci||nonAuthECI||paayDetails.cc3DSError)){if(!challengeTimedout){var actionBtn=$("button[data-id='"+buttonId+"']");actionBtn=actionBtn.length?actionBtn:$("a[data-id='"+buttonId+"']");if(actionBtn.length&&$(".fk-popup").find(actionBtn[0]).length){var _id=$(actionBtn[0]).closest(".fk-popup").attr("id");hidePopUpBlock(_id)}$("<p id='ccPAAYNonAuthError' class='"+commonErrorClass+"' style='color: red;'>Card failed 3D Secure authentication</p>").insertAfter("[name='cardNumber']");$("[name='cardNumber']").focus()}enableInteractions();return}paayDetails.threeDSStatus=data.status;if(!nonAuthECI){var sessionKey=isRebill?"paayRebillData":"paayInitialData";sessionStorage.setItem(sessionKey,JSON.stringify(data))}if((data.success===true||["Y","A"].includes(data.status))&&sessionStorage.getItem("paayRebill")==="1"&&sessionStorage.getItem("paayInitial")===null){sessionStorage.setItem("paayInitial",1);return}var route=sessionStorage.getItem("paay_route");sessionStorage.setItem("paayCompleted",1);sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");sessionStorage.removeItem("paayInitial");if(pageData.pageTypeId===4){importOrder(buttonId,route,null,paayDetails)}else{importUpsale(buttonId,route,paayDetails)}};var paayInitialCallback=function paayInitialCallback(data){paayCallback(data,false)};var paayRebillCallback=function paayRebillCallback(data){paayCallback(data,true)};var showChallenges=getAddOnKeyValue(findAddOn("PAAY_show_challenge"));if(showChallenges==="2"){var paayChallengeMinAmount=Number(getAddOnKeyValue(findAddOn("PAAY_CH_MIN_AMT")))||0;tds.options.challengeIndicator=initialAmount>=getItemPrice(null,paayChallengeMinAmount,1,true)?"04":"01"}if(showChallenges&&parseInt(showChallenges)>0){tds.options.prompt=function(){var paayIframe=document.querySelector("#paayIframeId");if(paayIframe){sessionStorage.setItem("ccPaayChallengePromptShown","1");paayIframe.style.position="fixed";paayIframe.style.width="100vw";paayIframe.style.height="100vh";paayIframe.style.top=0;paayIframe.style.left=0;paayIframe.style.zIndex=2147483647;paayIframe.style.background="#FFFFFF"}}}else{tds.options.prompt=function(){var buttonId=sessionStorage.getItem("paay_buttonId");var route=sessionStorage.getItem("paay_route");sessionStorage.setItem("paayCompleted",1);sessionStorage.removeItem("paay_buttonId");sessionStorage.removeItem("paay_route");sessionStorage.removeItem("paay_item");sessionStorage.removeItem("paayInitial");if(pageData.pageTypeId===4){importOrder(buttonId,route)}else{importUpsale(buttonId,route)}}}var merchantName=getAddOnKeyValue(findAddOn("PAAY_MERCHANT_NAME")),requestorName=getAddOnKeyValue(findAddOn("PAAY_REQUESTOR_NAME"));var authDetails={amount:parseFloat(initialAmount)};merchantName?authDetails.merchantName=merchantName:null;requestorName?authDetails.requestorName=requestorName:null;tds.verify(paayInitialCallback,paayInitialCallback,authDetails,null,null,paayRebillCallback,paayRebillCallback);if(tds.errors.length>0){var _buttonId3=sessionStorage.getItem("paay_buttonId");var tag=document.getElementById("error-"+_buttonId3);if(tag===null){tag=document.createElement("p");tag.setAttribute("id","error-"+_buttonId3);tag.classList.add(commonErrorClass)}else{tag.innerHTML=""}tag.innerHTML="ERROR: "+tds.errors[0];var color=tag.style.color="red";var pageForm=$("button[data-id='"+_buttonId3+"']").length?$("button[data-id='"+_buttonId3+"']"):$("a[data-id='"+_buttonId3+"']");$(tag).insertAfter(pageForm);enableInteractions()}}function openSurveySection(attributes,e){e.preventDefault();var parentID="";var targetSurveyID="";var surveySectionElement=$(e.target).closest("section.fk-section");progressBar=document.getElementById("progressbar");if(e.currentTarget.localName==="button"){var buttonDataID=e.currentTarget.dataset.id;var button=$("button[data-id='"+buttonDataID+"']")[0];if(button.parentNode.nodeName==="SECTION"){var customName=button.parentNode.attributes.customName?button.parentNode.attributes.customName.value:"";if(customName!==""){customName=customName.replace(" ","_");var custom="custom_"+customName;sessionStorage.setItem(custom,button.innerHTML)}}parentID="#"+surveySectionElement[0].attributes.id.value}else{var radioDataID=e.currentTarget.dataset.id;var radioButton=$("input[data-id='"+radioDataID+"']")[0];var inputContainer=radioButton.parentNode;if(inputContainer.parentNode.nodeName==="SECTION"){var _customName=inputContainer.parentNode.attributes.customName?inputContainer.parentNode.attributes.customName.value:"";if(_customName!==""){_customName=_customName.replace(" ","_");var _custom="custom_"+_customName;sessionStorage.setItem(_custom,inputContainer.lastElementChild.innerHTML)}}parentID="#"+surveySectionElement[0].attributes.id.value}decrementSectionCount--;targetSurveyID+=attributes.opensurveysection?attributes.opensurveysection.value:"";if(targetSurveyID&&targetSurveyID!=="#"&&$(targetSurveyID).is(":hidden")){$(targetSurveyID).slideDown("fast");if(parentID&&parentID!==""){$(parentID).hide()}if(decrementSectionCount===0){$("#progressbar").hide();$("#progressbarcontainer").hide()}}else if(e.target.attributes.opensurveysection){var targetNonSurveyID="#"+e.target.attributes.opensurveysection.value;targetNonSurveyID.length>1&&$(targetNonSurveyID).slideDown("fast");if(parentID&&parentID!==""){$(parentID).hide()}if(decrementSectionCount===0){$("#progressbar").hide();$("#progressbarcontainer").hide()}}// Only takes place if progress bar is present
if(progressBar){var valueSet=100/surveySectionCount;var newWidth=parseInt(progressBar.style.width.replace("%",""))+valueSet;if(newWidth<=100){progressBar.style.width=newWidth+percentage;progressBar.innerHTML=Math.round(newWidth)+percentage}}return true}function displayShipSection(attributes){if(attributes.openCheckBoxSection&&attributes.openCheckBoxSection.value!=""){var shippingSectionID="#"+attributes.openCheckBoxSection.value;var shippingSectionIDElement=$(shippingSectionID);var nestedHTML=shippingSectionIDElement&&shippingSectionIDElement[0]&&shippingSectionIDElement[0].outerHTML;var openCheckBoxElement=$(nestedHTML).find("[opencheckboxsection]");$(openCheckBoxElement).each(function(){var openCheckBoxName=$(this).attr("name");var openCheckBoxNameElement=openCheckBoxName&&document.getElementsByName(openCheckBoxName);var checked=openCheckBoxNameElement&&openCheckBoxNameElement[0]&&openCheckBoxNameElement[0].checked;var openCheckBoxValue=$(this).attr("opencheckboxsection");if(openCheckBoxValue){var elementId="#"+openCheckBoxValue;if(openCheckBoxName=="billShipSame"){checked?$(elementId).hide():$(elementId).slideDown()}else{checked?$(elementId).slideDown():$(elementId).hide()}}});if(attributes.type&&attributes.type.nodeValue==="radio"){$("input:radio").each(function(){var openCheckBoxSectionValue=$(this).attr("openCheckBoxSection");if(openCheckBoxSectionValue){var checkedValue=$(this)[0]&&$(this)[0].checked;if(checkedValue){$("#"+openCheckBoxSectionValue).slideDown()}else{$("#"+openCheckBoxSectionValue).hide()}}})}else{$(shippingSectionID).is(":hidden")?$(shippingSectionID).slideDown():$(shippingSectionID).slideUp()}}}function disableButtons(disabled){var buttons=document.getElementsByTagName("button");var buttonsLength=buttons.length;if(buttonsLength!==0){for(var _i99=0;_i99<buttonsLength;_i99++){buttons[_i99].disabled=disabled}}}function disableLinks(pointerEvents){var links=document.getElementsByTagName("a");var linksLength=links.length;for(var _i100=0;_i100<linksLength;_i100++){links[_i100].style.pointerEvents=pointerEvents}}function turnOnSpinner(buttonOrLinkId,uniqueBtnId){var buttonElement=$("button[data-id='"+buttonOrLinkId+"']").length?$("button[data-id='"+buttonOrLinkId+"']"):$("a[data-id='"+buttonOrLinkId+"']");var uniqueElement=document.querySelector("[uniqueBtnId = '".concat(uniqueBtnId,"']"));var spinner=document.getElementById("fk-submit-spinner");if(spinner)spinner.style.display="block";else if(buttonElement.parents(".fk-popup")[0]){$(getParentSpinnerDiv()).insertAfter(buttonElement[0].parentNode)}else{var ele=uniqueElement||buttonElement;$(getSpinnerDiv()).insertAfter(ele)}}function getParentSpinnerDiv(){var parentSpinnerDiv=document.createElement("div");var spinnerDiv=document.createElement("div");parentSpinnerDiv.style.display="flex";parentSpinnerDiv.style.justifyContent="center";parentSpinnerDiv.id="fk-submit-spinner";spinnerDiv.className="fa fa-spinner fa-pulse fa-lg m-r-xs";spinnerDiv.style.display="inline-block";spinnerDiv.style.textAlign="center";parentSpinnerDiv.appendChild(spinnerDiv);return parentSpinnerDiv}function getSpinnerDiv(){var spinnerDiv=document.createElement("div");spinnerDiv.id="fk-submit-spinner";spinnerDiv.className="fa fa-spinner fa-pulse fa-lg m-r-xs";spinnerDiv.style.display="block";spinnerDiv.style.textAlign="center";return spinnerDiv}function turnOffSpinner(){var fkSpinner=document.getElementById("fk-submit-spinner");if(fkSpinner){fkSpinner.style.display="none";fkSpinner.remove()}}function disableInteractions(id,isButton,isLink,uniqueBtnId){isButton&&disableButtons(true);isLink&&disableLinks("none");turnOnSpinner(id,uniqueBtnId)}function enableInteractions(){var overlayEffectDiv=document.getElementById("overlayEffectDiv");if(overlayEffectDiv){overlayEffectDiv.style.display="none"}disableButtons(false);disableLinks("auto");turnOffSpinner()}function moveToNextTab(){$("#shipping").hide();$("#payment").show();$("#quantityTab").addClass("active");$("#shippingTab").removeClass("active")}function loadPlacesAutocomplete(){if(pageData.funnelData&&pageData.funnelData.addOns&&[1,2,4,8].includes(pageData.pageTypeId)){var googlePlacesKey=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="Google_Places"});if(googlePlacesKey.length!==0&&googlePlacesKey[0].keyValue){googlePlacesKey&&loadScript("https://maps.googleapis.com/maps/api/js?key="+googlePlacesKey[0].keyValue+"&libraries=places",configureAutocomplete)}}}function initAddressFields(){loadPlacesAutocomplete()}function initSocialProof(){if(pageData.funnelData&&pageData.funnelData.addOns){var socialProofKey=pageData.funnelData.addOns.filter(function(addOns){return addOns.keyName==="Social_Proof"});if(socialProofKey.length!==0&&socialProofKey[0].keyValue){var newScript=document.createElement("script");newScript.type="text/javascript";newScript.src="https://cdn-kk.cappedoutsocial.com/widget/js/popup-"+socialProofKey[0].keyValue+".js";document.body.appendChild(newScript)}}}function assignProdQtyEventListeners(){var productSections=document.getElementsByClassName("fk-product-section");var productSectionsLength=productSections.length;var _loop25=function _loop25(){var productSection=productSections[_i101];var product=pageData.selectedCampaign&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productSection.getAttribute("value")});if(product&&product[0]){if(product[0].maxOrderQty){var quantityInput=productSection.querySelectorAll("input[name='quantity']");quantityInput&&quantityInput[0]&&quantityInput[0].addEventListener("change",function(event){quantityProdSectionOnChange(event,product[0].maxOrderQty)})}var quantitySelect=productSection.querySelectorAll("select[name='quantity']");quantitySelect.length>0&&quantitySelect[0].addEventListener("change",function(event){if(pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length){getVariants(productSection.id);displayPrices()}})}};for(var _i101=0;_i101<productSectionsLength;_i101++){_loop25()}}function assignCardDetailsEventListeners(){var cardDate=document.querySelectorAll("input[name='cardDate']");var cardMonth=document.getElementsByName("cardMonth");var cardYear=document.getElementsByName("cardYear");cardDate&&cardDate[0]&&cardDate[0].addEventListener("change",function(event){var cardDateValueParsed=event.target.value.replace("/","");if(cardDateValueParsed){var month=cardDateValueParsed.substring(0,2);var year=cardDateValueParsed.substr(cardDateValueParsed.length-2);$(cardMonth[0]).attr("value",parseInt(month));$(cardYear[0]).attr("value",parseInt(year))}})}function quantityProdSectionOnChange(event,maxOrderQty){if(event.target.value>maxOrderQty){$("#alertTopAutoHideDiv")&&$("#alertTopAutoHideDiv").remove();$("body").prepend("<div id='alertTopAutoHideDiv' style='position:fixed; top:0; left:0; width:100%; z-index:999;'><div class='alert alert-danger alert-dismissible' role='alert' ><strong> Quantity cannot exceed "+maxOrderQty+" </strong><button type='button' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span></button></div></div>");event.target.value=maxOrderQty;setTimeout(function(){$("#alertTopAutoHideDiv").remove()},4000)}if(event.target.value<=0){event.target.value=""}}function fillInAddress(){// Get the place details from the autocomplete object.
var address_components=address1FieldAutComplete.getPlace().address_components;document.getElementsByName("address1")[0].value=getAddressField("street_number",address_components)+" "+getAddressField("route",address_components);document.getElementsByName("city")[0].value=getAddressField("locality",address_components);document.getElementsByName("country")[0].value=getAddressField("country",address_components);document.getElementsByName("postalCode")[0].value=getAddressField("postal_code",address_components);loadStates("state",document.getElementsByName("country")[0].value);document.getElementsByName("state")[0].value=getAddressField("administrative_area_level_1",address_components)}function fillInShipAddress(){// Get the place details from the autocomplete object.
var address_components=shipAddress1FieldAutComplete.getPlace().address_components;document.getElementsByName("shipAddress1")[0].value=getAddressField("street_number",address_components)+" "+getAddressField("route",address_components);document.getElementsByName("shipCity")[0].value=getAddressField("locality",address_components);document.getElementsByName("shipCountry")[0].value=getAddressField("country",address_components);document.getElementsByName("shipPostalCode")[0].value=getAddressField("postal_code",address_components);loadStates("shipState",document.getElementsByName("shipCountry")[0].value);document.getElementsByName("shipState")[0].value=getAddressField("administrative_area_level_1",address_components)}function fillInInputIfExists(field,value){if(document.getElementsByName(field).length){document.getElementsByName(field)[0].value=value}}function setAppleAddress(address,type,obj){var addressMap={"givenName":{billing:"firstName",shipping:"shipFirstName"},"familyName":{billing:"lastName",shipping:"shipLastName"},"addressLines":{billing:"address1",shipping:"shipAddress1",billing2:"address2",shipping2:"shipAddress2"},"locality":{billing:"city",shipping:"shipCity"},"countryCode":{billing:"country",shipping:"shipCountry"},"administrativeArea":{billing:"state",shipping:"shipState"},"postalCode":{billing:"postalCode",shipping:"shipPostalCode"},"phoneNumber":{shipping:"phoneNumber"},"emailAddress":{shipping:"emailAddress"}};var addressMapEntries=Object.entries(addressMap);var addressMapEntriesLength=addressMapEntries.length;for(var _i102=0;_i102<addressMapEntriesLength;_i102++){var key=addressMapEntries[_i102][0];var value=addressMapEntries[_i102][1];if(address[key]&&value[type]){if(key==="addressLines"){fillInInputIfExists(value[type],address[key][0]);obj[value[type]]=address[key][0];if(address[key].length>1){var address2Key=type+"2";fillInInputIfExists(value[address2Key],address[key][1]);obj[value[address2Key]]=address[key][1]}}else{fillInInputIfExists(value[type],address[key]);if(value[type]==="shipCountry"){loadStates("shipState",address[key])}obj[value[type]]=address[key]}}}}function getAddressField(field,address_components){var fieldObj=address_components.filter(function(e){return e.types.includes(field)});if(fieldObj.length){if(field==="administrative_area_level_1"||field==="country"){return fieldObj[0].short_name}else{return fieldObj[0].long_name}}else{return""}}function configureAutocomplete(){var addressField=document.getElementsByName("address1")[0];var campaignCountries=pageData.selectedCampaign.countries.map(function(e){return e.countryCode});var options={types:["address"]};if(campaignCountries.length&&campaignCountries.length<=5){options.componentRestrictions={country:campaignCountries}}if(addressField){address1FieldAutComplete=new google.maps.places.Autocomplete(addressField,options);address1FieldAutComplete.setFields(["address_component"]);google.maps.event.addListener(address1FieldAutComplete,"place_changed",fillInAddress)}var shipAddressField=document.getElementsByName("shipAddress1")[0];if(shipAddressField){shipAddress1FieldAutComplete=new google.maps.places.Autocomplete(shipAddressField,options);shipAddress1FieldAutComplete.setFields(["address_component"]);google.maps.event.addListener(shipAddress1FieldAutComplete,"place_changed",fillInShipAddress)}setTimeout(function(){// Resetting the default placeholder set by Google
if(addressField&&addressField.placeholder==="Enter a location"){addressField.placeholder=""}if(shipAddressField&&shipAddressField.placeholder==="Enter a location"){shipAddressField.placeholder=""}},1000)}function getCurrentWindowLocation(){if(window.location!==window.parent.location){//  Inside IFrame
return window.parent.location}else{return window.location}}function replaceCurrentWindow(route){if(route&&route.startsWith("https://")){window.location.replace(route);return}var reference="";if(checkDomainForRoute()){reference="/"+pageData.funnelData.referenceId}route=route.startsWith("/")?route:reference+"/"+route;// Its like a redirection, replace() does not keep the originating page in the session history
window.location.replace(route)}function getAbsolutePathByUrl(url){var parts=url.split("/");var size=3;if(checkDomainForRoute()){size=4}return parts.slice(0,size).join("/")}function setCurrentWindowLocation(route){window.onbeforeunload=null;var redirectRoute=route.startsWith("http")?route:getAbsolutePathByUrl(getCurrentWindowLocation().href)+"/"+route;if(window.location!==window.parent.location){//  Inside IFrame
window.parent.location.href=redirectRoute}else{window.location.href=redirectRoute}}function loadProfilePage(){var membership=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):getMembershipDetails();memberFields.forEach(function(field){var fieldObj=document.getElementsByName(field)[0];if(fieldObj&&membership){fieldObj.value=membership[field]}});ship.forEach(function(field){var fieldObj=document.getElementsByName(field)[0];if(fieldObj&&membership){fieldObj.value=membership[field]}})}function loadScript(url,callback,appendTo,id,dataSetAttrs,attributes,scriptContent,onErrorCallback){// Adding the script tag to the head as suggested before
var appendElement=appendTo?document[appendTo]:document.head;var script=document.createElement("script");script.type="text/javascript";script.src=url;if(id){script.id=id}if(dataSetAttrs&&dataSetAttrs.length){dataSetAttrs.forEach(function(attrs){script.dataset[attrs.key]=attrs.value})}if(attributes&&attributes.length){attributes.forEach(function(attrs){script.setAttribute(attrs.key,attrs.value)})}// Then bind the event to the callback function.
// There are several events for cross browser compatibility.
script.onreadystatechange=callback;script.onload=callback;if(scriptContent){script.innerHTML=scriptContent}script.onerror=onErrorCallback;// Fire the loading
appendElement.appendChild(script)}function clearAddressValues(addressOrigin){var addressLength=addressOrigin.length;for(var _i103=0;_i103<addressLength;_i103++){if(document.getElementsByName(addressOrigin[_i103])[0]&&document.getElementsByName(addressOrigin[_i103])[0].value!=""){document.getElementsByName(addressOrigin[_i103])[0].value=""}}}function openPopUp(element){var popupId=element?element.getAttribute("openpopup"):"customizable_popup";var modal=document.getElementById(popupId);var recurringExists=false;var modalTitle=modal.getAttribute("name");if(modalTitle==="Subscribe"){var _orderItems10=getOrderItems();var _loop26=function _loop26(id){var product=pageData.selectedCampaign.products.find(function(data){return data.campaignProductId==id.split(".")[0]});var recurringId=product.billingCycleType==="ONE_TIME"?swapSubscriptions("","",id):id;if(recurringId!==id){recurringExists=true;return 1;// break
}};for(var id in _orderItems10){if(_loop26(id))break}}if(modal){var submitButtonInModal=$(modal).find("button[action=submit], a[action=submit], .gpay-button, div[title=AmazonPay], .paypal-buttons");var noRecurringOnOrder=modalTitle==="Subscribe"&&!recurringExists;var buttonId=$(element).attr("data-id");if(pageData&&pageData.pageTypeId===4&&submitButtonInModal.length&&!checkRequiredInputs(null,buttonId)){return}else if(noRecurringOnOrder){callMethodApply(buttonId);return}modal.style.display="block"}}function loadStaticCurrencyValues(){var currencyCharArray=campaignBaseCurrencySymbol&&campaignBaseCurrencySymbol.split("")||[];var currencyRegEx=currencyCharArray.reduce(function(regexp,_char){return regexp+"["+_char+"]"},"");var regexString="("+currencyRegEx+"\\d[0-9]{0,9})(,\\d{3})*(\\.\\d{1,})?";var updatedRegex=new RegExp(regexString,"g");staticCurrencyValues=[];$("body").find(":not(iframe):not(.fk-shopping-cart):not(.fk-dynamic-invoice-price-row):not(.dynamic-shipping-total):not(.dynamic-price-total):not(.vat):not(.salesTax):not(.grandTotal):not(.discount):not(.insurance):not(.savings):not(.cc-negative-savings):not(.compareAtTotal)").addBack().contents().filter(function(index){var _this2=this;if(this.nodeType==3&&this.textContent.indexOf(campaignBaseCurrencySymbol)>-1){var values=this.textContent.match(updatedRegex);values&&values.forEach(function(value){if(!staticCurrencyValues.includes(value.substring(campaignBaseCurrencySymbol.length))){var element=$($(_this2).parent()[0]);var id=element.attr("id");if(!id){id="ccdynamiclabel"+index;element.attr("id",id)}staticCurrencyValues.push(id+"~|~"+value.substring(campaignBaseCurrencySymbol.length))}})};})}function convertStaticCurrencyValues(){var previousSymbol=sessionStorage.getItem("previousCurrencySymbol")?sessionStorage.getItem("previousCurrencySymbol"):campaignBaseCurrencySymbol;var previousFxRate=sessionStorage.getItem("previousExchangeRate")?sessionStorage.getItem("previousExchangeRate"):"1";var newSymbol=sessionStorage.getItem("currencyCodeSymbol")?sessionStorage.getItem("currencyCodeSymbol"):campaignBaseCurrencySymbol;var newFxRate=sessionStorage.getItem("exchangeRate")?sessionStorage.getItem("exchangeRate"):"1";var checkoutWorkFlowPages=[2,3,4,5].includes(pageData.pageTypeId);if(newSymbol!=previousSymbol||!ccSkipStaticCurrencyConversion&&checkoutWorkFlowPages){var skipElement=$("#items-list, .fk-dynamic-invoice-row");var staticCurrencyValuesLength=staticCurrencyValues.length;if(staticCurrencyValuesLength&&!ccSkipStaticCurrencyConversion){ccSkipStaticCurrencyConversion=true;previousSymbol=campaignBaseCurrencySymbol}var _loop27=function _loop27(){var value=staticCurrencyValues[_i104].split("~|~")[1];var dataCurrencyId=staticCurrencyValues[_i104].split("~|~")[0];var wrapperElement=document.getElementById(dataCurrencyId);if($(wrapperElement).closest(skipElement).length)return 1;// continue
var previousValue=previousSymbol!==campaignBaseCurrencySymbol?convertStaticValue(value,previousSymbol,previousFxRate):campaignBaseCurrencySymbol+value;var newValue=newSymbol!==campaignBaseCurrencySymbol?convertStaticValue(value,newSymbol,newFxRate):campaignBaseCurrencySymbol+value;if(checkoutWorkFlowPages&&!($(wrapperElement).prop("tagName")==="SPAN"&&$(wrapperElement).attr("data-cc-price"))){var applyProductPrices=$(wrapperElement).hasClass("cc-apply-currency-rules")?"data-cc-price-type='true'":"";newValue="<span data-cc-check-decimal='true' data-cc-price='"+value+"' "+applyProductPrices+">"+newValue+"</span>"}if(wrapperElement){wrapperElement.innerHTML=wrapperElement.innerHTML.replaceAll(previousValue,function replacementCallBack(){return newValue})}};for(var _i104=0;_i104<staticCurrencyValuesLength;_i104++){if(_loop27())continue}}sessionStorage.setItem("previousCurrencySymbol",newSymbol);sessionStorage.setItem("previousExchangeRate",newFxRate)}function convertStaticValue(value,currencySymbol,exchangeRate){var newValue=value;if(value.includes(".")||exchangeRate.includes(".")){newValue=(parseFloat(value)*parseFloat(exchangeRate)).toFixed(2)}else{newValue=parseInt(value)*parseInt(exchangeRate)}return currencySymbol+newValue.toString()}var ccProdSectionProducts={};var ccActionPurchaseItem=null;function replaceTokens(){var headerAndLabelList=["H1","H2","H3","H4","H5","H6","P","LABEL","SPAN","B","I"];var textBoxesAndLabels=document.querySelectorAll("label, input[type='text'], div, h1, h2, h3, h4, h5, h6, p, span, a, b, .fk-product-image, i");var purchaseItem=sessionStorage.getItem("ccActionPurchaseItem");ccActionPurchaseItem=pageData.pageTypeId===13&&purchaseItem?JSON.parse(purchaseItem):null;textBoxesAndLabels.forEach(function(el){if(el.tagName=="INPUT"){assignTokenValues("input",el)}if(el.tagName=="IMG"&&el.classList&&el.classList.contains("fk-product-image")){assignTokenValues("prodImg",el)}if(headerAndLabelList.indexOf(el.tagName)>-1){assignTokenValues("label",el)}if(el.tagName=="DIV"){var childNodes=Object.assign([],el.childNodes);var childNodesLength=childNodes.length;for(var _i105=0;_i105<childNodesLength;_i105++){var node=childNodes[_i105];var tokenMatch=node.textContent.match(/{{(.*?)}}/g);if(node.nodeName=="#text"&&tokenMatch&&tokenMatch.length){assignTokenValues("label",el);break}}}if(el.tagName=="A"){if(el.childNodes[0]&&el.childNodes[0].nodeName=="#text"){assignTokenValues("label",el)}assignTokenValues("href",el)}});for(var _productId12 in ccProdSectionProducts){delete ccProdSectionProducts[_productId12]};}function assignTokenValues(inputType,el){var currentItem=sessionStorage.getItem("currentItem");if(!currentItem&&(el.closest(".cc-dynamic-order-bump")||el.closest(".cc-dynamic-product-section")))return;var date=new Date;var orderData=JSON.parse(sessionStorage.getItem("orderData"));var requestUri=sessionStorage.getItem("requestUri");var uriParams=requestUri&&new URL(requestUri).searchParams;var loginOrder=sessionStorage.getItem("loginOrder");loginOrder=loginOrder&&loginOrder!=="undefined"&&JSON.parse(sessionStorage.getItem("loginOrder"))||{};var customerOrders=JSON.parse(sessionStorage.getItem("customerOrders"));var membershipInfo=getMembershipDetails();var membership=membershipInfo?membershipInfo:[];var orderStatusInfo=JSON.parse(sessionStorage.getItem("orderStatusInfo"));var elSubAndSave=el.closest(".cc-subscribe-and-save");if(!currentItem&&[4,33].includes(pageData.pageTypeId)){fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):null;if(fkCart&&Object.keys(fkCart).length>0)currentItem=Object.keys(fkCart)[0]}var tokenItem;var productId=$(el).closest(".fk-product-section").attr("value");if(pageData.pageTypeId===34&&elSubAndSave){var elParent=el.parentElement;var radio=elParent&&($(elParent).find(".one-time")[0]||$(elParent).find(".recurring")[0]);productId=radio?radio.value:productId}productId=productId&&productId.trim();if(Number(productId))currentItem=productId;if(orderStatusInfo){tokenItem=orderStatusInfo;updateMap(orderStatusInfo)}else if(currentItem){if(!ccProdSectionProducts[currentItem]){var _productData13=currentItem.split(".");tokenItem=pageData.selectedCampaign&&pageData.selectedCampaign.products.find(function(data){return data.campaignProductId==_productData13[0]});if(tokenItem){tokenItem=Object.assign({},tokenItem);tokenItem=getMemberPrice(tokenItem);if(tokenItem.variants&&!ccDynamicProductSection&&!dynamicOrderBump){var variantDetails=_productData13.length>1?tokenItem.variants.find(function(data){return data.variantDetailId===parseInt(_productData13[1])}):tokenItem.variants[0];if(variantDetails){//adjust a few items with variant details
variantDetails=getMemberPrice(variantDetails);tokenItem.productName+=" "+variantDetails.title;tokenItem.cycle1_price=parseFloat(variantDetails.price)>0&&!tokenItem.isVariantBundle&&!tokenItem.isEditable?variantDetails.price:tokenItem.cycle1_price;tokenItem.cycle1_shipPrice=parseFloat(variantDetails.shippingPrice)>0&&!tokenItem.isVariantBundle?variantDetails.shippingPrice:tokenItem.cycle1_shipPrice;tokenItem.imageUrl=variantDetails.imageUrl?variantDetails.imageUrl:tokenItem.imageUrl}}tokenItem.cycle1_price=parseFloat(tokenItem.cycle1_price).toFixed(2);tokenItem.cycle1_shipPrice=parseFloat(tokenItem.cycle1_shipPrice).toFixed(2)}ccProdSectionProducts[currentItem]=tokenItem}tokenItem=ccProdSectionProducts[currentItem]}else if(orderData&&orderData["items"]){tokenItem=orderData["items"][0]}else if(loginOrder&&loginOrder["items"]){tokenItem=loginOrder["items"][0]}else if(customerOrders&&customerOrders[0]["items"]){var key=Object.keys(customerOrders[0]["items"])[0];tokenItem=customerOrders[0]["items"][key]}var formattedValue="";var tokenValue="";var token="";if(inputType=="prodImg"&&tokenItem&&tokenItem.imageUrl){el.src=tokenItem.imageUrl}if(inputType=="input"){tokenValue=el.value}if(inputType=="label"){tokenValue=el.innerHTML}if(inputType=="href"){tokenValue=decodeURIComponent(el.href)}var remSubstring=tokenValue&&tokenValue.match(/{{(.*?)}}/g);if(remSubstring&&remSubstring.length>0){for(var _i106=0;_i106<remSubstring.length;_i106++){var trimmedString=remSubstring[_i106].trim().replace(/(?:^(?:&nbsp;)+)|(?:(?:&nbsp;)+$)/g,"");token=trimmedString;trimmedString=trimmedString.split("{{")[1].split("}}")[0];var isDate=trimmedString.indexOf("yy")>-1||trimmedString.indexOf("MM")>-1||trimmedString.indexOf("ddd")>-1;var orderOrUriValue=orderData&&orderData[trimmedString]||uriParams&&uriParams.has(trimmedString)&&uriParams.get(trimmedString);if(trimmedString==="savings_percent"){var savingsPercentValue=sessionStorage.getItem("savingsPercentValue")!==null?sessionStorage.getItem("savingsPercentValue"):null;formattedValue=savingsPercentValue||"";sessionStorage.removeItem("savingsPercentValue")}else if(isDate){formattedValue=setDateFormat(date,trimmedString)}else if(ccActionPurchaseItem&&ccActionPurchaseItem[trimmedString]){var value=ccActionPurchaseItem[trimmedString];formattedValue=trimmedString.indexOf("date")>-1?setDateFormat(value,"yyyy-MM-dd"):value}else if(!orderStatusInfo&&orderOrUriValue){if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(orderOrUriValue,"yyyy-MM-dd")}else{formattedValue=orderOrUriValue}}else if(!orderStatusInfo&&loginOrder&&(loginOrder[trimmedString]||loginOrder.fulfillments&&loginOrder.fulfillments[0]&&loginOrder.fulfillments[0][trimmedString])){var _value=loginOrder[trimmedString]||loginOrder.fulfillments&&loginOrder.fulfillments[0]&&loginOrder.fulfillments[0][trimmedString];if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(_value,"yyyy-MM-dd")}else{formattedValue=_value}}else if(!orderStatusInfo&&customerOrders&&customerOrders[0][trimmedString]){if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(customerOrders[0][trimmedString],"yyyy-MM-dd")}else{formattedValue=customerOrders[0][trimmedString]}}else if(tokenItem&&tokenItem[trimmedString]||orderStatusInfo&&tokenItem&&tokenItem.fulfillments&&tokenItem.fulfillments[0]&&tokenItem.fulfillments[0][trimmedString]){var _value2=tokenItem[trimmedString]||tokenItem.fulfillments&&tokenItem.fulfillments[0]&&tokenItem.fulfillments[0][trimmedString];if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(_value2,"yyyy-MM-dd")}else{formattedValue=_value2}}else if(membership&&membership[trimmedString]){if(trimmedString.indexOf("date")>-1){formattedValue=setDateFormat(membership[trimmedString],"yyyy-MM-dd")}else{formattedValue=membership[trimmedString]}}else{var isBuildOrTemplate=checkBuildOrTemplate();if(isBuildOrTemplate){formattedValue=token}else{formattedValue=""}}if(trimmedString==="stockQuantity"&&!formattedValue){formattedValue="0"}var priceValue=formattedValue,cycle1PriceToken=trimmedString.includes("cycle1_price");if(cycle1PriceToken&&formattedValue!==""){formattedValue=(parseFloat(formattedValue)*vatTaxRate).toFixed(2)}if(trimmedString.match(/price/gi)&&formattedValue!==""){if((!formattedValue||Number(formattedValue)===0)&&trimmedString==="compareAtPrice"){formattedValue=""}else if([2,3,4].includes(pageData.pageTypeId)){var _productId13=pageData.cartData&&tokenItem&&tokenItem.campaignProductId;var attr=cycle1PriceToken&&tokenItem.isPricePercent===1?" data-cc-perc-prod='true' ":"";formattedValue="<span "+attr+"data-cc-prod-id='"+_productId13+"' "+"data-cc-price-type='"+trimmedString+"' data-cc-price='"+priceValue+"'>"+ccFormatCurrency(formattedValue,pageData.selectedCampaign.currencySymbol)+"</span>"}else{formattedValue=pageData.selectedCampaign.currencySymbol+formattedValue}}if(inputType=="input"){el.value=tokenValue.replace(token,formattedValue);tokenValue=el.value}if(inputType=="label"){formattedValue=typeof formattedValue==="string"?formattedValue.replaceAll("\n","<br>"):formattedValue;if(trimmedString==="ffl_info"&&globalOrderData&&globalOrderData.customFields&&globalOrderData.customFields.fflNumber){var fflNumber=sessionStorage.getItem("fflNumber");var fflAddress=sessionStorage.getItem("fflAddress");fflAddress=fflAddress?fflAddress.split(","):[];formattedValue=(fflNumber?fflNumber:"")+(fflAddress[0]?"<br>"+fflAddress[0]:"")+(fflAddress[1]?"<br>"+fflAddress[1]+", ":"")+(fflAddress[2]||"")}else if((pageData.pageTypeId===17||pageData.pageTypeId===18)&&trimmedString==="collectionName"){formattedValue="<span class='cc-collection-name-label'></span>"}else if(trimmedString==="trackingNumber"&&formattedValue){formattedValue=addTrackingNumberLink(formattedValue,false)}el.innerHTML=tokenValue.replace(token,formattedValue);tokenValue=el.innerHTML}if(inputType=="href"){el.href=tokenValue.replace(token,formattedValue);tokenValue=el.href}}}}function addTrackingNumberLink(trackingValue,returnElement){var trackingNumber=trackingValue+"";var trackingNumberLength=trackingNumber.length;if(trackingNumber[0]==="9"&&trackingNumberLength>=20&&trackingNumberLength<=26){trackingValue="<a target='_blank' href='https://tools.usps.com/go/TrackConfirmAction_input?strOrigTrackNum="+trackingNumber+"'>"+trackingNumber+"</a>"}else if(trackingNumber.substring(0,2).toLowerCase()==="1z"){trackingValue="<a target='_blank' href='https://wwwapps.ups.com/WebTracking/track?track=yes&trackNums="+trackingNumber+"'>"+trackingNumber+"</a>"}if(returnElement&&trackingValue&&trackingValue.length>trackingNumberLength){trackingValue=$(trackingValue)[0]}return trackingValue}function setDateFormat(date,dateFormat){var orderDate=typeof date==="string"?new Date(date):date;var formattedDate="";var monthShort=["Jan","Feb","$ar","Apr","$ay","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var monthLong=["January","February","$arch","April","$ay","June","July","August","September","October","November","December"];var dayShort=["Sun","Mon","Tue","We$","Thu","Fri","Sat"];var dayLong=["Sun$ay","Mon$ay","Tues$ay","We$nes$ay","Thurs$ay","Fri$ay","Satur$ay"];var year=orderDate.getFullYear().toString();formattedDate=dateFormat;formattedDate=formattedDate.replace("yyyy",year);formattedDate=formattedDate.replace("yy",year.substring(2,4));formattedDate=formattedDate.replace("MMMM",monthLong[orderDate.getMonth()]);formattedDate=formattedDate.replace("MMM",monthShort[orderDate.getMonth()]);formattedDate=formattedDate.replace("MM",appendLeadingZeroes(orderDate.getMonth()+1));formattedDate=formattedDate.replace("M",orderDate.getMonth()+1);formattedDate=formattedDate.replace(/\$/g,"M");//so the replace on line above this does not get "May"
formattedDate=formattedDate.replace("dddd",dayLong[orderDate.getDay()]);formattedDate=formattedDate.replace("ddd",dayShort[orderDate.getDay()]);formattedDate=formattedDate.replace("dd",appendLeadingZeroes(orderDate.getDate()));formattedDate=formattedDate.replace("d",orderDate.getDate());formattedDate=formattedDate.replace(/\$/g,"d");//so the replace on line above this does not get "day"
return formattedDate}function affixImports(type,url,onloadFunction){if(type==="js"){var newScript=document.createElement("script");var scriptData=document.getElementById("scriptData");if(onloadFunction){newScript.onload=onloadFunction}document.body.insertBefore(newScript,scriptData);newScript.src=url}else{// To move the links to head if anything is present other than it
var listItems=document.getElementsByTagName("link");Array.from(listItems,function(elem){if(elem.parentElement.nodeName!=="HEAD"){document.head.appendChild(elem)}});var newLink=document.createElement("link");document.head.insertBefore(newLink,listItems[listItems.length-1].nextSibling);newLink.rel="stylesheet";newLink.href=url}}function configurePopup(){$("<div/>",{"class":"dialogContainer","id":"dialogContainer"}).appendTo("body");$("#dialogContainer").position({my:"center",at:"center"});$("<div/>",{"class":"dialogIframeDiv","id":"dialogIframeDiv"}).appendTo("#dialogContainer");$("#dialogIframeDiv").dialog({resizable:false,autoOpen:false,height:$(window).height()*.75,width:$(window).width()*.75,show:"slideDown",modal:true,open:function open(){setTimeout(function(){$(".dialogPopupIframe").focus()},1000)}});$(".ui-dialog-titlebar").css({"background":"none","border":"0"});$(".dialogIframeDiv").css({"padding":"5px"});window.addEventListener("resize",function(){var popupHeight=ccPopupConfigData["ccdesktoppopupheight"],popupWidth=ccPopupConfigData["ccdesktoppopupwidth"];if(window.innerWidth<=600){popupHeight=ccPopupConfigData["ccmobilepopupheight"];popupWidth=ccPopupConfigData["ccmobilepopupwidth"]}$("#dialogIframeDiv").dialog({height:$(window).height()*popupHeight,width:$(window).width()*popupWidth});var headerHeight=$(".cartPanelHeader").css("height");$("body").css({marginTop:headerHeight})})}function appendLeadingZeroes(n){if(n<=9){return"0"+n}return n}function selectRadioTiles(element,source){var variantTypeCheckedValue=element.getAttribute("varianttype");var productVariantElement=element.closest(".fk-product-variant-select");if(variantTypeCheckedValue&&variantTypeCheckedValue.toLowerCase()=="color"&&!element.classList.contains("ccNoColorTile")){var border=productVariantElement?"2px solid #000000":"2px solid #000000";var boxShadow=productVariantElement?"rgb(230 241 241) 0px 0px 1px 1px inset":"0 0 0 2px #f3f5f6 inset";$(element).css({"border":border,"box-shadow":boxShadow})}else{if(source==="from-on-load"){element.firstElementChild.checked=true}var selectedColor=$(element).closest(".fk-product-section").attr("selectedcolor");var _boxShadow=productVariantElement?"rgb(230 241 241) 0px 0px 1px 1px inset":"0 0 0 2px #000";$(element).css({"background-color":selectedColor?selectedColor:"","cursor":"pointer","box-shadow":_boxShadow});productVariantElement&&$(element).css({"border":"2px solid #000000"})}$(element).attr("data-selected","true")}function productVariantTileClick(element){var variantRadioTiles=element.closest(".variant-parent-div");if(variantRadioTiles&&variantRadioTiles.children&&variantRadioTiles.children.length>0){var childElementLength=variantRadioTiles.children.length;var childElements=variantRadioTiles.children;for(var _i107=0;_i107<childElementLength;_i107++){var childElement=childElements[_i107];childElement=childElement.tagName.toLowerCase()=="div"?childElement.firstElementChild:childElement;var variantTypeValue=childElement.getAttribute("varianttype");if(variantTypeValue&&variantTypeValue.toLowerCase()=="color"&&!childElement.classList.contains("ccNoColorTile")){$(childElement).css({"box-shadow":"unset","border":"2px solid #c5cacd"})}else{childElement.style.setProperty("background-color","unset","important");childElement.style.setProperty("box-shadow","unset","important");if($(element).closest(".fk-product-variant-select")[0]){childElement.style.setProperty("border","2px solid #c5cacd")}}$(childElement).attr("data-selected","false")}}if(element.checked==true){if(element&&element.parentElement){selectRadioTiles(element.parentElement)}}}$("input[type=radio][class=variant-radio]").on("click change",function(e){productVariantTileClick(this)});function showVariantImageOnProductSection(){var prodSection=document.querySelectorAll(".fk-product-section");if(prodSection&&prodSection.length>0){prodSection.forEach(function(prodSection){var prodImg=$(prodSection).find("img");var prodValue=prodSection&&prodSection.getAttribute("value");var prodPrice=$(prodSection).find(".fk-price")[0];var prodShipPrice=$(prodSection).find(".fk-ship-price")[0];if(prodImg&&prodImg[0]){showVariantImage(prodSection,prodImg[0],prodValue,prodPrice,prodShipPrice)}})}}function mapSelectVariant(product,productSection,productData,index,isChangeProdSection){try{var tileVariantValue={};for(var _i108=1;_i108<=3;_i108++){var key="variant"+_i108;tileVariantValue[key]=$(productSection).find("[data-selected=true][name="+key+"]").find("[type=radio]").attr("data-value")}$(productSection).find(".variant-parent-div").remove();var variantsLength=product&&product.variants&&product.variants.length;var variantTypeCount=variantsLength>0?getNumOfVariantTypes(product):0;var firstSelect=productSection.querySelector("select[name='variant"+1+"']");var firstSelectGroup=firstSelect&&firstSelect.closest(".fk-element-container");["1","2","3"].map(function(value){var currentValueSelect=productSection.querySelector("select[name='variant"+value+"']");if(isChangeProdSection&&value<=variantTypeCount&&!currentValueSelect&&firstSelectGroup){var newSelect=firstSelect.cloneNode();var newSelectGroup=firstSelectGroup.cloneNode();newSelectGroup.removeAttribute("id");newSelect.setAttribute("name","variant"+value);var label=$(firstSelect).siblings("label")[0];var newLabel=label&&label.cloneNode();newSelectGroup.append(newSelect);newLabel&&newSelect.before(newLabel);productSection.querySelector("select[name='variant"+(value-1)+"']").closest(".fk-element-container").after(newSelectGroup)}else if(value!=1&&value>variantTypeCount&&isChangeProdSection){var variantEle=productSection.querySelectorAll("select[name='variant"+value+"']");removeItems(variantEle,"",true)}var productVariants=productSection.querySelectorAll("select[name='variant"+value+"']");var productVariantsTile=productSection.querySelectorAll(".variant-label"+value);var variantTileLabel="";var usedValues=[];if(productVariants&&productVariants.length>0){product&&populateVariantSelects(product,productSection,productVariants,"",value,productData,true,isChangeProdSection)}else if(productVariantsTile&&productVariantsTile.length>0){variantTileLabel=$(productVariantsTile).siblings("label");if(product.variants&&product.variants.length>0){product.variants.sort(function(a,b){return a["variantOptionSequence"+value]-b["variantOptionSequence"+value]});var variantTileParent=document.createElement("div");variantTileParent.className="variant-parent-div";variantTileParent.style.display="flex";variantTileParent.style.flexWrap="wrap";variantTileParent.style.alignSelf="flex-start";var tileClasses=Array.from(productVariantsTile[0].classList);var variantImageClassExists=tileClasses.includes("fk-variant-image"),noColorTileClass=tileClasses.includes("ccNoColorTile");var prodVariantSelection=productSection.classList.contains("fk-product-variant-select");var variantImageNameClassExists=prodVariantSelection&&variantImageClassExists&&tileClasses.includes("fk-variant-image-name");var prodVariants=product.variants;var prodVariantsLength=prodVariants.length;var _loop28=function _loop28(){var variant=prodVariants[_i109];var optionName=variant["variantOptionName"+value];var variantTypeNameVar=variant["variantName"+value];var imageExists=variantImageClassExists?variant["imageUrl"]:true;if(optionName&&imageExists){var variantimageText,variantTileDiv;var variantTypeName=variant["variantName"+value];var variantRadioInput=document.createElement("input");variantRadioInput.setAttribute("type","radio");variantRadioInput.setAttribute("data-value",variant["variantDetailId"]);variantRadioInput.style.display="none";variantRadioInput.className="variant-radio";variantRadioInput.name=variantTypeName+"-"+(index+1);var variantTile=document.createElement("label");var variantValue=optionName;variantTile.innerText=optionName;VariantType=document.createAttribute("variantType");// Create a "class" attribute
title=document.createAttribute("title");// Create a "class" attribute
VariantType.value=variantTypeName;// Set the value of the class attribute
variantTile.setAttribute("variantoptionvalue",optionName);variantTile.setAttributeNode(VariantType);var isColorVariant=variantTypeName.toLowerCase()=="color"&&!noColorTileClass;if(variantTypeName&&variantTypeName!==""&&(isColorVariant||variantImageClassExists)){var borderRadius="50%",dimension="25px",bgColor=variantValue;if(variantImageClassExists){borderRadius="0%";dimension="50px";bgColor="transparent";variantTile.style.backgroundImage="url("+variant["imageUrl"]+")";variantTile.style.backgroundRepeat="no-repeat";variantTile.style.backgroundPosition="center";if(!productVariantsTile[0].closest(".fk-product-variant-select")){variantTile.style.backgroundSize="contain"}if(variantImageNameClassExists){variantTileDiv=document.createElement("div");variantimageText=document.createElement("label");variantTileDiv.style.display="flex";variantTileDiv.style.flexDirection="column";variantTileDiv.style.flex="1";VariantType2=document.createAttribute("variantType");VariantType2.value=variantTypeName;// Set the value of the class attribute            
variantTileDiv.setAttributeNode(VariantType2);variantimageText.innerText=optionName;variantimageText.style.margin="-11px 10px 0";variantimageText.style.backgroundColor="black";variantimageText.style.color="white";variantimageText.style.fontSize="10px"}}if(!productVariantsTile[0].closest(".fk-product-variant-select")||isColorVariant&&!variantImageClassExists){variantTile.style.height=dimension;variantTile.style.width=dimension;variantTile.style.flex="unset"}variantTile.style.setProperty("background-color",bgColor,"important");variantTile.style.border="2px solid #c5cacd";variantTile.style.fontSize="0";variantTile.style.borderRadius=borderRadius;title.value=variantValue;variantTile.setAttributeNode(title)}variantTile.className="variant-label"+value+(noColorTileClass?" ccNoColorTile":"");variantTile.setAttribute("name","variant"+value);variantTile.setAttribute("data-selected","false");variantTileLabel=$(productVariantsTile).siblings("label");productVariantsTile[0].innerText="";if(variantTileLabel&&variantTileLabel.length>0){variantTileLabel[0].parentElement.appendChild(variantTileParent);variantTileLabel[0].innerHTML=variant["variantName"+value]}else{productVariantsTile[0].parentElement.append(variantTileParent)}productVariantsTile[0].id!==""&&variantTile.setAttribute("id",productVariantsTile[0].id);$(productVariantsTile[0]).hide();if(!usedValues.includes(optionName)){usedValues.push(optionName);variantTile.appendChild(variantRadioInput);if(variantImageNameClassExists){variantTileDiv.appendChild(variantTile);variantTileDiv.appendChild(variantimageText);variantTileParent.appendChild(variantTileDiv)}else{variantTileParent.appendChild(variantTile)}}if(_i109===product.variants.length-1&&productData.length>1){//set current variant
var _variant=product.variants.filter(function(data){return data.variantDetailId==productData[1]});$(variantTileParent).children().each(function(){var innerText=$(this).text();if(innerText===_variant[0]["variantOptionName"+value]){selectRadioTiles(this)}})}}else{$(productVariantsTile[0]).hide();if(!variantImageClassExists&&variantTileLabel&&variantTileLabel.length>0){$(variantTileLabel[0]).hide()}}},VariantType,title,VariantType2;for(var _i109=0;_i109<prodVariantsLength;_i109++){_loop28()}}else{$(productVariantsTile[0]).hide();variantTileLabel&&variantTileLabel.length&&$(variantTileLabel[0]).hide()}}});for(var _i110=1;_i110<=3;_i110++){var _key2="variant"+_i110;var tileValue=tileVariantValue[_key2];tileValue&&$(productSection).find("[name="+_key2+"]").find("[data-value="+tileValue+"]").click()}}catch(error){console.log(error)}}function ccHandleBundleSetValue(productSection,product,variant,orderItems,sessionItemCpId,bundleVarCount){var productVariantSelects=productSection&&productSection.querySelector(".fk-variant-bundle-select-identifier"+bundleVarCount);var productVariants=productSection&&productSection.querySelectorAll("[name = 'variants'");if(productVariantSelects){productVariantSelects.value=variant.variantDetailId}else if(productVariants){var variantId=variant.variantDetailId;for(var _i111 in productVariants){if(productVariants[_i111].getAttribute("variantValue")==variantId){var qtyInput=productVariants[_i111].querySelector(".quantity-field")||productVariants[_i111].children[1];qtyInput.value=orderItems[sessionItemCpId];break}}}var id=pageData.pageViewReferenceId+"|"+sessionItemCpId;removeBundleFromCart[id]=1}function removeProductsFromCart(product,productSection){try{//remove products from cart
var prodCampId=product[0]&&product[0].campaignProductId;var _orderItems11=getOrderItems();var reccProductId=swapSubscriptions(_orderItems11,"",prodCampId).sectionValue;var bundleVarCount=1;var _loop29=function _loop29(){if(sessionItemCpId.indexOf(".")>0){var _productData14=sessionItemCpId.split(".");var productSelect=productSection.querySelector("[name = 'productSelect']");var bundlesOnPage=document.querySelectorAll(".fk-variant-bundle1, .fk-variant-bundle2").length;var bundleWithSelect=bundlesOnPage===1&&product[0].isVariantBundle&&productSelect;var bundleProductsPageRef=sessionStorage.getItem("bundleProductsPageRef")!==null?JSON.parse(sessionStorage.getItem("bundleProductsPageRef")):{};var id=pageData.pageViewReferenceId+"|"+sessionItemCpId;if(bundleWithSelect&&handleBundleEle){var numOfProducts=productSelect.options.length;if(bundleProductsPageRef[id]&&_productData14[0]!=prodCampId&&numOfProducts){for(var _i112 in productSelect.options){if(productSelect.options[_i112].value==_productData14[0]){ccProdSelectSectionLoad(productSection,_productData14[0],"",true);product=pageData.selectedCampaign.products.filter(function(product){return product.campaignProductId==_productData14[0]});prodCampId=product[0]&&product[0].campaignProductId}}}}if(_productData14[0]==prodCampId||_productData14[0]==reccProductId||bundleWithSelect&&bundleProductsPageRef[id]){if(![2,34].includes(pageData.pageTypeId))delete _orderItems11[sessionItemCpId];var variant=product[0]&&product[0].variants.find(function(data){return data.variantDetailId==_productData14[1]});if(variant){if(product[0].isVariantBundle&&handleBundleEle){var qty=product[0].bundleProductQty||product[0].campaignProductQty||product[0].productQty;ccHandleBundleSetValue(productSection,product,variant,_orderItems11,sessionItemCpId,bundleVarCount);bundleVarCount=bundleVarCount<qty?bundleVarCount+1:1}else{["1","2","3"].map(function(value){var productVariants=productSection&&productSection.querySelectorAll("select[name='variant"+value+"']");if(productVariants&&productVariants.length>0){productVariants[0].value=variant["variantOptionName"+value]}})}}}}else if(sessionItemCpId==(product[0]&&product[0].campaignProductId)){var button=productSection&&productSection.querySelectorAll("button");if(button&&button.length>0&&button[0].innerHTML==="Select"){button[0].innerHTML="Selected";button[0].className="btn btn-success"}}};for(var sessionItemCpId in _orderItems11){_loop29()}sessionStorage.setItem("fkCart",JSON.stringify(_orderItems11))}catch(error){console.log(error)}}function mapProductVariantNameSelect(product,productSection,isChangeProdSection){try{var productNameSelect=productSection.querySelectorAll("select[name='productVariant']")[0];var selectValue=$(productNameSelect).val();if(productNameSelect){var chooseOptionText=productNameSelect.options.length>0&&productNameSelect.options[0].value===""?productNameSelect.options[0].text:null;var usedValues=[];var firstVariant=product&&product[0]&&product[0].variants&&product[0].variants[0]&&product[0].variants[0].title&&product[0].variants[0].title.charAt(0);if(isNaN(+firstVariant)){product[0].variants.sort(function(a,b){return a.title[0].charCodeAt(0)-b.title[0].charCodeAt(0)})}isChangeProdSection&&$(productNameSelect).siblings("label").first().html("Variants");productNameSelect.innerHTML="";if(chooseOptionText){var chooseOption=document.createElement("OPTION");chooseOption.value="";chooseOption.innerHTML=chooseOptionText;productNameSelect.add(chooseOption)}var variantsLength=product[0].variants.length;var actionCurrentItem=sessionStorage.getItem("actionCurrentItem");var variantDetailId=pageData.pageTypeId===13&&isChangeProdSection&&actionCurrentItem?actionCurrentItem.split(".")[1]:"";var currentVariant=variantsLength&&variantDetailId&&product[0].variants.find(function(data){return data.variantDetailId==variantDetailId});for(var _i113=0;_i113<variantsLength;_i113++){var variant=product[0].variants[_i113];var option=document.createElement("OPTION");var optionName=variant.variantDetailId;var variantIdMatch=currentVariant&&currentVariant.variantDetailId==variant.variantDetailId;if(variantIdMatch||!currentVariant&&isChangeProdSection&&_i113===0){selectValue=optionName}option.value=optionName;option.innerHTML=variant.title;if(!usedValues.includes(optionName)){productNameSelect.add(option);usedValues.push(optionName)}}selectValue&&$(productNameSelect).val(selectValue).change()}}catch(error){console.log(error)}}function mapBundleVariant(product,productSection){try{if(product[0].isVariantBundle){var productVariants=productSection.querySelectorAll("div[name='variant-bundle-parent']");var variantBundleSelects=productSection.querySelectorAll("select[name='variantBundleSelect']");var productElement=productSection.getElementsByClassName("fk-product-name");var divSelectedValue={};if(productElement&&productElement.length>0){var stockStatus=verifyStock&&product[0].cycle1_isShippable&&product[0].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";productElement[0].innerHTML=product[0].baseProductName+stockStatus}var productVariantsCheck=productVariants&&productVariants.length>0;if(!productVariantsCheck&&variantBundleSelects.length===0){var variantBundleParentDiv=$(productSection).find(".fk-variant-bundle-parent-div");var variantBundleParentDivLength=variantBundleParentDiv.length;for(var _i114=0;_i114<variantBundleParentDivLength;_i114++){var _item14=variantBundleParentDiv[_i114];var value=$(_item14).attr("variantvalue");divSelectedValue[value]=$(_item14).find("[name=quantity]").val()}productVariants=variantBundleParentDiv;variantBundleParentDivLength>1&&$(productSection).find(".fk-variant-bundle-parent-div").slice(1).remove();productVariantsCheck=true}if(productVariantsCheck){product[0].variants.sort(function(a,b){return b["variantOptionSequence1"]-a["variantOptionSequence1"]});var usedValues=[];var cloneProductVariants=productVariants[0].cloneNode(true);var productVariantsParent=productVariants[0].parentNode;var variantsLength=product[0].variants.length;for(var _i115=0;_i115<variantsLength;_i115++){var variant=product[0].variants[_i115];if(!usedValues.includes(variant["title"])){var child=cloneProductVariants.cloneNode(true);child.classList.add("fk-variant-bundle-parent-div");child.setAttribute("name","variants");child.setAttribute("variantvalue",variant["variantDetailId"]);var _stockStatus=verifyStock&&variant["stockQuantity"].toString()==="0"?"  - OUT-OF-STOCK":"";child.childNodes[0].innerHTML=variant["title"]+_stockStatus;var _value3=divSelectedValue[variant["variantDetailId"]];$(child).find("[name=quantity]").val(_value3||"");productVariants[0].insertAdjacentElement("afterend",child);usedValues.push(variant["title"])}}productVariants[0].remove()}if(variantBundleSelects&&variantBundleSelects.length>0){var bundleProductQuantity=product[0].bundleProductQty||product[0].campaignProductQty||product[0].productQty;var selectedValues={};var identifier="fk-variant-bundle-select-identifier";for(var _i116=0;_i116<bundleProductQuantity;_i116++){var key=identifier+(_i116+1);selectedValues[key]=$(productSection).find("."+key).val()}var variantBundleSelectId=$(variantBundleSelects[0]).attr("id")?$(variantBundleSelects[0]).attr("id"):"";variantBundleSelects.length>1&&$(productSection).find("select[name='variantBundleSelect']").slice(1).remove();product[0].variants.sort(function(a,b){return a["variantDetailId"]-b["variantDetailId"]});var bundleVariantOptions=product[0].variants.map(function(variant){var stockStatus=verifyStock&&variant.stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";return"<option value='"+variant.variantDetailId+"'>"+variant.title+stockStatus+"</option>"}).join("");var dynamicBundleVariantSelects=Array.from(Array(bundleProductQuantity),function(item,index){return"<select class='form-control-custom fk-form-select mb-3 "+identifier+(index+1)+"' id='"+variantBundleSelectId+"' name='variantBundleSelect'>"+bundleVariantOptions+"</select>"}).join("");$(variantBundleSelects[0]).after(dynamicBundleVariantSelects);variantBundleSelects[0].remove();for(var _i117=0;_i117<bundleProductQuantity;_i117++){var _key3=identifier+(_i117+1);var _value4=selectedValues[_key3];_value4&&$(productSection).find("."+_key3).val(_value4).change()}}}}catch(error){console.log(error)}}function changeTilePrices(productVariantElement){var tileVariants=$(productVariantElement).find(".fk-product-tile-parent");var tileLength=tileVariants.length;var productId=productVariantElement.getAttribute("value");var product=pageData.selectedCampaign.products.find(function(product){return product.campaignProductId===parseInt(productId)});var _loop30=function _loop30(_i118){var variant=product.variants.find(function(variant){return variant.variantDetailId===parseInt(tileVariants[_i118].variantvalue)});populateDataClass(tileVariants[_i118],product,variant,productId,1)};for(var _i118=0;_i118<tileLength;_i118++){_loop30(_i118)}}function populateDataClass(parentArea,product,variant,productId,qty,j){try{var currenySymbol=pageData.selectedCampaign.currencySymbol;var unitPrice=variant&&parseFloat(variant.price)>0&&!product.isVariantBundle&&!product.isEditable?parseFloat(variant.price):parseFloat(product.cycle1_price);var vatPrice=unitPrice&&getItemPrice(productId,unitPrice,qty,false);var qtyPerOrder=variant&&parseInt(variant.productQty)||1;var compareAtPrice=product.compareAtPrice&&parseFloat(product.compareAtPrice)>0?getItemPrice(productId,parseFloat(product.compareAtPrice),qty,false):null;var actualCompareAtPrice=variant&&variant.compareAtPrice&&parseFloat(variant.compareAtPrice)>0&&!product.isVariantBundle?getItemPrice(productId,parseFloat(variant.compareAtPrice),qty,false):compareAtPrice;compareAtPrice=actualCompareAtPrice||vatPrice;var exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||1,prodTax=1;var prodPrice=unitPrice*qty,prodCompareAtPrice=compareAtPrice/(exchangeRate*prodTax);var imagePath=variant&&variant.imageUrl!==""?variant.imageUrl:product.imageUrl;if(imagePath!==""){$(parentArea).find("img").first().attr({"src":imagePath,"data-src":imagePath})}$(parentArea).find(".tile-title").first().html(variant&&variant["variantOptionName"+j]);$(parentArea).find(".product-price").first().html("<span data-cc-price-type='true' data-cc-price='"+prodPrice+"'>"+ccFormatCurrency(vatPrice.toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".unit-price").first().html("<span data-cc-price-type='true' data-cc-price='"+unitPrice/qtyPerOrder+"'>"+ccFormatCurrency((vatPrice/qtyPerOrder).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".compare-at-price").first().html("<span data-cc-price-type='true' data-cc-price='"+prodCompareAtPrice+"'>"+ccFormatCurrency(compareAtPrice.toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".compare-at-unit-price").first().html("<span data-cc-price-type='true' data-cc-price='"+prodCompareAtPrice/qtyPerOrder+"'>"+ccFormatCurrency((compareAtPrice/qtyPerOrder).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".product-savings").first().html("<span data-cc-price-type='true' data-cc-price='"+(prodCompareAtPrice-prodPrice)+"'>"+ccFormatCurrency((compareAtPrice-vatPrice).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".savings-unit-price").first().html("<span data-cc-price-type='true' data-cc-price='"+((prodCompareAtPrice-prodPrice)/qtyPerOrder).toFixed(2)+"'>"+ccFormatCurrency((compareAtPrice/qtyPerOrder-vatPrice).toFixed(2),currenySymbol)+"</span>");$(parentArea).find(".savings-percent").first().html(parseFloat((compareAtPrice-vatPrice)/compareAtPrice*100).toFixed(0)+"%");$(parentArea).find(".product-description").first().html(variant&&variant.title);!actualCompareAtPrice||Number(actualCompareAtPrice)===0?$(parentArea).find(".compare-at-price, .compare-at-unit-price").hide():$(parentArea).find(".compare-at-price, .compare-at-unit-price").show()}catch(e){e}}function getNumOfVariantTypes(product){var variantTypeCount=0;for(var _i119=1;_i119<=3;_i119++){var variantNameAttr="variantName"+_i119;var variantName=product.variants[0][variantNameAttr];if(variantName&&variantName!==""){variantTypeCount++}}return variantTypeCount}function constructProductVariantElement(selectedElement,parentSection,orderItems){try{var productTile=selectedElement?$(selectedElement).closest(".fk-product-tile-parent")[0]:$(parentSection).find(".fk-product-tile-parent")[0];var childElements=_toConsumableArray($(parentSection).find(".fk-product-variant-area")[0].childNodes);var productContainer=$(parentSection).find(".fk-product-display-container")[0];var variantsLength;var variantContainer=$(parentSection).find(".fk-variant-display-container")[0];var firstOptions=[],variantLabels;for(var _i120=1;_i120<=3;_i120++){var firstLabel=$(variantContainer).find(".variant-label"+_i120)[1];var opt=$(firstLabel).attr("variantoptionvalue");opt=opt&&opt.replace(/ /g,"");opt&&firstOptions.push(opt)}var _product14=null;if(productTile&&variantSelectFlag===0){var classList=_toConsumableArray(productTile.classList);var variantCategoryNum;var classListLength=classList.length;for(var _i121=0;_i121<classListLength;_i121++){if(["variant-tile1","variant-tile2","variant-tile3"].includes(classList[_i121])){var className=classList[_i121];variantCategoryNum=parseInt(className[className.length-1]);break}}variantLabels=$(parentSection).find(".fk-variant-label");var _productId14=parentSection.getAttribute("value");_product14=pageData.selectedCampaign.products.find(function(product){return product.campaignProductId===parseInt(_productId14)});if(variantLabels.length){var variantTypeCount=0;variantsLength=_product14&&_product14.variants&&_product14.variants.length;if(variantsLength){variantTypeCount=getNumOfVariantTypes(_product14);var _loop31=function _loop31(j){_product14.variants.sort(function(a,b){return a["variantOptionSequence"+j]-b["variantOptionSequence"+j]});var variantForTile=j===variantCategoryNum||j===variantTypeCount?true:false;if(variantForTile&&variantSelectFlag===0){var tempTile=productTile;var _loop32=function _loop32(_i122){createTile();function createTile(){var unitPrice=_product14.variants[_i122]&&parseFloat(_product14.variants[_i122].price)>0&&!_product14.isVariantBundle&&!_product14.isEditable?parseFloat(_product14.variants[_i122].price):parseFloat(_product14.cycle1_price);var newProdTile=productTile.cloneNode(true);populateDataClass(newProdTile,_product14,_product14.variants[_i122],_productId14,1,j);newProdTile.value=_productId14;newProdTile.variantvalue=_product14.variants[_i122].variantDetailId;$(newProdTile).attr({"price":unitPrice,"variantName":_product14.variants[_i122].title});var tileRadio=$(newProdTile).find(".fk-product-radio")[0];$(tileRadio).attr({"value":_productId14,"variantvalue":_product14.variants[_i122].variantDetailId,"quantity":1,"id":_product14.variants[_i122].variantDetailId});tileRadio.addEventListener("click",function(e){e.stopPropagation();displayPrices()});var section=$(newProdTile).closest("section")[0];var variantName=newProdTile.getAttribute("variantName").replace(/ /g,"");tempTile.after(newProdTile);$(section).attr("style","display: none !important");matched=variantName&&checkVariantMatch(_product14,variantName,firstOptions);if(matched===firstOptions.length){if(_i122===0&&parentSection.offsetHeight>0){checkedElement=tileRadio;tileRadio.checked=true;$(newProdTile).find("button").first().html("SELECTED")}$(section).attr("style","display: block")}tempTile=newProdTile}};for(var _i122=0;_i122<variantsLength;_i122++){_loop32(_i122)}productTile.remove()}};for(var j=1;j<=variantTypeCount;j++){_loop31(j)}}}}if(variantSelectFlag===0){$(".fk-product-variant-select").trigger("click")}variantSelectFlag=variantsLength?1:variantSelectFlag}catch(error){console.log(error)}}function checkVariantMatch(product,variantName,partialVariants){var matched=0;var variant=product.variants.find(function(variant){return variant.title.replace(/ /g,"")===variantName});var partialVariantLength=partialVariants.length;if(variant){for(var _i123=1;_i123<=3;_i123++){for(var j=0;j<partialVariantLength;j++){var variantOptionName=variant["variantOptionName"+_i123];if(variantOptionName&&variantOptionName.replace(/ /g,"")==partialVariants[j]){matched++}}}}return matched};function filterTiles(productVariantElement,product){try{var variantLabels=$(productVariantElement).find(".variant-label1, .variant-label2, .variant-label3").filter("[data-selected='true']");var tileVariants=$(productVariantElement).find(".fk-product-tile-parent");var tileLength=tileVariants.length,partialVariants=[],variantLabelLength=variantLabels.length;if(variantLabelLength){for(var _i124=0;_i124<variantLabelLength;_i124++){var opt=$(variantLabels[_i124]).attr("variantoptionvalue");opt&&partialVariants.push(opt.replace(/ /g,""))}}var count=0;for(var _i125=0;_i125<tileLength;_i125++){var _matched=0;var section=$(tileVariants[_i125]).closest("section").first().attr("style","display: none !important");var variantName=tileVariants[_i125].getAttribute("variantName")&&tileVariants[_i125].getAttribute("variantName").replace(/ /g,"");_matched=variantName&&checkVariantMatch(product,variantName,partialVariants);if(_matched===partialVariants.length){section&&section.attr("style","display: block");var defaultSelectRadio=count===0?$(tileVariants[_i125]).find(".fk-product-radio")[0]:"";if(defaultSelectRadio&&productVariantElement.offsetHeight>0){checkedElement=defaultSelectRadio;defaultSelectRadio.checked=true;count++;$(defaultSelectRadio).trigger("click")}}}}catch(err){err}}function showInitialElement(productSection){var variantEle=productSection.querySelector("select[name='variant1']")||productSection.querySelector("select[name='productVariant']");var elementContainer=variantEle&&variantEle.closest(".fk-element-container");elementContainer&&$(elementContainer).show()}function hideRemoveVariantSelects(productSection,noVariants){if(noVariants){var variantEle=productSection.querySelector("select[name='variant1']")||productSection.querySelector("select[name='productVariant']");var elementContainer=variantEle&&variantEle.closest(".fk-element-container");elementContainer&&$(elementContainer).hide()}["2","3"].map(function(value){var variantEle=productSection.querySelectorAll("select[name='variant"+value+"']");removeItems(variantEle,"",true)});var productVariantNameSelect=$(productSection).find("[name=productVariant]")[0]}function hideRemoveComboEle(productSection,noVariants){var comboEle=$(productSection).find("[name=comboEle]");removeItems(comboEle,1,true);noVariants&&$(comboEle[0]).hide()}function productDetailSubscription(ccSubscribeAndSave,product,productId){var idParams=swapSubscriptions("","",productId,true);var expectedProductId=idParams.sectionValue;var oneTimeId=idParams.oneTimeId;var oneTimePrice,subscribePrice;if(expectedProductId!=productId||product.billingCycleType==="RECURRING"&&oneTimeId){var variant=product.variants[0];var variantPrice=variant&&parseFloat(variant.price)>0&&!product.isVariantBundle&&!product.isEditable?parseFloat(variant.price):null;if(product.billingCycleType=="ONE_TIME"){oneTimePrice=variantPrice||parseFloat(product.cycle1_price);subscribePrice=variantPrice||parseFloat(pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==expectedProductId}).cycle1_price);$(".one-time")[0].setAttribute("value",productId);expectedProductId&&$(".recurring")[0].setAttribute("value",expectedProductId);$(".one-time")[0].checked=true}else{subscribePrice=variantPrice||parseFloat(product.cycle1_price);oneTimePrice=variantPrice||parseFloat(pageData.selectedCampaign.products.find(function(prod){return prod.campaignProductId==oneTimeId}).cycle1_price);oneTimeId&&$(".one-time")[0].setAttribute("value",oneTimeId);$(".recurring")[0].setAttribute("value",productId);$(".recurring")[0].checked=true}var savingsPercentValue=parseFloat((oneTimePrice-subscribePrice)/oneTimePrice*100).toFixed(0)+"%";sessionStorage.setItem("savingsPercentValue",savingsPercentValue)}else{ccSubscribeAndSave.style.display="none"}}function loadVariants(prodSelect,previousValue,skipRecall){var productSections=document.getElementsByClassName("fk-product-section");var currentItem=sessionStorage.getItem("currentItem");var newItem=sessionStorage.getItem("newProductItem");var currentProductQty=sessionStorage.getItem("currentProductQty");var productSectionsLength=productSections.length;var currentItemData=newItem?newItem.split("."):currentItem&&currentItem.split(".");var currentItemId=currentItemData&&currentItemData[0];var currentItemProduct=currentItemId&&pageData.selectedCampaign&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==currentItemId});dynamicOrderBump&&currentItemId&&dynamicOrderBump.setAttribute("value",currentItemId);if(productSectionsLength>0){var _loop33=function _loop33(){var productSection=productSections[_i126];var sectionClassList=productSection.classList;var sectionValue=productSection.getAttribute("value");var isSectionDynamic=sectionClassList.contains("cc-dynamic-product-section")||sectionClassList.contains("cc-dynamic-order-bump");var pageTypeId=pageData.pageTypeId;var comboElement=sectionClassList.contains("fk-combo-product");var dynamicChangeProduct=sectionClassList.contains("cc-dynamic-change-product");var comboChangeProdSection=sectionClassList.contains("cc-change-product-section");var onlyComboOnChangeProd=comboElement&&pageTypeId===13&&productSections.length===1;var isComboChangeProdSection=comboChangeProdSection||onlyComboOnChangeProd&&sectionValue!=="choose";var isDyChangeProdSection=dynamicChangeProduct||onlyComboOnChangeProd&&sectionValue==="choose";var productValue=newItem&&!ccDynamicProductSection&&!isComboChangeProdSection?newItem:currentItem&&!isComboChangeProdSection&&(pageTypeId===34||isSectionDynamic)?currentItem:sectionValue;var productData=productValue.split(".");var sectionProductSelect=$(productSection).find("[name='productSelect']");if(productValue&&sectionProductSelect&&sectionProductSelect[0]){var defaultOpt=Number(sectionProductSelect[0].options[0].value);if(productValue=="choose"){sectionProductSelect[0].value=sectionProductSelect[0].options[0].value;if(defaultOpt&&defaultOpt!=0&&typeof defaultOpt=="number"){productValue=defaultOpt.toString();productData=productValue.split(".")}}else{sectionProductSelect[0].value=productValue.split(".")[0]}}!dynamicChangeProduct&&isDyChangeProdSection&&sectionClassList.add("cc-dynamic-change-product");!comboChangeProdSection&&isComboChangeProdSection&&sectionClassList.add("cc-change-product-section");var isVariantTileClassAdded=Array.from(sectionClassList).includes("fk-variant-tile");var productVariantNameSelect=$(productSection).find("[name=productVariant]")[0];var product=pageData.selectedCampaign&&pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productData[0]});var isComboExists=product.length&&product[0].combinations.length;var isComboProdSection=comboElement&&(pageTypeId!==13||sectionValue!=="choose"&&isComboExists);var sectionId=productSection.getAttribute("id");var qtyPlusButton=productSection.getElementsByClassName("button-plus")[0];var qtyMinusButton=productSection.getElementsByClassName("button-minus")[0];qtyPlusButton?qtyPlusButton.setAttribute("onclick","plusQuantity('', '"+sectionId+"', true, event);"):null;qtyMinusButton?qtyMinusButton.setAttribute("onclick","minusQuantity('', '', '"+sectionId+"', true, event);"):null;if(isDyChangeProdSection&&currentItem||isComboChangeProdSection){productSection.setAttribute("value",productData[0]);if(product[0].combinations.length>0){hideRemoveVariantSelects(productSection);showInitialElement(productSection);displayCombos(product,productSection,true,previousValue)}else if(product[0].variants&&!product[0].variants.length){hideRemoveVariantSelects(productSection,true);hideRemoveComboEle(productSection,true)}else if(productVariantNameSelect){hideRemoveComboEle(productSection);showInitialElement(productSection);mapProductVariantNameSelect(product,productSection,true)}else{hideRemoveComboEle(productSection);showInitialElement(productSection);mapSelectVariant(product[0],productSection,productData,_i126,true)}}else if(isSectionDynamic&&currentItem){var dynamicElement=dynamicOrderBump||ccDynamicProductSection;[2,3,4].includes(pageTypeId)&&dynamicElement.setAttribute("value",currentItemId);mapSelectVariant(currentItemProduct[0],dynamicElement,currentItemData,_i126);pageData.pageTypeId===3&&removeProductsFromCart(product,productSection)}else if(currentItem&&!ccDynamicProductSection&&!dynamicOrderBump){if(productSectionsLength==1&&[13,34].includes(pageTypeId)){var ccSubscribeAndSave=document.getElementsByClassName("cc-subscribe-and-save")[0];productSection.setAttribute("value",productData[0]);if(ccSubscribeAndSave){productDetailSubscription(ccSubscribeAndSave,product[0],productData[0])}else{isComboProdSection&&displayCombos(product,productSection)}}mapSelectVariant(product[0],productSection,productData,_i126)}else if(productValue&&!isSectionDynamic){if(product&&product.length>0){if(isComboProdSection){displayCombos(product,productSection)}else if(product[0].variants&&product[0].variants.length>0){isVariantTileClassAdded?mapSelectVariant(product[0],productSection,productData,_i126):iterateAndMapVariants(product,productSection,prodSelect);mapBundleVariant(product,productSection);mapProductVariantNameSelect(product,productSection)}!skipRecall&&removeProductsFromCart(product,productSection)}}};for(var _i126=0;_i126<productSectionsLength;_i126++){_loop33()}}}function createOptions(optionName,newSelect,usedValues){var option=document.createElement("OPTION");option.value=optionName&&optionName.replace("  - OUT-OF-STOCK","");option.innerHTML=optionName;if(!usedValues.includes(optionName)){newSelect.add(option);usedValues.push(optionName)}}function displayCombos(product,productSection,isChangeProdSection,previousValue){try{var combinations=product[0].combinations;var _productId15=product[0].campaignProductId;var comboEle=productSection.querySelector("div[name='comboEle']");var productSelect=productSection.querySelector("[name='productSelect']");var comboEleCollection=$(productSection).find("div[name='comboEle']");var combinationsLength=combinations.length;var combinationSelectValues={};for(var _i127=0;_i127<combinationsLength;_i127++){combinationSelectValues["productCombo"+_i127]=$(productSection).find("[name=productCombo"+_i127+"]").val()}comboEleCollection.length>1&&comboEleCollection.slice(1).remove();if(comboEle&&combinations&&combinations.length>0){var tempComboEle=comboEle;var customizations;if(isChangeProdSection){var actionPurchaseId=sessionStorage.getItem("actionPurchaseId");var customPurchases=JSON.parse(sessionStorage.getItem("customPurchases"));var purchaseOrder=customPurchases[actionPurchaseId];customizations=purchaseOrder&&purchaseOrder.customization}for(var value=0;value<combinations.length;value++){var newComboSection=tempComboEle.cloneNode(true);var newSelect=newComboSection.querySelector("select");newSelect.name="productCombo"+value;var stockStatus=verifyStock&&product[0].cycle1_isShippable&&combinations[value].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";newComboSection.firstElementChild.innerHTML=combinations[value].comboProductName;tempComboEle.after(newComboSection);newComboSection.style.display="block";combinations[value].variants.sort(function(a,b){return a["title"]-b["title"]});var usedValues=[];newSelect.innerHTML="";var variantsLength=combinations[value].variants.length;if(variantsLength>0){for(var _i128=0;_i128<variantsLength;_i128++){var _stockStatus2=verifyStock&&product[0].cycle1_isShippable&&combinations[value].variants[_i128].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";var optionName=combinations[value].variants[_i128]["title"];if(optionName){optionName=combinations[value].variants[_i128]["title"]+_stockStatus2}if(customizations){var customVariantsLength=customizations.length;for(var j=0;j<customVariantsLength;j++){if(customizations[j].variantDetailId==combinations[value].variants[_i128].variantDetailId){combinationSelectValues["productCombo"+value]=optionName}}}createOptions(optionName,newSelect,usedValues)}}else{var _optionName=combinations[value].comboProductName+stockStatus;createOptions(_optionName,newSelect,usedValues)}tempComboEle=newComboSection}}comboEle.style.display="none";for(var _i129=0;_i129<combinationsLength;_i129++){var _value5=combinationSelectValues["productCombo"+_i129];if(_value5&&(previousValue&&previousValue==_productId15||!previousValue))$(productSection).find("[name=productCombo"+_i129+"]").val(_value5).change()}}catch(error){error}}function populateVariantSelects(product,productSection,productVariants,prodSelect,value,productData,fromMapSelect,isChangeProdSection){var variantDetailId,currentVariant,usedValues=[];var variantLabel=$(productVariants).siblings("label");if(product.variants&&product.variants.length>0){var selectValue=prodSelect?"":$(productVariants[0]).val();product.variants.sort(function(a,b){return a["variantOptionSequence"+value]-b["variantOptionSequence"+value]});productVariants[0].innerHTML="";if(isChangeProdSection){var actionCurrentItem=sessionStorage.getItem("actionCurrentItem");variantDetailId=actionCurrentItem?actionCurrentItem.split(".")[1]:"";currentVariant=variantDetailId&&product.variants.find(function(data){return data.variantDetailId==variantDetailId})}var variantsLength=product.variants.length;for(var _i130=0;_i130<variantsLength;_i130++){var variant=product.variants[_i130];var stockStatus=verifyStock&&product.variants[_i130].stockQuantity.toString()==="0"?"  - OUT-OF-STOCK":"";var optionName=product.variants[_i130]["variantOptionName"+value];var variantIdMatch=currentVariant&&currentVariant.variantDetailId==variant.variantDetailId;if(optionName){optionName=optionName+stockStatus}createOptions(optionName,productVariants[0],usedValues,fromMapSelect,variant);if(variant["variantName"+value]===null){$(productVariants).hide();$(variantLabel).hide()}if(fromMapSelect){if(variantIdMatch||!currentVariant&&isChangeProdSection&&_i130===0){selectValue=optionName}if(variantLabel&&variantLabel.length>0){variantLabel[0].innerHTML=variant["variantName"+value]}var variantTypeName=variant["variantName"+value];var VariantType=document.createAttribute("variantType");VariantType.value=variantTypeName;productVariants[0].setAttributeNode(VariantType);if(productData.length>1){//set current variant
var _variant2=product.variants.find(function(data){return data.variantDetailId==productData[1]});productVariants[0].value=_variant2&&_variant2["variantOptionName"+value]}}}selectValue&&$(productVariants[0]).val(selectValue).change()}else{$(productVariants).hide();$(variantLabel).hide()}}function iterateAndMapVariants(product,productSection,prodSelect){try{["1","2","3"].map(function(value){var productVariants=productSection.querySelectorAll("select[name='variant"+value+"']");if(productVariants&&productVariants.length>0){product&&product[0]&&populateVariantSelects(product[0],productSection,productVariants,prodSelect,value)}})}catch(error){console.log(error)}}function getShopPayCheckoutUrl(orderItems){var validShopPayUrl=false;var shopPayUrl=pageData.selectedCampaign.shopPayUrl;var orderItemsCopy=JSON.parse(JSON.stringify(getOrderItems()));if(!shopPayUrl||Object.keys(orderItems).length===0){var errMsg=!shopPayUrl?"ShopPay payment is not enabled. Please try other payment method.":"No products exist in the order.";alert("Error: "+errMsg);return false}shopPayUrl+="/cart/";Object.keys(orderItemsCopy).forEach(function(key){var keys=key.split(".");var qty=parseInt(orderItemsCopy[key]);qty=qty>0?qty:1;var externalVariantId=getExternalVariantId(keys[0],keys[1]?keys[1]:"");if(externalVariantId){validShopPayUrl=true;shopPayUrl+=externalVariantId+":"+qty+","}});if(!validShopPayUrl){alert("Error: Unable to generate ShopPay checkout. Please try other payment method.");return false}shopPayUrl=shopPayUrl.substring(0,shopPayUrl.length-1);shopPayUrl+="?payment=shop_pay";return shopPayUrl}function getExternalVariantId(productId,variantId){var products=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==productId});var product=products&&products[0]?products[0]:"";if(!product)return false;if(!variantId&&product.externalVariantDetailId)return product.externalVariantDetailId;if(variantId&&product.variants&&product.variants.length>0){var variant=product.variants.filter(function(data){return data.variantDetailId==variantId});if(variant&&variant[0]&&variant[0].externalVariantDetailId)return variant[0].externalVariantDetailId}return false}function getVariantsAndDisplay(event){var productSection=event.currentTarget.closest("section.fk-product-section");getVariants(productSection.id);displayPrices()}function getVariants(productSectionId,qtyChange){try{var productSections=document.getElementsByClassName("fk-product-section");var productSectionsLength=productSections.length;var comboCount=0,comboUpdate=false;if(productSectionsLength>0){var _loop34=function _loop34(){var productSection=productSections[_i131];if(productSectionId&&productSection.getAttribute("id")!=productSectionId)return 0;// continue
if($(productSection).closest(".bump-div-class").find("[name=orderBump]").prop("checked")===false){return 0;// continue
}if($(productSection).find("input[name='product']").prop("checked")===false){return 0;// continue
}var sectionValue=productSection.getAttribute("value");var subAndSaveRadio=productSection.querySelectorAll("input[name='Subscribe']:checked")[0];sectionValue=subAndSaveRadio?subAndSaveRadio.value:sectionValue;var sectionId=$(productSection).attr("id");var orderBumpVariant=sectionId&&sectionId.startsWith("orderBumpVariants");var checkoutPayPage=pageData.pageTypeId==4&&document.getElementsByName("cardNumber").length;if(sectionValue&&$(productSection).find("[name='variants']").length==0&&(!orderBumpVariant||productSection.offsetHeight||checkoutPayPage)){var _product15=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==sectionValue});var isComboExists=_product15.length&&_product15[0].combinations.length;var productVariants=$(productSection).find("[name='variant1'], [name='variant2'], [name='variant3']").filter("select");for(var _i132=productVariants.length-1;_i132>=0;_i132--){if(productVariants[_i132].style.display==="none"){productVariants.splice(_i132,1)}}var productVariantsTiles=$(productSection).find(".variant-label1, .variant-label2, .variant-label3").filter("[data-selected='true']");productVariants=[].concat(_toConsumableArray(productVariantsTiles),_toConsumableArray(productVariants));productVariants.sort(function(a,b){return a.getAttribute("name")>b.getAttribute("name")?1:-1});var isProductNameSelectorExists=productSection.querySelectorAll("select[name='productVariant']")[0];var quantity=productSection.querySelectorAll("input[name='quantity'], select[name='quantity']");var sectionInputs=productSection.querySelectorAll("input[name='product']");var variantInputValue=sectionInputs.length?sectionInputs[0].getAttribute("variantvalue"):null;var comboElement=productSection.classList.contains("fk-combo-product");var sectionClassList=productSection.classList;var isSectionDynamic=sectionClassList.contains("cc-dynamic-product-section")||sectionClassList.contains("cc-dynamic-order-bump");var isComboProdSection=comboElement&&(pageData.pageTypeId!==13||sectionValue!=="choose"&&isComboExists);var isProdSelectExists=$(productSection).find("[name='productSelect']")[0];var orderBump=$(productSection).closest(".bump-div-class")[0];var useCartQty=false;var filteredProductVariants;var qty=0;if(quantity&&quantity[0]){qty=quantity[0].value}else if(isProdSelectExists&&orderBump||isComboProdSection||isProductNameSelectorExists||productVariants&&productVariants.length>0||isSectionDynamic){qty=1;useCartQty=true}if((qty>0||qtyChange)&&_product15&&_product15[0]){_product15[0].variants.sort(function(a,b){return a["variantDetailId"]-b["variantDetailId"]});if(isComboProdSection&&!qtyChange){var selectedCombiItems={};var comboOpt=productSection.querySelectorAll("div[name='comboEle']");var comboOptLength=comboOpt.length;var comboString="";var comboProd=_product15[0].campaignProductId.toString()+"|"+qty.toString()+"|";for(var _i133=0;_i133<comboOptLength;_i133++){var comboProdName=productSection.querySelectorAll("div[name='comboEle']")[_i133].firstChild.innerHTML;var _item15=comboOpt[_i133].querySelector("select").value;selectedCombiItems[_i133]=_defineProperty({},comboProdName,_item15)}var selectedComboLength=Object.keys(selectedCombiItems).length;for(var _i134=0;_i134<selectedComboLength;_i134++){comboString+=JSON.stringify(selectedCombiItems[_i134])}comboString=comboString.replaceAll(",","|").replaceAll("{","").replaceAll("}","|").replaceAll("\"","");comboProd=comboProd.concat(comboString);if(pageData.pageTypeId===13){comboUpdate=true;sessionStorage.setItem("selectedCombo",comboProd)}if(pageData.pageTypeId===3){var _orderItems12=getUpsaleItems();_orderItems12["product_custom"+(comboCount+1)]=comboProd;comboCount++;sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems12))}}//filter products[0].variants by variant1.value, variant2.value, and variant3.value to get the correct variantDetailId
//variant1 should always have a value.  variant2 and 3 may not
//set variantDetailId to the filter result (if more than 1 in result, take the first)
//this logic also supports products without variants, in a product section
else if(_product15[0].variants&&_product15[0].variants.length>0&&!isProductNameSelectorExists){var selectedVariantsMap={};productVariants&&productVariants.length&&productVariants.map(function(item,index){var elementTagName=$(item).prop("tagName");var elementNameAttr=$(item).prop("name");var itemValue=item.value?item.value.replace("  - OUT-OF-STOCK",""):item.value;var elementValue=elementTagName.toLowerCase()==="select"?itemValue:item.getAttribute("variantoptionvalue")||item.innerText;if(elementValue&&elementValue!=="null"&&elementValue!=="undefined"){selectedVariantsMap["variant"+(index+1)]=elementValue}});var selectedVariantsLength=Object.keys(selectedVariantsMap).length;filteredProductVariants=selectedVariantsLength>0&&_product15[0].variants.find(function(variantItem){var matchedVariants=0;for(var _i135=1;_i135<=selectedVariantsLength;_i135++){if(variantItem["variantOptionName"+_i135]===selectedVariantsMap["variant"+_i135]){matchedVariants=matchedVariants+1}else{break}}return matchedVariants===selectedVariantsLength})}if(isProductNameSelectorExists||variantInputValue){var productNameVariantVal=isProductNameSelectorExists?isProductNameSelectorExists.value:variantInputValue;filteredProductVariants=_product15[0].variants.find(function(item){return item.variantDetailId===parseInt(productNameVariantVal)})}var variantDetailId=filteredProductVariants?filteredProductVariants.variantDetailId:null;if(_product15[0].variants&&_product15[0].variants.length>0&&variantDetailId==null){return 0;// continue
}if(variantDetailId!=null||productVariants.length==0||comboUpdate){var itemKey=sectionValue;var prodId=itemKey;if(variantDetailId!=null)itemKey+="."+variantDetailId;if(qtyChange){sessionStorage.setItem("productAndVariantId",itemKey);return{v:void 0}}if(pageData.pageTypeId===3){var _orderItems13=getUpsaleItems();_orderItems13[itemKey]=qty;sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems13))}else if(pageData.pageTypeId===34){var _orderItems14=getOrderItems();var currentItem=sessionStorage.getItem("currentItem");currentItem=isSubscribeOn?swapSubscriptions(_orderItems14,"",currentItem).sectionValue:currentItem;currentItem&&delete _orderItems14[currentItem];_orderItems14[itemKey]=qty;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems14));sessionStorage.setItem("currentItem",itemKey)}else if(pageData.pageTypeId===2){var _orderItems15=getOrderItems();prodId=isSubscribeOn?swapSubscriptions(_orderItems15,"",prodId).sectionValue:prodId;delete _orderItems15[prodId];_orderItems15[itemKey]=qty;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems15))}else if(pageData.pageTypeId===13){sessionStorage.setItem("newProductItem",itemKey);sessionStorage.setItem("currentItem",itemKey);sessionStorage.setItem("currentProductQty",qty);sessionStorage.setItem("newProductQty",qty)}else if(pageData.pageTypeId!==3){var _orderItems16=getOrderItems();if(!_orderItems16[itemKey]||!useCartQty)_orderItems16[itemKey]=qty;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems16));var customInputs=$(productSection).find("input[name^='custom_item_']");if(pageData.pageTypeId===4&&customInputs.length){customItemCheck(customInputs,itemKey,productSection)}}}}else if(quantity&&quantity[0]&&productVariants.length==0){var _itemKey=productSection.getAttribute("value");if(pageData.pageTypeId===3){var _orderItems17=getUpsaleItems();delete _orderItems17[_itemKey];sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems17))}else{var _orderItems18=getOrderItems();delete _orderItems18[_itemKey];_orderItems18=isSubscribeOn?swapSubscriptions(_orderItems18,_itemKey):_orderItems18;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems18))}}}},_ret3;for(var _i131=0;_i131<productSectionsLength;_i131++){_ret3=_loop34();if(_ret3===0)continue;if(_ret3)return _ret3.v}}}catch(error){error}}function getBundleVariants(params,index){var outOfStockBundleVariants=[];var outOfStockBundleProductIds=[];var productSections=document.getElementsByClassName("fk-product-section");var productSectionsLength=productSections.length;ccDeleteBundleFromCart();var bundleItems=sessionStorage.getItem("bundleItems")!==null?JSON.parse(sessionStorage.getItem("bundleItems")):{};var orderItems=getOrderItems();var bundleProductsPageRef=sessionStorage.getItem("bundleProductsPageRef")!==null?JSON.parse(sessionStorage.getItem("bundleProductsPageRef")):{};if(productSectionsLength>0){var _loop35=function _loop35(){var productSection=productSections[_i136];var item;var campaignProdId=isSubscribeOn?swapSubscriptions("","",productSection.getAttribute("value")).sectionValue:productSection.getAttribute("value");if(campaignProdId&&$(productSection).find("[name='variants']").length){var _product16=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==campaignProdId});var productVariants=productSection.querySelectorAll("[name='variants']");var productVariantsLength=productVariants.length;var bundle="";for(var j=0;j<productVariantsLength;j++){var productVariant=productVariants[j];var bundleVarQty=Number(productVariant.children[1].value).toString();var qtyValue=productVariant.querySelector(".quantity-field")&&productVariant.querySelector(".quantity-field").value||bundleVarQty;if(parseInt(qtyValue)>0){index++;params["product"+index+"_id"]=campaignProdId;params["variant"+index+"_id"]=productVariant.getAttribute("variantvalue");params["product"+index+"_qty"]=qtyValue;var _productData15=[];_productData15[0]=campaignProdId;_productData15[1]=productVariant.getAttribute("variantvalue");var _productId16=_productData15.join(".");item=verifyStock&&getOutStockedVariant(_productData15,"","","",qtyValue);if(item&&item.length>0){outOfStockBundleVariants.push(item);outOfStockBundleProductIds.push(_productId16)}orderItems[_productId16]=qtyValue;bundle+=_productId16+":"+qtyValue+"|";bundleItems[campaignProdId]=bundle;var id=pageData.pageViewReferenceId+"|"+_productId16;bundleProductsPageRef[id]=qtyValue}}}if(campaignProdId&&$(productSection).find("[name='variantBundleSelect']").length){var _product17=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId==campaignProdId});var variantBundleSelects=productSection.querySelectorAll("[name='variantBundleSelect']");var variantBundleSelectsLength=variantBundleSelects.length;var _bundle="";for(var _j3=0;_j3<variantBundleSelectsLength;_j3++){var variantBundleSelect=variantBundleSelects[_j3];index++;params["product"+index+"_id"]=campaignProdId;params["variant"+index+"_id"]=variantBundleSelect.value;var _productData16=[];_productData16[0]=campaignProdId;_productData16[1]=variantBundleSelect.value;var _productId17=_productData16.join(".");item=verifyStock&&getOutStockedVariant(_productData16,"","","",1);if(item&&item.length>0){outOfStockBundleVariants.push(item);outOfStockBundleProductIds.push(_productId17)}orderItems[_productId17]="1";_bundle+=_productId17+":1|";bundleItems[campaignProdId]=_bundle;var _id2=pageData.pageViewReferenceId+"|"+_productId17;bundleProductsPageRef[_id2]=1}}};for(var _i136=0;_i136<productSectionsLength;_i136++){_loop35()}}sessionStorage.setItem("fkCart",JSON.stringify(orderItems));sessionStorage.setItem("bundleProductsPageRef",JSON.stringify(bundleProductsPageRef));sessionStorage.setItem("bundleItems",JSON.stringify(bundleItems));var bundleStockParams={params:params,outOfStockBundleVariants:outOfStockBundleVariants,outOfStockBundleProductIds:outOfStockBundleProductIds};return bundleStockParams}function ccAddAndOpenCart(event){event.preventDefault();event.stopImmediatePropagation();try{toggleProductSelection(event)}catch(err){}openNav()}function toggleProductSelection(e){var isReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var target=e.target,currentTarget=e.currentTarget;if(isReset){currentTarget=e;target=e}var qtyInput=!isReset&&$(e.currentTarget).closest(".fk-product-section").find("[name='quantity']");if(qtyInput&&qtyInput.length&&!Number(qtyInput.val()))return;var clickableElementId=currentTarget.dataset.id;var product=null;var prodSection=null;var initBtnValue=e.currentTarget.getAttribute("data-text-value")||"Select";var btnSelectedText=e.currentTarget.getAttribute("selectedText")||"Selected";var btnSelectedBgColor=e.currentTarget.getAttribute("selectedBgColor")||"#218838";var btnSelectedTextColor=e.currentTarget.getAttribute("selectedTextColor")||"Selected";var initTextColor=$(currentTarget).attr("initTextColor");var initBgColor=$(currentTarget).attr("initBgColor");if(!initBgColor){var currentColor=$(currentTarget).css("background-color");$(currentTarget).attr("initBgColor",currentColor);initBgColor=currentColor}if(!initTextColor){var currentTextColor=$(currentTarget).css("color");$(currentTarget).attr("initTextColor",currentTextColor);initTextColor=currentTextColor}if(clickableElementId&&clickableElementId!==""){var clickableElement=$("button[data-id='"+clickableElementId+"'],a[data-id='"+clickableElementId+"']")[0];prodSection=clickableElement.closest("section.fk-product-section");if(pageData.pageTypeId===34){getVariants();product=sessionStorage.getItem("currentItem")}else if([1,2,17,18].includes(pageData.pageTypeId)){product=clickableElement.getAttribute("offer");//get the variant within this particular product section
var quantityExists=$(prodSection).find("[name='quantity']")[0];if(prodSection&&(quantityExists||$(prodSection).find("[name='variant1']").filter("select").length!==0||$(prodSection).find(".variant-label1").filter("[data-selected='true']").length>0)){getVariants(prodSection.getAttribute("id"))}else{prodSection=null}}else if(pageData.pageTypeId===3)product=clickableElement.getAttribute("upsell");else product=clickableElement.getAttribute("offer");if(!product||isNaN(parseFloat(product))){if(clickableElement){product=findParentNode(clickableElement,"product");if(product)product=product.getAttribute("value")}}else{var variantValue=clickableElement.getAttribute("variantvalue");if(variantValue)product=product+"."+variantValue}}if(product&&!isNaN(parseFloat(product))){if(currentTarget.innerHTML===btnSelectedText){currentTarget.innerHTML=initBtnValue;initBgColor?currentTarget.style.setProperty("background-color",initBgColor,"important"):currentTarget.className="btn btn-primary";btnSelectedTextColor&&initTextColor?currentTarget.style.setProperty("color",initTextColor,"important"):null;if(pageData.pageTypeId===3){var _orderItems19=getUpsaleItems();delete _orderItems19[product];sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems19))}else{var _orderItems20=getOrderItems();delete _orderItems20[product];_orderItems20=isSubscribeOn?swapSubscriptions(_orderItems20,product):_orderItems20;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems20))}}else if(!isReset){if(currentTarget.innerHTML===initBtnValue){currentTarget.innerHTML=btnSelectedText;btnSelectedBgColor?currentTarget.style.setProperty("background-color",btnSelectedBgColor,"important"):currentTarget.className="btn btn-success";btnSelectedTextColor?currentTarget.style.setProperty("color",btnSelectedTextColor,"important"):null}// If this is an upsale page, add product to upsale cart
// Else add to cart
if(pageData.pageTypeId===3){var _orderItems21=getUpsaleItems();var quantity=prodSection&&prodSection.querySelectorAll("input[name='quantity'], select[name='quantity']");if(quantity&&quantity[0]){_orderItems21[product]=quantity[0].value>0?quantity[0].value:""}else{_orderItems21[product]=1}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems21))}else if([2,17,18].includes(pageData.pageTypeId)&&prodSection){//catalog page cart was set above in getVariants
product=isSubscribeOn?swapSubscriptions(orderItems,"",product).sectionValue:product;callAddToCartEvent(product)}else{var _orderItems22=getOrderItems();product=isSubscribeOn?swapSubscriptions(_orderItems22,"",product).sectionValue:product;_orderItems22[product]=pageData.pageTypeId===34?getQuantity():1;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems22));callAddToCartEvent(product)}}displayPrices()}}function getProductDetails(product){var obj={productName:product,productValue:0};var currentOrderItems=getOrderItemDetails(false);if(currentOrderItems[product]){var _item16=currentOrderItems[product];var unitPrice=_item16.variant&&parseFloat(_item16.variant.price)>0&&!_item16.isVariantBundle&&!_item16.isEditable?_item16.variant.price:_item16.cycle1_price;var title=_item16.variant?" "+_item16.variant.title:"";obj.productName=_item16.productName+title;obj.productValue=parseFloat(getItemPrice(product,unitPrice,_item16.currentOrderQuantity).toFixed(2));obj.quantity=_item16.currentOrderQuantity;obj.campaignProductId=_item16.campaignProductId;obj.externalProductId=_item16.externalProductId;obj.variantDetailId=_item16.variant?_item16.variant.variantDetailId:""}return obj}function findParentNode(el,parentName){while(el.parentNode){el=el.parentNode;if(el.getAttribute("name")===parentName){return el}}return null}//Auto-load inputs with order data submitted on previous pages - Ex: firstName input on checkout page automatically filled with firstName submitted on leadPage
function autoLoadInputs(orderDataParam){var ccIdMeDetails=window.ccGetIdmeUserSessionDetails&&ccGetIdmeUserSessionDetails()||{};var ccUrlParams=new URLSearchParams(getCurrentWindowLocation().search);var orderData=orderDataParam?orderDataParam:JSON.parse(sessionStorage.getItem("orderData"));var inputs=$("input, select");var updatePriceTotals=false;if(orderData){orderData.country&&loadStates("state",orderData.country);orderData.shipCountry&&loadStates("shipState",orderData.shipCountry);var items=orderData.items;var isCampaignMatched=pageData.selectedCampaign.campaignId==orderData.campaignId;if(ccUrlParams.has("includeProducts")&&isCampaignMatched&&items){var _orderItems23=getOrderItems();for(var index in items){var _item17=items[index];var itemKey=_item17.variantDetailId?_item17.productId+"."+_item17.variantDetailId:_item17.productId;_orderItems23[itemKey]=_item17.qty}sessionStorage.setItem("fkCart",JSON.stringify(_orderItems23));updatePriceTotals=true}}var inputsLength=inputs.length;for(var _i137=0;_i137<inputsLength;_i137++){var input=inputs[_i137];var inputValue=orderData&&orderData[input.name]?orderData[input.name]:ccUrlParams.has(input.name)?ccUrlParams.get(input.name):ccIdMeDetails[input.name]||"";if(inputValue){var formInputs=document.getElementsByName(input.name);var formInputsLength=formInputs.length;for(var j=0;j<formInputsLength;j++){var formInput=formInputs[j];if(formInput.type==="checkbox"){if(inputValue==="on"||inputValue===true||inputValue==="true"||inputValue==="1"||inputValue===1)formInput.checked=true;else formInput.checked=false}else if(formInput.type==="radio"){if(formInput.value===inputValue)formInput.checked=true}else formInput.value=inputValue}}else if(input.name==="product"&&(input.type==="checkbox"||input.type==="radio")){var changeProductItem=pageData.pageTypeId===13&&sessionStorage.getItem("currentItem")?sessionStorage.getItem("currentItem"):null;var quantity=input.getAttribute("quantity");if(fkCart[input.value]&&(!quantity||fkCart[input.value]==quantity)||changeProductItem&&(changeProductItem===input.value||input.getAttribute("variantvalue")&&changeProductItem==input.value+"."+input.getAttribute("variantvalue")||!input.getAttribute("variantvalue")&&changeProductItem.includes(input.value+"."))){input.checked=true;updatePriceTotals=true;var prodSection=$(input).closest("section.fk-product-section");if(prodSection&&prodSection.length&&changeProductItem){var button=prodSection[0].querySelectorAll("button");button&&button.length&&button[0].click()}}}else if(input.name==="fullName"){var firstName=orderData&&orderData["firstName"]?orderData["firstName"]:ccUrlParams.has("firstName")?ccUrlParams.get("firstName"):ccIdMeDetails["firstName"]||"";if(firstName){var lastName=orderData&&orderData["lastName"]?orderData["lastName"]:ccUrlParams.has("lastName")?ccUrlParams.get("lastName"):ccIdMeDetails["lastName"]||"";var _formInputs=document.getElementsByName(input.name);var _formInputsLength=_formInputs.length;for(var _j4=0;_j4<_formInputsLength;_j4++){_formInputs[_j4].value=firstName+" "+lastName}}}else if(input.name==="shipFullName"){var shipFirstName=orderData&&orderData["shipFirstName"]?orderData["shipFirstName"]:ccUrlParams.has("shipFirstName")?ccUrlParams.get("shipFirstName"):ccIdMeDetails["shipFirstName"]||"";if(shipFirstName){var shipLastName=orderData&&orderData["shipLastName"]?orderData["shipLastName"]:ccUrlParams.has("shipLastName")?ccUrlParams.get("shipLastName"):ccIdMeDetails["shipLastName"]||"";var _formInputs2=document.getElementsByName(input.name);var _formInputsLength2=_formInputs2.length;for(var _j5=0;_j5<_formInputsLength2;_j5++){_formInputs2[_j5].value=shipFirstName+" "+shipLastName}}}}if(updatePriceTotals)displayPrices()}function ccSetCountryAndStateValues(countryInput,countryValue,stateInput,stateValue){if(countryInput){if(countryInput.value!=countryValue){countryInput.value=countryValue;var event=new Event("change");countryInput.dispatchEvent(event);var stateInputName=stateInput&&stateInput.getAttribute("name");stateInputName&&loadStates(stateInputName,countryValue)}if(stateInput&&stateValue){stateInput.value=$(stateInput).find("option[value="+stateValue+"]").val()||$(stateInput).find("option").first().val()||"";var event=new Event("change");stateInput.dispatchEvent(event)}}}$("[name=country], [name=shipCountry], [name=state], [name=shipState]").on("change",function(){var sessionInfo=sessionStorage.getItem("ccCountryAndStateInfoTracker");sessionInfo=sessionInfo?JSON.parse(sessionInfo):{};var selectElement=$(this),name=selectElement.attr("name"),value=selectElement.val();sessionInfo[name]=value;switch(name){case"country":sessionInfo["state"]="";break;case"shipCountry":sessionInfo["shipState"]="";break}sessionStorage.setItem("ccCountryAndStateInfoTracker",JSON.stringify(sessionInfo))});//load state/country from IP address
function setGeoFromIP(){return _setGeoFromIP.apply(this,arguments)}//return currency from sessionStorage if present
function _setGeoFromIP(){_setGeoFromIP=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee32(){var address1,shipAddress1,country,state,shipCountry,shipState,ip,currencyElements,currencyCodeValue,pageDataCurrency,pageDataCurrencies,currency,countryCode,regionCode,sessionAddressInfo,_ccUrlParams2,countryValue,orderData,customerOrders,customerOrderData,selectedCampaignCountry;return _regeneratorRuntime().wrap(function _callee32$(_context36){while(1)switch(_context36.prev=_context36.next){case 0:address1=document.getElementsByName("address1")[0]?document.getElementsByName("address1")[0].value:null;shipAddress1=document.getElementsByName("shipAddress1")[0]?document.getElementsByName("shipAddress1")[0].value:null;country=document.getElementsByName("country")[0];state=document.getElementsByName("state")[0];shipCountry=document.getElementsByName("shipCountry")[0];shipState=document.getElementsByName("shipState")[0];ip=null;currencyElements=document.getElementsByName("currency")[0]?document.getElementsByName("currency")[0]:null;currencyCodeValue=returnCurrencyCode();pageDataCurrency=pageData.selectedCampaign.currency;pageDataCurrencies=pageData.selectedCampaign.currencies;currency=pageData.cartData&&pageData.cartData.currency;if(currency){if(!fetchCurrentCurrencyObj(currency)){if(pageDataCurrencies&&pageDataCurrencies.length){pageData.selectedCampaign.currencies.push({currencySymbol:currency,currencyCode:currency})}else{pageData.selectedCampaign.currencies=[{currencySymbol:currency,currencyCode:currency}]}pageDataCurrencies=pageData.selectedCampaign.currencies}currencyCodeValue=currency}if(!(!address1&&!shipAddress1&&(country||shipCountry))){_context36.next=19;break}_context36.next=16;return getIpPhysicalAddress();case 16:ip=_context36.sent;countryCode=ip&&ip.country_code;if(countryCode){if(pageData.selectedCampaign.countries.find(function(data){return data.countryCode==countryCode})){regionCode=ip.region_code;sessionAddressInfo=sessionStorage.getItem("ccCountryAndStateInfoTracker");sessionAddressInfo=sessionAddressInfo?JSON.parse(sessionAddressInfo):{};_ccUrlParams2=new URLSearchParams(getCurrentWindowLocation().search);countryCode=_ccUrlParams2&&_ccUrlParams2.has("country")?_ccUrlParams2.get("country"):sessionAddressInfo["country"]||countryCode;regionCode=_ccUrlParams2&&_ccUrlParams2.has("state")?_ccUrlParams2.get("state"):sessionAddressInfo["state"]||regionCode;ccSetCountryAndStateValues(country,countryCode,state,regionCode);countryCode=_ccUrlParams2&&_ccUrlParams2.has("shipCountry")?_ccUrlParams2.get("shipCountry"):sessionAddressInfo["shipCountry"]||ip.country_code;regionCode=_ccUrlParams2&&_ccUrlParams2.has("shipState")?_ccUrlParams2.get("shipState"):sessionAddressInfo["shipState"]||ip.region_code;ccSetCountryAndStateValues(shipCountry,countryCode,shipState,regionCode)}}case 19:countryValue=country&&country.value||shipCountry&&shipCountry.value;countryValue&&ccTriggerSocialProof(countryValue);orderData=sessionStorage.getItem("orderData");orderData=orderData?JSON.parse(orderData):{};if(!(orderData&&orderData.country)){_context36.next=27;break}defaultCountryCode=orderData.country;_context36.next=37;break;case 27:defaultCountryCode=pageData.selectedCampaign.countries.length&&!pageData.selectedCampaign.states["US"]?pageData.selectedCampaign.countries[0].countryCode:"US";if(ip){_context36.next=34;break}_context36.next=31;return getIpPhysicalAddress();case 31:_context36.t0=_context36.sent;_context36.next=35;break;case 34:_context36.t0=ip;case 35:ip=_context36.t0;if(ip&&ip.country_code&&pageData.selectedCampaign.countries.find(function(obj){return obj.countryCode===ip.country_code})){defaultCountryCode=ip.country_code;vatTaxRate=getTaxRate().vatTaxRate}case 37:if(cookieData["access_token"]){customerOrders=sessionStorage.getItem("customerOrders");customerOrders=customerOrders?JSON.parse(customerOrders):[];customerOrderData=customerOrders[0]||{};ccSetCountryAndStateValues(country,customerOrderData.country,state,customerOrderData.state);ccSetCountryAndStateValues(shipCountry,customerOrderData.shipCountry,shipState,customerOrderData.shipState)}if(!(pageDataCurrencies&&pageDataCurrencies.length)){_context36.next=50;break}loadStaticCurrencyValues();if(currencyCodeValue){_context36.next=48;break}sessionStorage.setItem("currencyCode",pageDataCurrency);if(ip){_context36.next=46;break}_context36.next=45;return getIpPhysicalAddress();case 45:ip=_context36.sent;case 46:if(ip&&ip.country_code){selectedCampaignCountry=pageData.selectedCampaign.countries.find(function(obj){return obj.countryCode===ip.country_code});if(selectedCampaignCountry&&pageDataCurrencies.find(function(obj){return obj.currencyCode===selectedCampaignCountry.currencyCode})){sessionStorage.setItem("currencyCode",selectedCampaignCountry.currencyCode)}}currencyCodeValue=returnCurrencyCode();case 48:if(currencyElements){$(currencyElements).find("option").remove().end().append("<option value="+pageDataCurrency+">"+pageDataCurrency+"</option>").attr("selected","selected");$(pageDataCurrencies).each(function(){var currencyObj=this;currencyObj.currencyCode!==pageDataCurrency&&$(currencyElements).append($("<option></option>").attr("value",currencyObj.currencyCode).text(currencyObj.currencyCode))});$(currencyElements).find("option[value=\""+currencyCodeValue+"\"]").attr("selected","selected");currency&&$(currencyElements).attr("disabled",currency!==pageData.selectedCampaign.currency)}setPriceAndCurrency(currencyCodeValue);case 50:case"end":return _context36.stop()}},_callee32)}));return _setGeoFromIP.apply(this,arguments)}function returnCurrencyCode(){return sessionStorage.getItem("currencyCode")?sessionStorage.getItem("currencyCode"):null}//Fire pixels returned from Import Click (importClick or useSession function)
function firePixel(pixelHtml){var pixelDiv=document.createElement("DIV");pixelDiv.innerHTML=pixelHtml;document.body.appendChild(pixelDiv)}//CRM-4650
function fireSiftPixel(beaconKey){var _sift=window._sift=window._sift||[];_sift.push(["_setAccount",beaconKey]);_sift.push(["_setUserId",""]);_sift.push(["_setSessionId",sessionStorage.getItem("sessionId")]);_sift.push(["_trackPageview"]);(function(){var ta=document.createElement("script");ta.type="text/javascript";ta.async=true;ta.src="https://cdn.sift.com/s.js";document.body.appendChild(ta)})()}function getQuantity(){var qty=1;var qtyInput=document.getElementsByName("quantity")[0];if(qtyInput){qty=parseInt(qtyInput.value)||1;qty=qty>0?qty:1}return qty}function setShoppingCartSpinner(){var dynamicCartRow=document.querySelector("tr[id='fk-dynamic-cart-row']");if(dynamicCartRow){$(dynamicCartRow).find("button").attr("disabled",false);$(dynamicCartRow).find("a").css("pointer-events","auto");cellFormat=Array.prototype.slice.call(dynamicCartRow.cells);if(cellFormat.length>0){dynamicCartRow.innerHTML="<td colspan=4>"+getSpinnerDiv().outerHTML+"</td>";dynamicCartRow.style.display="contents"}}}function findAddOn(addOnKey){var addons=pageData&&pageData.funnelData&&pageData.funnelData.addOns||funnelJson&&funnelJson.funnelData&&funnelJson.funnelData.addOns;if(addons){return addons.find(function(addOns){return addOns.keyName===addOnKey})}else{return null}}function getAddOnKeyValue(addOn){return addOn?addOn.keyValue:""}function generateDisplayItems(shipping,tax,discount,displayItemObj){var cartLabelValues=["Shipping","Sales Tax","Discount"];var cartValues=[shipping,tax,discount];var cartLength=cartValues.length;for(var _i138=0;_i138<cartLength;_i138++){var displayItemObject={};if(cartValues[_i138]){displayItemObject.label=cartLabelValues[_i138];displayItemObject.type="LINE_ITEM";displayItemObject.price=cartLabelValues[_i138]==="Discount"?"-"+cartValues[_i138]:cartValues[_i138].toString();displayItemObj.lineItems.push(displayItemObject)}}}function customerNotificationHandler(message,buttonId){enableInteractions();sessionStorage.removeItem("paySource");var tag=document.getElementById("paypal-notify");if(tag===null){tag=document.createElement("p");tag.setAttribute("id","paypal-notify")}tag.innerHTML=message;var color=tag.style.color="red";var paypalButton=document.getElementById(buttonId);paypalButton?$(tag).insertAfter(paypalButton):alert(message);clearCCPayPalSessionData()}function addOverlayEffectScripts(){try{if(document.getElementById("overlayEffectDiv")){return}$("head").append(overlayStyles);$("body").append(overlayHTML)}catch(err){console.log("Error: Unable to add overlay scripts")}}function hideOverlayEffect(){try{document.getElementById("overlayEffectDiv").style.display="none"}catch(err){console.log("Error: Unable to hide overlay effect")}}function showOverlayEffect(){try{document.getElementById("overlayEffectDiv").style.display="block"}catch(err){console.log("Error: Unable to show overlay effect")}}function configurePayPalSmartButtons(){$("[data-partner-attribution-id=CheckoutChampLLC_PPFM_PPCP]").remove();var isBuildOrTemplate=checkBuildOrTemplate();var pageTypeId=pageData.pageTypeId;if(isBuildOrTemplate||![3,4].includes(pageTypeId)){return}var isUpsellPage=pageTypeId===3;var ispaypalSmartButtonUsed=sessionStorage.getItem("paypalSmartButton");var isReferencedTransaction=getAddOnKeyValue(findAddOn("PayPal_Reference"))==="1"?1:0;var isPayPalVaultEnabled=getAddOnKeyValue(findAddOn("PayPal_Vault"))==="1"?1:0;var singleTransaction=isReferencedTransaction&&parseInt(pageData.selectedCampaign.singleTransaction);var shippableCheckout=sessionStorage.getItem("ccShippableCheckout");var captureOnShipment=(!shippableCheckout||shippableCheckout==="true")&&Number(pageData.selectedCampaign.captureOnShipment);var orderData=sessionStorage.getItem("orderData");orderData=orderData?JSON.parse(orderData):{};var orderPrepaidType=orderData.prepaidType;if(isUpsellPage&&(ispaypalSmartButtonUsed!=="true"||(isPayPalVaultEnabled?isReferencedTransaction&&orderPrepaidType!=="PAYPAL_PAYLATER":isReferencedTransaction))){ccSetSpecificButtonLoadStatus(".btnPayPal, .btnPayPal2");return}var isPayPalGatewaySelected=getAddOnKeyValue(findAddOn("paypalPayLaterHide"))==="true"?true:false;var isVenmoSelected=parseInt(getAddOnKeyValue(findAddOn("PayPal_Venmo")));var isPayLaterSelected=parseInt(getAddOnKeyValue(findAddOn("PayPal_PayLater")));var enableFunding=[];var disableFunding="card,bancontact,giropay,blik,eps,ideal,mercadopago,mybank,p24,sepa,sofort";if(isVenmoSelected&&(!isUpsellPage||isUpsellPage&&orderPrepaidType==="PAYPAL_VENMO")){enableFunding.push("venmo")}else{disableFunding=disableFunding+",venmo"}var messageComponent="";if(isPayLaterSelected&&!singleTransaction&&(!isUpsellPage||isUpsellPage&&orderPrepaidType==="PAYPAL_PAYLATER")){messageComponent=",messages";enableFunding.push("paylater")}else{disableFunding=disableFunding+",credit,paylater"}enableFunding=enableFunding.join();var merchantId=getAddOnKeyValue(findAddOn("PayPal_Merchant"));if(isPayPalGatewaySelected||(isUpsellPage?false:!enableFunding)||!merchantId||!(!isReferencedTransaction||isPayPalVaultEnabled)){$(".btnPayPal, .btnPayPal2").css("pointer-events","auto");ccSetSpecificButtonLoadStatus(".btnPayPal, .btnPayPal2");return}$(".btnPayPal, .btnPayPal2").css("pointer-events","none");disableFunding="&disable-funding="+disableFunding;enableFunding=enableFunding?"&enable-funding="+enableFunding:"";addOverlayEffectScripts();var transactionParams="";if(parseInt(pageData.selectedCampaign.requireQA)||singleTransaction||captureOnShipment){transactionParams="&intent=authorize"}var payPalSandbox=document.URL.includes("dev-funnels")||getAddOnKeyValue(findAddOn("PayPal_Sandbox"))==="1";var datasetObj=[{key:"partnerAttributionId",value:"CheckoutChampLLC_PPFM_PPCP"}];var clientId=payPalSandbox?"AdATBZ6vUtyH5FQ3weG-63lWwkNioUYJ0b07KEdVwrw0z_DkctGqnz2Q7O-59Dh5nLAOo0LsQOw5GTqY":"AWGTxJ1AlWxI4ZyxZ8J-Mrc_gkVkPR-CFBcT4UnlYUFvEulP6ItFrm_DnLhpZ7dlB94KhqFGd3t7dMQs";var paypalUrl="https://www.paypal.com/sdk/js?client-id="+clientId+disableFunding+enableFunding+"&merchant-id="+merchantId+transactionParams+"&components=buttons"+messageComponent+"&currency="+(returnCurrencyCode()||pageData.selectedCampaign.currency);var scriptAttrs=[{key:"async",value:true}];loadScript(paypalUrl,addPayPalSmartButton,false,false,datasetObj,scriptAttrs,null,handleScriptLoadError);function handleScriptLoadError(event){$(".paypalSdkLoadFailureError").remove();$(".btnPayPal, .btnPayPal2").css("pointer-events","none");$("<div style='color: red;' class='paypalSdkLoadFailureError'>PayPal transaction is not supported with selected currency.</div>").insertAfter($(".btnPayPal, .btnPayPal2"))}function addPayPalSmartButton(){var paypalSdkParams="";var pageType=pageData.pageTypeId;var paypalButtonCollection=document.querySelectorAll(".btnPayPal, .btnPayPal2");var buttonAndLinkCollection=[],productAttr=isUpsellPage?"upsell":"offer";if(isUpsellPage&&ispaypalSmartButtonUsed==="true"){var linkCollection=document.querySelectorAll("a");var buttonCollection=document.querySelectorAll("button");[].concat(_toConsumableArray(linkCollection),_toConsumableArray(buttonCollection)).forEach(function(element){if(element.getAttribute("action")==="submit"){buttonAndLinkCollection.push(element)}})}[].concat(_toConsumableArray(paypalButtonCollection),buttonAndLinkCollection).forEach(function(payPalButton){var divId=payPalButton.id,dataSetId=payPalButton.dataset.id;var payPalButtonDiv=document.createElement("div");payPalButtonDiv.classList=payPalButton.classList;payPalButtonDiv.dataset.id=dataSetId;payPalButtonDiv.attributes=payPalButton.attributes;payPalButtonDiv.title=payPalButton.title;payPalButtonDiv.style.backgroundImage="none";payPalButtonDiv.style.backgroundColor="transparent";payPalButtonDiv.style.padding="0px";payPalButtonDiv.style.height="auto";payPalButtonDiv.style.width="auto";payPalButtonDiv.style.display="inline-flex";payPalButtonDiv.style.border="none";payPalButtonDiv.setAttribute(productAttr,payPalButton.getAttribute(productAttr)||"");payPalButtonDiv.setAttribute("variantvalue",payPalButton.getAttribute("variantvalue")||"");payPalButtonDiv.setAttribute("replaceproductid",payPalButton.getAttribute("replaceproductid")||"");payPalButtonDiv.setAttribute("quantity",payPalButton.getAttribute("quantity")||"");payPalButtonDiv.setAttribute("price",payPalButton.getAttribute("price")||"");payPalButtonDiv.setAttribute("altvalue",payPalButton.getAttribute("altvalue")||"");ccSetAltValues(payPalButtonDiv);payPalButton.insertAdjacentElement("beforebegin",payPalButtonDiv);payPalButton.remove();payPalButtonDiv.id=divId;var smartButtonReplacementId="#"+divId;var buttonId=payPalButton.dataset.id;var buttonItem=getNavigationItemFromPageData(buttonId);var buttonData=getButtonOrLinkData(buttonItem,pageType);var route=redirectPath(buttonData,true);var paypalPrePaidType=null;var smartButtonConfig={style:{layout:"vertical",shape:"rect",label:"paypal"},onClick:function onClick(data,actions){try{if(fflPopUpRequired(buttonId)){updateFFLModalButtonCSS(buttonId);showFFLPopUp();return actions.reject()}sessionStorage.setItem("paypalSdk",true);sessionStorage.setItem("paySource","PAYPAL");var fundingSource=data&&data.fundingSource&&data.fundingSource.toUpperCase();if(["VENMO","PAYLATER"].includes(fundingSource)){paypalPrePaidType="PAYPAL_"+fundingSource}if(isUpsellPage&&orderPrepaidType!==paypalPrePaidType){customerNotificationHandler("PayPal's payment method must match the method used on the checkout page.",divId);return actions.reject()}return callMethodApply(buttonId,paypalPrePaidType).then(function(res){if(res&&res.result==="SUCCESS"&&res.message&&res.message.paypalSdkParams){paypalSdkParams=res.message.paypalSdkParams;return actions.resolve()}else{return actions.reject()}})}catch(err){if(!(window.paypal&&window.paypal.Buttons)){throw new Error("Error: Unable to load PayPal script.")}else{throw new Error("Error: Please configure PayPal credentials properly.")}}},onApprove:function onApprove(data,actions){try{sessionStorage.setItem("ccConfirmPayPalCalled",true);confirmPaypal(data.orderID,data.payerID,data.billingToken,paypalPrePaidType)}catch(err){throw new Error("Error: Unable to confirm order.")}},onCancel:function onCancel(data){customerNotificationHandler("Payment cancelled",divId)},onError:function onError(err){customerNotificationHandler(err,divId)}};if($(".cc-express-checkout").find("[data-id='"+dataSetId+"']").length){smartButtonConfig.onInit=function(){ccSetButtonLoadStatus(null,dataSetId,true)}}smartButtonConfig.createOrder=function(data,actions){try{var _orderId6=paypalSdkParams&&paypalSdkParams.id;if(!_orderId6)throw new Error("Insufficient data to process PayPal checkout.");return _orderId6}catch(err){throw err.message}};paypal.Buttons(smartButtonConfig).render(smartButtonReplacementId)});$(".btnPayPal, .btnPayPal2").css("pointer-events","auto")}}function configureAmazonPay(){var amazonBillerId=getAddOnKeyValue(findAddOn("amazonBillerId"));var amazonClientId=getAddOnKeyValue(findAddOn("amazonClientId"));var amazonSellerId=getAddOnKeyValue(findAddOn("amazonSellerId"));var amazonAccessKey=getAddOnKeyValue(findAddOn("amazonAccessKey"));var amazonRecurring=getAddOnKeyValue(findAddOn("amazonRecurring"));if(!amazonBillerId||!amazonClientId||!amazonSellerId||!amazonAccessKey)return;sessionStorage.setItem("amazonBillerId",amazonBillerId);var useAmazonSandbox=document.URL.includes("dev-funnels");window.onAmazonLoginReady=function(){amazon.Login.setClientId(amazonClientId)};window.onAmazonPaymentsReady=function(){//get parameters from the URL query string
var ccUrlParams=new URLSearchParams(getCurrentWindowLocation().search);if(ccUrlParams.has("access_token")){var amazonAccessToken=ccUrlParams.get("access_token");sessionStorage.setItem("amazonAccessToken",amazonAccessToken);addAmazonAddressBook();addAmazonWallet();//get Amazon profile details: username, email address, userID
var profileResponse;var amazonProfileUrl=useAmazonSandbox?"https://api.sandbox.amazon.com/user/profile":"https://api.amazon.com/user/profile";$.ajax({async:false,type:"GET",// cors: true,
headers:{"Authorization":"bearer "+amazonAccessToken},url:amazonProfileUrl,success:function success(result){profileResponse=result},error:function error(xhr){return xhr.status}});sessionStorage.setItem("amazonEmail",profileResponse.email);sessionStorage.setItem("amazonName",profileResponse.name);sessionStorage.setItem("amazonUserId",profileResponse.user_id)}else{addAmazonButton()}};var amazonScriptUrl=useAmazonSandbox?"https://static-na.payments-amazon.com/OffAmazonPayments/us/sandbox/js/Widgets.js":"https://static-na.payments-amazon.com/OffAmazonPayments/us/js/Widgets.js";loadScript(amazonScriptUrl);function addAmazonButton(){document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark").forEach(function(amazonButton){var buttonColor=amazonButton.className.includes("btnAmazonGold")?"Gold":amazonButton.className.includes("btnAmazonLight")?"LightGray":"DarkGray";var divId=amazonButton.id;var amazonButtonDiv=document.createElement("div");var datasetId=amazonButton.dataset.id;amazonButtonDiv.className=amazonButton.className;amazonButtonDiv.dataset.id=datasetId;amazonButtonDiv.title=amazonButton.title;amazonButtonDiv.attributes=amazonButton.attributes;amazonButtonDiv.style.backgroundImage="none";amazonButtonDiv.style.padding="0px";amazonButton.insertAdjacentElement("beforebegin",amazonButtonDiv);amazonButton.remove();amazonButtonDiv.id=divId;var authRequest;OffAmazonPayments.Button(divId,amazonSellerId,{type:"PwA",color:buttonColor,size:"x-large",authorization:function authorization(){loginOptions={scope:"profile payments:widget payments:shipping_address",popup:"true"};authRequest=amazon.Login.authorize(loginOptions,getCurrentWindowLocation().href)},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}});var amazonBtnImgTag=amazonButtonDiv.querySelectorAll("img")[0];amazonBtnImgTag?$(amazonBtnImgTag).css({"max-height":"fit-content","height":"auto","width":"100%"}):null})}function addAmazonAddressBook(){var addressBookDiv=document.createElement("div");addressBookDiv.id="amazonAddressBookDiv";addressBookDiv.style.width="500px";addressBookDiv.style.height="400px";var amazonBtn=document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark")[0];amazonBtn.insertAdjacentElement("beforebegin",addressBookDiv);if(amazonRecurring){sessionStorage.setItem("amazonRebillEnabled",1);new OffAmazonPayments.Widgets.AddressBook({sellerId:amazonSellerId,agreementType:"BillingAgreement",onReady:function onReady(billingAgreement){var amazonOrderId=billingAgreement.getAmazonBillingAgreementId();sessionStorage.setItem("paySource","AMAZON");sessionStorage.setItem("amazonOrderId",amazonOrderId);addConsentWidget(amazonOrderId)},design:{designMode:"responsive"},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonAddressBookDiv")}else{new OffAmazonPayments.Widgets.AddressBook({sellerId:amazonSellerId,onOrderReferenceCreate:function onOrderReferenceCreate(orderReference){var amazonOrderId=orderReference.getAmazonOrderReferenceId();sessionStorage.setItem("paySource","AMAZON");sessionStorage.setItem("amazonOrderId",amazonOrderId)},design:{designMode:"responsive"},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonAddressBookDiv")}}function addAmazonWallet(){var walletDiv=document.createElement("div");walletDiv.id="amazonWalletDiv";walletDiv.style.width="500px";walletDiv.style.height="400px";var amazonBtn=document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark")[0];amazonBtn.insertAdjacentElement("beforebegin",walletDiv);new OffAmazonPayments.Widgets.Wallet({sellerId:amazonSellerId,design:{designMode:"responsive"},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonWalletDiv")}function addConsentWidget(amazonBillingAgreementId){var consentDiv=document.createElement("div");consentDiv.id="amazonConsentDiv";consentDiv.style.width="500px";consentDiv.style.height="400px";var amazonBtn=document.querySelectorAll(".btnAmazonGold, .btnAmazonLight, .btnAmazonDark")[0];amazonBtn.insertAdjacentElement("beforebegin",consentDiv);new OffAmazonPayments.Widgets.Consent({sellerId:amazonSellerId,amazonBillingAgreementId:amazonBillingAgreementId,design:{designMode:"responsive"},onConsent:function onConsent(billingAgreementConsentStatus){var consentStatus=billingAgreementConsentStatus.getConsentStatus();if(consentStatus)sessionStorage.setItem("amazonConsentReceived",1);else sessionStorage.removeItem("amazonConsentReceived")},onError:function onError(error){alert("Amazon Error: "+error.getErrorCode()+" - "+error.getErrorMessage())}}).bind("amazonConsentDiv")}}function configureSquare(){var squareLabels=document.querySelectorAll(".squareCheckoutLabel");var squareAppId=getAddOnKeyValue(findAddOn("squareApplicationId"));var squareLocationId=getAddOnKeyValue(findAddOn("squareLocationId"));if(!squareLabels[0]||!squareAppId||!squareLocationId)return;var squareForm="<form id=\"payment-form\"><div id=\"square-card-container\"></div><input type=\"button\" value=\"\" id=\"square-card-button\" class=\"d-none\"></form><input type=\"hidden\" id=\"formCardNonce\" name=\"formCardNonce\" value=\"\" />";squareLabels[0].insertAdjacentHTML("beforebegin",squareForm);squareLabels[0].style.display="none";var squareUrl=document.URL.includes("dev-funnels")?"https://sandbox.web.squarecdn.com/v1/square.js":"https://web.squarecdn.com/v1/square.js";loadScript(squareUrl,initSquare)}function initSquare(){return _initSquare.apply(this,arguments)}function _initSquare(){_initSquare=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee37(){var squareAppId,squareLocationId,squareInitializeCard,_squareInitializeCard,squareTokenize,_squareTokenize,squarePayments,squareCard,handleSquarePaymentToken,_handleSquarePaymentToken,squareCardButton,handleSquareSuccess,handleSquareError;return _regeneratorRuntime().wrap(function _callee37$(_context41){while(1)switch(_context41.prev=_context41.next){case 0:handleSquareError=function _handleSquareError(error){alert(error);enableInteractions()};handleSquareSuccess=function _handleSquareSuccess(token){var nonce=document.getElementById("formCardNonce");if(nonce)nonce.value=token;var squareSubmitBtnId=localStorage.getItem("squareSubmitBtnId");callMethodApply(squareSubmitBtnId)};_handleSquarePaymentToken=function _handleSquarePaymentT2(){_handleSquarePaymentToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee36(event,paymentMethod){var nonce,_token3;return _regeneratorRuntime().wrap(function _callee36$(_context40){while(1)switch(_context40.prev=_context40.next){case 0:event.preventDefault();nonce=document.getElementById("formCardNonce");if(!(nonce&&nonce.value!="")){_context40.next=6;break}handleSquareSuccess(nonce.value);_context40.next=16;break;case 6:_context40.prev=6;_context40.next=9;return squareTokenize(paymentMethod);case 9:_token3=_context40.sent;handleSquareSuccess(_token3);_context40.next=16;break;case 13:_context40.prev=13;_context40.t0=_context40["catch"](6);handleSquareError(_context40.t0.message);case 16:case"end":return _context40.stop()}},_callee36,null,[[6,13]])}));return _handleSquarePaymentToken.apply(this,arguments)};handleSquarePaymentToken=function _handleSquarePaymentT(_x48,_x49){return _handleSquarePaymentToken.apply(this,arguments)};_squareTokenize=function _squareTokenize3(){_squareTokenize=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee35(paymentMethod){var tokenResult,errorMessage;return _regeneratorRuntime().wrap(function _callee35$(_context39){while(1)switch(_context39.prev=_context39.next){case 0:_context39.next=2;return paymentMethod.tokenize();case 2:tokenResult=_context39.sent;if(!(tokenResult.status==="OK")){_context39.next=7;break}return _context39.abrupt("return",tokenResult.token);case 7:errorMessage="Tokenization failed with status:"+tokenResult.status;if(tokenResult.errors&&tokenResult.errors[0]&&tokenResult.errors[0].message)errorMessage+=" and error: "+tokenResult.errors[0].message;throw new Error(errorMessage);case 10:case"end":return _context39.stop()}},_callee35)}));return _squareTokenize.apply(this,arguments)};squareTokenize=function _squareTokenize2(_x47){return _squareTokenize.apply(this,arguments)};_squareInitializeCard=function _squareInitializeCard3(){_squareInitializeCard=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee34(payments){var card;return _regeneratorRuntime().wrap(function _callee34$(_context38){while(1)switch(_context38.prev=_context38.next){case 0:_context38.next=2;return payments.card();case 2:card=_context38.sent;_context38.next=5;return card.attach("#square-card-container");case 5:return _context38.abrupt("return",card);case 6:case"end":return _context38.stop()}},_callee34)}));return _squareInitializeCard.apply(this,arguments)};squareInitializeCard=function _squareInitializeCard2(_x46){return _squareInitializeCard.apply(this,arguments)};if(window.Square){_context41.next=11;break}handleSquareError("Square.js failed to load properly");return _context41.abrupt("return");case 11:squareAppId=getAddOnKeyValue(findAddOn("squareApplicationId"));squareLocationId=getAddOnKeyValue(findAddOn("squareLocationId"));_context41.prev=13;squarePayments=window.Square.payments(squareAppId,squareLocationId);_context41.next=21;break;case 17:_context41.prev=17;_context41.t0=_context41["catch"](13);handleSquareError("applicationId and/or locationId is incorrect");return _context41.abrupt("return");case 21:_context41.prev=21;_context41.next=24;return squareInitializeCard(squarePayments);case 24:squareCard=_context41.sent;_context41.next=31;break;case 27:_context41.prev=27;_context41.t1=_context41["catch"](21);handleSquareError("Initializing Card failed. Reason: "+_context41.t1.message);return _context41.abrupt("return");case 31:squareCardButton=document.getElementById("square-card-button");squareCardButton.addEventListener("click",/*#__PURE__*/function(){var _ref50=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee33(event){var squareSubmitBtnId;return _regeneratorRuntime().wrap(function _callee33$(_context37){while(1)switch(_context37.prev=_context37.next){case 0:squareSubmitBtnId=localStorage.getItem("squareSubmitBtnId");disableInteractions(squareSubmitBtnId,true,false);_context37.next=4;return handleSquarePaymentToken(event,squareCard);case 4:case"end":return _context37.stop()}},_callee33)}));return function(_x50){return _ref50.apply(this,arguments)}}());case 33:case"end":return _context41.stop()}},_callee37,null,[[13,17],[21,27]])}));return _initSquare.apply(this,arguments)}function configureApplePay(buttonId){var applePayPluginId=getAddOnKeyValue(findAddOn("applePayPluginId"));var applePayBillerId=getAddOnKeyValue(findAddOn("applePayBillerId"));if(!applePayPluginId&&!applePayBillerId)return;if(buttonId&&window.ApplePaySession&&window.ApplePaySession.canMakePayments()&&window.ApplePaySession.supportsVersion(1)){try{createPaymentRequest(buttonId)}catch(e){console.log(e)}}else{var applePayBtns=document.querySelectorAll(".btnApplePay, .cc-global-payment-btn");if(!applePayBtns)return;var appleButtonLength=applePayBtns.length;var _loop36=function _loop36(){var appleButton=applePayBtns[_i139];if(window.ApplePaySession&&window.ApplePaySession.canMakePayments()&&window.ApplePaySession.supportsVersion(1)){appleButton.removeAttribute("onclick");appleButton.onclick=function(){event.preventDefault();var datasetId=appleButton.dataset.id;sessionStorage.setItem("paySource","APPLEPAY");try{createPaymentRequest(datasetId)}catch(e){console.log(e)}}}else{appleButton.style.display="none"}};for(var _i139=0;_i139<appleButtonLength;_i139++){_loop36()}}function getShippingDetails(lineItems){var shipProfileData=getShipProfile();var shipProfileName=shipProfileData&&shipProfileData.profileName;var shipMethod=shipProfileData&&shipProfileData.shipMethod;var shipLabel=shipProfileName?shipProfileName:"Product shipping";var shipDetail=shipMethod?shipMethod:"Standard";var shipAmount="0.00";lineItems&&lineItems.forEach(function(item){if(item.label==="Shipping"){shipAmount=item.amount}});var shippingDetails=[{"label":shipLabel,"detail":shipDetail,"amount":shipAmount,"identifier":"shipping"}];return shippingDetails}function createPaymentRequest(buttonId){var request={};var offer=getOfferFromNavigationItem(buttonId);request.countryCode=getAddOnKeyValue(findAddOn("applePayCountryCode"));//required
request.currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;//required
request.merchantCapabilities=["supports3DS"];//required
request.supportedNetworks=["visa","masterCard","amex","discover"];//required
if(pageData.pageTypeId===4){var offerButtonElement=document.querySelector("[data-id="+buttonId+"]");var offerButtonVariantValue=offerButtonElement.getAttribute("variantvalue");getVariants();var _orderItems24=getOrderItems();if(offer){var itemOfferKey;if(offerButtonVariantValue){itemOfferKey=offer+"."+offerButtonVariantValue}else{itemOfferKey=offer}_orderItems24[itemOfferKey]=getQuantity();_orderItems24=isSubscribeOn?swapSubscriptions(_orderItems24):_orderItems24;sessionStorage.setItem("fkCart",JSON.stringify(_orderItems24))}}else if(pageData.pageTypeId===3){var upsell=getUpsellFromNavigationItem(buttonId);var upsellButtonElement=document.querySelector("[data-id="+buttonId+"]");var upsellButtonVariantValue=upsellButtonElement.getAttribute("variantvalue");getVariants();var _orderItems25=sessionStorage.getItem("upsalefkCart")!==null?JSON.parse(sessionStorage.getItem("upsalefkCart")):{};if(upsell){if(upsellButtonVariantValue){var _itemOfferKey3=upsell+"."+upsellButtonVariantValue;_orderItems25[_itemOfferKey3]=getQuantity()}else{_orderItems25[upsell]=getQuantity()}sessionStorage.setItem("upsalefkCart",JSON.stringify(_orderItems25))}}if(fflPopUpRequired(buttonId)){updateFFLModalButtonCSS(buttonId);showFFLPopUp();return}var _getAppleItems=getAppleItems(),appleTotal=_getAppleItems.appleTotal,appleItems=_getAppleItems.appleItems;request.total=appleTotal;//required
request.lineItems=appleItems;request.requiredBillingContactFields=["email","name","phone","postalAddress"];request.requiredShippingContactFields=["email","name","phone","postalAddress"];if(shippingCostApplePayIncluded){request.shippingMethods=getShippingDetails(request.lineItems)}var version;for(var _i140=4;_i140>0;_i140--){if(window.ApplePaySession.supportsVersion(_i140)){version=_i140;break}}var settings={};var session=new ApplePaySession(version,request);session.onshippingcontactselected=function onshippingcontactselected(event){//update totals and line items based on shipping address selection
var shippingContact=event.shippingContact;var formShipAddress=document.getElementsByName("shipAddress1")[0]&&document.getElementsByName("shipAddress1")[0].value;if(!formShipAddress){setAppleAddress(event.shippingContact,"shipping",{})}var _getAppleItems2=getAppleItems(),appleTotal=_getAppleItems2.appleTotal,appleItems=_getAppleItems2.appleItems;var update={newTotal:appleTotal,//new transaction total amount
newLineItems:appleItems};session.completeShippingContactSelection(update)};session.onshippingmethodselected=function onshippingmethodselected(event){//update totals and line items based on shipping method selection
var shippingMethod=event.shippingMethod;var _getAppleItems3=getAppleItems(),appleTotal=_getAppleItems3.appleTotal,appleItems=_getAppleItems3.appleItems;var update={newTotal:appleTotal,//new transaction total amount
newLineItems:appleItems};session.completeShippingMethodSelection(update)};session.onpaymentauthorized=function onpaymentauthorized(event){var payment=event.payment;sessionStorage.setItem("applePayPayment",JSON.stringify(payment));sessionStorage.setItem("applePayToken",JSON.stringify(payment.token));//Call Import Order / Import Upsale here with applePayToken parameter
callMethodApply(buttonId)};session.onpaymentmethodselected=function onpaymentmethodselected(event){//update totals and line items based on payment method selection
var paymentMethod=event.paymentMethod;var _getAppleItems4=getAppleItems(),appleTotal=_getAppleItems4.appleTotal,appleItems=_getAppleItems4.appleItems;var update={newTotal:appleTotal,//new transaction total amount
newLineItems:appleItems};session.completePaymentMethodSelection(update)};session.oncancel=function oncancel(event){if(pageData.pageTypeId===4){offer&&rolebackSessionProducts(offer);sessionStorage.removeItem("paySource");displayPrices()}sessionStorage.removeItem("upsalefkCart");enableInteractions()};session.onvalidatemerchant=function onvalidatemerchant(event){//call API (via server to server - backend) using event.validationURL as endpoint to start Apple Pay Payment Session
var params={};applePayPluginId?params.applePayPluginId=applePayPluginId:params.applePayBillerId=applePayBillerId;params.displayName=getAddOnKeyValue(findAddOn("applePayMerchantName"));params.domainName=getCurrentWindowLocation().hostname;params.validationURL=event.validationURL;var data=JSON.stringify(params);var response=httpMethod("".concat(providerUrl,"/Plugin/ApplePaySession"),data).then(function(data){if(data.result==="SUCCESS"){var merchantSessionObj=typeof data.message==="string"?JSON.parse(data.message):data.message;session.completeMerchantValidation(merchantSessionObj)}else{session.abort()}})};window.session=session;if(offer){displayPrices().then(function(){session.begin()})}else{session.begin()}}function getAppleItems(){var retObj={};retObj.appleItems=[];var lineItemShipPrice,lineItemTotalShipPrice=0;var appleDisplayName=getAddOnKeyValue(findAddOn("applePayMerchantName"));if(pageData.pageTypeId===4){var _JSON$parse3=JSON.parse(sessionStorage.getItem("totals")),grandTotal=_JSON$parse3.grandTotal,shipTotal=_JSON$parse3.shipTotal,salesTax=_JSON$parse3.salesTax,discount=_JSON$parse3.discount;shippingCostApplePayIncluded=shipTotal>0;retObj.appleTotal={"label":appleDisplayName,"type":"final","amount":grandTotal.toString()};var currentOrderItems=getOrderItemDetails();var currentOrderItemsEntries=Object.entries(currentOrderItems);var currentOrderItemsEntriesLength=currentOrderItemsEntries.length;for(var _i141=0;_i141<currentOrderItemsEntriesLength;_i141++){var campaignProductId=currentOrderItemsEntries[_i141][0];var _item18=currentOrderItemsEntries[_i141][1];var variantTitle=_item18.variant?" "+_item18.variant.title:"";var itemLabel=_item18.productName+variantTitle;var itemPrice=_item18.variant&&_item18.variant.price&&!_item18.isVariantBundle&&!_item18.isEditable?_item18.variant.price:_item18.cycle1_price;retObj.appleItems.push({"label":itemLabel,"type":"final","amount":getItemPrice(campaignProductId,itemPrice,_item18.currentOrderQuantity).toString()})}retObj.appleItems.push({"label":"Shipping","type":"final","amount":shipTotal.toString()});retObj.appleItems.push({"label":"Sales Tax","type":"final","amount":salesTax.toString()});retObj.appleItems.push({"label":"Discount","type":"final","amount":"-"+discount})}else{var _orderItems26=getUpsaleItems();if(Object.keys(_orderItems26).length){var total=0;var _shipTotal=0;var cpId=null;var variantId=null;var _itemLabel="";var _productData17=null;for(var upsaleItemCpId in _orderItems26){var _itemPrice=0;var shipPrice=0;if(upsaleItemCpId.indexOf(".")>0){_productData17=upsaleItemCpId.split(".");cpId=_productData17[0];variantId=_productData17[1]}else{cpId=upsaleItemCpId}var _item19=pageData.selectedCampaign.products.filter(function(data){return data.campaignProductId===parseInt(cpId)})[0];if(!_item19)continue;if(variantId&&_item19.variants&&_productData17&&_productData17.length>1){var variantDetails=_item19.variants.filter(function(data){return data.variantDetailId===parseInt(variantId)});if(variantDetails&&variantDetails.length>0){_itemLabel=_item19.productName+" "+variantDetails[0].title;_itemPrice=parseFloat(variantDetails[0].price)>0&&!_item19.isVariantBundle&&!_item19.isEditable?variantDetails[0].price:_item19.cycle1_price;shipPrice=parseFloat(variantDetails[0].shippingPrice)>0&&!_item19.isVariantBundle?variantDetails[0].shippingPrice:_item19.cycle1_shipPrice}}else{_itemLabel=_item19.productName;_itemPrice=_item19.cycle1_price;shipPrice=_item19.cycle1_shipPrice}lineItemShipPrice=getShipPrice(shipPrice,_orderItems26[upsaleItemCpId]);lineItemTotalShipPrice+=lineItemShipPrice;var itemTotal=(getItemPrice(upsaleItemCpId,_itemPrice,_orderItems26[upsaleItemCpId])+lineItemShipPrice).toFixed(2);total+=parseFloat(itemTotal);shippingCostApplePayIncluded=lineItemTotalShipPrice>0;retObj.appleItems.push({"label":_itemLabel,"type":"final","amount":itemTotal.toString()})}retObj.appleTotal={"label":appleDisplayName,"type":"final","amount":total.toString()}}}return retObj}}function configureLoyaltyLion(){var loyaltyLionPluginId=getAddOnKeyValue(findAddOn("loyaltyLionPluginId"));var loyaltyLionToken=getAddOnKeyValue(findAddOn("loyaltyLionToken"));if(!loyaltyLionPluginId||!loyaltyLionToken)return;!function(t,n){function o(n){var o=t.getElementsByTagName("script")[0],i=t.createElement("script");i.src=n,i.crossOrigin="",o.parentNode.insertBefore(i,o)}if(!n.isLoyaltyLion){window.loyaltylion=n,void 0===window.lion&&(window.lion=n),n.version=2,n.isLoyaltyLion=!0;var i=new Date,e=i.getFullYear().toString()+i.getMonth().toString()+i.getDate().toString();o("https://sdk.loyaltylion.net/static/2/loader.js?t="+e);var r=!1;n.init=function(t){if(r)throw new Error("Cannot call loyaltylion.init more than once");r=!0;var a=n._token=t.token;if(!a)throw new Error("Token must be supplied to loyaltylion.init");for(var l=[],s="_push configure bootstrap shutdown on removeListener authenticateCustomer".split(" "),c=0;c<s.length;c+=1)!function(t,n){t[n]=function(){l.push([n,Array.prototype.slice.call(arguments,0)])}}(n,s[c]);o("https://sdk.loyaltylion.net/sdk/start/"+a+".js?t="+e+i.getHours().toString()),n._initData=t,n._buffer=l}}}(document,window.loyaltylion||[]);var membership=null;var loginCustomer=null;var loyaltyLionAuthToken=sessionStorage.getItem("loyaltyLionAuthToken")?sessionStorage.getItem("loyaltyLionAuthToken"):null;membership=sessionStorage.getItem("membership")?JSON.parse(sessionStorage.getItem("membership")):null;loginCustomer=sessionStorage.getItem("loginCustomer")?JSON.parse(sessionStorage.getItem("loginCustomer")):null;if(loyaltyLionAuthToken&&(membership||loginCustomer)){var customerId=membership?membership.customerId:loginCustomer.customerId;var customerEmail=membership?membership.emailAddress:loginCustomer.emailAddress;var tokenData=loyaltyLionAuthToken.split("||");loyaltylion.init({token:loyaltyLionToken,customer:{id:customerId,email:customerEmail},auth:{date:tokenData[1],token:tokenData[0]}})}else{loyaltylion.init({token:loyaltyLionToken})}loyaltylion.on("ready",function(){loyaltylion.registerHook("customers.rewards.claimed",/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(_ref8){var claimedReward,obj,_data4,_response3,returnAction;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:claimedReward=_ref8.claimedReward;if(claimedReward.redeemable.code){obj={};obj.campaignId=parseInt(pageData.funnelData.campaign);obj.rewardsPluginId=loyaltyLionPluginId;obj.reward=JSON.stringify(claimedReward);_data4=JSON.stringify(obj);_response3=httpMethod("".concat(providerUrl,"/Import/Coupon"),_data4).then(function(data){if(data.result==="SUCCESS"){if(pageData.pageTypeId===4){appliedCouponCode.push(claimedReward.redeemable.code);displayPrices()}}})}returnAction=pageData.pageTypeId===4?"hide_claim_modal":"show_claim_modal";return _context6.abrupt("return",{action:returnAction});case 4:case"end":return _context6.stop()}},_callee6)}));return function(_x42){return _ref9.apply(this,arguments)}}())})}function configureReachBadge(){return _configureReachBadge.apply(this,arguments)}function _configureReachBadge(){_configureReachBadge=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee38(){var isCardInput,reachSandbox,reachProduction,reachUrl,reachResponse,reachJson,filterGenericBtnAndLink;return _regeneratorRuntime().wrap(function _callee38$(_context42){while(1)switch(_context42.prev=_context42.next){case 0:isCardInput=document.getElementsByName("cardNumber").length;if(!(isCardInput&&reachMerchantId)){_context42.next=21;break}$("head").append(reachBadgeStyles);reachSandbox="https://checkout.rch.how/v2.22/badge?MerchantId=";reachProduction="https://checkout.rch.io/v2.22/badge?MerchantId=";reachUrl=document.URL.includes("dev-funnels")?reachSandbox:reachProduction;_context42.prev=6;_context42.next=9;return fetch(reachUrl+reachMerchantId+"&Theme="+reachTheme+"&Locale="+reachLocale);case 9:reachResponse=_context42.sent;if(!reachResponse.ok){_context42.next=16;break}_context42.next=13;return reachResponse.json();case 13:reachJson=_context42.sent;filterGenericBtnAndLink=$("button[action=submit], a[action=submit]").filter(function(){var submitBtnCls=$(this).attr("class")||"";var submitBtnClsArr=submitBtnCls.split(" ");return!btnClasses.some(function(item){return submitBtnClsArr.includes(item)})});if(filterGenericBtnAndLink.length&&reachJson&&reachJson.Html){filterGenericBtnAndLink.each(function(i,btn){var tempElement=document.createElement("div");tempElement.innerHTML=reachJson.Html;var divEle=tempElement.querySelector("div");if(reachTheme==="dark"){divEle.style.backgroundColor="#424242";divEle.style.color="#aaa9ad"}btn.insertAdjacentElement("beforebegin",divEle)})}case 16:_context42.next=21;break;case 18:_context42.prev=18;_context42.t0=_context42["catch"](6);console.log(_context42.t0);case 21:case"end":return _context42.stop()}},_callee38,null,[[6,18]])}));return _configureReachBadge.apply(this,arguments)}function ccGetElementId(name){if(!name)return;var element=$("[name='"+name+"']");var id=element.length?element.attr("id")||element.attr("id","ccOE"+name)&&element.attr("id"):"";return id?"#"+id:id}function ccErrorResponse(proceed,errorMessage,errorTitle,data){return{proceed:proceed,errorMessage:errorMessage,errorTitle:errorTitle,data:data}}function ccOpenPathLoadSuccess(){var checkoutBtn=$(".cc-open-path-checkout");if(!checkoutBtn.length){console.warn("OpenPath routing button not configured");return}var checkoutBtnDataId=checkoutBtn.first().attr("data-id");var defualBillShipSameValue=false;if(document.getElementsByName("billShipSame")[0]){defualBillShipSameValue=document.getElementsByName("billShipSame")[0].checked?true:false}else if(document.getElementsByName("address1")[0]&&!document.getElementsByName("shipAddress1")[0]){defualBillShipSameValue=true}$("[name='shipCountry']").on("change",function(){!$(this).val()&&$(this).val(defaultCountryCode||"US")});var widget=new openElements(ccOpenPathUser,{enableECheck:false,paymentType:"SALE",shipping:{"country":"US"},sameShippingToBillingAddress:defualBillShipSameValue});widget.attach({payment:"open-elements-form",process:"open-elements-button",shippingAddress:"open-elements-shipping",billingAddress:"open-elements-billing",terms:"open-elements-terms",notification:"open-elements-notification-div"});var connectionObj={},shippingObj={},billingObj={};if($("[name='emailAddress']").length)connectionObj["email"]=ccGetElementId("emailAddress");if($("[name='phoneNumber']").length)connectionObj["phone"]=ccGetElementId("phoneNumber");if($("[name='billShipSame']").length)connectionObj["sameShippingToBillingAddress"]=ccGetElementId("billShipSame");if($("[name='shipAddress1']").length)shippingObj["address1"]=ccGetElementId("shipAddress1");if($("[name='shipAddress2']").length)shippingObj["address2"]=ccGetElementId("shipAddress2");if($("[name='shipCity']").length)shippingObj["city"]=ccGetElementId("shipCity");if($("[name='shipState']").length)shippingObj["state"]=ccGetElementId("shipState");if($("[name='shipPostalCode']").length)shippingObj["postalCode"]=ccGetElementId("shipPostalCode");if($("[name='shipCountry']").length)shippingObj["country"]=ccGetElementId("shipCountry");if($("[name='shipFirstName']").length)shippingObj["firstname"]=ccGetElementId("shipFirstName");if($("[name='shipLastName']").length)shippingObj["lastname"]=ccGetElementId("shipLastName");if($("[name='address1']").length)billingObj["address1"]=ccGetElementId("address1");if($("[name='address2']").length)billingObj["address2"]=ccGetElementId("address2");if($("[name='city']").length)billingObj["city"]=ccGetElementId("city");if($("[name='state']").length)billingObj["state"]=ccGetElementId("state");if($("[name='postalCode']").length)billingObj["postalCode"]=ccGetElementId("postalCode");if($("[name='country']").length)billingObj["country"]=ccGetElementId("country");if($("[name='firstName']").length)billingObj["firstname"]=ccGetElementId("firstName");if($("[name='lastName']").length)billingObj["lastname"]=ccGetElementId("lastName");if(Object.keys(shippingObj).length)connectionObj["shipping"]=shippingObj;if(Object.keys(billingObj).length)connectionObj["billing"]=billingObj;$("[name='billShipSame']").on("change",function(){widget.setSameShippingToBillingAddress($(this).prop("checked"))});widget.connect(connectionObj);widget.beforeSend(/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(data){var callData,gatewaySdkParams;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:_context7.prev=0;if(!fflPopUpRequired(checkoutBtnDataId)){_context7.next=5;break}updateFFLModalButtonCSS(checkoutBtnDataId);showFFLPopUp();return _context7.abrupt("return",ccErrorResponse(false,"Select a FFL address","FFL",data));case 5:sessionStorage.setItem("paySource","OPENPATH_IPAY");_context7.next=8;return callMethodApply(checkoutBtnDataId);case 8:callData=_context7.sent;gatewaySdkParams=callData&&callData.result==="SUCCESS"&&callData.message&&callData.message.gatewaySdkParams;enableInteractions();if(!gatewaySdkParams){_context7.next=13;break}return _context7.abrupt("return",{proceed:true,data:_objectSpread(_objectSpread({},data),{},{currency:gatewaySdkParams.currency,orderId:gatewaySdkParams.orderId,order_id:gatewaySdkParams.orderId,total:parseFloat(gatewaySdkParams.total),total_amount:parseFloat(gatewaySdkParams.total),is_recurring:true})});case 13:sessionStorage.removeItem("paySource");return _context7.abrupt("return",ccErrorResponse(false,data&&data.message||"","Error",data));case 17:_context7.prev=17;_context7.t0=_context7["catch"](0);enableInteractions();sessionStorage.removeItem("paySource");return _context7.abrupt("return",ccErrorResponse(false,_context7.t0&&_context7.t0.message||"","Error",data));case 22:case"end":return _context7.stop()}},_callee7,null,[[0,17]])}));return function(_x43){return _ref10.apply(this,arguments)}}());widget.start().then(function(transactionData){sessionStorage.setItem("paySource","OPENPATH_IPAY");var openElementFormDetails=JSON.stringify(transactionData);callMethodApply(checkoutBtnDataId,null,openElementFormDetails)})["catch"](function(err){enableInteractions();sessionStorage.removeItem("paySource");console.log(err)})}function ccOpenPathLoadFailure(){ccShowBSAlert("Open Path script load failed","cc-open-path-alert",true,alertColorClass="alert-danger",boldText="Alert :")}function ccIframeResizerLoaded(){var openPathUrl="https://elements.openpath.io/open-element.4.0.0.js";loadScript(openPathUrl,ccOpenPathLoadSuccess,false,false,null,[{key:"async",value:true}],null,ccOpenPathLoadFailure)}function ccLoadOpenPathScript(){try{if(pageData&&pageData.pageTypeId===4&&ccOpenPathId&&ccOpenPathUser&&$("[name='emailAddress']").length&&$("[name='phoneNumber']").length){$(".cc-open-path-checkout").attr("onclick","");$(".cc-open-path-checkout").hide();$("head").append("<link rel=\"stylesheet\" href=\"https://elements.openpath.io/open-element.4.0.0.css\">");var iframeResizerUrl="https://elements.openpath.io/iframeResizer.min.js";loadScript(iframeResizerUrl,ccIframeResizerLoaded,false,false,null,[{key:"async",value:true}],null,ccOpenPathLoadFailure)}}catch(err){console.log(err)}}function addValuesInExternalURL(route){try{if(route.includes("{")){var _orderData9=JSON.parse(sessionStorage.getItem("orderData"));if(_orderData9){["customerId"].forEach(function(value){if(_orderData9[value]){route=route.replace("{"+value+"}",_orderData9[value])}})}}}catch(er){}return route}function addOrderIdInExternalURL(route,orderId){if(orderId&&route&&!route.includes("orderId=")){route+=(route.includes("?")?"&":"?")+"orderId="+orderId.replace(/"/g,"")}return route}function handleMaskedInputChange(e){var name=e.target.getAttribute("name");switch(e.keyCode){// allows navigating thru input
case 20:// caplocks
case 17:// control
case 18:// option
case 16:// shift
case 37:// arrow keys
case 9:// tab (let blur handle tab)
return}var placeholder=e.target.getAttribute("placeholder");if(e.keyCode==8&&(e.target.value.length==2||e.target.value.length==3)&&placeholder.toUpperCase().substr(0,3)=="MM/"){document.getElementsByName(name)[0].value=e.target.value.substr(0,2)}else{document.getElementsByName(name)[0].value=handleCurrentValue(e)}}function handleCurrentValue(e){var placeholder=e.target.getAttribute("placeholder");if(e.target.getAttribute("name")==="phoneNumber"){var phoneNumberFormat=e.target.getAttribute("format");placeholder=phoneNumberFormat||placeholder}if(e.target.getAttribute("name")==="cardDate"){var cardDateSplit=placeholder.split("/");if(cardDateSplit&&cardDateSplit.length>1){placeholder=cardDateSplit[1].length===2?"MM/YY":"MM/YYYY"}else{placeholder="MMYY"}}var value=e.target.value,l=placeholder.length;var i,j,isInt,newValue="",isLetter,strippedValue;var maskedNumber="dDmMyY0123456789";// strip special characters
strippedValue=value.replace(integerRegex,"");var matchesNumber;for(i=0,j=0;i<l;i++){isInt=!isNaN(parseInt(strippedValue[j]));isLetter=strippedValue[j]?strippedValue[j].match(alphabetsRegex):false;matchesNumber=maskedNumber.indexOf(placeholder[i])>=0;if(matchesNumber&&isInt){newValue+=strippedValue[j++]}else if(matchesNumber&&!isInt){return newValue}else{newValue+=placeholder[i]}// break if no characters left and the pattern is non-special character
if(strippedValue[j]==undefined){break}}if(value==""){newValue=""}if(e.target.dataset.validDataExample){var retval=validateProgress(e,newValue);return retval}return newValue}function validateProgress(e,value){var validExample=e.target.dataset.validDataExample,pattern=new RegExp(e.target.dataset.pattern),placeholder=e.target.getAttribute("placeholder");var testValue="";//convert to months
if(value.length==1&&placeholder.toUpperCase().substr(0,2)=="MM"){if(value>1&&value<10){value="0"+value}return value}if(value.length==2&&placeholder.toUpperCase().substr(0,3)=="MM/"){return value+"/"}// test the value, removing the last character, until what you have is a submatch
for(i=value.length;i>=0;i--){testValue=value+validExample.substr(value.length);if(pattern.test(testValue)){return value}else{value=value.substr(0,value.length-1)}}return value}function isRouteAppReady(){var ready=true;try{routeapp}catch(e){ready=false}return ready}function calculateShipInsurance(subTotal){var routePluginKey=getAddOnKeyValue(findAddOn("routePluginKey"));if(subTotal===undefined){subTotal=0}var currencyCode=returnCurrencyCode()||pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.currency||"";var updateInsuranceInTotal=function updateInsuranceInTotal(insurance){var _JSON$parse4=JSON.parse(sessionStorage.getItem("totals")),subTotal=_JSON$parse4.subTotal,vat=_JSON$parse4.vat,salesTax=_JSON$parse4.salesTax,shipTotal=_JSON$parse4.shipTotal,discount=_JSON$parse4.discount,savings=_JSON$parse4.savings,compareAtTotal=_JSON$parse4.compareAtTotal;prepareTotals(parseFloat(subTotal),parseFloat(vat),parseFloat(salesTax),parseFloat(shipTotal),parseFloat(discount),parseFloat(insurance),parseFloat(savings),parseFloat(compareAtTotal));displayPricesApply()};if(routePluginKey&&subTotal>=0&&currencyCode.length===3&&isRouteAppReady()){routeapp.get_quote(routePluginKey,subTotal,currencyCode,function(insuranceDetails){document.getElementById("shipmentInsurancePrice").value=0;if(insuranceDetails.insurance_selected){document.getElementById("shipmentInsurancePrice").value=insuranceDetails.insurance_price;document.getElementsByName("insureShipment")[0].checked=true}updateInsuranceInTotal(document.getElementById("shipmentInsurancePrice").value)});routeapp.on_insured_change(function(insuranceDetails){document.getElementsByName("insureShipment")[0].checked=false;document.getElementById("shipmentInsurancePrice").value=0;if(insuranceDetails.insurance_selected){document.getElementById("shipmentInsurancePrice").value=insuranceDetails.insurance_price;document.getElementsByName("insureShipment")[0].checked=true}updateInsuranceInTotal(document.getElementById("shipmentInsurancePrice").value)})}}function hideInsureShipmentCheckbox(){// Hide checkbox from builder
document.getElementsByName("insureShipment")[0].style.display="none";document.getElementsByName("insureShipment")[0].nextElementSibling.style.display="none"}function facebookCustomerChat(){var facebookPageId=getAddOnKeyValue(findAddOn("FB_Page_Id"));var enableChatPlugin=getAddOnKeyValue(findAddOn("ENABLE_CHAT_PLUGIN"));if(facebookPageId&&enableChatPlugin==="1"){var fbRoot=document.createElement("div");fbRoot.id="fb-root";var chatbox=document.createElement("div");chatbox.id="fb-customer-chat";chatbox["class"]="fb-customerchat";fbRoot.appendChild(chatbox);$("body").append(fbRoot);chatbox=document.getElementById("fb-customer-chat");chatbox.setAttribute("class","fb-customerchat");chatbox.setAttribute("page_id",facebookPageId);chatbox.setAttribute("attribution","biz_inbox");window.fbAsyncInit=function(){FB.init({xfbml:true,version:"v10.0"})};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/en_US/sdk/xfbml.customerchat.js";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk")}}function hideFBCheckboxPlugin(){// Hide checkbox from builder
document.getElementsByName("messenger")[0].style.display="none";document.getElementsByName("messenger")[0].nextElementSibling.style.display="none"}function configureFBMessengerCheckboxPlugin(){var fbCheckboxPlugin=document.getElementsByName("messenger")[0];var facebookAppId=getAddOnKeyValue(findAddOn("FB_App_Id"));var facebookPageId=getAddOnKeyValue(findAddOn("FB_Page_Id"));if(fbCheckboxPlugin&&facebookAppId&&facebookPageId){loadScript("https://connect.facebook.net/en_US/sdk.js");window.fbAsyncInit=function(){FB.init({appId:facebookAppId,autoLogAppEvents:true,xfbml:true,version:"v10.0"})};var input=document.createElement("input");input.type="hidden";input.id="fbMessengerCheckbox";document.forms[0].append(input);var div=document.createElement("div");div.setAttribute("class","fb-messenger-checkbox");div.setAttribute("origin",window.location.origin);div.setAttribute("page_id",facebookPageId);div.setAttribute("messenger_app_id",facebookAppId);div.setAttribute("user_ref",userRef);div.setAttribute("allow_login","true");div.setAttribute("size","small");div.setAttribute("skin","light");div.setAttribute("center_align","true");fbCheckboxPlugin.insertAdjacentElement("beforebegin",div);hideFBCheckboxPlugin()}else{var isBuildOrTemplate=checkBuildOrTemplate();!isBuildOrTemplate&&fbCheckboxPlugin&&hideFBCheckboxPlugin()}}function confirmOptIn(){return _confirmOptIn.apply(this,arguments)}function _confirmOptIn(){_confirmOptIn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee39(){var facebookAppId,facebookPageId,fbCheckboxPlugin;return _regeneratorRuntime().wrap(function _callee39$(_context43){while(1)switch(_context43.prev=_context43.next){case 0:facebookAppId=getAddOnKeyValue(findAddOn("FB_App_Id"));facebookPageId=getAddOnKeyValue(findAddOn("FB_Page_Id"));fbCheckboxPlugin=document.getElementsByName("messenger")[0];if(!(fbCheckboxPlugin&&facebookAppId&&facebookPageId)){_context43.next=6;break}_context43.next=6;return FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,{"app_id":facebookAppId,"page_id":facebookPageId,"user_ref":userRef});case 6:case"end":return _context43.stop()}},_callee39)}));return _confirmOptIn.apply(this,arguments)}function configureRoutePlugin(){var insureShipment=document.getElementsByName("insureShipment")[0];var routePluginKey=getAddOnKeyValue(findAddOn("routePluginKey"));if(insureShipment&&routePluginKey&&document.getElementsByName("cardNumber")[0]&&pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.insureShipId>0){var input=document.createElement("input");input.type="hidden";input.id="shipmentInsurancePrice";document.forms[0].append(input);// Append Route Checkbox Widget
var div=document.createElement("div");div.id="RouteWidget";insureShipment.checked&&div.setAttribute("data-default-checked",true);document.getElementsByName("insureShipment")[0].insertAdjacentElement("beforebegin",div);hideInsureShipmentCheckbox();loadScript("https://cdn.routeapp.io/route-widget/stable/route-widget-stable.min.js",displayPrices)}else{var isBuildOrTemplate=checkBuildOrTemplate();!isBuildOrTemplate&&insureShipment&&hideInsureShipmentCheckbox()}}function handleCouponSplit(){var couponCodes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";couponCodes=couponCodes.trim();return couponCodes!=""?couponCodes.split(","):[]}function setOrderDataForFinalizeTransaction(urlOrderData){sessionStorage.setItem("orderData",JSON.stringify(urlOrderData));sessionStorage.setItem("orderId",JSON.stringify(urlOrderData.orderId));window.history.replaceState(null,null,window.location.pathname);if(sessionStorage.getItem("multiPayRoute")&&sessionStorage.getItem("multiPayRebillProductId")){addOverlayEffectScripts();showOverlayEffect();processMultiPayRebill(urlOrderData)}}function ccUpdateProductPrices(){var items=pageData&&pageData.cartData&&pageData.cartData.items;items&&items.forEach(function(item){pageData.selectedCampaign.products.find(function(product){if(product.campaignProductId===item.campaignProductId){var _price6=parseFloat(item.unitPrice);if(item.variantId){product.variants&&product.variants.length&&product.variants.find(function(variant){if(variant.variantDetailId===item.variantId){variant.price=_price6;variant.compareAtPrice=_price6;return true}})}else{product.cycle1_price=_price6;product.cycle2_price=_price6;product.compareAtPrice=_price6}return true}})})}function swapCartProducts(){return _swapCartProducts.apply(this,arguments)}function _swapCartProducts(){_swapCartProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee40(){var pageProducts,extVarDetailProduct,campaignId,pageElements,pageTypeId,merchantRedirectfkCart,merchantRedirectUpsalefkCart,cc3dsPageSubmitDetails,isFinalizeTransaction,urlOrderId,sessionKeys,errorMessage,_orderId10,payload,_data12,orderDataString,orderData,orderStatus,exchangeRate,sendingCurrencyTxn,sessionItemCpId,_productData22,globalRecommendations,orderItems,orderItemsLength,prevSuggestions,recommendationOption,recommendationValue,orderItemsIds,_i151,_confirmOption2,currentItem,currentItemProductId,pageProductIds,cartId,campaignFirstProduct,productHashMap,searchProducts,searchExternal,importedProducts,_params3,_response10,_data13,rebillCartCleanup,rebillCartExists,_loop42,_sessionItemCpId2,pageProductIdCollection,_params4,sessionCustomCart,customCartLength,extVar,_sessionItemCpId3,_productData24,itemKey,_product20,extVariantKey,extVariantId,newProductId,_i152,_cartKey,_itemKey2,_sessionItemCpId4,ckey,customCartData,_product21,_sessionItemCpId5,_productData25,_itemKey3,qty;return _regeneratorRuntime().wrap(function _callee40$(_context45){while(1)switch(_context45.prev=_context45.next){case 0:pageProducts=[];extVarDetailProduct=[];campaignId=pageData.selectedCampaign.campaignId;pageElements=document.querySelectorAll("button, a, input[type='radio'], input[type='checkbox'], .fk-product-section, select[name='productSelect']");pageElements.forEach(function(element){if(element.name==="productSelect"){var options=_toConsumableArray(element.childNodes);var productIds=[];options.forEach(function(opt){opt.value&&opt.value!==""&&pageProducts.push(opt.value)})}else if(!["shipProfileId"].includes(element.name)){var offer=element.getAttribute("offer"),upsell=element.getAttribute("upsell"),value=element.getAttribute("value");if(offer&&parseInt(offer)>0)pageProducts.push(offer);else if(upsell&&parseInt(upsell)>0)pageProducts.push(upsell);else if(value&&parseInt(value)>0)pageProducts.push(value)}});pageTypeId=pageData&&pageData.pageTypeId;merchantRedirectfkCart=sessionStorage.getItem("merchantRedirectfkCart");sessionStorage.removeItem("merchantRedirectfkCart");merchantRedirectUpsalefkCart=sessionStorage.getItem("merchantRedirectUpsalefkCart");cc3dsPageSubmitDetails=sessionStorage.getItem("cc3dsPageSubmitDetails");cc3dsPageSubmitDetails=cc3dsPageSubmitDetails?JSON.parse(cc3dsPageSubmitDetails):null;sessionStorage.removeItem("cc3dsPageSubmitDetails");isFinalizeTransaction=ccUrlParams.has("finalizeTransaction")&&ccUrlParams.get("finalizeTransaction")==="1";urlOrderId=ccUrlParams.has("orderId");if(!(urlOrderId&&(isFinalizeTransaction||pageTypeId===5))){_context45.next=31;break}if(isFinalizeTransaction){sessionKeys=Object.keys(sessionStorage);sessionKeys.forEach(function(key){if(key.indexOf("custom_")===0)sessionStorage.removeItem(key)});if(merchantRedirectUpsalefkCart){mergeOfferUpsale(JSON.parse(merchantRedirectUpsalefkCart))}}errorMessage="Error retrieving order details. Reason: ";_context45.prev=17;_orderId10=ccUrlParams.get("orderId");_orderId10=_orderId10&&_orderId10.trim();if(!_orderId10){_context45.next=26;break}payload=JSON.stringify({"orderId":_orderId10,"finalizeTransaction":1});_context45.next=24;return httpMethod("".concat(providerUrl,"/ClubMembership/OrderQueryByOrderId"),payload);case 24:_data12=_context45.sent;if(_data12&&_data12.result==="SUCCESS"){sessionStorage.setItem("products",JSON.stringify(_data12.message.items));setOrderDataForFinalizeTransaction(_data12.message);if(isFinalizeTransaction){registerClick(1,null,cc3dsPageSubmitDetails);if(merchantRedirectfkCart){sessionStorage.setItem("checkoutOrderData",JSON.stringify({items:_data12.message.items,totalAmount:_data12.message.totalAmount,taxTotal:_data12.message.taxTotal,shipTotal:_data12.message.shipTotal}));sessionStorage.setItem("importOrderSuccess",true);ccTrackSygnalEvents&&sessionStorage.setItem("importOrderSuccessSygnal",true);getProvidersData(1)&&sessionStorage.setItem("importOrderSuccessGA",true);getProvidersData(3)&&sessionStorage.setItem("importOrderSuccessSC",true)}else if(merchantRedirectUpsalefkCart&&orderPurchaseEvent){sessionStorage.setItem("importUpsellSuccess",true);ccTrackSygnalEvents&&sessionStorage.setItem("importUpsellSuccessSygnal",true);getProvidersData(1)&&sessionStorage.setItem("importUpsellSuccessGA",true);getProvidersData(3)&&sessionStorage.setItem("importUpsellSuccessSC",true)}}}else if(_data12&&_data12.result==="ERROR"){alert(errorMessage+_data12.message)}case 26:_context45.next=31;break;case 28:_context45.prev=28;_context45.t0=_context45["catch"](17);alert(errorMessage+_context45.t0.message);case 31:orderDataString=sessionStorage.getItem("orderData");orderData=orderDataString&&JSON.parse(orderDataString);orderStatus=orderData&&["COMPLETE","PENDING","COD_PENDING"].includes(orderData.orderStatus);if(orderStatus){exchangeRate=Number(sessionStorage.getItem("exchangeRate"))||1;sendingCurrencyTxn=orderData.currencyCode===(returnCurrencyCode()||pageData.selectedCampaign.currency);ccProductPercentageValue=Number((Number(orderData.subTotal)*(sendingCurrencyTxn?1:exchangeRate)).toFixed(2))||0;sessionStorage.setItem("ccCartProductsPercentageTotal",ccProductPercentageValue)}ccConfigureAndInitializeAgeVerificationScript();pageTypeId===3&&pageProducts.forEach(function(item){if(Number(item))ccUpsellPageFFLProducts[item]=1});fkCart=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):{};if(fkCart&&Object.keys(fkCart).length>0){for(sessionItemCpId in fkCart){_productData22=sessionItemCpId.split("~");if(_productData22.length>1){pageProducts.push(_productData22[1].split(".")[0])}else{pageProducts.push(sessionItemCpId.split(".")[0])}}}globalRecommendations=globalOrderData&&globalOrderData.recommendedProducts&&globalOrderData.recommendedProducts.length?globalOrderData.recommendedProducts:null;orderItems=globalOrderData&&globalOrderData.items;orderItemsLength=orderItems&&Object.keys(orderItems).length;prevSuggestions=![4].includes(pageData.pageTypeId)&&sessionStorage.getItem("prevSuggestions")!==null?JSON.parse(sessionStorage.getItem("prevSuggestions")):[];recommendationOption=pageData.currentPage.pageProperties.find(function(property){return property.pageAttributeName==="RecommendationOption"});recommendationValue=recommendationOption&&recommendationOption.pageAttributeValue;orderItemsIds=[];if(orderItemsLength){for(_i151=0;_i151<orderItemsLength;_i151++){orderItemsIds[_i151]=orderItems[_i151]&&orderItems[_i151].productId.toString()}}if(ccDynamicProductSection&&recommendationValue){if(orderItemsLength&&pageData.pageTypeId===3&&[2,3].includes(Number(recommendationValue))){prevSuggestions=ccSetRecommendationFromCart(orderItems,recommendationValue,prevSuggestions)}else if([0,1].includes(Number(recommendationValue))&&globalRecommendations){_confirmOption2=ccGetRecommendation(globalRecommendations,"",orderItemsIds,prevSuggestions);prevSuggestions=ccHandleConfirmOption(_confirmOption2,prevSuggestions)}}currentItem=![7,9].includes(pageTypeId)&&sessionStorage.getItem("currentItem");currentItem=pageTypeId===13?sessionStorage.getItem("actionCurrentItem"):currentItem;if(currentItem){currentItemProductId=currentItem.split(".")[0];pageProducts.push(currentItemProductId)}pageProductIds={};pageProducts=new Set(pageProducts);pageProducts=Array.from(pageProducts);cartId=pageData.pageTypeId===4&&sessionStorage.getItem("cartId");campaignFirstProduct=(dynamicOrderBump||ccDynamicProductSection)&&!pageProducts.length&&pageData.selectedCampaign.products.find(function(product,index){return index===0});campaignFirstProduct&&pageProducts.push(campaignFirstProduct.campaignProductId.toString());if(!(pageProducts.length>0||cartId)){_context45.next=96;break}productHashMap={};pageData&&pageData.selectedCampaign&&pageData.selectedCampaign.products&&pageData.selectedCampaign.products.forEach(function(product){productHashMap[product.campaignProductId]=product;var extProductId=product.externalProductId;extProductId?productHashMap[extProductId]=product:null});searchProducts=[];searchExternal=[];pageProducts.forEach(function(sessionItemCpId){if(sessionItemCpId.startsWith("EXT")){var extSessionItemCpId=sessionItemCpId.substring(3);if(!productHashMap[extSessionItemCpId]){searchExternal.push(extSessionItemCpId)}else{pageProductIds[productHashMap[extSessionItemCpId].campaignProductId]=extSessionItemCpId}}else{if(!productHashMap[sessionItemCpId]||currentItemProductId==sessionItemCpId){searchProducts.push(sessionItemCpId)}else{pageProductIds[sessionItemCpId]=sessionItemCpId}}});importedProducts=[];if(!(searchProducts.length>0||searchExternal.length>0)){_context45.next=79;break}//call campaign query API passing in the campaignId, list of products, and list of externals
_params3={};_params3.campaignId=campaignId;if(searchProducts.length>0)_params3.campaignProductId=searchProducts.join(",");if(searchExternal.length>0)_params3.externalProductId=searchExternal.join(",");_context45.prev=69;_context45.next=72;return httpMethod("".concat(providerUrl,"/Import/CampaignQuery"),JSON.stringify(_params3));case 72:_response10=_context45.sent;if(_response10&&_response10.result==="SUCCESS"){_data13=_response10.message&&_response10.message.data&&_response10.message.data[campaignId];if(_data13){importedProducts=_data13.products||[];//add the products returned to pageData.selectedCampaign.products
importedProducts.forEach(function(product){if(!productHashMap[product.campaignProductId]){pageData.selectedCampaign.products.push(product)}else if(product.campaignProductId==currentItemProductId){var currentItemIndex=pageData.selectedCampaign.products.findIndex(function(product){return product.campaignProductId==currentItemProductId});currentItemIndex!==-1?pageData.selectedCampaign.products[currentItemIndex]=product:null}productHashMap[product.campaignProductId]=product;var extProductId=product.externalProductId;var extVariantId=true;for(var externalId in searchExternal){if(extProductId==searchExternal[externalId]){productHashMap[extProductId]=product;extVariantId=false;break}}if(extVariantId){var _loop41=function _loop41(_externalId){var extVariant=product.variants.find(function(variant){return variant.externalVariantDetailId==searchExternal[_externalId]});if(extVariant&&extVariant.externalVariantDetailId){extVarDetailProduct[extVariant.externalVariantDetailId]=extVariant.variantDetailId;var campProdVariantId="EXTVAR"+extVariant.externalVariantDetailId;productHashMap[campProdVariantId]=product};};for(var _externalId in searchExternal){_loop41(_externalId)}}pageProductIds[product.campaignProductId]=product.campaignProductId});glOrderItems=null}}_context45.next=79;break;case 76:_context45.prev=76;_context45.t1=_context45["catch"](69);console.log(_context45.t1);case 79:rebillCartCleanup={};rebillCart=sessionStorage.getItem("rebillCart")!==null?JSON.parse(sessionStorage.getItem("rebillCart")):null;rebillCartExists=rebillCart&&Object.keys(rebillCart).length;if(!rebillCartExists){_context45.next=90;break}_loop42=/*#__PURE__*/_regeneratorRuntime().mark(function _loop42(_sessionItemCpId2){var cartKey,itemKey,_productData23,_product19,productForQuery,rebillProduct;return _regeneratorRuntime().wrap(function _loop42$(_context44){while(1)switch(_context44.prev=_context44.next){case 0:cartKey=_sessionItemCpId2.split("~");if(cartKey.length>1){itemKey=cartKey[1];_productData23=itemKey.split(".");//find the one time product (skip if product is recurring)
_product19=productHashMap[_productData23[0]];productForQuery=_product19.campaignProductId;if(_product19&&_product19.billingCycleType=="ONE_TIME"){//find the recurring product of same base product
rebillProduct=pageData.selectedCampaign.products.find(function(item){return item.productId==_product19.productId&&item.billingCycleType=="RECURRING"&&item.productName.toLowerCase().includes(rebillCart[_sessionItemCpId2].toLowerCase())});if(!rebillProduct){rebillProduct=pageData.selectedCampaign.products.find(function(item){return item.productId==_product19.productId&&item.billingCycleType=="RECURRING"})}if(rebillProduct){//change cart to rebill product
itemKey=_productData23.length>1?rebillProduct.campaignProductId+"."+_productData23[1]:rebillProduct.campaignProductId;productForQuery=rebillProduct.campaignProductId}}pageProductIds[productForQuery]=productForQuery;rebillCartCleanup[itemKey]=_sessionItemCpId2}case 2:case"end":return _context44.stop()}},_loop42)});_context45.t2=_regeneratorRuntime().keys(rebillCart);case 85:if((_context45.t3=_context45.t2()).done){_context45.next=90;break}_sessionItemCpId2=_context45.t3.value;return _context45.delegateYield(_loop42(_sessionItemCpId2),"t4",88);case 88:_context45.next=85;break;case 90:pageData.selectedCampaign.products.forEach(function(item){var campaignProductId=item.campaignProductId;if(item.clubPluginId&&!pageProductIds[campaignProductId]){pageProductIds[campaignProductId]=campaignProductId}});pageProductIdCollection=Object.keys(pageProductIds);// pageTypeId !== 3 && ccTrackProductViewEvent(pageProductIds);
if(pageProductIdCollection.length||cartId){try{_params4={campaignId:campaignId,campaignProductId:pageProductIdCollection.join(",")};if(cartId){_params4.cartId=cartId}httpMethod("".concat(providerUrl,"/Import/CampaignQuery"),JSON.stringify(_params4)).then(function(response){if(response&&response.result==="SUCCESS"){var _data14=response.message&&response.message.data&&response.message.data[campaignId];if(!_data14){return}ccCampaignProductsData=response.message.data[campaignId].products;var ccCartData=_data14.cartData;if(ccCartData){ccCartData.itemsInfo={};var items=ccCartData.items||[];var ccCartItems=getOrderItems();items.forEach(function(item){var productId=item.campaignProductId.toString();if(item.variantId){productId=productId+"."+item.variantId}if(ccCartItems[productId]){ccCartData.itemsInfo[productId]=true}});if(items.length){sessionStorage.setItem("ccShopifyProducts",JSON.stringify({currency:ccCartData.currency,itemsInfo:ccCartData.itemsInfo}))}ccCartData.cartId=cartId;pageData.cartData=ccCartData}var pageCrmProducts=_data14.products||[];var pageCrmProductIds={};pageCrmProducts.forEach(function(prod){pageCrmProductIds[prod.campaignProductId]=1});var pageDataProducts=pageData.selectedCampaign.products.filter(function(product){if(!pageProductIds[product.campaignProductId]&&!pageCrmProductIds[product.campaignProductId]){return true}});pageData.selectedCampaign=_data14;ccUpdateCampaignId();var currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;ccSetCurrencyRules(currencyCode);var productsCollection=pageCrmProducts.concat(pageDataProducts);pageData.selectedCampaign.products=productsCollection;glOrderItems=null;var validDynamicUpsell=!recommendationFlag&&pageData.pageTypeId===3&&[0,1].includes(Number(recommendationValue));if(![13,18,34].includes(pageData.pageTypeId)&&(ccDynamicProductSection||dynamicOrderBump)){if(validDynamicUpsell||pageData.pageTypeId!==3)ccSetRecommendation(pageProductIdCollection,prevSuggestions,orderItemsIds,globalRecommendations)}initializeCountryStates();replaceTokens();loadVariants();var productVariantElement=document.getElementsByClassName("fk-product-variant-select")[0];if(productVariantElement){productVariantElement.removeAttribute("name");constructProductVariantElement("",productVariantElement)}setUnselectedTiles();showVariantImageOnProductSection();if(pageData.pageTypeId===4&&document.getElementsByName("cardNumber").length){getVariants()}ccProductSectionsOnPage&&enableInteractions();pageData.cartData&&ccUpdateProductPrices();displayPrices()}else{ccProductSectionsOnPage&&enableInteractions()}})}catch(error){ccProductSectionsOnPage&&enableInteractions();console.log(error)}}else{ccProductSectionsOnPage&&enableInteractions()}if(fkCart&&Object.keys(fkCart).length>0){sessionCustomCart=sessionStorage.getItem("customCart");customCart=sessionCustomCart&&sessionCustomCart!=="undefined"&&sessionCustomCart!=="null"?JSON.parse(sessionStorage.getItem("customCart")):{};customCartLength=Object.keys(customCart).length;//replace cart external id with campaign product id
extVar=[];for(_sessionItemCpId3 in fkCart){_productData24=_sessionItemCpId3.split("~");itemKey=_productData24[0].startsWith("EXT")?_productData24[0].substring(3):null;itemKey=_productData24.length>1&&_productData24[1].startsWith("EXT")?_productData24[1].substring(3):itemKey;if(itemKey){_product20=void 0;extVariantKey="EXTVAR"+itemKey;if(productHashMap[extVariantKey]&&!extVar[extVariantKey]){_product20=productHashMap[extVariantKey];extVar[extVariantKey]=1}else{_product20=productHashMap[itemKey]}if(_product20){extVariantId=extVarDetailProduct[itemKey];newProductId=extVariantId?_product20.campaignProductId+"."+extVariantId:_product20.campaignProductId;fkCart[newProductId]=fkCart[_sessionItemCpId3];delete fkCart[_sessionItemCpId3];if(customCartLength){for(_i152=0;_i152<customCartLength;_i152++){_cartKey=customCart[_i152].split("|");if(_cartKey[0]==_productData24[1]){_cartKey[0]=_product20.campaignProductId;customCart[_i152]=_cartKey.join("|")}}sessionStorage.setItem("customCart",JSON.stringify(customCart))}}}}//swap to recurring products
if(rebillCartExists){for(_itemKey2 in rebillCartCleanup){_sessionItemCpId4=rebillCartCleanup[_itemKey2];fkCart[_itemKey2]=fkCart[_sessionItemCpId4];rebillCart[_itemKey2]=rebillCart[_sessionItemCpId4];if(customCartLength){for(ckey in customCart){customCartData=customCart[ckey]&&customCart[ckey].split("|")||[];_product21=_sessionItemCpId4.split("~")[1];if(_product21&&customCartData[0]&&_product21===customCartData[0]){customCartData[0]=_itemKey2;customCart[ckey]=customCartData.join("|")}}sessionStorage.setItem("customCart",JSON.stringify(customCart))}delete fkCart[_sessionItemCpId4];delete rebillCart[_sessionItemCpId4]}sessionStorage.setItem("rebillCart",JSON.stringify(rebillCart))}//remove any remaining tilde in the cart
for(_sessionItemCpId5 in fkCart){_productData25=_sessionItemCpId5.split("~");if(_productData25.length>1){_itemKey3=_productData25[1];qty=fkCart[_itemKey3]?fkCart[_itemKey3]:0;fkCart[_itemKey3]=(parseInt(fkCart[_sessionItemCpId5])+parseInt(qty)).toString();delete fkCart[_sessionItemCpId5];fkCart=isSubscribeOn?swapSubscriptions(fkCart,_sessionItemCpId5):fkCart}}sessionStorage.setItem("fkCart",JSON.stringify(fkCart))}_context45.next=97;break;case 96:ccProductSectionsOnPage&&enableInteractions();case 97:case"end":return _context45.stop()}},_callee40,null,[[17,28],[69,76]])}));return _swapCartProducts.apply(this,arguments)}function setUnselectedTiles(){var productSections=$(".fk-variant-tile");var productSectionsLength=productSections.length;if(productSectionsLength){for(var _i142=0;_i142<productSectionsLength;_i142++){var section=productSections[_i142];for(var j=1;j<=3;j++){var variants=$(section).find("[data-selected=true][name=variant"+j+"]");if(!variants.length){var nonSelectedTitle=$(section).find("[data-selected=false][name=variant"+j+"]").first();if(nonSelectedTitle.length&&nonSelectedTitle[0].offsetHeight>0){nonSelectedTitle.click()}}}}}}function ccSetAltValues(element){try{var altValue=element.attr("altvalue");if(altValue){var productValue=element.attr("value");var offer=element.attr("offer");var upsell=element.attr("upsell");productValue=parseInt(offer)>0?offer:parseInt(upsell)>0?upsell:productValue;var variantValue=element.attr("variantvalue");if(variantValue)productValue=productValue+"."+variantValue;var quantity=element.attr("quantity");var unitPrice=element.attr("price");quantity=quantity?quantity:1;unitPrice=unitPrice?unitPrice:0;altValues[productValue+"|"+quantity]=quantity+"|"+unitPrice+"|"+altValue}}catch(err){err}}function loadAltValues(){var productElements=$(".fk-product-radio, .fk-product-checkbox, button, a");$(productElements).each(function(){ccSetAltValues($(this))})}function getItemPrice(productValue,unitPrice,quantity,skipTax,skipExchangeRate){//convert unitPrice to current currency
var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;var itemsInfo=pageData&&pageData.pageTypeId===4&&pageData.cartData&&pageData.cartData.itemsInfo&&pageData.cartData.itemsInfo[productValue];var shopifyCurrencyMatch=itemsInfo&&(returnCurrencyCode()||pageData.selectedCampaign.currency)===pageData.cartData.currency;if(itemsInfo&&shopifyCurrencyMatch||skipExchangeRate)exchangeRate=1;unitPrice=(parseFloat(unitPrice)*parseFloat(exchangeRate)).toFixed(2);var itemTotalPrice=parseFloat(unitPrice);var key=productValue+"|"+quantity;if(altValues[key]){var altValue=altValues[key].split("|");if(parseFloat(altValue[1])>0){itemTotalPrice=(parseFloat(altValue[1])*parseFloat(exchangeRate)).toFixed(2);quantity=1}}itemTotalPrice=shopifyCurrencyMatch?itemTotalPrice:ccRoundingPrice(itemTotalPrice);if(!skipTax){var taxParams=getTaxRate();if(taxParams.isVat){if(skipTax===false){itemTotalPrice*=taxParams.vatTaxRate}else{var currencyCode=returnCurrencyCode()||pageData.selectedCampaign.currency;var matchedCurrency=pageData.selectedCampaign.currencies&&pageData.selectedCampaign.currencies.find(function(currency){return currency.currencyCode==currencyCode});var vatPrices=sessionStorage.getItem("vatPrices")!==null&&JSON.parse(sessionStorage.getItem("vatPrices"));var productVatPrice=vatPrices&&parseFloat(vatPrices[productValue]&&vatPrices[productValue].replaceAll(",",""));productVatPrice=matchedCurrency&&!matchedCurrency.sendToGateway?parseFloat(productVatPrice)*parseFloat(exchangeRate):productVatPrice;itemTotalPrice=productVatPrice||itemTotalPrice;quantity=1}}}itemTotalPrice=itemTotalPrice*quantity;return itemTotalPrice}function getShipPrice(unitPrice,quantity,skipFixation,item){var exchangeRate=sessionStorage.getItem("exchangeRate")!==null?sessionStorage.getItem("exchangeRate"):1;unitPrice=parseFloat(unitPrice)*parseFloat(exchangeRate);var count=item&&item.itemCountThreshold?Math.min(parseInt(item.itemCountThreshold),quantity):quantity;var shipTotalPrice=parseFloat(skipFixation?unitPrice:unitPrice.toFixed(2))*count;return shipTotalPrice}function isFirstTime(){return window&&window.performance&&window.performance.navigation&&(window.performance.navigation.type===0||navigator.userAgent.indexOf("Firefox")!==-1&&window.performance.navigation.type===255)&&!ccUrlParams.has("token")}function getItemAlt(productValue,quantity){itemAlt=false;var key=productValue+"|"+quantity;if(altValues[key]){var altValue=altValues[key].split("|");itemAlt=altValue[2]}return itemAlt}function displayGatewayScripts(){$("afterpay-placement, affirm-placement").each(function(){$(this).remove()});var totals=JSON.parse(sessionStorage.getItem("totals"));if(totals){var grandTotal=totals.grandTotal;var payLaterBannerTagExists=$("div[data-pp-placement=product]").length;var afterPayDisplay=$(".afterpayButton").css("display")==="inline-block"?true:false;var selectedCurrency=returnCurrencyCode()||pageData.selectedCampaign.currency;afterPayDisplay&&$(".afterpayButton").each(function(){$(this).before("<afterpay-placement data-locale='en_US' data-currency='"+selectedCurrency+"' data-amount='"+grandTotal+"'></afterpay-placement>")});var affirmButtons=$(".affirmButton");var affirmUpdatedPrice=Math.trunc(grandTotal*100);// Covert $ to cents
var affirmElement="<affirm-placement class='affirm-as-low-as' style='display:block;' data-page-type='cart' data-amount='"+affirmUpdatedPrice+"'></affirm-placement>";var paypalPayLaterEnabled=parseInt(getAddOnKeyValue(findAddOn("PayPal_PayLater")));var paypalButtons=$(".btnPayPal2, .btnPayPal");var paypalPayLaterButtonExists=!payLaterBannerTagExists&&paypalButtons.length&&paypalPayLaterEnabled;var paypalPayLaterElement="<div data-pp-message data-pp-placement='product' data-pp-amount='"+grandTotal+"'></div>";var grandTotalElement=$(".grandTotal").filter(":not(.cc-cart-toggle .grandTotal)");if(grandTotalElement.length){var grandElementTotalParent=grandTotalElement.closest("div");paypalPayLaterButtonExists&&grandElementTotalParent.after(paypalPayLaterElement);affirmButtons.length&&grandElementTotalParent.after(affirmElement)}else{paypalPayLaterButtonExists&&paypalButtons.before(paypalPayLaterElement);affirmButtons.before(affirmElement)}if(payLaterBannerTagExists){$("div[data-pp-placement=product]").attr("data-pp-amount",grandTotal)}$("[data-pp-placement=product]").find("iframe").css({"opacity":1,"pointer-events":"auto"});if(window.hasOwnProperty("affirm")){affirm.ui.ready(function(){affirm.ui.refresh()})}}}function fetchNewProducts(eventType){var totalPrice=0;var contents=[];var orderData=JSON.parse(sessionStorage.getItem("orderData"));if(orderData&&orderData.hasOwnProperty("items")){var _fkCart3=sessionStorage.getItem("fkCart")!==null?JSON.parse(sessionStorage.getItem("fkCart")):[];var fkCartSent=sessionStorage.getItem("fkCartSent")!==null&&(eventType.toLowerCase()!=="purchase"||!isFirstTime())?JSON.parse(sessionStorage.getItem("fkCartSent")):[];var newItems=Object.keys(_fkCart3).filter(function(x){return!Object.keys(fkCartSent).includes(x)});if(newItems.length>0){orderData.items.forEach(function(item){var key=item.variantDetailId?item.productId.toString()+"."+item.variantDetailId.toString():item.productId.toString();if(newItems.includes(key)){contents.push({id:key,name:item.title?item.name+" "+item.title:item.name,quantity:parseInt(item.qty),price:item.price,sku:item.variantSku?item.variantSku:item.productSku,category:""});totalPrice+=parseFloat(item.price)}})}}var params={};params.event=eventType;params.transactionId=orderData?orderData.orderId:"";params.priceTotal=totalPrice.toFixed(2);params.currencyCode=orderData&&orderData.currencyCode||returnCurrencyCode()||pageData.selectedCampaign.currency;params.products=contents;if(eventType.toLowerCase()=="purchase"&&orderData&&orderData.shipAddress1){params.shippingAddress=orderData.shipAddress1;params.shippingAddress+=orderData.shipAddress2?" "+orderData.shipAddress2:"";params.shippingAddress+=" "+orderData.shipCity+" "+orderData.shipState+" "+orderData.shipCountry+" "+orderData.shipPostalCode}sessionStorage.setItem("fkCartSent",sessionStorage.getItem("fkCart"));return params}function fetchCartProducts(eventType){var totalPrice=0;var contents=[];var cartProducts=getOrderItemDetails();if(cartProducts&&Object.keys(cartProducts).length>0){var fkCartSent=sessionStorage.getItem("fkCartSent")!==null?JSON.parse(sessionStorage.getItem("fkCartSent")):[];var cartProductsEntries=Object.entries(cartProducts);var cartProductsEntriesLength=cartProductsEntries.length;for(var _i143=0;_i143<cartProductsEntriesLength;_i143++){var campaignProductId=cartProductsEntries[_i143][0];var _product18=cartProductsEntries[_i143][1];if(!fkCartSent[campaignProductId]){var unitPrice=_product18.variant&&parseFloat(_product18.variant.price)>0&&!_product18.isVariantBundle&&!_product18.isEditable?_product18.variant.price:_product18.cycle1_price;var _price7=getItemPrice(campaignProductId,unitPrice,_product18.currentOrderQuantity).toFixed(2);contents.push({id:campaignProductId.toString(),name:_product18.variant?_product18.productName+" "+_product18.variant.title:_product18.productName,quantity:_product18.currentOrderQuantity,price:_price7,sku:_product18.variant&&_product18.variant.productSku!==""?_product18.variant.productSku:_product18.productSku,category:""});totalPrice+=parseFloat(_price7)}}}var orderData=JSON.parse(sessionStorage.getItem("orderData"));var params={};params.event=eventType;params.transactionId=orderData?orderData.orderId:"";params.priceTotal=totalPrice.toFixed(2);params.currencyCode=orderData&&orderData.currencyCode||returnCurrencyCode()||pageData.selectedCampaign.currency;params.items=contents;sessionStorage.setItem("fkCartSent",sessionStorage.getItem("fkCart"));return params}function verifyShippingRequiredFields(required,paySource,requireAddressAddon){var baseFields;var orderItems=Object.values(getOrderItemDetails());var isOrderShippable=orderItems.some(function(item){return item.cycle1_isShippable});var address1Element=document.getElementsByName("address1")[0];var shipAddress1Element=document.getElementsByName("shipAddress1")[0];var shipProfile=getCurrentShipProfile();if(isOrderShippable&&requireAddressAddon==="true"&&(!shipProfile||shipProfile==="0")){baseFields=shipAddress1Element?["shipAddress1","shipCity","shipPostalCode"]:["address1","city","postalCode"]}else if(paySource==="PAYPAL"){if(shipAddress1Element){baseFields=shipAddress1Element.value?["shipCity","shipPostalCode"]:null}else if(address1Element){baseFields=address1Element.value?["city","postalCode"]:null}}if(baseFields){var countryField=shipAddress1Element?"shipCountry":"country";var country=document.getElementsByName(countryField)[0]?document.getElementsByName(countryField)[0].value:defaultCountryCode;if(["US","CA"].includes(country)){var stateField=shipAddress1Element?"shipState":"state";baseFields.push(stateField)}baseFields.forEach(function(name){var field=document.getElementsByName(name)[0];if(field){required.push(field)}})}}function setSplitSelected(currentPage){if(currentPage.splitReferenceId){sessionStorage.setItem(currentPage.splitReferenceId,window.location.href)}}function determineSplit(funnelReferenceId,splitReferenceId){var splitLoadedUrl=sessionStorage.getItem(splitReferenceId);if(splitLoadedUrl){return splitLoadedUrl}return"".concat(rootUrl,"/SplitTest/funnel/")+funnelReferenceId+"/split/"+splitReferenceId+"/redirect/true/funnelEnvironment/"+getEnvironment()}window.onbeforeunload=function(event){if(pageData.pageTypeId===3){// FUN2-3434 : HOTFIX Remove confirm order. User might click back which is triggering the below call
// let params = {};
// params.orderId = JSON.parse(sessionStorage.getItem("orderId"));
// httpMethod("${providerUrl}/import/order/confirm", JSON.stringify(params));
// FUN2-3384
var purchaseEventType=pageData.funnelData.addOns.find(function(_ref11){var keyName=_ref11.keyName;return keyName==="Purchase_Event_FB"}).keyValue;if(purchaseEventType!=2&&purchaseEventType!=3){if(window.ltk)callPurchaseEventForLisTrak(window.ltk)}}};